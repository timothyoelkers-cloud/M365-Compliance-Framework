[
  {
    "displayName": "CA01 | Block Legacy Authentication",
    "state": "enabledForReportingButNotEnforced",
    "conditions": {
      "users": {
        "includeUsers": [
          "All"
        ],
        "excludeUsers": [],
        "excludeGroups": []
      },
      "applications": {
        "includeApplications": [
          "All"
        ]
      },
      "clientAppTypes": [
        "exchangeActiveSync",
        "other"
      ]
    },
    "grantControls": {
      "operator": "OR",
      "builtInControls": [
        "block"
      ]
    },
    "_metadata": {
      "policyNumber": "CA01",
      "description": "Blocks all legacy authentication protocols including Exchange ActiveSync, SMTP AUTH, POP3, IMAP, and older Office clients that do not support modern authentication. Legacy auth cannot enforce MFA and is the primary vector for password-spray and credential-stuffing attacks.",
      "cisControls": [
        "CIS 5.2.2.3 - Ensure legacy authentication is not allowed",
        "CIS 6.5.1 - Ensure modern authentication for Exchange Online is enabled"
      ],
      "frameworkMappings": {
        "NIST-800-53": [
          "IA-2",
          "IA-5",
          "AC-17(2)"
        ],
        "CIS-Microsoft-365": [
          "5.2.2.3",
          "6.5.1"
        ],
        "ISO-27001-2022": [
          "A.8.5 - Secure authentication"
        ],
        "MITRE-ATT&CK": [
          "T1078 - Valid Accounts",
          "T1110 - Brute Force"
        ],
        "NIS2": [
          "Article 21(2)(j) - Multi-factor authentication"
        ],
        "Essential-Eight": [
          "Restrict administrative privileges"
        ]
      },
      "requiredLicenses": [
        "Microsoft Entra ID P1 or P2"
      ],
      "deploymentNotes": "Deploy in report-only first. Monitor sign-in logs under Entra > Monitoring > Sign-in logs, filter by Client App = 'Exchange ActiveSync' and 'Other clients' to identify remaining legacy auth usage before enforcing. Replace  with the Object ID of your break-glass exclusion security group."
    }
  },
  {
    "displayName": "CA02 | Require MFA for All Users",
    "state": "enabledForReportingButNotEnforced",
    "conditions": {
      "users": {
        "includeUsers": [
          "All"
        ],
        "excludeUsers": [],
        "excludeGroups": []
      },
      "applications": {
        "includeApplications": [
          "All"
        ]
      },
      "clientAppTypes": [
        "browser",
        "mobileAppsAndDesktopClients"
      ]
    },
    "grantControls": {
      "operator": "OR",
      "builtInControls": [
        "mfa"
      ]
    },
    "_metadata": {
      "policyNumber": "CA02",
      "description": "Requires multi-factor authentication for all users across all cloud applications. This is the foundational MFA policy and the single most effective control against identity compromise, blocking over 99.9% of account compromise attacks.",
      "cisControls": [
        "CIS 1.3.1 - Ensure MFA is required for all users in all cloud apps",
        "CIS 5.2.2.2 - Ensure multifactor authentication is enabled for all users in administrative roles",
        "CIS 5.3.1 - Ensure the Microsoft Authenticator app is configured to protect against MFA fatigue"
      ],
      "frameworkMappings": {
        "NIST-800-53": [
          "IA-2(1)",
          "IA-2(2)",
          "IA-2(6)"
        ],
        "CIS-Microsoft-365": [
          "1.3.1",
          "5.2.2.2",
          "5.3.1"
        ],
        "ISO-27001-2022": [
          "A.8.5 - Secure authentication"
        ],
        "MITRE-ATT&CK": [
          "T1078 - Valid Accounts",
          "T1556 - Modify Authentication Process"
        ],
        "NIS2": [
          "Article 21(2)(j) - Multi-factor authentication"
        ],
        "Essential-Eight": [
          "Multi-factor authentication"
        ],
        "SOC-2": [
          "CC6.1 - Logical and physical access controls"
        ]
      },
      "requiredLicenses": [
        "Microsoft Entra ID P1 or P2"
      ],
      "deploymentNotes": "Deploy in report-only first. Ensure all users have registered at least one MFA method via https://aka.ms/mfasetup before enforcing. Review the Authentication methods activity report in Entra admin centre. Replace  with the Object ID of your break-glass exclusion security group."
    }
  },
  {
    "displayName": "CA03 | Require Phishing-Resistant MFA for Admins",
    "state": "enabledForReportingButNotEnforced",
    "conditions": {
      "users": {
        "includeUsers": [],
        "excludeUsers": [],
        "includeRoles": [
          "62e90394-69f5-4237-9190-012177145e10",
          "e8611ab8-c189-46e8-94e1-60213ab1f814",
          "29232cdf-9323-42fd-ade2-1d097af3e4de",
          "f28a1f50-f6e7-4571-818b-6a12f2af6b6c",
          "fe930be7-5e62-47db-91af-98c3a49a38b1",
          "b0f54661-2d74-4c50-afa3-1ec803f12efe",
          "b1be1c3e-b65d-4f19-8427-f6fa0d97feb9",
          "729827e3-9c14-49f7-bb1b-9608f156bbb8",
          "c4e39bd9-1100-46d3-8c65-fb160da0071f",
          "7be44c8a-adaf-4e2a-84d6-ab2649e08a13",
          "9b895d92-2cd3-44c7-9d02-a6ac2d5ea5c3",
          "158c047a-c907-4556-b7ef-446551a6b5f7"
        ],
        "excludeGroups": []
      },
      "applications": {
        "includeApplications": [
          "All"
        ]
      },
      "clientAppTypes": [
        "browser",
        "mobileAppsAndDesktopClients"
      ]
    },
    "grantControls": {
      "operator": "OR",
      "authenticationStrength": {
        "id": "00000000-0000-0000-0000-000000000004"
      }
    },
    "_metadata": {
      "policyNumber": "CA03",
      "description": "Requires phishing-resistant MFA (FIDO2 security keys, Windows Hello for Business, or X.509 certificate-based authentication) for all privileged administrator roles. Standard MFA methods like SMS, voice call, or Authenticator app push notifications are insufficient for admin accounts due to real-time phishing (AiTM) attacks and MFA fatigue exploitation.",
      "adminRoleTemplateIds": {
        "62e90394-69f5-4237-9190-012177145e10": "Global Administrator",
        "e8611ab8-c189-46e8-94e1-60213ab1f814": "Security Administrator",
        "29232cdf-9323-42fd-ade2-1d097af3e4de": "Exchange Administrator",
        "f28a1f50-f6e7-4571-818b-6a12f2af6b6c": "SharePoint Administrator",
        "fe930be7-5e62-47db-91af-98c3a49a38b1": "User Administrator",
        "b0f54661-2d74-4c50-afa3-1ec803f12efe": "Billing Administrator",
        "b1be1c3e-b65d-4f19-8427-f6fa0d97feb9": "Conditional Access Administrator",
        "729827e3-9c14-49f7-bb1b-9608f156bbb8": "Helpdesk Administrator",
        "c4e39bd9-1100-46d3-8c65-fb160da0071f": "Authentication Administrator",
        "7be44c8a-adaf-4e2a-84d6-ab2649e08a13": "Privileged Authentication Administrator",
        "9b895d92-2cd3-44c7-9d02-a6ac2d5ea5c3": "Application Administrator",
        "158c047a-c907-4556-b7ef-446551a6b5f7": "Cloud Application Administrator"
      },
      "cisControls": [
        "CIS 1.3.1 - Ensure MFA is required for all users in all cloud apps",
        "CIS 1.3.2 - Ensure phishing-resistant MFA strength is required for Administrators",
        "CIS 5.2.2.2 - Ensure MFA is enabled for all users in administrative roles",
        "CIS 5.3.1 - Ensure the Microsoft Authenticator app is configured to protect against MFA fatigue"
      ],
      "frameworkMappings": {
        "NIST-800-53": [
          "IA-2(1)",
          "IA-2(6)",
          "IA-2(12)"
        ],
        "CIS-Microsoft-365": [
          "1.3.1",
          "1.3.2",
          "5.2.2.2",
          "5.3.1"
        ],
        "ISO-27001-2022": [
          "A.8.2 - Privileged access rights",
          "A.8.5 - Secure authentication"
        ],
        "MITRE-ATT&CK": [
          "T1078.004 - Cloud Accounts",
          "T1556 - Modify Authentication Process",
          "T1621 - Multi-Factor Authentication Request Generation"
        ],
        "NIS2": [
          "Article 21(2)(i) - Human resources security, access control policies and asset management"
        ],
        "Essential-Eight": [
          "Multi-factor authentication"
        ]
      },
      "requiredLicenses": [
        "Microsoft Entra ID P1 or P2"
      ],
      "authenticationStrengthNotes": "The ID 00000000-0000-0000-0000-000000000004 is the built-in 'Phishing-resistant MFA' authentication strength policy. Accepted methods: FIDO2 security key, Windows Hello for Business, X.509 certificate-based authentication (CBA).",
      "deploymentNotes": "Ensure all admin accounts have enrolled a FIDO2 security key or Windows Hello for Business credential before enforcing. Deploy in report-only first and verify admin sign-in success in sign-in logs. Replace  with the Object ID of your break-glass exclusion security group."
    }
  },
  {
    "displayName": "CA04 | Block High-Risk Sign-Ins",
    "state": "enabledForReportingButNotEnforced",
    "conditions": {
      "users": {
        "includeUsers": [
          "All"
        ],
        "excludeUsers": [],
        "excludeGroups": []
      },
      "applications": {
        "includeApplications": [
          "All"
        ]
      },
      "clientAppTypes": [
        "browser",
        "mobileAppsAndDesktopClients"
      ],
      "signInRiskLevels": [
        "high"
      ]
    },
    "grantControls": {
      "operator": "OR",
      "builtInControls": [
        "block"
      ]
    },
    "_metadata": {
      "policyNumber": "CA04",
      "description": "Blocks sign-in attempts that Microsoft Entra ID Identity Protection classifies as high risk in real time. High-risk detections include sign-ins from anonymous IP addresses, malware-linked IP addresses, impossible travel, token anomalies, and password spray patterns.",
      "cisControls": [
        "CIS 1.2.2 - Ensure that a user risk policy is configured to block high-risk users",
        "CIS 5.2.2.5 - Ensure Sign-in risk policy is configured to require MFA for medium and high sign-in risk"
      ],
      "frameworkMappings": {
        "NIST-800-53": [
          "SI-4",
          "AC-7",
          "IA-5(13)",
          "RA-5"
        ],
        "CIS-Microsoft-365": [
          "1.2.2",
          "5.2.2.5"
        ],
        "ISO-27001-2022": [
          "A.8.16 - Monitoring activities"
        ],
        "MITRE-ATT&CK": [
          "T1078 - Valid Accounts",
          "T1110 - Brute Force",
          "T1090 - Proxy"
        ],
        "NIS2": [
          "Article 21(2)(b) - Incident handling"
        ],
        "Essential-Eight": [
          "Multi-factor authentication"
        ]
      },
      "requiredLicenses": [
        "Microsoft Entra ID P2 or Microsoft 365 E5"
      ],
      "deploymentNotes": "Requires Entra ID P2 licensing for Identity Protection real-time risk detection. Deploy in report-only first and monitor the Risky sign-ins report (Entra > Protection > Identity Protection > Risky sign-ins) for false positives before enforcing. Replace  with the Object ID of your break-glass exclusion security group."
    }
  },
  {
    "displayName": "CA05 | Require Password Change for High-Risk Users",
    "state": "enabledForReportingButNotEnforced",
    "conditions": {
      "users": {
        "includeUsers": [
          "All"
        ],
        "excludeUsers": [],
        "excludeGroups": []
      },
      "applications": {
        "includeApplications": [
          "All"
        ]
      },
      "clientAppTypes": [
        "browser",
        "mobileAppsAndDesktopClients"
      ],
      "userRiskLevels": [
        "high"
      ]
    },
    "grantControls": {
      "operator": "AND",
      "builtInControls": [
        "mfa",
        "passwordChange"
      ]
    },
    "_metadata": {
      "policyNumber": "CA05",
      "description": "Requires both MFA verification and a secure password change when Microsoft Entra ID Identity Protection classifies a user account as high risk. High-risk users are those with confirmed compromised credentials detected via dark web intelligence, leaked credential databases, or confirmed malicious sign-in activity patterns.",
      "cisControls": [
        "CIS 1.2.2 - Ensure that a user risk policy is configured to block high-risk users",
        "CIS 5.2.2.6 - Ensure user risk policy is configured to require MFA or password change for high user risk"
      ],
      "frameworkMappings": {
        "NIST-800-53": [
          "IA-5(1)",
          "IA-5(13)",
          "AC-7",
          "IR-4"
        ],
        "CIS-Microsoft-365": [
          "1.2.2",
          "5.2.2.6"
        ],
        "ISO-27001-2022": [
          "A.5.7 - Threat intelligence",
          "A.8.5 - Secure authentication"
        ],
        "MITRE-ATT&CK": [
          "T1078 - Valid Accounts",
          "T1110.001 - Password Guessing",
          "T1552 - Unsecured Credentials"
        ],
        "NIS2": [
          "Article 21(2)(b) - Incident handling"
        ],
        "Essential-Eight": [
          "Multi-factor authentication"
        ]
      },
      "requiredLicenses": [
        "Microsoft Entra ID P2 or Microsoft 365 E5"
      ],
      "deploymentNotes": "Requires Entra ID P2 licensing. For hybrid environments, password writeback must be enabled in Microsoft Entra Connect so that cloud-initiated password changes synchronise back to on-premises Active Directory. The AND operator ensures BOTH MFA and password change are required simultaneously. Deploy in report-only first. Replace  with the Object ID of your break-glass exclusion security group."
    }
  },
  {
    "displayName": "CA06 | Require Compliant or Hybrid Azure AD Joined Device",
    "state": "enabledForReportingButNotEnforced",
    "conditions": {
      "users": {
        "includeUsers": [
          "All"
        ],
        "excludeUsers": [],
        "excludeGroups": []
      },
      "applications": {
        "includeApplications": [
          "All"
        ]
      },
      "clientAppTypes": [
        "browser",
        "mobileAppsAndDesktopClients"
      ]
    },
    "grantControls": {
      "operator": "OR",
      "builtInControls": [
        "compliantDevice",
        "domainJoinedDevice"
      ]
    },
    "_metadata": {
      "policyNumber": "CA06",
      "description": "Requires that the device accessing cloud resources is either marked as Intune-compliant or is Hybrid Azure AD Joined. This prevents access from unmanaged personal devices, kiosks, and attacker-controlled endpoints, ensuring only corporate-managed endpoints that meet compliance policies can access organisational data.",
      "cisControls": [
        "CIS 1.3.7 - Ensure Conditional Access policies require compliant or hybrid joined devices",
        "CIS 5.1.4.1 - Ensure devices joining or registering to Entra ID require MFA",
        "CIS 5.2.2.9 - Ensure access is restricted to compliant devices",
        "CIS 5.2.2.12 - Ensure a Conditional Access policy is in place to require devices to be marked as compliant"
      ],
      "frameworkMappings": {
        "NIST-800-53": [
          "AC-19",
          "CM-8",
          "IA-3",
          "SC-43"
        ],
        "CIS-Microsoft-365": [
          "1.3.7",
          "5.1.4.1",
          "5.2.2.9",
          "5.2.2.12"
        ],
        "ISO-27001-2022": [
          "A.8.1 - User endpoint devices"
        ],
        "MITRE-ATT&CK": [
          "T1078 - Valid Accounts",
          "T1199 - Trusted Relationship"
        ],
        "NIS2": [
          "Article 21(2)(d) - Supply chain security"
        ],
        "Essential-Eight": [
          "Application control",
          "Configure Microsoft Office macro settings"
        ]
      },
      "requiredLicenses": [
        "Microsoft Entra ID P1 or P2",
        "Microsoft Intune"
      ],
      "deploymentNotes": "Ensure Intune device compliance policies are configured and devices are enrolled BEFORE enforcing this policy. The OR operator means EITHER a compliant device OR a Hybrid Azure AD Joined device will satisfy the grant. Deploy in report-only first and monitor for users accessing from unmanaged devices. Replace  with the Object ID of your break-glass exclusion security group."
    }
  },
  {
    "displayName": "CA07 | Block Sign-Ins from Non-Approved Countries",
    "state": "enabledForReportingButNotEnforced",
    "conditions": {
      "users": {
        "includeUsers": [
          "All"
        ],
        "excludeUsers": [],
        "excludeGroups": []
      },
      "applications": {
        "includeApplications": [
          "All"
        ]
      },
      "clientAppTypes": [
        "browser",
        "mobileAppsAndDesktopClients"
      ],
      "locations": {
        "includeLocations": [
          "All"
        ],
        "excludeLocations": [
          "AllTrusted"
        ]
      }
    },
    "grantControls": {
      "operator": "OR",
      "builtInControls": [
        "block"
      ]
    },
    "_metadata": {
      "policyNumber": "CA07",
      "description": "Blocks all sign-in attempts originating from countries not included in the approved Named Location. This is a geo-fencing control that significantly reduces the attack surface by preventing authentication from regions where the organisation has no legitimate users or operations.",
      "prerequisiteSteps": [
        "1. Navigate to Entra admin centre > Protection > Conditional Access > Named locations",
        "2. Click '+ Countries location'",
        "3. Name it 'AllowedCountries' (or your preferred name)",
        "4. Select the countries where your organisation operates",
        "5. Mark as 'trusted location' if appropriate",
        "6. Save and copy the resulting Location ID",
        "7. Replace AllTrusted in this policy with that ID"
      ],
      "cisControls": [
        "CIS 1.3.9 - Ensure that a Conditional Access policy is configured to block access from anonymous or threat-intelligence flagged IP addresses"
      ],
      "frameworkMappings": {
        "NIST-800-53": [
          "AC-2(11)",
          "SC-7",
          "SI-4"
        ],
        "CIS-Microsoft-365": [
          "1.3.9"
        ],
        "ISO-27001-2022": [
          "A.8.20 - Networks security",
          "A.8.22 - Segregation of networks"
        ],
        "MITRE-ATT&CK": [
          "T1078 - Valid Accounts",
          "T1090 - Proxy",
          "T1090.003 - Multi-hop Proxy"
        ],
        "NIS2": [
          "Article 21(2)(b) - Incident handling"
        ],
        "Essential-Eight": [
          "Multi-factor authentication"
        ]
      },
      "requiredLicenses": [
        "Microsoft Entra ID P1 or P2"
      ],
      "deploymentNotes": "IMPORTANT: You MUST create the Named Location in Entra admin centre BEFORE importing this policy, then replace AllTrusted with the actual GUID. If you import with the placeholder the API call will fail. Deploy in report-only first and monitor for legitimate users travelling or using VPN endpoints in blocked countries. Replace  with the Object ID of your break-glass exclusion security group."
    }
  },
  {
    "displayName": "CA08 | Require MFA for Azure Management",
    "state": "enabledForReportingButNotEnforced",
    "conditions": {
      "users": {
        "includeUsers": [
          "All"
        ],
        "excludeUsers": [],
        "excludeGroups": []
      },
      "applications": {
        "includeApplications": [
          "797f4846-ba00-4fd7-ba43-dac1f8f63013"
        ]
      },
      "clientAppTypes": [
        "browser",
        "mobileAppsAndDesktopClients"
      ]
    },
    "grantControls": {
      "operator": "OR",
      "builtInControls": [
        "mfa"
      ]
    },
    "_metadata": {
      "policyNumber": "CA08",
      "description": "Requires MFA for all access to Microsoft Azure Management, which covers the Azure Portal, Azure CLI, Azure PowerShell, and Azure Resource Manager API. This prevents unauthorised subscription and resource modifications even if credentials are compromised.",
      "targetApplication": {
        "appId": "797f4846-ba00-4fd7-ba43-dac1f8f63013",
        "displayName": "Microsoft Azure Management",
        "scope": "Azure Portal, Azure CLI, Azure PowerShell, Azure Resource Manager API"
      },
      "cisControls": [
        "CIS 1.3.2 - Ensure phishing-resistant MFA strength is required for Administrators",
        "CIS 1.3.5 - Ensure MFA is required for Azure management"
      ],
      "frameworkMappings": {
        "NIST-800-53": [
          "IA-2(1)",
          "AC-6(5)",
          "AC-17(2)"
        ],
        "CIS-Microsoft-365": [
          "1.3.2",
          "1.3.5"
        ],
        "ISO-27001-2022": [
          "A.8.2 - Privileged access rights"
        ],
        "MITRE-ATT&CK": [
          "T1078.004 - Cloud Accounts",
          "T1580 - Cloud Infrastructure Discovery"
        ],
        "NIS2": [
          "Article 21(2)(i) - Access control policies"
        ],
        "Essential-Eight": [
          "Restrict administrative privileges",
          "Multi-factor authentication"
        ]
      },
      "requiredLicenses": [
        "Microsoft Entra ID P1 or P2"
      ],
      "deploymentNotes": "The application ID 797f4846-ba00-4fd7-ba43-dac1f8f63013 is the well-known Microsoft Azure Management service principal that covers Azure Portal, CLI, PowerShell, and ARM API access. Deploy in report-only first. Replace  with the Object ID of your break-glass exclusion security group."
    }
  },
  {
    "displayName": "CA09 | Require MFA for Windows Azure Service Management API",
    "state": "enabledForReportingButNotEnforced",
    "conditions": {
      "users": {
        "includeUsers": [
          "All"
        ],
        "excludeUsers": [],
        "excludeGroups": []
      },
      "applications": {
        "includeApplications": [
          "797f4846-ba00-4fd7-ba43-dac1f8f63013"
        ]
      },
      "clientAppTypes": [
        "browser",
        "mobileAppsAndDesktopClients"
      ]
    },
    "grantControls": {
      "operator": "OR",
      "builtInControls": [
        "mfa"
      ]
    },
    "_metadata": {
      "policyNumber": "CA09",
      "description": "Requires MFA for Windows Azure Service Management API access. This complements CA08 by explicitly targeting the Service Management API layer used by Azure classic deployment model operations, REST API calls, and programmatic Azure resource management. Both CA08 and CA09 use the same service principal ID as Microsoft consolidated the Azure Management endpoints.",
      "targetApplication": {
        "appId": "797f4846-ba00-4fd7-ba43-dac1f8f63013",
        "displayName": "Windows Azure Service Management API",
        "scope": "Azure Service Management API, Azure classic deployment model, Azure REST API management operations"
      },
      "cisControls": [
        "CIS 1.3.5 - Ensure MFA is required for Azure management"
      ],
      "frameworkMappings": {
        "NIST-800-53": [
          "IA-2(1)",
          "AC-6(5)",
          "AC-17(2)",
          "SC-8"
        ],
        "CIS-Microsoft-365": [
          "1.3.5"
        ],
        "ISO-27001-2022": [
          "A.8.2 - Privileged access rights",
          "A.8.9 - Configuration management"
        ],
        "MITRE-ATT&CK": [
          "T1078.004 - Cloud Accounts",
          "T1580 - Cloud Infrastructure Discovery",
          "T1098 - Account Manipulation"
        ],
        "NIS2": [
          "Article 21(2)(i) - Access control policies"
        ],
        "Essential-Eight": [
          "Restrict administrative privileges",
          "Multi-factor authentication"
        ]
      },
      "requiredLicenses": [
        "Microsoft Entra ID P1 or P2"
      ],
      "deploymentNotes": "The application ID 797f4846-ba00-4fd7-ba43-dac1f8f63013 covers both Microsoft Azure Management and Windows Azure Service Management API as Microsoft consolidated these endpoints. This policy complements CA08 and provides defence-in-depth. Deploy in report-only first. Replace  with the Object ID of your break-glass exclusion security group."
    }
  },
  {
    "displayName": "CA10 | Require Managed Device for Security Info Registration",
    "state": "enabledForReportingButNotEnforced",
    "conditions": {
      "users": {
        "includeUsers": [
          "All"
        ],
        "excludeUsers": [],
        "excludeGroups": []
      },
      "applications": {
        "includeUserActions": [
          "urn:user:registersecurityinfo"
        ]
      },
      "clientAppTypes": [
        "browser",
        "mobileAppsAndDesktopClients"
      ]
    },
    "grantControls": {
      "operator": "OR",
      "builtInControls": [
        "compliantDevice"
      ]
    },
    "_metadata": {
      "policyNumber": "CA10",
      "description": "Requires a managed, Intune-compliant device for users registering or modifying their security information (MFA methods, SSPR, passwordless credentials). This prevents attackers who have compromised a password from registering their own MFA device on an unmanaged endpoint, which is a critical step in account takeover attacks.",
      "targetUserAction": "urn:user:registersecurityinfo",
      "cisControls": [
        "CIS 1.3.6 - Ensure Conditional Access policies are configured to prevent security information registration from outside the corporate network",
        "CIS 5.2.2.10 - Ensure that MFA is required to register or join devices",
        "CIS 5.2.2.11 - Ensure Conditional Access policies cover all user actions for security info registration"
      ],
      "frameworkMappings": {
        "NIST-800-53": [
          "IA-2(1)",
          "IA-5(2)",
          "IA-12"
        ],
        "CIS-Microsoft-365": [
          "1.3.6",
          "5.2.2.10",
          "5.2.2.11"
        ],
        "ISO-27001-2022": [
          "A.5.17 - Authentication information",
          "A.8.5 - Secure authentication"
        ],
        "MITRE-ATT&CK": [
          "T1098.005 - Device Registration",
          "T1556 - Modify Authentication Process"
        ],
        "NIS2": [
          "Article 21(2)(j) - Multi-factor authentication"
        ],
        "Essential-Eight": [
          "Multi-factor authentication"
        ]
      },
      "requiredLicenses": [
        "Microsoft Entra ID P1 or P2",
        "Microsoft Intune"
      ],
      "deploymentNotes": "This policy targets the user action 'Register security information' rather than a cloud application. Ensure Intune device compliance policies and device enrollment are configured before enforcing. For initial MFA registration bootstrapping, consider using Temporary Access Pass (TAP) on compliant devices. Deploy in report-only first. Replace  with the Object ID of your break-glass exclusion security group."
    }
  },
  {
    "displayName": "CA11 | Block All Guest and External User Access",
    "state": "enabledForReportingButNotEnforced",
    "conditions": {
      "users": {
        "includeGuestsOrExternalUsers": {
          "guestOrExternalUserTypes": "b2bCollaborationGuest,b2bDirectConnectUser,otherExternalUser",
          "externalTenants": {
            "membershipKind": "all"
          }
        },
        "excludeGroups": []
      },
      "applications": {
        "includeApplications": [
          "All"
        ]
      },
      "clientAppTypes": [
        "browser",
        "mobileAppsAndDesktopClients"
      ]
    },
    "grantControls": {
      "operator": "OR",
      "builtInControls": [
        "block"
      ]
    },
    "_metadata": {
      "policyNumber": "CA11",
      "description": "Blocks all access for guest and external users including B2B collaboration guests, B2B direct connect users, and other external users from all tenants. This is the most restrictive guest policy and should be used as a baseline when external collaboration is not required or when specific app-level exceptions via CA12 are preferred.",
      "guestUserTypes": {
        "b2bCollaborationGuest": "Users invited via Azure AD B2B collaboration (guest accounts in your directory)",
        "b2bDirectConnectUser": "Users from other organisations accessing resources via B2B direct connect (Teams shared channels)",
        "otherExternalUser": "Users that do not fall into B2B collaboration or direct connect categories"
      },
      "cisControls": [
        "CIS 5.1.6.2 - Ensure that only organizationally managed/approved public groups exist",
        "CIS 5.1.6.3 - Ensure guest access to a Teams or SharePoint channel is restricted",
        "CIS 5.1.2.3 - Ensure guest user access is restricted"
      ],
      "frameworkMappings": {
        "NIST-800-53": [
          "AC-2(7)",
          "AC-17",
          "IA-8"
        ],
        "CIS-Microsoft-365": [
          "5.1.6.2",
          "5.1.6.3",
          "5.1.2.3"
        ],
        "ISO-27001-2022": [
          "A.5.19 - Information security in supplier relationships",
          "A.8.3 - Information access restriction"
        ],
        "MITRE-ATT&CK": [
          "T1078 - Valid Accounts",
          "T1199 - Trusted Relationship"
        ],
        "NIS2": [
          "Article 21(2)(d) - Supply chain security"
        ],
        "GDPR": [
          "Article 28 - Processor"
        ]
      },
      "requiredLicenses": [
        "Microsoft Entra ID P1 or P2"
      ],
      "deploymentNotes": "This is a restrictive policy that blocks ALL guest and external user access. Use CA12 instead if you need to allow guest access with MFA. You can also add excludeApplications to allow guests to specific applications. Deploy in report-only first and monitor guest sign-in logs to avoid disrupting legitimate B2B collaboration. Replace  with the Object ID of your break-glass exclusion security group."
    }
  },
  {
    "displayName": "CA12 | Require MFA for Guest and External Users",
    "state": "enabledForReportingButNotEnforced",
    "conditions": {
      "users": {
        "includeGuestsOrExternalUsers": {
          "guestOrExternalUserTypes": "b2bCollaborationGuest,b2bCollaborationMember,b2bDirectConnectUser,otherExternalUser,serviceProvider",
          "externalTenants": {
            "membershipKind": "all"
          }
        },
        "excludeGroups": []
      },
      "applications": {
        "includeApplications": [
          "All"
        ]
      },
      "clientAppTypes": [
        "browser",
        "mobileAppsAndDesktopClients"
      ]
    },
    "grantControls": {
      "operator": "OR",
      "builtInControls": [
        "mfa"
      ]
    },
    "_metadata": {
      "policyNumber": "CA12",
      "description": "Requires multi-factor authentication for all guest and external user types when accessing any cloud application. This is the recommended alternative to CA11 when external B2B collaboration is needed but must be secured. Covers B2B collaboration guests, B2B collaboration members, B2B direct connect users, other external users, and service provider users.",
      "guestUserTypes": {
        "b2bCollaborationGuest": "Users invited via Azure AD B2B collaboration with guest role",
        "b2bCollaborationMember": "Users invited via Azure AD B2B collaboration with member role",
        "b2bDirectConnectUser": "Users from other organisations via B2B direct connect (Teams shared channels)",
        "otherExternalUser": "Users not classified under B2B collaboration or direct connect",
        "serviceProvider": "Users from Cloud Service Provider (CSP) partner organisations"
      },
      "cisControls": [
        "CIS 5.1.6.2 - Ensure that only organizationally managed/approved public groups exist",
        "CIS 5.1.6.3 - Ensure guest access to a Teams or SharePoint channel is restricted"
      ],
      "frameworkMappings": {
        "NIST-800-53": [
          "IA-2(1)",
          "IA-8(1)",
          "AC-17"
        ],
        "CIS-Microsoft-365": [
          "5.1.6.2",
          "5.1.6.3"
        ],
        "ISO-27001-2022": [
          "A.5.19 - Information security in supplier relationships",
          "A.8.5 - Secure authentication"
        ],
        "MITRE-ATT&CK": [
          "T1078 - Valid Accounts",
          "T1199 - Trusted Relationship"
        ],
        "NIS2": [
          "Article 21(2)(d) - Supply chain security",
          "Article 21(2)(j) - Multi-factor authentication"
        ],
        "GDPR": [
          "Article 28 - Processor"
        ]
      },
      "requiredLicenses": [
        "Microsoft Entra ID P1 or P2"
      ],
      "deploymentNotes": "This policy is the recommended alternative to CA11 when B2B collaboration is required. Guest users will be prompted to complete MFA using their home tenant credentials or register MFA in your resource tenant. Ensure cross-tenant access settings are configured appropriately. Deploy in report-only first. Replace  with the Object ID of your break-glass exclusion security group."
    }
  },
  {
    "displayName": "CA13 | Enforce Sign-In Frequency 1 Hour",
    "state": "enabledForReportingButNotEnforced",
    "conditions": {
      "users": {
        "includeUsers": [
          "All"
        ],
        "excludeUsers": [],
        "excludeGroups": []
      },
      "applications": {
        "includeApplications": [
          "All"
        ]
      },
      "clientAppTypes": [
        "browser",
        "mobileAppsAndDesktopClients"
      ]
    },
    "grantControls": {
      "operator": "OR",
      "builtInControls": [
        "mfa"
      ]
    },
    "sessionControls": {
      "signInFrequency": {
        "value": 1,
        "type": "hours",
        "isEnabled": true
      },
      "persistentBrowser": {
        "mode": "never",
        "isEnabled": true
      }
    },
    "_metadata": {
      "policyNumber": "CA13",
      "description": "Enforces a 1-hour sign-in frequency for all users across all cloud applications and disables persistent browser sessions. This limits the window of opportunity for session token theft and replay attacks by forcing re-authentication every hour. Persistent browser sessions are set to 'never' to prevent 'keep me signed in' tokens from persisting.",
      "cisControls": [
        "CIS 1.3.8 - Ensure sign-in frequency is enabled and browser sessions are not persistent for administrative users",
        "CIS 5.2.2.4 - Ensure Sign-in frequency is set and browser sessions are not persistent"
      ],
      "frameworkMappings": {
        "NIST-800-53": [
          "AC-11",
          "AC-12",
          "SC-10",
          "SC-23"
        ],
        "CIS-Microsoft-365": [
          "1.3.8",
          "5.2.2.4"
        ],
        "ISO-27001-2022": [
          "A.8.5 - Secure authentication",
          "A.8.11 - Data masking"
        ],
        "MITRE-ATT&CK": [
          "T1539 - Steal Web Session Cookie",
          "T1550.001 - Application Access Token"
        ],
        "NIS2": [
          "Article 21(2)(j) - Multi-factor authentication"
        ],
        "Essential-Eight": [
          "Multi-factor authentication"
        ]
      },
      "requiredLicenses": [
        "Microsoft Entra ID P1 or P2"
      ],
      "deploymentNotes": "This policy significantly impacts user experience as users must re-authenticate every hour. Consider applying this only to sensitive applications or using CA14 for admin-only frequency. The persistentBrowser mode 'never' ensures browser sessions are not preserved across browser closures. Deploy in report-only first and gather user feedback. Replace  with the Object ID of your break-glass exclusion security group."
    }
  },
  {
    "displayName": "CA14 | Enforce Sign-In Frequency Every Time for Admins",
    "state": "enabledForReportingButNotEnforced",
    "conditions": {
      "users": {
        "includeUsers": [],
        "excludeUsers": [],
        "includeRoles": [
          "62e90394-69f5-4237-9190-012177145e10",
          "e8611ab8-c189-46e8-94e1-60213ab1f814",
          "29232cdf-9323-42fd-ade2-1d097af3e4de",
          "f28a1f50-f6e7-4571-818b-6a12f2af6b6c",
          "fe930be7-5e62-47db-91af-98c3a49a38b1",
          "b0f54661-2d74-4c50-afa3-1ec803f12efe",
          "b1be1c3e-b65d-4f19-8427-f6fa0d97feb9",
          "729827e3-9c14-49f7-bb1b-9608f156bbb8",
          "c4e39bd9-1100-46d3-8c65-fb160da0071f",
          "7be44c8a-adaf-4e2a-84d6-ab2649e08a13",
          "9b895d92-2cd3-44c7-9d02-a6ac2d5ea5c3",
          "158c047a-c907-4556-b7ef-446551a6b5f7"
        ],
        "excludeGroups": []
      },
      "applications": {
        "includeApplications": [
          "All"
        ]
      },
      "clientAppTypes": [
        "browser",
        "mobileAppsAndDesktopClients"
      ]
    },
    "grantControls": {
      "operator": "OR",
      "builtInControls": [
        "mfa"
      ]
    },
    "sessionControls": {
      "signInFrequency": {
        "frequencyInterval": "everyTime",
        "isEnabled": true
      },
      "persistentBrowser": {
        "mode": "never",
        "isEnabled": true
      }
    },
    "_metadata": {
      "policyNumber": "CA14",
      "description": "Enforces 'every time' sign-in frequency for all privileged administrator roles. This is the most restrictive session control, requiring fresh authentication for every single session. Combined with persistent browser mode 'never', this ensures no admin session tokens persist and every admin action requires fresh, verified authentication.",
      "adminRoleTemplateIds": {
        "62e90394-69f5-4237-9190-012177145e10": "Global Administrator",
        "e8611ab8-c189-46e8-94e1-60213ab1f814": "Security Administrator",
        "29232cdf-9323-42fd-ade2-1d097af3e4de": "Exchange Administrator",
        "f28a1f50-f6e7-4571-818b-6a12f2af6b6c": "SharePoint Administrator",
        "fe930be7-5e62-47db-91af-98c3a49a38b1": "User Administrator",
        "b0f54661-2d74-4c50-afa3-1ec803f12efe": "Billing Administrator",
        "b1be1c3e-b65d-4f19-8427-f6fa0d97feb9": "Conditional Access Administrator",
        "729827e3-9c14-49f7-bb1b-9608f156bbb8": "Helpdesk Administrator",
        "c4e39bd9-1100-46d3-8c65-fb160da0071f": "Authentication Administrator",
        "7be44c8a-adaf-4e2a-84d6-ab2649e08a13": "Privileged Authentication Administrator",
        "9b895d92-2cd3-44c7-9d02-a6ac2d5ea5c3": "Application Administrator",
        "158c047a-c907-4556-b7ef-446551a6b5f7": "Cloud Application Administrator"
      },
      "cisControls": [
        "CIS 1.3.8 - Ensure sign-in frequency is enabled and browser sessions are not persistent for administrative users",
        "CIS 5.2.2.4 - Ensure Sign-in frequency is set and browser sessions are not persistent"
      ],
      "frameworkMappings": {
        "NIST-800-53": [
          "AC-11",
          "AC-12",
          "AC-6(5)",
          "SC-10"
        ],
        "CIS-Microsoft-365": [
          "1.3.8",
          "5.2.2.4"
        ],
        "ISO-27001-2022": [
          "A.8.2 - Privileged access rights",
          "A.8.5 - Secure authentication"
        ],
        "MITRE-ATT&CK": [
          "T1539 - Steal Web Session Cookie",
          "T1550.001 - Application Access Token",
          "T1078.004 - Cloud Accounts"
        ],
        "NIS2": [
          "Article 21(2)(i) - Access control policies",
          "Article 21(2)(j) - Multi-factor authentication"
        ],
        "Essential-Eight": [
          "Restrict administrative privileges",
          "Multi-factor authentication"
        ]
      },
      "requiredLicenses": [
        "Microsoft Entra ID P1 or P2"
      ],
      "deploymentNotes": "The 'everyTime' frequency interval is the most restrictive option and requires admins to authenticate freshly for every session. This is more restrictive than CA13 and targets only admin roles. Deploy in report-only first to measure admin authentication volume. Replace  with the Object ID of your break-glass exclusion security group."
    }
  },
  {
    "displayName": "CA15 | Require MFA for Device Registration and Enrollment",
    "state": "enabledForReportingButNotEnforced",
    "conditions": {
      "users": {
        "includeUsers": [
          "All"
        ],
        "excludeUsers": [],
        "excludeGroups": []
      },
      "applications": {
        "includeUserActions": [
          "urn:user:registerdevice"
        ]
      },
      "clientAppTypes": [
        "browser",
        "mobileAppsAndDesktopClients"
      ]
    },
    "grantControls": {
      "operator": "OR",
      "builtInControls": [
        "mfa"
      ]
    },
    "sessionControls": {
      "signInFrequency": {
        "frequencyInterval": "everyTime",
        "isEnabled": true
      }
    },
    "_metadata": {
      "policyNumber": "CA15",
      "description": "Requires MFA for all Intune device enrollment and Azure AD device registration actions, with sign-in frequency set to 'every time' to ensure fresh authentication for each device enrollment. This prevents attackers from registering rogue devices to your tenant using compromised credentials.",
      "targetUserAction": "urn:user:registerdevice",
      "cisControls": [
        "CIS 5.2.2.11 - Ensure that MFA is required to complete device registration or join"
      ],
      "frameworkMappings": {
        "NIST-800-53": [
          "IA-2(1)",
          "IA-3",
          "CM-8"
        ],
        "CIS-Microsoft-365": [
          "5.2.2.11"
        ],
        "ISO-27001-2022": [
          "A.8.1 - User endpoint devices",
          "A.8.5 - Secure authentication"
        ],
        "MITRE-ATT&CK": [
          "T1098.005 - Device Registration",
          "T1078 - Valid Accounts"
        ],
        "NIS2": [
          "Article 21(2)(j) - Multi-factor authentication"
        ],
        "Essential-Eight": [
          "Multi-factor authentication"
        ]
      },
      "requiredLicenses": [
        "Microsoft Entra ID P1 or P2",
        "Microsoft Intune"
      ],
      "deploymentNotes": "This policy targets the user action 'Register or join devices' (urn:user:registerdevice) which covers both Intune enrollment and Azure AD device join/registration. The 'everyTime' sign-in frequency ensures that each device enrollment requires fresh authentication rather than reusing existing session tokens. Deploy in report-only first. Replace  with the Object ID of your break-glass exclusion security group."
    }
  },
  {
    "displayName": "CA16 | Block Access from Unregistered or Non-Compliant Devices",
    "state": "enabledForReportingButNotEnforced",
    "conditions": {
      "users": {
        "includeUsers": [
          "All"
        ],
        "excludeUsers": [],
        "excludeGroups": []
      },
      "applications": {
        "includeApplications": [
          "All"
        ]
      },
      "clientAppTypes": [
        "browser",
        "mobileAppsAndDesktopClients"
      ],
      "devices": {
        "deviceFilter": {
          "mode": "include",
          "rule": "device.isCompliant -ne True -or device.trustType -ne \"AzureAD\" -and device.trustType -ne \"ServerAD\" -and device.trustType -ne \"Workplace\""
        }
      }
    },
    "grantControls": {
      "operator": "OR",
      "builtInControls": [
        "block"
      ]
    },
    "_metadata": {
      "policyNumber": "CA16",
      "description": "Blocks access from devices that are not registered with Entra ID or are not marked as Intune-compliant. Uses a device filter rule to explicitly identify non-compliant and unregistered devices. This is a more aggressive version of CA06 that uses device filters for granular device state evaluation.",
      "deviceFilterRule": "device.isCompliant -ne True -or device.trustType -ne 'AzureAD' -and device.trustType -ne 'ServerAD' -and device.trustType -ne 'Workplace'",
      "deviceFilterExplanation": {
        "device.isCompliant -ne True": "Matches devices not marked as compliant in Intune",
        "device.trustType -ne AzureAD": "Matches devices not Azure AD Joined",
        "device.trustType -ne ServerAD": "Matches devices not Hybrid Azure AD Joined",
        "device.trustType -ne Workplace": "Matches devices not Azure AD Registered (Workplace Join)"
      },
      "cisControls": [
        "CIS 1.3.7 - Ensure Conditional Access policies require compliant or hybrid joined devices",
        "CIS 5.1.3.1 - Ensure that device code flow is restricted",
        "CIS 5.2.2.9 - Ensure access is restricted to compliant devices"
      ],
      "frameworkMappings": {
        "NIST-800-53": [
          "AC-19",
          "CM-8",
          "IA-3",
          "SC-43"
        ],
        "CIS-Microsoft-365": [
          "1.3.7",
          "5.1.3.1",
          "5.2.2.9"
        ],
        "ISO-27001-2022": [
          "A.8.1 - User endpoint devices",
          "A.8.9 - Configuration management"
        ],
        "MITRE-ATT&CK": [
          "T1078 - Valid Accounts",
          "T1199 - Trusted Relationship",
          "T1098.005 - Device Registration"
        ],
        "NIS2": [
          "Article 21(2)(d) - Supply chain security"
        ],
        "Essential-Eight": [
          "Application control"
        ]
      },
      "requiredLicenses": [
        "Microsoft Entra ID P1 or P2",
        "Microsoft Intune"
      ],
      "deploymentNotes": "This policy uses device filters which are more granular than the built-in grant controls in CA06. Ensure all corporate devices are enrolled and compliant in Intune before enforcing. The device filter expression blocks devices that fail compliance OR are not of a recognised trust type. Deploy in report-only first and carefully monitor for false positives on newly enrolled devices. Replace  with the Object ID of your break-glass exclusion security group."
    }
  },
  {
    "displayName": "CA17 | Require MFA for Medium-Risk Sign-Ins",
    "state": "enabledForReportingButNotEnforced",
    "conditions": {
      "users": {
        "includeUsers": [
          "All"
        ],
        "excludeUsers": [],
        "excludeGroups": []
      },
      "applications": {
        "includeApplications": [
          "All"
        ]
      },
      "clientAppTypes": [
        "browser",
        "mobileAppsAndDesktopClients"
      ],
      "signInRiskLevels": [
        "medium"
      ]
    },
    "grantControls": {
      "operator": "OR",
      "builtInControls": [
        "mfa"
      ]
    },
    "_metadata": {
      "policyNumber": "CA17",
      "description": "Requires MFA step-up verification for sign-in attempts classified as medium risk by Microsoft Entra ID Identity Protection. Unlike CA04 which blocks high-risk sign-ins entirely, this policy allows medium-risk sign-ins to proceed after MFA verification, balancing security with usability. Medium-risk detections include atypical travel, anomalous token, and suspicious browser patterns.",
      "cisControls": [
        "CIS 1.3.3 - Ensure that a sign-in risk policy requires MFA for medium or high-risk",
        "CIS 5.2.2.5 - Ensure Sign-in risk policy is configured to require MFA for medium and high sign-in risk"
      ],
      "frameworkMappings": {
        "NIST-800-53": [
          "SI-4",
          "AC-7",
          "IA-2(1)",
          "IA-5(13)"
        ],
        "CIS-Microsoft-365": [
          "1.3.3",
          "5.2.2.5"
        ],
        "ISO-27001-2022": [
          "A.8.16 - Monitoring activities",
          "A.8.5 - Secure authentication"
        ],
        "MITRE-ATT&CK": [
          "T1078 - Valid Accounts",
          "T1110 - Brute Force",
          "T1550 - Use Alternate Authentication Material"
        ],
        "NIS2": [
          "Article 21(2)(b) - Incident handling",
          "Article 21(2)(j) - Multi-factor authentication"
        ],
        "Essential-Eight": [
          "Multi-factor authentication"
        ]
      },
      "requiredLicenses": [
        "Microsoft Entra ID P2 or Microsoft 365 E5"
      ],
      "deploymentNotes": "Requires Entra ID P2 for Identity Protection risk detection. This policy complements CA04 (block high-risk) by providing a less disruptive response to medium-risk sign-ins. The MFA requirement auto-remediates the risk level upon successful completion. Deploy in report-only first and review the Risky sign-ins report for medium-risk detection patterns. Replace  with the Object ID of your break-glass exclusion security group."
    }
  },
  {
    "displayName": "CA18 | Block Access from Unsupported Device Platforms",
    "state": "enabledForReportingButNotEnforced",
    "conditions": {
      "users": {
        "includeUsers": [
          "All"
        ],
        "excludeUsers": [],
        "excludeGroups": []
      },
      "applications": {
        "includeApplications": [
          "All"
        ]
      },
      "clientAppTypes": [
        "browser",
        "mobileAppsAndDesktopClients"
      ],
      "platforms": {
        "includePlatforms": [
          "all"
        ],
        "excludePlatforms": [
          "android",
          "iOS",
          "windows",
          "macOS"
        ]
      }
    },
    "grantControls": {
      "operator": "OR",
      "builtInControls": [
        "block"
      ]
    },
    "_metadata": {
      "policyNumber": "CA18",
      "description": "Blocks access from unsupported device platforms by including all platforms and excluding only the approved ones (Android, iOS, Windows, macOS). This effectively blocks Linux, ChromeOS, and any other unrecognised or spoofed platform strings. Ensures only organisationally managed and supported operating systems can access corporate cloud resources.",
      "platformLogic": {
        "includePlatforms": "all - Targets every device platform",
        "excludePlatforms": "android, iOS, windows, macOS - Only these four approved platforms are allowed through",
        "effectivelyBlocked": "Linux, ChromeOS, WindowsPhone, unknown/unrecognised platforms"
      },
      "cisControls": [
        "CIS 5.1.3.1 - Ensure that device code flow is restricted",
        "CIS 5.1.4.3 - Ensure Conditional Access policies are configured to filter for devices"
      ],
      "frameworkMappings": {
        "NIST-800-53": [
          "AC-19",
          "CM-8",
          "CM-7",
          "SC-43"
        ],
        "CIS-Microsoft-365": [
          "5.1.3.1",
          "5.1.4.3"
        ],
        "ISO-27001-2022": [
          "A.8.1 - User endpoint devices",
          "A.8.9 - Configuration management"
        ],
        "MITRE-ATT&CK": [
          "T1078 - Valid Accounts",
          "T1036 - Masquerading"
        ],
        "NIS2": [
          "Article 21(2)(e) - Security in network and information systems acquisition"
        ],
        "Essential-Eight": [
          "Application control",
          "Patch operating systems"
        ]
      },
      "requiredLicenses": [
        "Microsoft Entra ID P1 or P2"
      ],
      "deploymentNotes": "This policy uses the platform include/exclude pattern to block all platforms except the four approved ones. Be aware that platform detection relies on the User-Agent string and can be spoofed in some scenarios. This policy is most effective when combined with CA06 or CA16 which enforce device compliance. Deploy in report-only first and monitor for legitimate users on Linux workstations or ChromeOS devices before enforcing. Replace  with the Object ID of your break-glass exclusion security group."
    }
  },
  {
    "_metadata": {
      "id": "DEF01",
      "title": "Anti-Phishing Policy - Strict",
      "description": "Deploys a strict anti-phishing policy with aggressive thresholds, mailbox intelligence, spoof intelligence, organization domain protection, and targeted user protection. All impersonation detections are routed to quarantine.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "MITRE ATT&CK T1566",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "HITRUST CSF v11",
        "CMMC v2.0",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "ASD Essential Eight",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "2.1.1",
        "2.1.2",
        "2.1.3",
        "2.1.4",
        "2.1.7"
      ],
      "severity": "High",
      "category": "Defender for Office 365",
      "deploymentOrder": 1,
      "requiredLicence": "Microsoft Defender for Office 365 Plan 1 or Plan 2",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "Requires Defender for Office 365 P1/P2. Deploy the policy first (step 1), then assign to recipients via the rule (step 2). TargetedUsersToProtect must be populated with high-value targets (C-suite, finance, HR) before deployment. Review quarantine for false positives during the first 7 days."
    },
    "steps": [
      {
        "cmdlet": "New-AntiPhishPolicy",
        "parameters": {
          "Name": "Strict Anti-Phish Policy",
          "Enabled": true,
          "PhishThresholdLevel": 3,
          "EnableMailboxIntelligence": true,
          "EnableMailboxIntelligenceProtection": true,
          "MailboxIntelligenceProtectionAction": "Quarantine",
          "MailboxIntelligenceQuarantineTag": "DefaultFullAccessPolicy",
          "EnableSpoofIntelligence": true,
          "SpoofQuarantineTag": "DefaultFullAccessPolicy",
          "AuthenticationFailAction": "Quarantine",
          "EnableOrganizationDomainsProtection": true,
          "EnableTargetedDomainsProtection": false,
          "EnableTargetedUserProtection": true,
          "TargetedUsersToProtect": [
            ";",
            ";",
            ";"
          ],
          "TargetedUserProtectionAction": "Quarantine",
          "TargetedUserQuarantineTag": "DefaultFullAccessPolicy",
          "TargetedDomainProtectionAction": "Quarantine",
          "TargetedDomainQuarantineTag": "DefaultFullAccessPolicy",
          "EnableFirstContactSafetyTips": true,
          "EnableSimilarUsersSafetyTips": true,
          "EnableSimilarDomainsSafetyTips": true,
          "EnableUnusualCharactersSafetyTips": true,
          "EnableUnauthenticatedSender": true,
          "EnableViaTag": true,
          "HonorDmarcPolicy": true,
          "DmarcQuarantineAction": "Quarantine",
          "DmarcRejectAction": "Reject",
          "ImpersonationProtectionState": "Automatic"
        }
      },
      {
        "cmdlet": "New-AntiPhishRule",
        "parameters": {
          "Name": "Strict Anti-Phish Rule - All Recipients",
          "AntiPhishPolicy": "Strict Anti-Phish Policy",
          "RecipientDomainIs": [],
          "Enabled": true,
          "Priority": 0
        }
      }
    ],
    "postDeployment": [
      "Get-AntiPhishPolicy -Identity 'Strict Anti-Phish Policy' | Format-List",
      "Get-AntiPhishRule -Identity 'Strict Anti-Phish Rule - All Recipients' | Format-List",
      "Populate TargetedUsersToProtect with actual C-suite and high-value user entries before enforcement",
      "Monitor quarantine for false positives during first 7 days of deployment"
    ]
  },
  {
    "_metadata": {
      "id": "DEF02",
      "title": "Safe Links - All Applications",
      "description": "Enables Safe Links URL scanning and detonation for email, Microsoft Teams, and Office desktop/mobile apps. Blocks click-through to malicious URLs, rewrites URLs for tracking, and scans links at time of click.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "MITRE ATT&CK T1566.002",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "HITRUST CSF v11",
        "CMMC v2.0",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "ASD Essential Eight",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "2.1.5",
        "2.1.11",
        "2.4.1",
        "2.4.3",
        "2.4.4"
      ],
      "severity": "High",
      "category": "Defender for Office 365",
      "deploymentOrder": 2,
      "requiredLicence": "Microsoft Defender for Office 365 Plan 1 or Plan 2",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "Requires Defender for Office 365 P1/P2. Safe Links scanning applies at time of click, not time of delivery. DeliverMessageAfterScan ensures URLs are scanned before the user can click. DisableUrlRewrite: false ensures URLs are wrapped for real-time protection."
    },
    "steps": [
      {
        "cmdlet": "New-SafeLinksPolicy",
        "parameters": {
          "Name": "Safe Links - All Applications",
          "EnableSafeLinksForEmail": true,
          "EnableSafeLinksForTeams": true,
          "EnableSafeLinksForOffice": true,
          "TrackClicks": true,
          "AllowClickThrough": false,
          "ScanUrls": true,
          "EnableForInternalSenders": true,
          "DeliverMessageAfterScan": true,
          "DisableUrlRewrite": false,
          "EnableOrganizationBranding": false,
          "DoNotRewriteUrls": [],
          "CustomNotificationText": "",
          "EnableSafeLinksForO365Clients": true
        }
      },
      {
        "cmdlet": "New-SafeLinksRule",
        "parameters": {
          "Name": "Safe Links Rule - All Recipients",
          "SafeLinksPolicy": "Safe Links - All Applications",
          "RecipientDomainIs": [],
          "Enabled": true,
          "Priority": 0
        }
      }
    ],
    "postDeployment": [
      "Get-SafeLinksPolicy -Identity 'Safe Links - All Applications' | Format-List",
      "Get-SafeLinksRule -Identity 'Safe Links Rule - All Recipients' | Format-List",
      "Add any legitimate URLs that must not be rewritten to DoNotRewriteUrls (use sparingly)",
      "Verify Safe Links is functioning by sending a test email with a known-safe URL and checking URL rewriting"
    ]
  },
  {
    "_metadata": {
      "id": "DEF03",
      "title": "Safe Attachments - Strict (Dynamic Delivery)",
      "description": "Enables Safe Attachments with Dynamic Delivery mode. Email bodies are delivered immediately while attachments are sandboxed and scanned. Malicious attachments are blocked after detonation. ActionOnError ensures messages are not delivered if scanning fails.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "MITRE ATT&CK T1566.001",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "HITRUST CSF v11",
        "CMMC v2.0",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "ASD Essential Eight",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "2.1.4",
        "2.1.12",
        "2.1.13"
      ],
      "severity": "High",
      "category": "Defender for Office 365",
      "deploymentOrder": 3,
      "requiredLicence": "Microsoft Defender for Office 365 Plan 1 or Plan 2",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "Requires Defender for Office 365 P1/P2. Dynamic Delivery sends the message body immediately and replaces attachments with a placeholder until scanning completes. This minimizes user disruption while still providing sandbox detonation. ActionOnError: true blocks delivery if the scanning service is unavailable."
    },
    "steps": [
      {
        "cmdlet": "New-SafeAttachmentPolicy",
        "parameters": {
          "Name": "Safe Attachments - Dynamic Delivery",
          "Action": "DynamicDelivery",
          "Enable": true,
          "ActionOnError": true,
          "Redirect": false,
          "RedirectAddress": "",
          "QuarantineTag": "AdminOnlyAccessPolicy"
        }
      },
      {
        "cmdlet": "New-SafeAttachmentRule",
        "parameters": {
          "Name": "Safe Attachments Rule - All Recipients",
          "SafeAttachmentPolicy": "Safe Attachments - Dynamic Delivery",
          "RecipientDomainIs": [],
          "Enabled": true,
          "Priority": 0
        }
      }
    ],
    "postDeployment": [
      "Get-SafeAttachmentPolicy -Identity 'Safe Attachments - Dynamic Delivery' | Format-List",
      "Get-SafeAttachmentRule -Identity 'Safe Attachments Rule - All Recipients' | Format-List",
      "Send a test email with a benign attachment to verify Dynamic Delivery behavior (placeholder shown, then replaced with scanned attachment)",
      "If redirect to a security mailbox is desired, set Redirect: true and populate RedirectAddress"
    ]
  },
  {
    "_metadata": {
      "id": "DEF04",
      "title": "Anti-Malware Policy - Strict",
      "description": "Strict anti-malware policy for Exchange Online. Enables the common attachment types filter to block 70+ dangerous file extensions. Enables ZAP for retroactive malware removal. Sends internal admin notifications for malware detections.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "MITRE ATT&CK T1204",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "HITRUST CSF v11",
        "CMMC v2.0",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "ASD Essential Eight",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "2.1.1",
        "2.1.3"
      ],
      "severity": "High",
      "category": "Defender for Office 365",
      "deploymentOrder": 4,
      "requiredLicence": "Exchange Online Protection (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "EOP is included with all Microsoft 365 plans. This policy creates a new malware filter policy and rule. The file type filter blocks common malicious extensions at the transport layer before they reach the user mailbox. ZAP retroactively removes malware discovered after delivery. InternalSenderAdminNotifications alert the security team when internal users send malware (possible compromise indicator)."
    },
    "steps": [
      {
        "cmdlet": "New-MalwareFilterPolicy",
        "parameters": {
          "Name": "Strict Anti-Malware Policy",
          "EnableFileFilter": true,
          "FileTypeAction": "Reject",
          "FileTypes": [
            "ace",
            "apk",
            "app",
            "appx",
            "ani",
            "arj",
            "bat",
            "cab",
            "cmd",
            "com",
            "deb",
            "dex",
            "dll",
            "docm",
            "elf",
            "exe",
            "hta",
            "img",
            "iso",
            "jar",
            "jnlp",
            "kext",
            "lha",
            "lib",
            "library",
            "lnk",
            "lzh",
            "macho",
            "msc",
            "msi",
            "msix",
            "msp",
            "mst",
            "pif",
            "ppa",
            "ppam",
            "reg",
            "rev",
            "scf",
            "scr",
            "sh",
            "sys",
            "vb",
            "vbe",
            "vbs",
            "vxd",
            "wsc",
            "wsf",
            "wsh",
            "xll",
            "xz",
            "ps1",
            "ps2",
            "js",
            "jse",
            "wsh",
            "xlam",
            "xla",
            "dotm",
            "sldm",
            "potm",
            "ppsm",
            "xlsm"
          ],
          "ZapEnabled": true,
          "EnableInternalSenderAdminNotifications": true,
          "InternalSenderAdminAddress": "",
          "EnableExternalSenderAdminNotifications": false,
          "QuarantineTag": "AdminOnlyAccessPolicy",
          "EnableInternalSenderNotifications": false,
          "EnableExternalSenderNotifications": false,
          "CustomNotifications": false
        }
      },
      {
        "cmdlet": "New-MalwareFilterRule",
        "parameters": {
          "Name": "Strict Anti-Malware Rule - All Recipients",
          "MalwareFilterPolicy": "Strict Anti-Malware Policy",
          "RecipientDomainIs": [],
          "Enabled": true,
          "Priority": 0
        }
      }
    ],
    "postDeployment": [
      "Get-MalwareFilterPolicy -Identity 'Strict Anti-Malware Policy' | Format-List",
      "Get-MalwareFilterRule -Identity 'Strict Anti-Malware Rule - All Recipients' | Format-List",
      "Replace  with the actual security operations mailbox",
      "Test by sending an EICAR test file to verify detection and quarantine behavior",
      "Review FileTypes list and add any organization-specific extensions that should be blocked"
    ]
  },
  {
    "_metadata": {
      "id": "DEF05",
      "title": "Anti-Spam Inbound - Strict",
      "description": "Strict inbound anti-spam policy. Routes all spam categories (spam, high-confidence spam, bulk, phish, high-confidence phish) to quarantine instead of junk mail folder. Enables ZAP for retroactive removal. Sets bulk complaint level threshold to 5.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "2.1.2",
        "2.1.6"
      ],
      "severity": "High",
      "category": "Defender for Office 365",
      "deploymentOrder": 5,
      "requiredLicence": "Exchange Online Protection (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "Quarantine is preferred over MoveToJmf (junk mail folder) because users cannot accidentally release quarantined messages without admin approval. BulkThreshold 5 is aggressive; values range from 1 (most strict) to 9 (least strict). IncreaseScoreWith* and MarkAsSpam* settings provide additional heuristic detection. SpamZapEnabled and PhishZapEnabled enable zero-hour auto purge."
    },
    "steps": [
      {
        "cmdlet": "New-HostedContentFilterPolicy",
        "parameters": {
          "Name": "Strict Inbound Anti-Spam Policy",
          "SpamAction": "Quarantine",
          "SpamQuarantineTag": "DefaultFullAccessPolicy",
          "HighConfidenceSpamAction": "Quarantine",
          "HighConfidenceSpamQuarantineTag": "AdminOnlyAccessPolicy",
          "BulkSpamAction": "Quarantine",
          "BulkQuarantineTag": "DefaultFullAccessPolicy",
          "PhishSpamAction": "Quarantine",
          "PhishQuarantineTag": "DefaultFullAccessPolicy",
          "HighConfidencePhishAction": "Quarantine",
          "HighConfidencePhishQuarantineTag": "AdminOnlyAccessPolicy",
          "BulkThreshold": 5,
          "MarkAsSpamBulkMail": "On",
          "IncreaseScoreWithNumericIps": "On",
          "IncreaseScoreWithRedirectToOtherPort": "On",
          "IncreaseScoreWithBizOrInfoUrls": "Off",
          "IncreaseScoreWithImageLinks": "Off",
          "MarkAsSpamEmptyMessages": "On",
          "MarkAsSpamJavaScriptInHtml": "On",
          "MarkAsSpamObjectTagsInHtml": "Off",
          "MarkAsSpamEmbedTagsInHtml": "Off",
          "MarkAsSpamFormTagsInHtml": "Off",
          "MarkAsSpamFramesInHtml": "Off",
          "MarkAsSpamWebBugsInHtml": "Off",
          "MarkAsSpamSensitiveWordList": "Off",
          "MarkAsSpamSpfRecordHardFail": "On",
          "MarkAsSpamFromAddressAuthFail": "On",
          "MarkAsSpamNdrBackscatter": "On",
          "SpamZapEnabled": true,
          "PhishZapEnabled": true,
          "InlineSafetyTipsEnabled": true,
          "QuarantineRetentionPeriod": 30,
          "EndUserSpamNotificationFrequency": 3,
          "EnableEndUserSpamNotifications": true,
          "AllowedSenders": [],
          "AllowedSenderDomains": [],
          "BlockedSenders": [],
          "BlockedSenderDomains": []
        }
      },
      {
        "cmdlet": "New-HostedContentFilterRule",
        "parameters": {
          "Name": "Strict Inbound Anti-Spam Rule - All Recipients",
          "HostedContentFilterPolicy": "Strict Inbound Anti-Spam Policy",
          "RecipientDomainIs": [],
          "Enabled": true,
          "Priority": 0
        }
      }
    ],
    "postDeployment": [
      "Get-HostedContentFilterPolicy -Identity 'Strict Inbound Anti-Spam Policy' | Format-List",
      "Get-HostedContentFilterRule -Identity 'Strict Inbound Anti-Spam Rule - All Recipients' | Format-List",
      "Do NOT add entries to AllowedSenders or AllowedSenderDomains unless absolutely necessary (creates bypass risk)",
      "Monitor quarantine volume for first 7 days; adjust BulkThreshold if too many legitimate bulk emails are quarantined",
      "Review end-user spam notification settings to ensure users can request release of false positives"
    ]
  },
  {
    "_metadata": {
      "id": "DEF06",
      "title": "Anti-Spam Outbound - Strict",
      "description": "Strict outbound spam filtering policy. Limits external recipients to 500/hour and internal to 1000/hour. Blocks users who exceed thresholds (indicates account compromise). Disables automatic external forwarding. Notifies security team of outbound spam detections.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "2.1.15",
        "2.1.2"
      ],
      "severity": "High",
      "category": "Defender for Office 365",
      "deploymentOrder": 6,
      "requiredLicence": "Exchange Online Protection (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "Outbound spam limits protect your tenant IP reputation and prevent compromised accounts from being used for spam campaigns. ActionWhenThresholdReached: BlockUser is the strictest setting and requires admin intervention to unblock. AutoForwardingMode: Off prevents data exfiltration via auto-forwarding rules. NotifyOutboundSpamRecipients should be set to the security operations mailbox."
    },
    "steps": [
      {
        "cmdlet": "New-HostedOutboundSpamFilterPolicy",
        "parameters": {
          "Name": "Strict Outbound Anti-Spam Policy",
          "RecipientLimitExternalPerHour": 500,
          "RecipientLimitInternalPerHour": 1000,
          "RecipientLimitPerDay": 1000,
          "ActionWhenThresholdReached": "BlockUser",
          "AutoForwardingMode": "Off",
          "NotifyOutboundSpam": true,
          "NotifyOutboundSpamRecipients": "",
          "BccSuspiciousOutboundMail": true,
          "BccSuspiciousOutboundAdditionalRecipients": ""
        }
      },
      {
        "cmdlet": "New-HostedOutboundSpamFilterRule",
        "parameters": {
          "Name": "Strict Outbound Anti-Spam Rule - All Senders",
          "HostedOutboundSpamFilterPolicy": "Strict Outbound Anti-Spam Policy",
          "SenderDomainIs": [],
          "Enabled": true,
          "Priority": 0
        }
      }
    ],
    "postDeployment": [
      "Get-HostedOutboundSpamFilterPolicy -Identity 'Strict Outbound Anti-Spam Policy' | Format-List",
      "Get-HostedOutboundSpamFilterRule -Identity 'Strict Outbound Anti-Spam Rule - All Senders' | Format-List",
      "Replace  with the actual security operations mailbox",
      "Communicate to helpdesk: blocked users will need admin unblock via Remove-BlockedConnector or the Security & Compliance portal",
      "Monitor for legitimate high-volume senders (e.g., marketing, automated systems) and create exceptions if necessary"
    ]
  },
  {
    "_metadata": {
      "id": "DEF07",
      "title": "Defender for SharePoint, OneDrive, and Teams",
      "description": "Enables Microsoft Defender for Office 365 file scanning for SharePoint Online, OneDrive for Business, and Microsoft Teams. Enables Safe Documents for Office clients. Prevents users from opening files flagged as malicious in Safe Documents.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "MITRE ATT&CK T1080",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "HITRUST CSF v11",
        "CMMC v2.0",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "ASD Essential Eight",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "2.1.12",
        "2.1.13"
      ],
      "severity": "High",
      "category": "Defender for Office 365",
      "deploymentOrder": 7,
      "requiredLicence": "Microsoft Defender for Office 365 Plan 1 or Plan 2 (Safe Documents requires E5 or Defender P2)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "This is a tenant-wide setting using Set-AtpPolicyForO365 (not a policy/rule pair). EnableATPForSPOTeamsODB scans files uploaded to SharePoint/OneDrive/Teams for malware. EnableSafeDocs sends Protected View documents to the cloud for sandbox analysis. AllowSafeDocsOpen: false prevents users from bypassing Safe Documents warnings. Safe Documents requires Microsoft 365 E5 or Defender for Office 365 Plan 2."
    },
    "cmdlet": "Set-AtpPolicyForO365",
    "parameters": {
      "EnableATPForSPOTeamsODB": true,
      "EnableSafeDocs": true,
      "AllowSafeDocsOpen": false
    },
    "postDeployment": [
      "Get-AtpPolicyForO365 | Format-List",
      "Verify licensing: Safe Documents requires Microsoft 365 E5 or Defender for Office 365 Plan 2",
      "Test by uploading an EICAR test file to a SharePoint document library and verifying it is blocked",
      "Note: There may be a delay of up to 30 minutes before scanning becomes active after enabling"
    ]
  },
  {
    "_metadata": {
      "id": "DEF08",
      "title": "Common Attachment Types Filter - Default Policy",
      "description": "Updates the default malware filter policy to enable the common attachment types filter. Blocks 50+ dangerous file extensions at the transport layer. Uses the default policy so all recipients are covered without needing a rule.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "MITRE ATT&CK T1204.002",
        "NIS2",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "UK NCSC Cyber Essentials v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "CMMC v2.0",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "ASD Essential Eight",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "2.1.1"
      ],
      "severity": "High",
      "category": "Defender for Office 365",
      "deploymentOrder": 8,
      "requiredLicence": "Exchange Online Protection (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "This modifies the built-in Default malware filter policy using Set-MalwareFilterPolicy. The Default policy applies to all recipients automatically. No rule is needed. The FileTypes list below is comprehensive and covers executable, script, archive, disk image, and macro-enabled Office formats. Review the list against business requirements; some organizations may need to allow specific types (e.g., .iso for IT, .apk for mobile development)."
    },
    "cmdlet": "Set-MalwareFilterPolicy",
    "parameters": {
      "Identity": "Default",
      "EnableFileFilter": true,
      "FileTypes": [
        "ace",
        "apk",
        "app",
        "appx",
        "ani",
        "arj",
        "bat",
        "cab",
        "cmd",
        "com",
        "deb",
        "dex",
        "dll",
        "docm",
        "elf",
        "exe",
        "hta",
        "img",
        "iso",
        "jar",
        "jnlp",
        "kext",
        "lha",
        "lib",
        "library",
        "lnk",
        "lzh",
        "macho",
        "msc",
        "msi",
        "msix",
        "msp",
        "mst",
        "pif",
        "ppa",
        "ppam",
        "reg",
        "rev",
        "scf",
        "scr",
        "sh",
        "sys",
        "vb",
        "vbe",
        "vbs",
        "vxd",
        "wsc",
        "wsf",
        "wsh",
        "xll",
        "xz"
      ]
    },
    "postDeployment": [
      "Get-MalwareFilterPolicy -Identity Default | Select-Object -ExpandProperty FileTypes",
      "Test by sending an email with a .exe or .bat attachment to verify it is rejected",
      "Review FileTypes list against business requirements and add or remove extensions as needed",
      "Common legitimate exceptions to consider: .iso (IT teams), .apk (mobile dev), .dll (software dev)"
    ]
  },
  {
    "_metadata": {
      "id": "ENT01",
      "title": "Disable User Consent to Third-Party Apps",
      "description": "Disables the ability for users to consent to third-party OAuth applications accessing corporate data. Removes the legacy default user consent policy, requiring admin approval for all application permission grants. Prevents OAuth phishing and illicit consent grant attacks.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "ISO 27001:2022",
        "NIST SP 800-53 Rev.5",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "GDPR (EU) 2016/679",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "BSI IT-Grundschutz",
        "DORA",
        "ASD Essential Eight",
        "MITRE ATT&CK",
        "Microsoft Cloud Security Benchmark",
        "CJIS v6",
        "EU Cyber Resilience Act"
      ],
      "cisChecks": [
        "5.1.2.1",
        "5.1.5.1"
      ],
      "mitreMappings": [
        "T1550.001",
        "T1528",
        "T1098.003"
      ],
      "requiredLicences": [
        "Microsoft Entra ID Free (included with any M365 plan)"
      ],
      "requiredRoles": [
        "Global Administrator",
        "Privileged Role Administrator"
      ],
      "deploymentOrder": 1,
      "importMethod": "powershell-graph",
      "importScript": "scripts/Import-EntraSettings.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Global Administrator or Privileged Role Administrator role required",
        "Review existing user-consented applications before disabling consent",
        "Deploy ENT02 (Admin Consent Workflow) simultaneously to provide a governed request process",
        "Communicate change to users before deployment"
      ],
      "deploymentSteps": [
        "1. Audit existing user-consented applications via Entra admin center > Enterprise applications",
        "2. Deploy ENT02 (Admin Consent Workflow) first to provide a request mechanism",
        "3. Apply the Graph API PATCH to remove user consent permissions",
        "4. Verify the change via Graph API GET",
        "5. Monitor the admin consent request queue for incoming requests"
      ],
      "rollbackProcedure": "PATCH /policies/authorizationPolicy with permissionGrantPoliciesAssigned including 'ManagePermissionGrantsForSelf.microsoft-user-default-legacy'"
    },
    "graphApiCalls": [
      {
        "stepOrder": 1,
        "description": "Remove all user consent permission grant policies - disable user consent to third-party apps",
        "method": "PATCH",
        "endpoint": "https://graph.microsoft.com/v1.0/policies/authorizationPolicy/authorizationPolicy",
        "headers": {
          "Content-Type": "application/json",
          "Authorization": "Bearer "
        },
        "body": {
          "defaultUserRolePermissions": {
            "permissionGrantPoliciesAssigned": []
          }
        },
        "_explanation": "Setting permissionGrantPoliciesAssigned to an empty array removes 'ManagePermissionGrantsForSelf.microsoft-user-default-legacy' which is the default user consent policy. Users will no longer be able to consent to any application permissions."
      },
      {
        "stepOrder": 2,
        "description": "Verify the user consent policy has been removed",
        "method": "GET",
        "endpoint": "https://graph.microsoft.com/v1.0/policies/authorizationPolicy/authorizationPolicy",
        "expectedResponse": {
          "defaultUserRolePermissions": {
            "permissionGrantPoliciesAssigned": []
          }
        }
      }
    ],
    "powershellAlternative": {
      "module": "Microsoft.Graph",
      "commands": [
        {
          "description": "Connect to Microsoft Graph with required permissions",
          "command": "Connect-MgGraph -Scopes 'Policy.ReadWrite.Authorization'"
        },
        {
          "description": "Update the authorization policy to remove user consent",
          "command": "Update-MgPolicyAuthorizationPolicy -DefaultUserRolePermissions @{ PermissionGrantPoliciesAssigned = @() }"
        },
        {
          "description": "Verify the change",
          "command": "(Get-MgPolicyAuthorizationPolicy).DefaultUserRolePermissions.PermissionGrantPoliciesAssigned"
        }
      ]
    },
    "entraPortalPath": {
      "navigation": "Entra admin center > Identity > Applications > Enterprise applications > Consent and permissions > User consent settings",
      "setting": "Do not allow user consent",
      "_note": "This is the portal equivalent of the Graph API call"
    },
    "auditExistingConsents": {
      "_description": "Before disabling user consent, review existing consented applications",
      "graphApiQuery": {
        "method": "GET",
        "endpoint": "https://graph.microsoft.com/v1.0/oauth2PermissionGrants?$filter=consentType eq 'Principal'",
        "_explanation": "Lists all user-level consent grants. Review these before disabling consent to identify applications that may need admin consent."
      },
      "powershellCommand": "Get-MgOAuth2PermissionGrant -Filter \"consentType eq 'Principal'\" -All | Select-Object ClientId, ConsentType, Scope, PrincipalId"
    }
  },
  {
    "_metadata": {
      "id": "ENT02",
      "title": "Enable Admin Consent Workflow",
      "description": "Enables the admin consent request workflow so that users who need access to applications that require organizational permissions can submit a request for admin review. Provides a governed process to complement ENT01 (disabled user consent).",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "ISO 27001:2022",
        "NIST SP 800-53 Rev.5",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "GDPR (EU) 2016/679",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "BSI IT-Grundschutz",
        "DORA",
        "ASD Essential Eight",
        "MITRE ATT&CK",
        "Microsoft Cloud Security Benchmark",
        "CJIS v6",
        "EU Cyber Resilience Act"
      ],
      "cisChecks": [
        "5.1.5.2"
      ],
      "mitreMappings": [
        "T1550.001",
        "T1528"
      ],
      "requiredLicences": [
        "Microsoft Entra ID Free (included with any M365 plan)"
      ],
      "requiredRoles": [
        "Global Administrator",
        "Privileged Role Administrator"
      ],
      "deploymentOrder": 2,
      "importMethod": "powershell-graph",
      "importScript": "scripts/Import-EntraSettings.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Deploy ENT01 (Disable User Consent) first or simultaneously",
        "Identify admin reviewers who will approve or deny consent requests",
        "Reviewer group must include users with Cloud Application Administrator or Application Administrator role",
        "Global Administrator or Privileged Role Administrator required to configure"
      ],
      "deploymentSteps": [
        "1. Create or identify the reviewer group in Entra ID",
        "2. Apply the Graph API PATCH to enable the admin consent workflow",
        "3. Configure notification and reminder settings",
        "4. Test by requesting consent as a regular user",
        "5. Monitor the admin consent request queue regularly"
      ],
      "rollbackProcedure": "PATCH /policies/adminConsentRequestPolicy with isEnabled: false"
    },
    "graphApiCalls": [
      {
        "stepOrder": 1,
        "description": "Enable admin consent workflow with reviewer notifications and reminders",
        "method": "PATCH",
        "endpoint": "https://graph.microsoft.com/v1.0/policies/adminConsentRequestPolicy",
        "headers": {
          "Content-Type": "application/json",
          "Authorization": "Bearer "
        },
        "body": {
          "isEnabled": true,
          "notifyReviewers": true,
          "remindersEnabled": true,
          "requestDurationInDays": 30,
          "reviewers": [
            {
              "query": "/users/",
              "queryType": "MicrosoftGraph",
              "queryRoot": null
            },
            {
              "query": "/groups//members",
              "queryType": "MicrosoftGraph",
              "queryRoot": null
            }
          ]
        },
        "_explanation": "Enables the workflow, sends notifications to designated reviewers, enables periodic reminders, and auto-expires requests after 30 days if not acted upon."
      },
      {
        "stepOrder": 2,
        "description": "Verify the admin consent workflow is enabled",
        "method": "GET",
        "endpoint": "https://graph.microsoft.com/v1.0/policies/adminConsentRequestPolicy",
        "expectedResponse": {
          "isEnabled": true,
          "notifyReviewers": true,
          "remindersEnabled": true,
          "requestDurationInDays": 30
        }
      }
    ],
    "powershellAlternative": {
      "module": "Microsoft.Graph",
      "commands": [
        {
          "description": "Connect to Microsoft Graph with required permissions",
          "command": "Connect-MgGraph -Scopes 'Policy.ReadWrite.ConsentRequest'"
        },
        {
          "description": "Enable the admin consent workflow",
          "command": "Update-MgPolicyAdminConsentRequestPolicy -IsEnabled -NotifyReviewers -RemindersEnabled -RequestDurationInDays 30 -Reviewers @(@{Query='/groups//members'; QueryType='MicrosoftGraph'})"
        },
        {
          "description": "Verify the configuration",
          "command": "Get-MgPolicyAdminConsentRequestPolicy | Select-Object IsEnabled, NotifyReviewers, RemindersEnabled, RequestDurationInDays"
        }
      ]
    },
    "entraPortalPath": {
      "navigation": "Entra admin center > Identity > Applications > Enterprise applications > Consent and permissions > Admin consent settings",
      "settings": {
        "usersCanRequestAdminConsentToApps": true,
        "selectedUsersToReviewConsentRequests": "",
        "consentRequestExpiresDays": 30,
        "emailNotifications": true,
        "reminderNotifications": true
      }
    }
  },
  {
    "_metadata": {
      "id": "ENT03",
      "title": "Block Users from Creating App Registrations",
      "description": "Disables the ability for non-admin users to register new applications (app registrations) in Entra ID. Prevents shadow IT and unapproved SaaS integrations with corporate M365 data.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "ISO 27001:2022",
        "NIST SP 800-53 Rev.5",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "GDPR (EU) 2016/679",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "BSI IT-Grundschutz",
        "DORA",
        "CMMC v2.0",
        "ASD Essential Eight",
        "MITRE ATT&CK",
        "Microsoft Cloud Security Benchmark",
        "CJIS v6",
        "EU Cyber Resilience Act"
      ],
      "cisChecks": [
        "5.1.2.2"
      ],
      "mitreMappings": [
        "T1098.003",
        "T1550.001",
        "T1528"
      ],
      "requiredLicences": [
        "Microsoft Entra ID Free (included with any M365 plan)"
      ],
      "requiredRoles": [
        "Global Administrator",
        "Privileged Role Administrator"
      ],
      "deploymentOrder": 3,
      "importMethod": "powershell-graph",
      "importScript": "scripts/Import-EntraSettings.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Global Administrator or Privileged Role Administrator role required",
        "Communicate to developers/IT that app registrations must go through an approved process",
        "Establish an app registration request process (e.g., ServiceNow ticket) before deploying"
      ],
      "deploymentSteps": [
        "1. Audit existing user-created app registrations",
        "2. Establish an approved app registration request process",
        "3. Apply the Graph API PATCH to disable user app registrations",
        "4. Verify the change",
        "5. Communicate the new process to development teams"
      ],
      "rollbackProcedure": "PATCH /policies/authorizationPolicy with allowedToCreateApps: true"
    },
    "graphApiCalls": [
      {
        "stepOrder": 1,
        "description": "Disable users from creating app registrations",
        "method": "PATCH",
        "endpoint": "https://graph.microsoft.com/v1.0/policies/authorizationPolicy/authorizationPolicy",
        "headers": {
          "Content-Type": "application/json",
          "Authorization": "Bearer "
        },
        "body": {
          "defaultUserRolePermissions": {
            "allowedToCreateApps": false
          }
        },
        "_explanation": "Setting allowedToCreateApps to false prevents non-admin users from creating new application registrations in Entra ID. Only users with Application Administrator, Cloud Application Administrator, or Application Developer roles can create registrations."
      },
      {
        "stepOrder": 2,
        "description": "Verify that users cannot create app registrations",
        "method": "GET",
        "endpoint": "https://graph.microsoft.com/v1.0/policies/authorizationPolicy/authorizationPolicy",
        "expectedResponse": {
          "defaultUserRolePermissions": {
            "allowedToCreateApps": false
          }
        }
      }
    ],
    "powershellAlternative": {
      "module": "Microsoft.Graph",
      "commands": [
        {
          "description": "Connect to Microsoft Graph",
          "command": "Connect-MgGraph -Scopes 'Policy.ReadWrite.Authorization'"
        },
        {
          "description": "Disable user app registration",
          "command": "Update-MgPolicyAuthorizationPolicy -DefaultUserRolePermissions @{ AllowedToCreateApps = $false }"
        },
        {
          "description": "Verify the change",
          "command": "(Get-MgPolicyAuthorizationPolicy).DefaultUserRolePermissions.AllowedToCreateApps"
        }
      ]
    },
    "entraPortalPath": {
      "navigation": "Entra admin center > Identity > Users > User settings",
      "setting": "Users can register applications: No"
    }
  },
  {
    "_metadata": {
      "id": "ENT04",
      "title": "Configure Custom Banned Password List",
      "description": "Configures Entra ID Password Protection with a custom banned password list containing organisation-specific terms (company name, product names, common weak passwords). Enforces the banned list for both cloud and on-premises Active Directory password changes.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "ISO 27001:2022",
        "NIST SP 800-53 Rev.5",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "GDPR (EU) 2016/679",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "BSI IT-Grundschutz",
        "DORA",
        "CMMC v2.0",
        "NERC-CIP",
        "ASD Essential Eight",
        "MITRE ATT&CK",
        "CJIS v6",
        "EU Cyber Resilience Act"
      ],
      "cisChecks": [
        "5.2.3.2",
        "5.2.3.3"
      ],
      "mitreMappings": [
        "T1110.001",
        "T1110.003",
        "T1078"
      ],
      "requiredLicences": [
        "Microsoft Entra ID P1 or P2 (for custom banned password list)",
        "Microsoft 365 E3 or E5 (includes Entra ID P1/P2)"
      ],
      "requiredRoles": [
        "Global Administrator",
        "Security Administrator"
      ],
      "deploymentOrder": 4,
      "importMethod": "powershell-graph",
      "importScript": "scripts/Import-EntraSettings.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Entra ID P1 or P2 licence required for custom banned passwords",
        "Maximum 1000 entries in the custom banned password list",
        "Each entry must be between 4 and 16 characters",
        "For on-premises enforcement, Azure AD Password Protection proxy and DC agents must be installed",
        "The global banned password list is always enforced automatically (no configuration needed)"
      ],
      "deploymentSteps": [
        "1. Compile the custom banned password list (company-specific terms)",
        "2. Apply the Graph API PATCH to configure password protection settings",
        "3. Set on-premises mode to Enforce (if hybrid AD environment)",
        "4. For on-prem: Install Azure AD Password Protection proxy on a domain-joined server",
        "5. For on-prem: Install the DC agent on all domain controllers",
        "6. Verify enforcement by attempting a password change with a banned term"
      ],
      "rollbackProcedure": "PATCH the settings to set enableBannedPasswordCheck to false or switch bannedPasswordCheckOnPremisesMode to 'Audit'."
    },
    "graphApiCalls": [
      {
        "stepOrder": 1,
        "description": "Configure custom banned password list and enable enforcement",
        "method": "PATCH",
        "endpoint": "https://graph.microsoft.com/v1.0/settings/",
        "headers": {
          "Content-Type": "application/json",
          "Authorization": "Bearer "
        },
        "body": {
          "values": [
            {
              "name": "BannedPasswordCheckOnPremisesMode",
              "value": "Enforce"
            },
            {
              "name": "EnableBannedPasswordCheck",
              "value": "true"
            },
            {
              "name": "CustomBannedPasswords",
              "value": "\n\n\n\npassword\nwelcome\nqwerty\nletmein\nchangeme\nadmin123\nsummer\nwinter\nautumn\nspring\nmonday\nfootball\nbaseball"
            },
            {
              "name": "EnableBannedPasswordCheckOnPremises",
              "value": "true"
            }
          ]
        },
        "_explanation": "Enables the custom banned password list with organisation-specific terms. Passwords containing these terms (including fuzzy matching variations) will be rejected. Newline-separated values in CustomBannedPasswords."
      },
      {
        "stepOrder": 2,
        "description": "Verify password protection settings",
        "method": "GET",
        "endpoint": "https://graph.microsoft.com/v1.0/settings",
        "filter": "templateId eq '5cf42378-d67d-4f36-ba46-e8b86229381d'",
        "expectedResponse": {
          "values": {
            "EnableBannedPasswordCheck": "true",
            "BannedPasswordCheckOnPremisesMode": "Enforce"
          }
        }
      }
    ],
    "powershellAlternative": {
      "module": "Microsoft.Graph",
      "commands": [
        {
          "description": "Connect to Microsoft Graph",
          "command": "Connect-MgGraph -Scopes 'Directory.ReadWrite.All'"
        },
        {
          "description": "Get the current password protection settings ID",
          "command": "$settings = Get-MgDirectorySetting | Where-Object { $_.TemplateId -eq '5cf42378-d67d-4f36-ba46-e8b86229381d' }"
        },
        {
          "description": "Update custom banned passwords",
          "command": "Update-MgDirectorySetting -DirectorySettingId $settings.Id -Values @(@{Name='EnableBannedPasswordCheck'; Value='true'}, @{Name='BannedPasswordCheckOnPremisesMode'; Value='Enforce'}, @{Name='CustomBannedPasswords'; Value=\"`n`npassword`nwelcome`nqwerty`nletmein`nchangeme\"})"
        }
      ]
    },
    "entraPortalPath": {
      "navigation": "Entra admin center > Protection > Authentication methods > Password protection",
      "settings": {
        "customBannedPasswords": "Enabled",
        "customList": [
          "password",
          "welcome",
          "qwerty",
          "letmein",
          "changeme"
        ],
        "enablePasswordProtectionOnWindoesServerActiveDirectory": true,
        "mode": "Enforced"
      }
    },
    "customBannedPasswordList": {
      "_description": "Replace placeholders with actual organisation-specific terms. Maximum 1000 entries, 4-16 characters each.",
      "organisationSpecific": [],
      "commonWeakPasswords": [
        "password",
        "welcome",
        "qwerty",
        "letmein",
        "changeme",
        "admin123",
        "temp1234",
        "summer",
        "winter",
        "autumn",
        "spring",
        "monday",
        "football",
        "baseball",
        "shadow",
        "master"
      ],
      "_note": "Entra ID applies fuzzy matching: 'company' also blocks 'c0mp@ny', 'COMPANY', 'Company123', etc."
    }
  },
  {
    "_metadata": {
      "id": "ENT05",
      "title": "Restrict User Device Registration",
      "description": "Restricts Azure AD / Entra ID device registration to a managed group or admins only, preventing users from silently registering personal devices and obtaining device-based Conditional Access tokens. Sets a device quota of 5 per user.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "ISO 27001:2022",
        "NIST SP 800-53 Rev.5",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "GDPR (EU) 2016/679",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "BSI IT-Grundschutz",
        "DORA",
        "CMMC v2.0",
        "NERC-CIP",
        "ASD Essential Eight",
        "NZ ISM v3.8",
        "MITRE ATT&CK",
        "Microsoft Cloud Security Benchmark",
        "CJIS v6",
        "EU Cyber Resilience Act"
      ],
      "cisChecks": [
        "5.1.3.1"
      ],
      "mitreMappings": [
        "T1078",
        "T1098",
        "T1136"
      ],
      "requiredLicences": [
        "Microsoft Entra ID Free (included with any M365 plan)"
      ],
      "requiredRoles": [
        "Global Administrator",
        "Cloud Device Administrator"
      ],
      "deploymentOrder": 5,
      "importMethod": "powershell-graph",
      "importScript": "scripts/Import-EntraSettings.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Create a security group for users/groups permitted to register devices",
        "Identify the device registration policy requirements for your Intune/MDM enrolment flows",
        "Ensure IT helpdesk and device provisioning teams are in the allowed group",
        "Autopilot and Intune enrolment may require device registration permissions"
      ],
      "deploymentSteps": [
        "1. Create a security group for allowed device registrars (e.g., 'Device Registration Allowed Users')",
        "2. Apply the Graph API PATCH to restrict device registration",
        "3. Set the device quota per user",
        "4. Verify that regular users cannot register devices",
        "5. Test that Intune enrolment and Autopilot still function correctly"
      ],
      "rollbackProcedure": "PATCH /policies/deviceRegistrationPolicy to restore allowedUsers to all users or increase the user device quota."
    },
    "graphApiCalls": [
      {
        "stepOrder": 1,
        "description": "Restrict Azure AD device registration to specific group",
        "method": "PATCH",
        "endpoint": "https://graph.microsoft.com/v1.0/policies/deviceRegistrationPolicy",
        "headers": {
          "Content-Type": "application/json",
          "Authorization": "Bearer "
        },
        "body": {
          "userDeviceQuota": 5,
          "azureADRegistration": {
            "isAdminConfigurable": true,
            "allowedToRegister": {
              "@odata.type": "#microsoft.graph.enumeratedDeviceRegistrationMembership",
              "users": [],
              "groups": []
            }
          },
          "azureADJoin": {
            "isAdminConfigurable": true,
            "allowedToJoin": {
              "@odata.type": "#microsoft.graph.enumeratedDeviceRegistrationMembership",
              "users": [],
              "groups": []
            }
          },
          "localAdminPassword": {
            "isEnabled": true
          }
        },
        "_explanation": "Restricts both Azure AD registration and Azure AD join to members of the specified security group. Sets a maximum of 5 devices per user. Enables Windows LAPS integration."
      },
      {
        "stepOrder": 2,
        "description": "Verify device registration policy",
        "method": "GET",
        "endpoint": "https://graph.microsoft.com/v1.0/policies/deviceRegistrationPolicy",
        "expectedResponse": {
          "userDeviceQuota": 5,
          "azureADRegistration": {
            "isAdminConfigurable": true
          }
        }
      }
    ],
    "powershellAlternative": {
      "module": "Microsoft.Graph",
      "commands": [
        {
          "description": "Connect to Microsoft Graph",
          "command": "Connect-MgGraph -Scopes 'Policy.ReadWrite.DeviceConfiguration'"
        },
        {
          "description": "Get current device registration policy",
          "command": "Get-MgPolicyDeviceRegistrationPolicy | ConvertTo-Json -Depth 5"
        },
        {
          "description": "Update device registration policy",
          "command": "Update-MgPolicyDeviceRegistrationPolicy -UserDeviceQuota 5 -AzureAdRegistration @{IsAdminConfigurable=$true; AllowedToRegister=@{Groups=@('')}}"
        }
      ]
    },
    "entraPortalPath": {
      "navigation": "Entra admin center > Identity > Devices > Device settings",
      "settings": {
        "usersCanJoinDevicesToAzureAd": "Selected (group)",
        "selectedGroup": "",
        "usersCanRegisterDevices": "Selected (group)",
        "maximumNumberOfDevicesPerUser": 5,
        "requireMultiFactorAuthToRegisterOrJoinDevices": true
      }
    }
  },
  {
    "_metadata": {
      "id": "ENT06",
      "title": "Restrict Guest Invitations to Admins and Guest Inviters",
      "description": "Restricts the ability to invite external guest users to Entra ID to administrators and users in the Guest Inviter role only. Prevents regular users and existing guests from inviting additional external users without IT oversight.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "ISO 27001:2022",
        "NIST SP 800-53 Rev.5",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "GDPR (EU) 2016/679",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "BSI IT-Grundschutz",
        "DORA",
        "CMMC v2.0",
        "NERC-CIP",
        "ASD Essential Eight",
        "NZ ISM v3.8",
        "MITRE ATT&CK",
        "Microsoft Cloud Security Benchmark",
        "CJIS v6",
        "EU Cyber Resilience Act"
      ],
      "cisChecks": [
        "5.1.6.2",
        "5.1.6.3"
      ],
      "mitreMappings": [
        "T1078.004",
        "T1136.003",
        "T1098"
      ],
      "requiredLicences": [
        "Microsoft Entra ID Free (included with any M365 plan)"
      ],
      "requiredRoles": [
        "Global Administrator",
        "External Identity Provider Administrator"
      ],
      "deploymentOrder": 6,
      "importMethod": "powershell-graph",
      "importScript": "scripts/Import-EntraSettings.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Review current guest invitation patterns before restricting",
        "Identify business users who legitimately need to invite guests and assign them Guest Inviter role",
        "Establish a guest invitation request process for regular users",
        "Consider impact on Teams external sharing and SharePoint guest access"
      ],
      "guestInvitationLevels": {
        "none": "No one can invite guests (most restrictive)",
        "adminsAndGuestInviters": "Only admins and users in Guest Inviter role can invite (recommended)",
        "adminsGuestInvitersAndAllMembers": "All members can invite guests",
        "everyone": "Anyone including guests can invite guests (least restrictive - default)"
      },
      "deploymentSteps": [
        "1. Audit current guest users and invitation patterns",
        "2. Assign Guest Inviter role to users who need invitation capabilities",
        "3. Apply the Graph API PATCH to restrict invitations",
        "4. Verify the change and test that restricted users cannot invite",
        "5. Communicate the new guest invitation process"
      ],
      "rollbackProcedure": "PATCH /policies/authorizationPolicy with allowInvitesFrom: 'adminsGuestInvitersAndAllMembers' or 'everyone'"
    },
    "graphApiCalls": [
      {
        "stepOrder": 1,
        "description": "Restrict guest invitations to admins and Guest Inviter role members only",
        "method": "PATCH",
        "endpoint": "https://graph.microsoft.com/v1.0/policies/authorizationPolicy/authorizationPolicy",
        "headers": {
          "Content-Type": "application/json",
          "Authorization": "Bearer "
        },
        "body": {
          "allowInvitesFrom": "adminsAndGuestInviters"
        },
        "_explanation": "Setting allowInvitesFrom to 'adminsAndGuestInviters' means only users with Global Administrator, User Administrator, or Guest Inviter roles can invite external guests. Regular users and existing guests cannot send invitations."
      },
      {
        "stepOrder": 2,
        "description": "Verify the guest invitation restriction",
        "method": "GET",
        "endpoint": "https://graph.microsoft.com/v1.0/policies/authorizationPolicy/authorizationPolicy",
        "expectedResponse": {
          "allowInvitesFrom": "adminsAndGuestInviters"
        }
      }
    ],
    "powershellAlternative": {
      "module": "Microsoft.Graph",
      "commands": [
        {
          "description": "Connect to Microsoft Graph",
          "command": "Connect-MgGraph -Scopes 'Policy.ReadWrite.Authorization'"
        },
        {
          "description": "Restrict guest invitations",
          "command": "Update-MgPolicyAuthorizationPolicy -AllowInvitesFrom 'adminsAndGuestInviters'"
        },
        {
          "description": "Verify the change",
          "command": "(Get-MgPolicyAuthorizationPolicy).AllowInvitesFrom"
        },
        {
          "description": "Assign Guest Inviter role to specific users",
          "command": "New-MgRoleManagementDirectoryRoleAssignment -PrincipalId '' -RoleDefinitionId '95e79109-95c0-4d8e-aee3-d01accf2d47b' -DirectoryScopeId '/'"
        }
      ]
    },
    "entraPortalPath": {
      "navigation": "Entra admin center > Identity > External Identities > External collaboration settings",
      "settings": {
        "guestInviteSettings": "Only users assigned to specific admin roles can invite guest users",
        "_options": [
          "Anyone in the organization can invite guest users including guests and non-admins (most inclusive)",
          "Member users and users assigned to specific admin roles can invite guest users including guests with member permissions",
          "Only users assigned to specific admin roles can invite guest users (recommended)",
          "No one in the organization can invite guest users including admins (most restrictive)"
        ]
      }
    },
    "guestInviterRoleId": {
      "roleId": "95e79109-95c0-4d8e-aee3-d01accf2d47b",
      "roleName": "Guest Inviter",
      "_note": "Assign this role to specific users who need to invite external guests"
    }
  },
  {
    "_metadata": {
      "id": "ENT07",
      "title": "Configure Self-Service Password Reset with Two Methods Required",
      "description": "Enables Self-Service Password Reset (SSPR) for all users and requires two authentication methods for password reset. Prevents account takeover via single-method SSPR while reducing helpdesk burden for password resets.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "DORA",
        "NIS2",
        "ISO 27001:2022",
        "NIST SP 800-53 Rev.5",
        "SOC 2",
        "CMMC v2.0",
        "UK NCSC CAF v3.2",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "HITRUST CSF v11",
        "BSI IT-Grundschutz"
      ],
      "cisChecks": [
        "5.2.4.1"
      ],
      "mitreMappings": [
        "T1078",
        "T1110",
        "T1556"
      ],
      "requiredLicences": [
        "Microsoft Entra ID P1 or P2 (for SSPR)",
        "Microsoft 365 E3 or E5 (includes Entra ID P1/P2)"
      ],
      "requiredRoles": [
        "Global Administrator",
        "Authentication Policy Administrator"
      ],
      "deploymentOrder": 7,
      "importMethod": "powershell-graph",
      "importScript": "scripts/Import-EntraSettings.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Entra ID P1 or P2 licence required for SSPR",
        "Users must register at least two authentication methods",
        "Combined registration experience should be enabled",
        "For hybrid environments, password writeback must be configured in Azure AD Connect",
        "Consider enabling the registration campaign to prompt unregistered users"
      ],
      "availableMethods": {
        "microsoftAuthenticatorApp": "Push notification or TOTP code via Microsoft Authenticator",
        "mobilePhone": "SMS or voice call to registered mobile number",
        "email": "Verification code to registered alternative email",
        "securityQuestions": "Pre-registered security questions (not recommended as primary)",
        "officePhone": "Voice call to office phone number"
      },
      "deploymentSteps": [
        "1. Enable combined registration experience if not already enabled",
        "2. Configure SSPR to require 2 methods via Graph API",
        "3. Enable password writeback if hybrid AD (Azure AD Connect)",
        "4. Run a registration campaign to ensure users register methods",
        "5. Test SSPR flow with a test user",
        "6. Monitor registration completeness via Authentication Methods activity"
      ],
      "rollbackProcedure": "Set numberOfAuthenticationMethodsRequired to 1 or disable SSPR via selfServicePasswordResetEnabled: false"
    },
    "graphApiCalls": [
      {
        "stepOrder": 1,
        "description": "Configure SSPR to require 2 authentication methods for all users",
        "method": "PATCH",
        "endpoint": "https://graph.microsoft.com/v1.0/policies/authenticationMethodsPolicy",
        "headers": {
          "Content-Type": "application/json",
          "Authorization": "Bearer "
        },
        "body": {
          "registrationEnforcement": {
            "authenticationMethodsRegistrationCampaign": {
              "state": "enabled",
              "snoozeDurationInDays": 3,
              "includeTargets": [
                {
                  "id": "all_users",
                  "targetType": "group",
                  "targetedAuthenticationMethod": "microsoftAuthenticator"
                }
              ]
            }
          }
        },
        "_explanation": "Enables the registration campaign to ensure users register the Microsoft Authenticator app as an authentication method."
      },
      {
        "stepOrder": 2,
        "description": "Enable SSPR for all users with 2 methods required",
        "method": "PATCH",
        "endpoint": "https://graph.microsoft.com/beta/policies/authenticationMethodsPolicy",
        "body": {
          "selfServicePasswordReset": {
            "isEnabled": true,
            "numberOfAuthenticationMethodsRequired": 2,
            "allowedMethods": [
              "mobilePhone",
              "email",
              "securityQuestions",
              "microsoftAuthenticator"
            ]
          }
        },
        "_explanation": "Enables SSPR for all users requiring 2 of the 4 allowed methods for password reset."
      }
    ],
    "powershellAlternative": {
      "module": "Microsoft.Graph",
      "commands": [
        {
          "description": "Connect to Microsoft Graph",
          "command": "Connect-MgGraph -Scopes 'Policy.ReadWrite.AuthenticationMethod'"
        },
        {
          "description": "Enable registration campaign for Microsoft Authenticator",
          "command": "Update-MgPolicyAuthenticationMethodPolicy -RegistrationEnforcement @{AuthenticationMethodsRegistrationCampaign=@{State='enabled'; SnoozeDurationInDays=3; IncludeTargets=@(@{Id='all_users'; TargetType='group'; TargetedAuthenticationMethod='microsoftAuthenticator'})}}"
        }
      ]
    },
    "entraPortalPath": {
      "navigation": "Entra admin center > Protection > Password reset",
      "settings": {
        "selfServicePasswordResetEnabled": "All",
        "numberOfMethodsRequired": 2,
        "methodsAvailableToUsers": [
          "Mobile app notification (Microsoft Authenticator)",
          "Mobile app code (Microsoft Authenticator)",
          "Mobile phone (SMS/Call)",
          "Email",
          "Security questions"
        ],
        "securityQuestionsRequired": 5,
        "securityQuestionsToReset": 3
      }
    },
    "passwordWritebackConfig": {
      "_description": "For hybrid AD environments, enable password writeback via Azure AD Connect",
      "azureAdConnectSettings": {
        "passwordWritebackEnabled": true,
        "selfServicePasswordResetEnabled": true,
        "_note": "Requires Azure AD Connect v1.4.0.0 or later with password writeback feature enabled"
      }
    }
  },
  {
    "_metadata": {
      "id": "ENT08",
      "title": "Disable LinkedIn Account Connection",
      "description": "Disables the LinkedIn account connection feature in Microsoft 365, preventing users from linking their M365 work account with LinkedIn. Mitigates data leakage risk and reduces social engineering exposure by preventing M365 profile data correlation with LinkedIn profiles.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "ISO 27001:2022",
        "NIST SP 800-53 Rev.5",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "GDPR (EU) 2016/679",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "BSI IT-Grundschutz",
        "DORA",
        "CMMC v2.0",
        "NERC-CIP",
        "ASD Essential Eight",
        "NZ ISM v3.8",
        "MITRE ATT&CK",
        "Microsoft Cloud Security Benchmark",
        "CJIS v6",
        "EU Cyber Resilience Act"
      ],
      "cisChecks": [
        "5.1.2.6"
      ],
      "mitreMappings": [
        "T1589",
        "T1593",
        "T1598"
      ],
      "requiredLicences": [
        "Microsoft Entra ID Free (included with any M365 plan)"
      ],
      "requiredRoles": [
        "Global Administrator"
      ],
      "deploymentOrder": 8,
      "importMethod": "powershell-graph",
      "importScript": "scripts/Import-EntraSettings.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Global Administrator role required",
        "Understand that disabling this feature removes LinkedIn profile cards, resume assistant, and profile enrichment in M365 apps",
        "Communicate to users that LinkedIn integration will no longer show in Outlook, Teams, and other M365 apps"
      ],
      "deploymentSteps": [
        "1. Apply the Graph API PATCH to disable LinkedIn connections",
        "2. Verify the setting is disabled",
        "3. Existing LinkedIn connections will stop working within 24 hours",
        "4. Communicate the change to users"
      ],
      "rollbackProcedure": "PATCH /settings with enableLinkedInAccountConnection: true"
    },
    "graphApiCalls": [
      {
        "stepOrder": 1,
        "description": "Disable LinkedIn account connections for the organisation",
        "method": "PATCH",
        "endpoint": "https://graph.microsoft.com/v1.0/settings/",
        "headers": {
          "Content-Type": "application/json",
          "Authorization": "Bearer "
        },
        "body": {
          "values": [
            {
              "name": "EnableLinkedInAccountConnection",
              "value": "false"
            }
          ]
        },
        "_explanation": "Disables the ability for users to connect their Microsoft 365 work accounts with LinkedIn. When disabled, LinkedIn profile data will not appear in M365 apps (Outlook, Teams, etc.) and users cannot link their accounts."
      },
      {
        "stepOrder": 2,
        "description": "Verify LinkedIn account connection is disabled",
        "method": "GET",
        "endpoint": "https://graph.microsoft.com/v1.0/settings",
        "expectedResponse": {
          "values": {
            "EnableLinkedInAccountConnection": "false"
          }
        }
      }
    ],
    "powershellAlternative": {
      "module": "Microsoft.Graph",
      "commands": [
        {
          "description": "Connect to Microsoft Graph",
          "command": "Connect-MgGraph -Scopes 'Directory.ReadWrite.All'"
        },
        {
          "description": "Get the directory settings ID for LinkedIn integration",
          "command": "$settings = Get-MgDirectorySetting | Where-Object { $_.DisplayName -eq 'LinkedIn' }"
        },
        {
          "description": "Disable LinkedIn account connections",
          "command": "Update-MgDirectorySetting -DirectorySettingId $settings.Id -Values @(@{Name='EnableLinkedInAccountConnection'; Value='false'})"
        },
        {
          "description": "Verify the change",
          "command": "(Get-MgDirectorySetting | Where-Object { $_.DisplayName -eq 'LinkedIn' }).Values | Where-Object { $_.Name -eq 'EnableLinkedInAccountConnection' }"
        }
      ]
    },
    "entraPortalPath": {
      "navigation": "Entra admin center > Identity > Users > User settings > LinkedIn account connections",
      "setting": "No - Users cannot connect their work or school account with LinkedIn",
      "_note": "This is the portal equivalent of the Graph API call"
    }
  },
  {
    "id": "ENT09",
    "file": "ENT09-Hide-Stay-Signed-In-Prompt.json",
    "type": "entra",
    "displayName": "ENT09 | Hide-Stay-Signed-In-Prompt",
    "description": "Disables 'Stay signed in?' prompt on Entra ID sign-in page. Prevents persistent browser sessions on shared/unmanaged devices. Complements CA13.",
    "frameworks": [
      "NIS2",
      "ISO 27001:2022",
      "NIST SP 800-53 Rev.5",
      "UK NCSC CAF v3.2",
      "SOC 2",
      "GDPR (EU) 2016/679",
      "FedRAMP Moderate",
      "HITRUST CSF v11",
      "BSI IT-Grundschutz",
      "ENS (Spain) RD311/22",
      "IASME Cyber Assurance",
      "UK CS&R Bill 2025",
      "NIST CSF 1.1",
      "NIST SP 800-171 Rev.3",
      "CMMC v2.0",
      "UK NCSC Cyber Essentials v3.2",
      "NZ ISM v3.8",
      "CSA CCM v4",
      "CRI Profile v2.0",
      "CJIS v6",
      "EU Cyber Resilience Act",
      "ISO 27017:2015",
      "ISO 27701:2019"
    ],
    "cisChecks": [
      "5.1.2.5"
    ],
    "importMethod": "powershell-graph",
    "importScript": "scripts/Import-EntraSettings.ps1",
    "deployState": "",
    "prerequisite": "",
    "requiredLicence": "",
    "version": "1.0",
    "path": "policies/entra/ENT09-Hide-Stay-Signed-In-Prompt.json"
  },
  {
    "id": "ENT10",
    "file": "ENT10-Configure-Authenticator-Number-Matching.json",
    "type": "entra",
    "displayName": "ENT10 | Configure-Authenticator-Number-Matching",
    "description": "Enables number matching and additional context for Microsoft Authenticator push notifications. Prevents MFA fatigue attacks. Requires users to type number shown at sign-in into Authenticator app.",
    "frameworks": [
      "NIS2",
      "ISO 27001:2022",
      "NIST SP 800-53 Rev.5",
      "UK NCSC CAF v3.2",
      "SOC 2",
      "GDPR (EU) 2016/679",
      "FedRAMP Moderate",
      "HITRUST CSF v11",
      "BSI IT-Grundschutz",
      "ENS (Spain) RD311/22",
      "IASME Cyber Assurance",
      "UK CS&R Bill 2025",
      "DORA",
      "NIST CSF 1.1",
      "UK NCSC Cyber Essentials v3.2",
      "ASD Essential Eight",
      "NZ ISM v3.8",
      "MITRE ATT&CK",
      "CISA CPG",
      "CRI Profile v2.0",
      "Microsoft Cloud Security Benchmark",
      "CJIS v6",
      "HPH CPGs",
      "TSA Security Directive",
      "EU Cyber Resilience Act",
      "SEC Cyber Rule"
    ],
    "cisChecks": [
      "1.2.1",
      "5.2.3.4",
      "5.2.3.5"
    ],
    "importMethod": "powershell-graph",
    "importScript": "scripts/Import-EntraSettings.ps1",
    "deployState": "",
    "prerequisite": "",
    "requiredLicence": "",
    "version": "1.0",
    "path": "policies/entra/ENT10-Configure-Authenticator-Number-Matching.json"
  },
  {
    "_metadata": {
      "id": "EXO01",
      "title": "DKIM - Enable for All Domains",
      "description": "Enables DomainKeys Identified Mail (DKIM) signing for all accepted domains in Exchange Online. Creates DKIM signing configurations and enables them. DKIM cryptographically signs outbound email to prove domain authenticity and detect message tampering.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "CMMC v2.0",
        "HITRUST CSF v11",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "2.1.8",
        "6.2.2"
      ],
      "severity": "High",
      "category": "Exchange Online",
      "deploymentOrder": 1,
      "requiredLicence": "Exchange Online (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "PREREQUISITE: Before enabling DKIM, you must create two CNAME records in DNS for each domain. The CNAME names are selector1._domainkey.<domain> and selector2._domainkey.<domain>, pointing to selector1-<domain-dashes>._domainkey.<tenant>.onmicrosoft.com and selector2-<domain-dashes>._domainkey.<tenant>.onmicrosoft.com respectively. DKIM signing will fail to enable if DNS records are not yet propagated. Allow 24-48 hours for DNS propagation before running Set-DkimSigningConfig -Enabled $true."
    },
    "steps": [
      {
        "cmdlet": "New-DkimSigningConfig",
        "parameters": {
          "DomainName": "",
          "KeySize": 2048,
          "Enabled": true
        },
        "_notes": "Run this for each accepted domain. If the signing config already exists, skip to Set-DkimSigningConfig."
      },
      {
        "cmdlet": "Set-DkimSigningConfig",
        "parameters": {
          "Identity": "",
          "Enabled": true
        },
        "_notes": "Use this to enable DKIM on domains that already have a signing config but are not yet enabled."
      }
    ],
    "dnsRecords": {
      "_notes": "Create these CNAME records in your DNS provider BEFORE enabling DKIM",
      "record1": {
        "type": "CNAME",
        "name": "selector1._domainkey.",
        "value": "selector1-._domainkey..onmicrosoft.com",
        "ttl": 3600
      },
      "record2": {
        "type": "CNAME",
        "name": "selector2._domainkey.",
        "value": "selector2-._domainkey..onmicrosoft.com",
        "ttl": 3600
      }
    },
    "postDeployment": [
      "Get-DkimSigningConfig | Format-List Domain, Enabled, Status, Selector1CNAME, Selector2CNAME",
      "For each domain, verify DNS CNAME records are published: nslookup -type=CNAME selector1._domainkey.",
      "Send a test email to an external address and verify DKIM-Signature header is present",
      "Use https://mxtoolbox.com/dkim.aspx to validate DKIM records externally",
      "If New-DkimSigningConfig fails with 'CNAME record does not exist', verify DNS propagation and retry after 24 hours"
    ]
  },
  {
    "_metadata": {
      "id": "EXO02",
      "title": "DMARC Policy Enforcement",
      "description": "Configures Domain-based Message Authentication, Reporting, and Conformance (DMARC) via DNS TXT records. DMARC builds on SPF and DKIM to prevent domain spoofing. Includes a staged rollout plan from monitoring (p=none) through quarantine to full reject enforcement.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "CMMC v2.0",
        "HITRUST CSF v11",
        "UK NCSC Cyber Essentials v3.2",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "2.1.10"
      ],
      "severity": "High",
      "category": "Exchange Online",
      "deploymentOrder": 2,
      "requiredLicence": "None (DNS configuration only)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "DMARC is a DNS record, not a PowerShell setting. SPF and DKIM MUST be correctly configured before enforcing DMARC. Follow the staged rollout: start with p=none to monitor, then p=quarantine, then p=reject. The rua address receives aggregate reports; the ruf address receives forensic (failure) reports. adkim=s and aspf=s enforce strict alignment. Use a DMARC reporting tool (e.g., Valimail, dmarcian, Agari) to analyze reports before moving to enforcement."
    },
    "deploymentType": "dns-record",
    "stagedRollout": [
      {
        "stage": 1,
        "name": "Monitor Only",
        "duration": "2-4 weeks minimum",
        "dnsRecord": {
          "type": "TXT",
          "name": "_dmarc.",
          "value": "v=DMARC1; p=none; rua=mailto:; ruf=mailto:; fo=1; adkim=r; aspf=r; pct=100; ri=86400",
          "ttl": 3600
        },
        "_notes": "p=none only monitors and reports without taking action. Use this phase to identify all legitimate sending sources and fix SPF/DKIM alignment issues. adkim=r and aspf=r use relaxed alignment during monitoring."
      },
      {
        "stage": 2,
        "name": "Quarantine (Partial Enforcement)",
        "duration": "2-4 weeks",
        "dnsRecord": {
          "type": "TXT",
          "name": "_dmarc.",
          "value": "v=DMARC1; p=quarantine; rua=mailto:; ruf=mailto:; fo=1; adkim=s; aspf=s; pct=25; ri=86400",
          "ttl": 3600
        },
        "_notes": "p=quarantine with pct=25 quarantines 25% of failing messages. Gradually increase pct to 50, 75, then 100 over subsequent weeks. Switch to strict alignment (adkim=s, aspf=s)."
      },
      {
        "stage": 3,
        "name": "Full Reject Enforcement",
        "duration": "Permanent",
        "dnsRecord": {
          "type": "TXT",
          "name": "_dmarc.",
          "value": "v=DMARC1; p=reject; rua=mailto:; ruf=mailto:; fo=1; adkim=s; aspf=s; pct=100; ri=86400",
          "ttl": 3600
        },
        "_notes": "p=reject instructs receiving servers to reject messages that fail DMARC. This is the target state for full domain spoofing protection. Only deploy after confirming all legitimate sources pass DMARC alignment."
      }
    ],
    "postDeployment": [
      "Verify DNS record: nslookup -type=TXT _dmarc.",
      "Use https://mxtoolbox.com/dmarc.aspx to validate the DMARC record",
      "Subscribe to a DMARC reporting service to analyze aggregate (rua) reports",
      "Review reports for 2-4 weeks before advancing to the next enforcement stage",
      "Ensure all third-party senders (marketing platforms, CRM, etc.) are included in SPF and have DKIM configured"
    ]
  },
  {
    "_metadata": {
      "id": "EXO03",
      "title": "Block External Auto-Forwarding",
      "description": "Blocks automatic email forwarding to external domains using both the Remote Domain default setting and a transport rule. This is a critical anti-data-exfiltration control that prevents compromised accounts or malicious insiders from silently forwarding email externally.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "CMMC v2.0",
        "HITRUST CSF v11",
        "NYDFS 23 NYCRR 500",
        "Microsoft Cloud Security Benchmark",
        "MITRE ATT&CK T1114.003"
      ],
      "cisChecks": [
        "2.2.1",
        "6.5.3"
      ],
      "severity": "Critical",
      "category": "Exchange Online",
      "deploymentOrder": 3,
      "requiredLicence": "Exchange Online (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "This deploys TWO layers of protection: (1) Set-RemoteDomain disables auto-forwarding at the remote domain level, (2) a transport rule explicitly blocks any auto-forward messages to external recipients. Both are needed because Set-RemoteDomain alone does not catch all forwarding mechanisms (e.g., inbox rules using redirect). The outbound spam filter policy (DEF06) AutoForwardingMode: Off provides a third layer."
    },
    "steps": [
      {
        "cmdlet": "Set-RemoteDomain",
        "parameters": {
          "Identity": "Default",
          "AutoForwardEnabled": false
        },
        "_notes": "Disables auto-forwarding for the default remote domain (all external domains). This blocks server-side forwarding set via OWA or Outlook."
      },
      {
        "cmdlet": "New-TransportRule",
        "parameters": {
          "Name": "Block External Auto-Forward",
          "Priority": 0,
          "SentToScope": "NotInOrganization",
          "MessageTypeMatches": "AutoForward",
          "RejectMessageReasonText": "External email auto-forwarding is prohibited by organization policy. Contact IT if you require an exception.",
          "RejectMessageEnhancedStatusCode": "5.7.1",
          "Mode": "Enforce",
          "StopRuleProcessing": true,
          "Comments": "Blocks all auto-forwarded email to external recipients. Part of CIS 2.2.1 and data exfiltration prevention controls."
        }
      }
    ],
    "postDeployment": [
      "Get-RemoteDomain -Identity Default | Select-Object Identity, AutoForwardEnabled",
      "Get-TransportRule -Identity 'Block External Auto-Forward' | Format-List",
      "Test by creating a forwarding rule to an external address in OWA and verify the forwarded message is rejected",
      "Audit existing auto-forwarding rules: Get-Mailbox -ResultSize Unlimited | Where-Object {$_.ForwardingSmtpAddress -ne $null} | Select-Object DisplayName, ForwardingSmtpAddress",
      "If specific users legitimately need external forwarding, create a RemoteDomain for the specific target domain or a transport rule exception"
    ]
  },
  {
    "_metadata": {
      "id": "EXO04",
      "title": "Disable Basic Authentication",
      "description": "Creates an authentication policy that disables basic authentication for all Exchange Online protocols (POP3, IMAP, SMTP, MAPI, ActiveSync, EWS, Autodiscover, Offline Address Book, RPC, PowerShell) and assigns it as the organization default. Basic auth transmits credentials in clear text and cannot enforce MFA.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "CMMC v2.0",
        "HITRUST CSF v11",
        "ASD Essential Eight",
        "NYDFS 23 NYCRR 500",
        "FFIEC-CAT",
        "Microsoft Cloud Security Benchmark",
        "MITRE ATT&CK T1078"
      ],
      "cisChecks": [
        "6.5.1",
        "6.1.2"
      ],
      "severity": "Critical",
      "category": "Exchange Online",
      "deploymentOrder": 4,
      "requiredLicence": "Exchange Online (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "PREREQUISITE: Ensure Modern Authentication (EXO05) is enabled and all clients support OAuth 2.0 BEFORE disabling basic auth. Audit basic auth usage first: Search the Azure AD sign-in logs for clientApp = 'Other clients' or protocol-specific entries. Microsoft has deprecated basic auth for most protocols. AllowBasicAuthSmtp may need to remain true temporarily for legacy devices (multifunction printers, LOB apps) but should be disabled as soon as possible."
    },
    "steps": [
      {
        "cmdlet": "New-AuthenticationPolicy",
        "parameters": {
          "Name": "Block Basic Auth - All Protocols",
          "AllowBasicAuthActiveSync": false,
          "AllowBasicAuthAutodiscover": false,
          "AllowBasicAuthImap": false,
          "AllowBasicAuthMapi": false,
          "AllowBasicAuthOfflineAddressBook": false,
          "AllowBasicAuthPop": false,
          "AllowBasicAuthPowershell": false,
          "AllowBasicAuthRpc": false,
          "AllowBasicAuthSmtp": false,
          "AllowBasicAuthWebServices": false
        }
      },
      {
        "cmdlet": "Set-OrganizationConfig",
        "parameters": {
          "DefaultAuthenticationPolicy": "Block Basic Auth - All Protocols"
        },
        "_notes": "Sets the new policy as the organization-wide default. All users without a per-user authentication policy override will be governed by this policy."
      }
    ],
    "postDeployment": [
      "Get-AuthenticationPolicy -Identity 'Block Basic Auth - All Protocols' | Format-List",
      "Get-OrganizationConfig | Select-Object DefaultAuthenticationPolicy",
      "Audit basic auth usage before enforcement: Search-UnifiedAuditLog -Operations UserLoggedIn -ResultSize 5000 | Where-Object {$_.AuditData -like '*Basic*'}",
      "If legacy SMTP devices need basic auth temporarily: Set-CASMailbox -Identity <service-account> -SmtpClientAuthenticationDisabled $false",
      "Monitor Azure AD sign-in logs for basic auth failures after deployment to identify remaining legacy clients"
    ]
  },
  {
    "_metadata": {
      "id": "EXO05",
      "title": "Enable Modern Authentication (OAuth 2.0)",
      "description": "Explicitly enables Modern Authentication (OAuth 2.0) for Exchange Online via Set-OrganizationConfig. Modern auth supports MFA, certificate-based auth, conditional access, and token-based authentication. This must be enabled before disabling basic auth (EXO04).",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "CMMC v2.0",
        "HITRUST CSF v11",
        "NYDFS 23 NYCRR 500",
        "FFIEC-CAT",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "6.1.2"
      ],
      "severity": "Critical",
      "category": "Exchange Online",
      "deploymentOrder": 3,
      "requiredLicence": "Exchange Online (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "Modern Authentication is enabled by default in tenants created after August 2017. This policy explicitly sets it to ensure it has not been disabled. Deploy this BEFORE EXO04 (Disable Basic Authentication). OAuth2ClientProfileEnabled must be true for Outlook clients to use modern auth. After enabling, verify Outlook prompts for modern auth (browser-based sign-in window) rather than basic auth (inline credential dialog)."
    },
    "cmdlet": "Set-OrganizationConfig",
    "parameters": {
      "OAuth2ClientProfileEnabled": true
    },
    "postDeployment": [
      "Get-OrganizationConfig | Select-Object OAuth2ClientProfileEnabled",
      "Verify Outlook clients receive the modern auth prompt (browser-based sign-in) rather than the legacy credential dialog",
      "Ensure Outlook 2016 or later is deployed to all workstations (older versions may not support modern auth without registry modifications)",
      "After confirming modern auth is working for all users, proceed with EXO04 (Disable Basic Authentication)"
    ]
  },
  {
    "_metadata": {
      "id": "EXO06",
      "title": "Block and Audit Mail Transport Whitelist Rules",
      "description": "Audits and removes transport rules that set SCL to -1 (whitelist), which bypasses all spam filtering for matched senders. These rules are a common attack surface as they allow phishing and malware to bypass all email security scanning for whitelisted domains.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "CMMC v2.0",
        "HITRUST CSF v11",
        "NYDFS 23 NYCRR 500",
        "Microsoft Cloud Security Benchmark",
        "MITRE ATT&CK T1562.001"
      ],
      "cisChecks": [
        "2.1.14",
        "6.1.3"
      ],
      "severity": "High",
      "category": "Exchange Online",
      "deploymentOrder": 6,
      "requiredLicence": "Exchange Online (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "Transport rules with SetSCL -1 bypass ALL spam filtering for matched messages. This is extremely dangerous as it allows phishing and malware from whitelisted senders. The audit step lists all such rules. The remediation step disables and optionally removes them. IMPORTANT: Review the audit output with stakeholders before removing rules, as some may have been intentionally created for business partners. Find alternatives such as Safe Sender lists (less dangerous) or Exchange Online connectors with proper TLS validation."
    },
    "steps": [
      {
        "cmdlet": "Get-TransportRule",
        "parameters": {},
        "_notes": "AUDIT STEP: Run this first to identify all transport rules with SCL=-1. PowerShell: Get-TransportRule | Where-Object {$_.SetSCL -eq -1} | Select-Object Name, State, SetSCL, FromAddressContainsWords, SenderDomainIs, Priority | Format-Table -AutoSize",
        "auditScript": "Get-TransportRule | Where-Object {$_.SetSCL -eq -1} | Select-Object Name, State, SetSCL, FromAddressContainsWords, SenderDomainIs, Priority"
      },
      {
        "cmdlet": "Disable-TransportRule",
        "parameters": {
          "Identity": "",
          "Confirm": false
        },
        "_notes": "REMEDIATION STEP 1: Disable each identified whitelist rule. Run for each rule found in the audit step. Disabling (rather than removing) allows for rollback."
      },
      {
        "cmdlet": "Remove-TransportRule",
        "parameters": {
          "Identity": "",
          "Confirm": false
        },
        "_notes": "REMEDIATION STEP 2 (OPTIONAL): After confirming no business impact from disabling, permanently remove the rule. Only execute after a monitoring period with the rule disabled."
      }
    ],
    "postDeployment": [
      "Get-TransportRule | Where-Object {$_.SetSCL -eq -1} | Select-Object Name, State (should return empty)",
      "Document all removed/disabled rules and the business justification for their original creation",
      "For legitimate business partner needs, replace SCL=-1 rules with: (a) Exchange Online connectors with TLS certificate validation, or (b) scoped Safe Sender entries",
      "Schedule quarterly audits: Get-TransportRule | Where-Object {$_.SetSCL -eq -1} to detect new whitelist rule creation",
      "Consider implementing an alert rule in the Security & Compliance Center for transport rule creation events"
    ]
  },
  {
    "_metadata": {
      "id": "EXO07",
      "title": "Disable Calendar External Sharing",
      "description": "Restricts Exchange Online calendar sharing to prevent detailed availability and appointment data from being shared with external or anonymous users. Limits the default sharing policy to free/busy time only (no subject or location details). Also restricts public folder connections.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "HITRUST CSF v11",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "6.2.1"
      ],
      "severity": "Medium",
      "category": "Exchange Online",
      "deploymentOrder": 7,
      "requiredLicence": "Exchange Online (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "Calendar sharing can leak sensitive information about meetings, attendees, subjects, and locations to external parties. The default sharing policy controls what level of detail is shared. CalendarSharingFreeBusySimple shares only free/busy availability without subjects or details. For maximum restriction, set Enabled: false on the sharing policy to disable all external calendar sharing."
    },
    "steps": [
      {
        "cmdlet": "Set-SharingPolicy",
        "parameters": {
          "Identity": "Default Sharing Policy",
          "Domains": [
            "Anonymous:CalendarSharingFreeBusySimple"
          ],
          "Enabled": true
        },
        "_notes": "Restricts the default sharing policy to free/busy simple (availability only, no details). To fully disable external sharing, set Enabled: false instead."
      },
      {
        "cmdlet": "Set-OrganizationConfig",
        "parameters": {
          "PublicFoldersEnabled": "None"
        },
        "_notes": "Disables public folder access to prevent calendar information leakage through public folder sharing."
      }
    ],
    "postDeployment": [
      "Get-SharingPolicy -Identity 'Default Sharing Policy' | Format-List",
      "Get-OrganizationConfig | Select-Object PublicFoldersEnabled",
      "Verify external users can only see free/busy availability (no appointment subjects or locations)",
      "If specific departments need detailed calendar sharing (e.g., with partners), create a scoped sharing policy for those users only",
      "Review existing organization relationships: Get-OrganizationRelationship | Format-List"
    ]
  },
  {
    "_metadata": {
      "id": "EXO08",
      "title": "Configure Connection Filter - Clear Safe List",
      "description": "Clears the IP Allow List in the connection filter policy and disables the Safe List. IP allow lists bypass all spam filtering for messages from listed IPs, creating a significant security gap. The Safe List is a Microsoft-maintained list of trusted third-party sources that also bypasses filtering.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "CMMC v2.0",
        "FFIEC-CAT",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "2.1.14",
        "6.5.4",
        "6.5.5"
      ],
      "severity": "High",
      "category": "Exchange Online",
      "deploymentOrder": 8,
      "requiredLicence": "Exchange Online (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "The connection filter IP Allow List bypasses ALL spam filtering for messages from listed IP addresses. This is dangerous because if a listed IP is compromised, all malicious email from that IP will bypass security scanning. The EnableSafeList option uses a Microsoft-maintained list of trusted third-party senders that also bypasses filtering. CIS recommends disabling both. If you have a legitimate third-party email service that needs IP allow-listing, consider using an Exchange Online connector with TLS certificate validation instead."
    },
    "cmdlet": "Set-HostedConnectionFilterPolicy",
    "parameters": {
      "Identity": "Default",
      "IPAllowList": [],
      "IPBlockList": [],
      "EnableSafeList": false
    },
    "postDeployment": [
      "Get-HostedConnectionFilterPolicy -Identity Default | Select-Object IPAllowList, IPBlockList, EnableSafeList",
      "Document any IPs that were in the allow list before clearing (for audit trail)",
      "If third-party email relay is required, configure an inbound connector with TLS certificate validation instead of IP allow-listing",
      "Monitor for delivery issues from previously-allowed IPs after clearing the list",
      "IPBlockList is also cleared to ensure it is explicitly managed; add known malicious IPs if needed"
    ]
  },
  {
    "_metadata": {
      "id": "EXO09",
      "title": "Enable Report Message Add-In",
      "description": "Deploys the Microsoft Report Message and Report Phishing add-ins organization-wide for all users. Enables users to report suspicious, phishing, and junk emails directly from Outlook. Reported messages are submitted to Microsoft for analysis and optionally to a security team mailbox.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "HITRUST CSF v11",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "6.2.3"
      ],
      "severity": "Medium",
      "category": "Exchange Online",
      "deploymentOrder": 9,
      "requiredLicence": "Exchange Online (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "The Report Message add-in provides both 'Report Phishing' and 'Report Junk' buttons in Outlook. The Report Phishing add-in provides only the phishing report button. Deploy both for maximum user flexibility. UserOverridable: false prevents users from removing the add-in. DefaultStateForUser: Enabled activates the add-in for all users without requiring individual installation. Also configure the user submission policy to route reported messages to your security team."
    },
    "steps": [
      {
        "cmdlet": "New-App",
        "parameters": {
          "OrganizationApp": true,
          "DefaultStateForUser": "Enabled",
          "ProvidedTo": "Everyone",
          "UserOverridable": false,
          "Url": "https://appsource.microsoft.com/en-us/product/office/WA104381180"
        },
        "_notes": "Deploys the Report Message add-in (WA104381180) from the Microsoft AppSource marketplace. This add-in adds 'Report Junk', 'Report Phishing', and 'Report Not Junk' buttons to Outlook."
      },
      {
        "cmdlet": "New-App",
        "parameters": {
          "OrganizationApp": true,
          "DefaultStateForUser": "Enabled",
          "ProvidedTo": "Everyone",
          "UserOverridable": false,
          "Url": "https://appsource.microsoft.com/en-us/product/office/WA200002469"
        },
        "_notes": "Deploys the Report Phishing add-in (WA200002469) for a streamlined phishing-only report button."
      },
      {
        "cmdlet": "New-ReportSubmissionPolicy",
        "parameters": {
          "ReportJunkToCustomizedAddress": true,
          "ReportNotJunkToCustomizedAddress": true,
          "ReportPhishToCustomizedAddress": true,
          "ReportJunkAddresses": [],
          "ReportNotJunkAddresses": [],
          "ReportPhishAddresses": [],
          "ReportChatMessageEnabled": false,
          "ReportChatMessageToCustomizedAddressEnabled": false
        },
        "_notes": "Routes user-reported messages to the security team mailbox in addition to Microsoft. Replace  with your SOC or phishing response mailbox."
      }
    ],
    "postDeployment": [
      "Get-App -OrganizationApp | Where-Object {$_.DisplayName -like '*Report*'} | Select-Object DisplayName, Enabled, DefaultStateForUser",
      "Get-ReportSubmissionPolicy | Format-List",
      "Verify the Report Message button appears in Outlook Web Access and Outlook desktop for test users",
      "Replace  with the actual security operations mailbox address",
      "Train users on when and how to use the Report Message and Report Phishing buttons",
      "Marketplace URLs - Report Message: https://appsource.microsoft.com/en-us/product/office/WA104381180 | Report Phishing: https://appsource.microsoft.com/en-us/product/office/WA200002469"
    ]
  },
  {
    "_metadata": {
      "id": "EXO10",
      "title": "Disable Public Folder Email Addresses",
      "description": "Disables mail-enabled public folders in Exchange Online. Mail-enabled public folders can receive email from external senders but bypass DLP policies, message trace, and audit logging. This policy removes email addresses from existing mail-enabled public folders and disables mail functionality.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "CMMC v2.0",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "HITRUST CSF v11",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "6.5.2"
      ],
      "severity": "Medium",
      "category": "Exchange Online",
      "deploymentOrder": 10,
      "requiredLicence": "Exchange Online (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "Mail-enabled public folders are a legacy feature. Email sent to public folders bypasses DLP, transport rules, and retention policies. It is difficult to audit who accessed the content. The audit step identifies all mail-enabled public folders. The remediation step disables mail on each one. IMPORTANT: Coordinate with business owners before disabling, as some organizations use mail-enabled public folders for shared mailbox functionality. Migrate to shared mailboxes or Microsoft 365 Groups instead."
    },
    "steps": [
      {
        "cmdlet": "Get-MailPublicFolder",
        "parameters": {
          "ResultSize": "Unlimited"
        },
        "_notes": "AUDIT STEP: Lists all mail-enabled public folders. Review the output with business stakeholders before proceeding with remediation. PowerShell: Get-MailPublicFolder -ResultSize Unlimited | Select-Object Name, DisplayName, PrimarySmtpAddress, EmailAddresses"
      },
      {
        "cmdlet": "Disable-MailPublicFolder",
        "parameters": {
          "Identity": "",
          "Confirm": false
        },
        "_notes": "REMEDIATION STEP: Run for each mail-enabled public folder identified in the audit step. This removes the email functionality but preserves the public folder content. PowerShell loop: Get-MailPublicFolder -ResultSize Unlimited | ForEach-Object { Disable-MailPublicFolder -Identity $_.Identity -Confirm:$false }"
      }
    ],
    "automationScript": "Get-MailPublicFolder -ResultSize Unlimited | ForEach-Object { Write-Host \"Disabling mail on: $($_.DisplayName)\"; Disable-MailPublicFolder -Identity $_.Identity -Confirm:$false }",
    "postDeployment": [
      "Get-MailPublicFolder -ResultSize Unlimited (should return empty if all were disabled)",
      "Verify public folder content is still accessible (only email functionality is removed)",
      "If business units require shared email functionality, migrate to shared mailboxes or Microsoft 365 Groups",
      "Document all disabled mail-enabled public folders for audit trail",
      "Schedule quarterly audit: Get-MailPublicFolder -ResultSize Unlimited | Select-Object Name, PrimarySmtpAddress"
    ]
  },
  {
    "@odata.type": "#microsoft.graph.windows10CompliancePolicy",
    "displayName": "INT01 - Windows 10/11 Device Compliance Baseline",
    "description": "Enforces baseline compliance for Windows 10/11 devices: BitLocker, Secure Boot, TPM 2.0, Defender real-time protection with current definitions, firewall, and minimum OS build 10.0.19045 (22H2). Noncompliant devices marked after 3 days, blocked after 7 days.",
    "version": 1,
    "bitLockerEnabled": true,
    "secureBootEnabled": true,
    "codeIntegrityEnabled": true,
    "osMinimumVersion": "10.0.19045",
    "osMaximumVersion": null,
    "mobileOsMinimumVersion": null,
    "mobileOsMaximumVersion": null,
    "storageRequireEncryption": true,
    "activeFirewallRequired": true,
    "defenderEnabled": true,
    "defenderVersion": null,
    "signatureOutOfDate": false,
    "rtpEnabled": true,
    "antivirusRequired": true,
    "antiSpywareRequired": true,
    "tpmRequired": true,
    "deviceThreatProtectionEnabled": false,
    "deviceThreatProtectionRequiredSecurityLevel": "unavailable",
    "configurationManagerComplianceRequired": false,
    "passwordRequired": true,
    "passwordBlockSimple": true,
    "passwordRequiredType": "alphanumeric",
    "passwordMinimumLength": 8,
    "passwordMinutesOfInactivityBeforeLock": 15,
    "passwordExpirationDays": null,
    "passwordMinimumCharacterSetCount": 3,
    "passwordPreviousPasswordBlockCount": 5,
    "requireHealthyDeviceReport": false,
    "earlyLaunchAntiMalwareDriverEnabled": false,
    "validOperatingSystemBuildRanges": [],
    "deviceCompliancePolicyScript": null,
    "scheduledActionsForRule": [
      {
        "ruleName": "PasswordRequired",
        "scheduledActionConfigurations": [
          {
            "actionType": "block",
            "gracePeriodHours": 72,
            "notificationTemplateId": "",
            "notificationMessageCCList": []
          },
          {
            "actionType": "block",
            "gracePeriodHours": 168,
            "notificationTemplateId": "",
            "notificationMessageCCList": []
          }
        ]
      }
    ],
    "roleScopeTagIds": [
      "0"
    ],
    "_metadata": {
      "policyId": "INT01",
      "description": "Windows 10/11 device compliance baseline enforcing BitLocker encryption, Secure Boot, TPM 2.0, Defender real-time protection with current definitions, firewall, and minimum OS build 10.0.19045 (22H2). Devices are marked noncompliant after 3 days (72 hours) and blocked after 7 days (168 hours).",
      "graphEndpoint": "POST /deviceManagement/deviceCompliancePolicies",
      "platform": "Windows 10/11",
      "frameworks": [
        "CIS Microsoft Intune for Windows 11 Benchmark v3.0.1",
        "NIST SP 800-171 Rev 2",
        "NIST SP 800-53 Rev 5 - CM-6, SI-3, SC-28",
        "ISO 27001:2022 A.8.1",
        "Essential Eight - Patch Applications, Configure Microsoft Office Macro Settings",
        "Microsoft Cloud Security Benchmark - DP-4, PV-6"
      ],
      "cisChecks": [
        "CIS 1.1.1 - Ensure BitLocker Drive Encryption is enabled",
        "CIS 1.1.2 - Ensure Secure Boot is enabled",
        "CIS 1.1.3 - Ensure TPM is present and enabled",
        "CIS 2.3.1 - Ensure Windows Defender real-time protection is enabled",
        "CIS 2.3.2 - Ensure antivirus definitions are up to date",
        "CIS 9.1.1 - Ensure Windows Firewall is enabled for all profiles"
      ],
      "version": "1.0.0",
      "lastUpdated": "2026-02-27"
    }
  },
  {
    "@odata.type": "#microsoft.graph.iosCompliancePolicy",
    "displayName": "INT02 - iOS/iPadOS Device Compliance Baseline",
    "description": "Enforces baseline compliance for iOS/iPadOS devices: minimum OS 16.0, no jailbreak, passcode required (min 6 characters, alphanumeric), 5-minute inactivity lock, and device encryption.",
    "version": 1,
    "passcodeBlockSimple": true,
    "passcodeExpirationDays": null,
    "passcodeMinimumLength": 6,
    "passcodeMinutesOfInactivityBeforeLock": 5,
    "passcodeMinutesOfInactivityBeforeScreenTimeout": 5,
    "passcodePreviousPasscodeBlockCount": 5,
    "passcodeMinimumCharacterSetCount": 1,
    "passcodeRequiredType": "alphanumeric",
    "passcodeRequired": true,
    "osMinimumVersion": "16.0",
    "osMaximumVersion": null,
    "osMinimumBuildVersion": null,
    "osMaximumBuildVersion": null,
    "securityBlockJailbrokenDevices": true,
    "deviceThreatProtectionEnabled": false,
    "deviceThreatProtectionRequiredSecurityLevel": "unavailable",
    "managedEmailProfileRequired": false,
    "restrictedApps": [],
    "scheduledActionsForRule": [
      {
        "ruleName": "PasswordRequired",
        "scheduledActionConfigurations": [
          {
            "actionType": "block",
            "gracePeriodHours": 72,
            "notificationTemplateId": "",
            "notificationMessageCCList": []
          }
        ]
      }
    ],
    "roleScopeTagIds": [
      "0"
    ],
    "_metadata": {
      "policyId": "INT02",
      "description": "iOS/iPadOS compliance baseline requiring minimum OS 16.0, jailbreak detection, alphanumeric passcode (minimum 6 characters), 5-minute inactivity lock, and device encryption. Noncompliant devices blocked after 72 hours.",
      "graphEndpoint": "POST /deviceManagement/deviceCompliancePolicies",
      "platform": "iOS/iPadOS",
      "frameworks": [
        "CIS Apple iOS/iPadOS Benchmark v1.0",
        "NIST SP 800-53 Rev 5 - AC-7, IA-5, SC-28",
        "ISO 27001:2022 A.8.1",
        "Essential Eight - Patch Operating Systems",
        "Microsoft Cloud Security Benchmark - DP-4"
      ],
      "cisChecks": [
        "CIS 2.1.1 - Ensure a passcode is required",
        "CIS 2.1.2 - Ensure minimum passcode length is 6 or greater",
        "CIS 2.1.3 - Ensure alphanumeric passcode is required",
        "CIS 2.2.1 - Ensure auto-lock is 5 minutes or less",
        "CIS 3.1.1 - Ensure jailbroken devices are detected and blocked"
      ],
      "version": "1.0.0",
      "lastUpdated": "2026-02-27"
    }
  },
  {
    "@odata.type": "#microsoft.graph.androidWorkProfileCompliancePolicy",
    "displayName": "INT03 - Android Enterprise Device Compliance Baseline",
    "description": "Enforces baseline compliance for Android Enterprise work profile devices: minimum OS 13.0, no root, numeric complex password (min 6), storage encryption, Google Play Services required, SafetyNet basic attestation.",
    "version": 1,
    "passwordRequired": true,
    "passwordMinimumLength": 6,
    "passwordRequiredType": "numericComplex",
    "passwordMinutesOfInactivityBeforeLock": 5,
    "passwordExpirationDays": null,
    "passwordPreviousPasswordBlockCount": 5,
    "passwordSignInFailureCountBeforeFactoryReset": 10,
    "securityPreventInstallAppsFromUnknownSources": true,
    "securityDisableUsbDebugging": true,
    "securityRequireVerifyApps": true,
    "deviceThreatProtectionEnabled": false,
    "deviceThreatProtectionRequiredSecurityLevel": "unavailable",
    "advancedThreatProtectionRequiredSecurityLevel": "unavailable",
    "securityBlockJailbrokenDevices": true,
    "osMinimumVersion": "13.0",
    "osMaximumVersion": null,
    "minAndroidSecurityPatchLevel": null,
    "storageRequireEncryption": true,
    "securityRequireSafetyNetAttestationBasicIntegrity": true,
    "securityRequireSafetyNetAttestationCertifiedDevice": false,
    "securityRequireGooglePlayServices": true,
    "securityRequireUpToDateSecurityProviders": true,
    "securityRequireCompanyPortalAppIntegrity": true,
    "scheduledActionsForRule": [
      {
        "ruleName": "PasswordRequired",
        "scheduledActionConfigurations": [
          {
            "actionType": "block",
            "gracePeriodHours": 72,
            "notificationTemplateId": "",
            "notificationMessageCCList": []
          }
        ]
      }
    ],
    "roleScopeTagIds": [
      "0"
    ],
    "_metadata": {
      "policyId": "INT03",
      "description": "Android Enterprise work profile compliance baseline requiring minimum OS 13.0, root detection, numeric complex password (min 6 digits), storage encryption, Google Play Services, and SafetyNet basic integrity attestation.",
      "graphEndpoint": "POST /deviceManagement/deviceCompliancePolicies",
      "platform": "Android Enterprise (Work Profile)",
      "frameworks": [
        "CIS Google Android Benchmark v1.3",
        "NIST SP 800-53 Rev 5 - AC-7, IA-5, SC-28",
        "ISO 27001:2022 A.8.1",
        "Essential Eight - Patch Operating Systems",
        "Microsoft Cloud Security Benchmark - DP-4"
      ],
      "cisChecks": [
        "CIS 1.1 - Ensure device encryption is enabled",
        "CIS 1.2 - Ensure screen lock is enabled",
        "CIS 1.3 - Ensure minimum password length is 6",
        "CIS 1.4 - Ensure root detection is enabled",
        "CIS 2.1 - Ensure Google Play Protect is enabled",
        "CIS 2.2 - Ensure SafetyNet attestation is required"
      ],
      "version": "1.0.0",
      "lastUpdated": "2026-02-27"
    }
  },
  {
    "@odata.type": "#microsoft.graph.macOSCompliancePolicy",
    "displayName": "INT04 - macOS Device Compliance Baseline",
    "description": "Enforces baseline compliance for macOS devices: minimum OS 14.0, FileVault encryption required, Gatekeeper enabled, System Integrity Protection enabled, passcode required (min 6), firewall enabled.",
    "version": 1,
    "passwordRequired": true,
    "passwordBlockSimple": true,
    "passwordExpirationDays": null,
    "passwordMinimumLength": 6,
    "passwordMinutesOfInactivityBeforeLock": 15,
    "passwordPreviousPasswordBlockCount": 5,
    "passwordMinimumCharacterSetCount": 1,
    "passwordRequiredType": "alphanumeric",
    "osMinimumVersion": "14.0",
    "osMaximumVersion": null,
    "osMinimumBuildVersion": null,
    "osMaximumBuildVersion": null,
    "systemIntegrityProtectionEnabled": true,
    "deviceThreatProtectionEnabled": false,
    "deviceThreatProtectionRequiredSecurityLevel": "unavailable",
    "storageRequireEncryption": true,
    "gatekeeperAllowedAppSource": "macAppStoreAndIdentifiedDevelopers",
    "firewallEnabled": true,
    "firewallBlockAllIncoming": false,
    "firewallEnableStealthMode": false,
    "scheduledActionsForRule": [
      {
        "ruleName": "PasswordRequired",
        "scheduledActionConfigurations": [
          {
            "actionType": "block",
            "gracePeriodHours": 72,
            "notificationTemplateId": "",
            "notificationMessageCCList": []
          }
        ]
      }
    ],
    "roleScopeTagIds": [
      "0"
    ],
    "_metadata": {
      "policyId": "INT04",
      "description": "macOS compliance baseline requiring minimum OS 14.0 (Sonoma), FileVault disk encryption, Gatekeeper app source restriction, System Integrity Protection, alphanumeric passcode (min 6), and firewall enabled.",
      "graphEndpoint": "POST /deviceManagement/deviceCompliancePolicies",
      "platform": "macOS",
      "frameworks": [
        "CIS Apple macOS Benchmark v3.0",
        "NIST SP 800-53 Rev 5 - AC-7, IA-5, SC-28, SI-7",
        "ISO 27001:2022 A.8.1",
        "Essential Eight - Patch Operating Systems",
        "Microsoft Cloud Security Benchmark - DP-4, ES-1"
      ],
      "cisChecks": [
        "CIS 2.5.1.1 - Ensure FileVault is enabled",
        "CIS 2.6.1.1 - Ensure Gatekeeper is enabled",
        "CIS 2.6.1.2 - Ensure System Integrity Protection is enabled",
        "CIS 2.6.4 - Ensure Firewall is enabled",
        "CIS 5.2.1 - Ensure password is required to wake from sleep or screen saver",
        "CIS 5.2.3 - Ensure complex password is required"
      ],
      "version": "1.0.0",
      "lastUpdated": "2026-02-27"
    }
  },
  {
    "@odata.type": "#microsoft.graph.windows10EndpointProtectionConfiguration",
    "displayName": "INT05 - BitLocker Drive Encryption Policy",
    "description": "Enforces BitLocker encryption on OS drives (TPM+PIN, XTS-AES 256-bit) and fixed data drives. Recovery keys stored in Azure AD. Compatible TPM startup configuration.",
    "version": 1,
    "bitLockerAllowStandardUserEncryption": true,
    "bitLockerDisableWarningForOtherDiskEncryption": true,
    "bitLockerEnableStorageCardEncryptionOnMobile": false,
    "bitLockerEncryptDevice": true,
    "bitLockerRecoveryPasswordRotation": "enabledForAzureAd",
    "bitLockerSystemDrivePolicy": {
      "encryptionMethod": "xtsAes256",
      "startupAuthenticationRequired": true,
      "startupAuthenticationBlockWithoutTpmChip": true,
      "startupAuthenticationTpmUsage": "required",
      "startupAuthenticationTpmPinUsage": "required",
      "startupAuthenticationTpmKeyUsage": "allowed",
      "startupAuthenticationTpmPinAndKeyUsage": "allowed",
      "prebootRecoveryEnableMessageAndUrl": false,
      "prebootRecoveryMessage": null,
      "prebootRecoveryUrl": null,
      "recoveryOptions": {
        "blockDataRecoveryAgent": false,
        "recoveryPasswordUsage": "allowed",
        "recoveryKeyUsage": "allowed",
        "hideRecoveryOptions": false,
        "enableRecoveryInformationSaveToStore": true,
        "recoveryInformationToStore": "passwordAndKey",
        "enableBitLockerAfterRecoveryInformationToStore": true
      },
      "minimumPinLength": 6
    },
    "bitLockerFixedDrivePolicy": {
      "encryptionMethod": "xtsAes256",
      "requireEncryptionForWriteAccess": true,
      "recoveryOptions": {
        "blockDataRecoveryAgent": false,
        "recoveryPasswordUsage": "allowed",
        "recoveryKeyUsage": "allowed",
        "hideRecoveryOptions": false,
        "enableRecoveryInformationSaveToStore": true,
        "recoveryInformationToStore": "passwordAndKey",
        "enableBitLockerAfterRecoveryInformationToStore": true
      }
    },
    "bitLockerRemovableDrivePolicy": {
      "encryptionMethod": "aes256",
      "requireEncryptionForWriteAccess": true,
      "blockCrossOrganizationWriteAccess": false
    },
    "roleScopeTagIds": [
      "0"
    ],
    "_metadata": {
      "policyId": "INT05",
      "description": "BitLocker encryption policy requiring XTS-AES 256-bit encryption on OS and fixed data drives. OS drive requires TPM+PIN startup authentication. Recovery keys automatically escrowed to Azure AD. Fixed drives require encryption for write access.",
      "graphEndpoint": "POST /deviceManagement/deviceConfigurations",
      "platform": "Windows 10/11",
      "frameworks": [
        "CIS Microsoft Intune for Windows 11 Benchmark v3.0.1",
        "NIST SP 800-53 Rev 5 - SC-28(1)",
        "NIST SP 800-171 Rev 2 - 3.13.11",
        "ISO 27001:2022 A.8.24",
        "PCI DSS v4.0 - Req 3.4",
        "Essential Eight - Restrict Administrative Privileges",
        "HIPAA - 164.312(a)(2)(iv)"
      ],
      "cisChecks": [
        "CIS 1.1.1 - Ensure BitLocker Drive Encryption is enabled on OS drive",
        "CIS 1.1.2 - Ensure BitLocker encryption method is XTS-AES 256-bit",
        "CIS 1.1.3 - Ensure BitLocker recovery information is saved to Azure AD",
        "CIS 1.1.4 - Ensure fixed data drives require BitLocker encryption"
      ],
      "version": "1.0.0",
      "lastUpdated": "2026-02-27"
    }
  },
  {
    "@odata.type": "#microsoft.graph.windows10CustomConfiguration",
    "displayName": "INT06 - Windows LAPS Local Admin Password Solution",
    "description": "Configures Windows LAPS to automatically rotate local administrator passwords. Passwords backed up to Azure AD, rotated every 30 days, 14-character complexity with upper, lower, numbers, and special characters.",
    "version": 1,
    "omaSettings": [
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "BackupDirectory - Azure AD",
        "description": "Configure backup directory for LAPS passwords. 1 = Azure AD.",
        "omaUri": "./Device/Vendor/MSFT/LAPS/Policies/BackupDirectory",
        "value": 1
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "PasswordAgeDays",
        "description": "Maximum password age in days before rotation.",
        "omaUri": "./Device/Vendor/MSFT/LAPS/Policies/PasswordAgeDays",
        "value": 30
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "PasswordComplexity",
        "description": "Password complexity: 4 = Large letters + small letters + numbers + special characters.",
        "omaUri": "./Device/Vendor/MSFT/LAPS/Policies/PasswordComplexity",
        "value": 4
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "PasswordLength",
        "description": "Length of generated password.",
        "omaUri": "./Device/Vendor/MSFT/LAPS/Policies/PasswordLength",
        "value": 14
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingString",
        "displayName": "AdministratorAccountName",
        "description": "Name of the local administrator account managed by LAPS.",
        "omaUri": "./Device/Vendor/MSFT/LAPS/Policies/AdministratorAccountName",
        "value": "LocalAdmin"
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "PostAuthenticationResetDelay",
        "description": "Hours to wait after authentication before resetting the password. 0 = disabled.",
        "omaUri": "./Device/Vendor/MSFT/LAPS/Policies/PostAuthenticationResetDelay",
        "value": 24
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "PostAuthenticationActions",
        "description": "Actions after authentication: 3 = Reset password and logoff managed account.",
        "omaUri": "./Device/Vendor/MSFT/LAPS/Policies/PostAuthenticationActions",
        "value": 3
      }
    ],
    "roleScopeTagIds": [
      "0"
    ],
    "_metadata": {
      "policyId": "INT06",
      "description": "Windows LAPS (Local Administrator Password Solution) policy deploying automatic local admin password rotation via Azure AD backup. Passwords are 14 characters with full complexity, rotated every 30 days, with post-authentication reset after 24 hours.",
      "graphEndpoint": "POST /deviceManagement/deviceConfigurations",
      "platform": "Windows 10/11",
      "omaUriBase": "./Device/Vendor/MSFT/LAPS/Policies/",
      "frameworks": [
        "CIS Microsoft Intune for Windows 11 Benchmark v3.0.1",
        "NIST SP 800-53 Rev 5 - AC-2, IA-5",
        "NIST SP 800-171 Rev 2 - 3.5.7, 3.5.8",
        "ISO 27001:2022 A.5.17",
        "Essential Eight - Restrict Administrative Privileges",
        "MITRE ATT&CK - T1078.003 (Local Accounts)"
      ],
      "cisChecks": [
        "CIS 1.1.5 - Ensure LAPS is configured to manage local admin passwords",
        "CIS 1.1.6 - Ensure LAPS password complexity meets requirements",
        "CIS 1.1.7 - Ensure LAPS password age is 30 days or less"
      ],
      "version": "1.0.0",
      "lastUpdated": "2026-02-27"
    }
  },
  {
    "@odata.type": "#microsoft.graph.windows10EndpointProtectionConfiguration",
    "displayName": "INT07 - Microsoft Defender Antivirus Configuration",
    "description": "Configures Defender AV via Intune: real-time protection, cloud-delivered protection (high level), automatic sample submission (safe), PUA protection, scan downloads, network files, and archives.",
    "version": 1,
    "defenderAdditionalGuardedFolders": [],
    "defenderAdobeReaderLaunchChildProcess": "enable",
    "defenderAdvancedRansomewareProtectionType": "enable",
    "defenderBlockEndUserAccess": false,
    "defenderBlockPersistenceThroughWmiType": "block",
    "defenderCheckForSignaturesBeforeRunningScan": true,
    "defenderCloudBlockLevel": "high",
    "defenderCloudExtendedTimeout": 50,
    "defenderCloudExtendedTimeoutInSeconds": 50,
    "defenderDaysBeforeDeletingQuarantinedMalware": 14,
    "defenderDetectedMalwareActions": {
      "lowSeverity": "quarantine",
      "moderateSeverity": "quarantine",
      "highSeverity": "quarantine",
      "severeSeverity": "remove"
    },
    "defenderDisableCatchupFullScan": false,
    "defenderDisableCatchupQuickScan": false,
    "defenderEnableLowCpuPriority": false,
    "defenderEnableScanDownloads": true,
    "defenderEnableScanIncomingMail": true,
    "defenderEnableScanMappedNetworkDrivesDuringFullScan": true,
    "defenderEnableScanNetworkFiles": true,
    "defenderFileExtensionsToExclude": [],
    "defenderFilesAndFoldersToExclude": [],
    "defenderGuardMyFoldersType": "auditMode",
    "defenderNetworkProtectionType": "enable",
    "defenderPotentiallyUnwantedAppAction": "block",
    "defenderProcessesToExclude": [],
    "defenderPromptForSampleSubmission": "sendSafeSamplesAutomatically",
    "defenderRealTimeMonitorAllowed": true,
    "defenderScanArchiveFiles": true,
    "defenderScanDirection": "monitorAllFiles",
    "defenderScanDownloads": true,
    "defenderScanIncomingMail": true,
    "defenderScanMappedNetworkDrivesDuringFullScan": true,
    "defenderScanMaxCpu": 50,
    "defenderScanNetworkFiles": true,
    "defenderScanRemovableDrivesDuringFullScan": true,
    "defenderScanScriptsLoadedInInternetExplorer": true,
    "defenderScanType": "quick",
    "defenderScheduledQuickScanTime": "12:00:00.0000000",
    "defenderScheduledScanTime": "02:00:00.0000000",
    "defenderScheduleScanDay": "everyday",
    "defenderSignatureUpdateIntervalInHours": 4,
    "defenderSubmitSamplesConsentType": "sendSafeSamplesAutomatically",
    "defenderSystemScanSchedule": "everyday",
    "roleScopeTagIds": [
      "0"
    ],
    "_metadata": {
      "policyId": "INT07",
      "description": "Microsoft Defender Antivirus configuration enabling real-time monitoring, high-level cloud-delivered protection with 50-second extended timeout, automatic safe sample submission, PUA blocking, network protection, and comprehensive scan coverage including downloads, network files, archives, and mapped drives.",
      "graphEndpoint": "POST /deviceManagement/deviceConfigurations",
      "platform": "Windows 10/11",
      "frameworks": [
        "CIS Microsoft Intune for Windows 11 Benchmark v3.0.1",
        "NIST SP 800-53 Rev 5 - SI-3, SI-4",
        "NIST SP 800-171 Rev 2 - 3.14.1, 3.14.2",
        "ISO 27001:2022 A.8.7",
        "Essential Eight - Application Control, Configure Microsoft Office Macro Settings",
        "Microsoft Cloud Security Benchmark - ES-1, ES-2"
      ],
      "cisChecks": [
        "CIS 2.3.1 - Ensure Windows Defender real-time protection is enabled",
        "CIS 2.3.2 - Ensure cloud-delivered protection is enabled",
        "CIS 2.3.3 - Ensure PUA protection is enabled",
        "CIS 2.3.4 - Ensure automatic sample submission is configured",
        "CIS 2.3.5 - Ensure scan all downloaded files and attachments"
      ],
      "version": "1.0.0",
      "lastUpdated": "2026-02-27"
    }
  },
  {
    "@odata.type": "#microsoft.graph.windowsUpdateForBusinessConfiguration",
    "displayName": "INT08 - Windows Update for Business Ring Policy",
    "description": "Windows Update ring: quality update deferral 7 days, feature update deferral 30 days, auto-install at maintenance time, active hours 8:00-17:00, deadline compliance enabled.",
    "version": 1,
    "deliveryOptimizationMode": "httpWithPeeringNat",
    "prereleaseFeatures": "userDefined",
    "automaticUpdateMode": "autoInstallAtMaintenanceTime",
    "microsoftUpdateServiceAllowed": true,
    "driversExcluded": false,
    "qualityUpdatesDeferralPeriodInDays": 7,
    "featureUpdatesDeferralPeriodInDays": 30,
    "qualityUpdatesPaused": false,
    "featureUpdatesPaused": false,
    "qualityUpdatesPauseExpiryDateTime": "0001-01-01T00:00:00Z",
    "featureUpdatesPauseExpiryDateTime": "0001-01-01T00:00:00Z",
    "businessReadyUpdatesOnly": "businessReadyOnly",
    "skipChecksBeforeRestart": false,
    "updateWeeks": null,
    "installationSchedule": {
      "@odata.type": "#microsoft.graph.windowsUpdateActiveHoursInstall",
      "activeHoursStart": "08:00:00.0000000",
      "activeHoursEnd": "17:00:00.0000000"
    },
    "userPauseAccess": "enabled",
    "userWindowsUpdateScanAccess": "enabled",
    "updateNotificationLevel": "defaultNotifications",
    "allowWindows11Upgrade": true,
    "autoRestartNotificationDismissal": "notConfigured",
    "scheduleRestartWarningInHours": 4,
    "scheduleImminentRestartWarningInMinutes": 15,
    "engagedRestartDeadlineInDays": 7,
    "engagedRestartSnoozeScheduleInDays": 1,
    "engagedRestartTransitionScheduleInDays": 2,
    "deadlineForFeatureUpdatesInDays": 14,
    "deadlineForQualityUpdatesInDays": 7,
    "deadlineGracePeriodInDays": 2,
    "postponeRebootUntilAfterDeadline": false,
    "roleScopeTagIds": [
      "0"
    ],
    "_metadata": {
      "policyId": "INT08",
      "description": "Windows Update for Business ring policy deferring quality updates by 7 days and feature updates by 30 days. Auto-installs during maintenance time with active hours 08:00-17:00. Engaged restart after deadline with grace period. Drivers included, Microsoft Update service enabled.",
      "graphEndpoint": "POST /deviceManagement/deviceConfigurations",
      "platform": "Windows 10/11",
      "frameworks": [
        "CIS Microsoft Intune for Windows 11 Benchmark v3.0.1",
        "NIST SP 800-53 Rev 5 - SI-2, CM-3",
        "NIST SP 800-171 Rev 2 - 3.14.1",
        "ISO 27001:2022 A.8.8",
        "Essential Eight - Patch Operating Systems (Maturity Level 2)",
        "Microsoft Cloud Security Benchmark - PV-6, PV-7"
      ],
      "cisChecks": [
        "CIS 18.9.102.1 - Ensure quality update deferral is configured",
        "CIS 18.9.102.2 - Ensure feature update deferral is configured",
        "CIS 18.9.102.3 - Ensure automatic updates are enabled",
        "CIS 18.9.102.4 - Ensure active hours are configured"
      ],
      "version": "1.0.0",
      "lastUpdated": "2026-02-27"
    }
  },
  {
    "@odata.type": "#microsoft.graph.iosManagedAppProtection",
    "displayName": "INT09 - App Protection Policy (MAM) - iOS/Android",
    "description": "Mobile Application Management policy: prevents cut/copy/paste to unmanaged apps, blocks save to personal storage, requires 6-digit numeric PIN, blocks screenshots, enforces minimum OS, wipes after 90 days offline.",
    "version": 1,
    "periodOfflineBeforeAccessCheck": "PT12H",
    "periodOnlineBeforeAccessCheck": "PT30M",
    "allowedInboundDataTransferSources": "managedApps",
    "allowedOutboundDataTransferDestinations": "managedApps",
    "organizationalCredentialsRequired": false,
    "allowedOutboundClipboardSharingLevel": "managedAppsWithPasteIn",
    "dataBackupBlocked": true,
    "deviceComplianceRequired": false,
    "managedBrowserToOpenLinksRequired": false,
    "saveAsBlocked": true,
    "periodOfflineBeforeWipeIsEnforced": "P90D",
    "pinRequired": true,
    "maximumPinRetries": 5,
    "simplePinBlocked": true,
    "minimumPinLength": 6,
    "pinCharacterSet": "numeric",
    "periodBeforePinReset": "P0D",
    "allowedDataStorageLocations": [
      "oneDriveForBusiness",
      "sharePoint"
    ],
    "contactSyncBlocked": false,
    "printBlocked": true,
    "fingerprintBlocked": false,
    "disableAppPinIfDevicePinIsSet": false,
    "minimumRequiredOsVersion": "16.0",
    "minimumWarningOsVersion": "16.0",
    "minimumRequiredAppVersion": null,
    "minimumWarningAppVersion": null,
    "managedBrowser": "microsoftEdge",
    "minimumRequiredSdkVersion": null,
    "screenCaptureBlocked": true,
    "encryptAppData": true,
    "disableAppEncryptionIfDeviceEncryptionIsEnabled": false,
    "appDataEncryptionType": "whenDeviceLocked",
    "faceIdBlocked": false,
    "customBrowserProtocol": null,
    "apps": [
      {
        "mobileAppIdentifier": {
          "@odata.type": "#microsoft.graph.iosMobileAppIdentifier",
          "bundleId": "com.microsoft.Office.Outlook"
        }
      },
      {
        "mobileAppIdentifier": {
          "@odata.type": "#microsoft.graph.iosMobileAppIdentifier",
          "bundleId": "com.microsoft.Office.Word"
        }
      },
      {
        "mobileAppIdentifier": {
          "@odata.type": "#microsoft.graph.iosMobileAppIdentifier",
          "bundleId": "com.microsoft.Office.Excel"
        }
      },
      {
        "mobileAppIdentifier": {
          "@odata.type": "#microsoft.graph.iosMobileAppIdentifier",
          "bundleId": "com.microsoft.Office.Powerpoint"
        }
      },
      {
        "mobileAppIdentifier": {
          "@odata.type": "#microsoft.graph.iosMobileAppIdentifier",
          "bundleId": "com.microsoft.onenote"
        }
      },
      {
        "mobileAppIdentifier": {
          "@odata.type": "#microsoft.graph.iosMobileAppIdentifier",
          "bundleId": "com.microsoft.msapps"
        }
      },
      {
        "mobileAppIdentifier": {
          "@odata.type": "#microsoft.graph.iosMobileAppIdentifier",
          "bundleId": "com.microsoft.skype.teams"
        }
      },
      {
        "mobileAppIdentifier": {
          "@odata.type": "#microsoft.graph.iosMobileAppIdentifier",
          "bundleId": "com.microsoft.sharepoint"
        }
      },
      {
        "mobileAppIdentifier": {
          "@odata.type": "#microsoft.graph.iosMobileAppIdentifier",
          "bundleId": "com.microsoft.msedge"
        }
      }
    ],
    "_androidPolicy": {
      "@odata.type": "#microsoft.graph.androidManagedAppProtection",
      "displayName": "INT09 - App Protection Policy (MAM) - Android",
      "description": "Android counterpart: same MAM protections applied to Android Enterprise managed apps.",
      "allowedInboundDataTransferSources": "managedApps",
      "allowedOutboundDataTransferDestinations": "managedApps",
      "allowedOutboundClipboardSharingLevel": "managedAppsWithPasteIn",
      "dataBackupBlocked": true,
      "saveAsBlocked": true,
      "pinRequired": true,
      "simplePinBlocked": true,
      "minimumPinLength": 6,
      "pinCharacterSet": "numeric",
      "periodOfflineBeforeWipeIsEnforced": "P90D",
      "periodOfflineBeforeAccessCheck": "PT12H",
      "screenCaptureBlocked": true,
      "encryptAppData": true,
      "minimumRequiredOsVersion": "13.0",
      "minimumWarningOsVersion": "13.0",
      "allowedDataStorageLocations": [
        "oneDriveForBusiness",
        "sharePoint"
      ],
      "printBlocked": true,
      "fingerprintBlocked": false,
      "disableAppPinIfDevicePinIsSet": false
    },
    "_metadata": {
      "policyId": "INT09",
      "description": "Mobile Application Management (MAM) policy for iOS and Android. Prevents data leakage via cut/copy/paste to unmanaged apps, blocks save to personal storage, requires 6-digit numeric PIN, blocks screenshots, enforces minimum OS (iOS 16.0 / Android 13.0), and wipes managed app data after 90 days offline. The _androidPolicy section provides the equivalent Android configuration for POST /deviceAppManagement/androidManagedAppProtections.",
      "graphEndpoint": "POST /deviceAppManagement/iosManagedAppProtections",
      "graphEndpointAndroid": "POST /deviceAppManagement/androidManagedAppProtections",
      "platform": "iOS/iPadOS and Android",
      "frameworks": [
        "CIS Microsoft 365 Foundations Benchmark v3.1",
        "NIST SP 800-53 Rev 5 - AC-19, MP-7, SC-28",
        "NIST SP 800-171 Rev 2 - 3.1.18, 3.1.19",
        "ISO 27001:2022 A.8.10",
        "Essential Eight - Restrict Administrative Privileges",
        "HIPAA - 164.312(d)"
      ],
      "cisChecks": [
        "CIS 2.6.1 - Ensure mobile device management is configured",
        "CIS 2.6.2 - Ensure app protection policies prevent data leakage",
        "CIS 2.6.3 - Ensure PIN is required for mobile app access",
        "CIS 2.6.4 - Ensure minimum OS version is enforced"
      ],
      "version": "1.0.0",
      "lastUpdated": "2026-02-27"
    }
  },
  {
    "@odata.type": "#microsoft.graph.deviceEnrollmentPlatformRestrictionsConfiguration",
    "displayName": "INT10 - Device Enrollment Restrictions - Corporate Only",
    "description": "Restricts Intune enrollment to corporate-owned devices only. Blocks personal enrollment, blocks Linux platform, limits per-user device count to 5.",
    "version": 1,
    "platformRestrictions": {
      "androidRestriction": {
        "platformBlocked": false,
        "personalDeviceEnrollmentBlocked": true,
        "osMinimumVersion": "13.0",
        "osMaximumVersion": null
      },
      "androidForWorkRestriction": {
        "platformBlocked": false,
        "personalDeviceEnrollmentBlocked": true,
        "osMinimumVersion": "13.0",
        "osMaximumVersion": null
      },
      "iosRestriction": {
        "platformBlocked": false,
        "personalDeviceEnrollmentBlocked": true,
        "osMinimumVersion": "16.0",
        "osMaximumVersion": null
      },
      "macOSRestriction": {
        "platformBlocked": false,
        "personalDeviceEnrollmentBlocked": true,
        "osMinimumVersion": "14.0",
        "osMaximumVersion": null
      },
      "windowsRestriction": {
        "platformBlocked": false,
        "personalDeviceEnrollmentBlocked": true,
        "osMinimumVersion": "10.0.19045",
        "osMaximumVersion": null
      },
      "windowsMobileRestriction": {
        "platformBlocked": true,
        "personalDeviceEnrollmentBlocked": true,
        "osMinimumVersion": null,
        "osMaximumVersion": null
      },
      "linuxRestriction": {
        "platformBlocked": true,
        "personalDeviceEnrollmentBlocked": true,
        "osMinimumVersion": null,
        "osMaximumVersion": null
      }
    },
    "deviceEnrollmentConfigurationType": "platformRestrictions",
    "roleScopeTagIds": [
      "0"
    ],
    "_deviceLimitConfiguration": {
      "@odata.type": "#microsoft.graph.deviceEnrollmentLimitConfiguration",
      "displayName": "INT10 - Device Enrollment Limit - 5 per User",
      "description": "Limits each user to a maximum of 5 enrolled devices.",
      "limit": 5
    },
    "_metadata": {
      "policyId": "INT10",
      "description": "Device enrollment restrictions blocking personal device enrollment (corporate-only), blocking Linux and Windows Mobile platforms, enforcing minimum OS versions per platform, and limiting each user to 5 enrolled devices. The _deviceLimitConfiguration section should be posted separately to /deviceManagement/deviceEnrollmentConfigurations.",
      "graphEndpoint": "POST /deviceManagement/deviceEnrollmentConfigurations",
      "platform": "Cross-platform",
      "frameworks": [
        "CIS Microsoft 365 Foundations Benchmark v3.1",
        "NIST SP 800-53 Rev 5 - AC-19, CM-8",
        "ISO 27001:2022 A.8.1",
        "Essential Eight - Restrict Administrative Privileges",
        "Microsoft Cloud Security Benchmark - AM-1, AM-2"
      ],
      "cisChecks": [
        "CIS 5.1.3.1 - Ensure device enrollment is restricted to corporate devices",
        "CIS 5.1.4.1 - Ensure minimum OS version is enforced at enrollment",
        "CIS 5.1.4.3 - Ensure per-user device limit is configured"
      ],
      "version": "1.0.0",
      "lastUpdated": "2026-02-27"
    }
  },
  {
    "@odata.type": "#microsoft.graph.windows10CustomConfiguration",
    "displayName": "INT11 - Windows Security Baseline (CIS-Aligned)",
    "description": "Windows security baseline aligned with CIS benchmarks: SMB signing required, NTLM restricted, LM hash storage disabled, audit logon events, credential caching limited to 1, screen lock after 15 minutes inactivity.",
    "version": 1,
    "omaSettings": [
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "Require SMB Signing (Server)",
        "description": "Microsoft network server: Digitally sign communications (always). 1 = Enabled.",
        "omaUri": "./Device/Vendor/MSFT/Policy/Config/LocalPoliciesSecurityOptions/MicrosoftNetworkServer_DigitallySignCommunicationsAlways",
        "value": 1
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "Require SMB Signing (Client)",
        "description": "Microsoft network client: Digitally sign communications (always). 1 = Enabled.",
        "omaUri": "./Device/Vendor/MSFT/Policy/Config/LocalPoliciesSecurityOptions/MicrosoftNetworkClient_DigitallySignCommunicationsAlways",
        "value": 1
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "Restrict NTLM - Network Security LAN Manager Authentication Level",
        "description": "Network security: LAN Manager authentication level. 5 = Send NTLMv2 response only. Refuse LM & NTLM.",
        "omaUri": "./Device/Vendor/MSFT/Policy/Config/LocalPoliciesSecurityOptions/NetworkSecurity_LANManagerAuthenticationLevel",
        "value": 5
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "Disable LM Hash Storage",
        "description": "Network security: Do not store LAN Manager hash value on next password change. 1 = Enabled.",
        "omaUri": "./Device/Vendor/MSFT/Policy/Config/LocalPoliciesSecurityOptions/NetworkSecurity_DoNotStoreLANManagerHashValueOnNextPasswordChange",
        "value": 1
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "Audit Logon Events - Success and Failure",
        "description": "Audit logon events. 3 = Success and Failure.",
        "omaUri": "./Device/Vendor/MSFT/Policy/Config/Audit/AccountLogon_AuditCredentialValidation",
        "value": 3
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "Audit Logon - Success and Failure",
        "description": "Audit logon. 3 = Success and Failure.",
        "omaUri": "./Device/Vendor/MSFT/Policy/Config/Audit/AccountLogonLogoff_AuditLogon",
        "value": 3
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "Audit Logoff - Success",
        "description": "Audit logoff. 1 = Success.",
        "omaUri": "./Device/Vendor/MSFT/Policy/Config/Audit/AccountLogonLogoff_AuditLogoff",
        "value": 1
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "Audit Account Lockout - Failure",
        "description": "Audit account lockout. 2 = Failure.",
        "omaUri": "./Device/Vendor/MSFT/Policy/Config/Audit/AccountLogonLogoff_AuditAccountLockout",
        "value": 2
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "Audit Special Logon - Success",
        "description": "Audit special logon. 1 = Success.",
        "omaUri": "./Device/Vendor/MSFT/Policy/Config/Audit/AccountLogonLogoff_AuditSpecialLogon",
        "value": 1
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "Interactive Logon - Cached Logons Count",
        "description": "Limit cached logon credentials to 1.",
        "omaUri": "./Device/Vendor/MSFT/Policy/Config/LocalPoliciesSecurityOptions/InteractiveLogon_NumberOfPreviousLogonsToCache",
        "value": 1
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "Screen Lock Timeout (seconds)",
        "description": "Machine inactivity limit - 900 seconds (15 minutes).",
        "omaUri": "./Device/Vendor/MSFT/Policy/Config/LocalPoliciesSecurityOptions/InteractiveLogon_MachineInactivityLimit",
        "value": 900
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "Disable Anonymous SID/Name Translation",
        "description": "Network access: Allow anonymous SID/Name translation. 0 = Disabled.",
        "omaUri": "./Device/Vendor/MSFT/Policy/Config/LocalPoliciesSecurityOptions/NetworkAccess_AllowAnonymousSIDNameTranslation",
        "value": 0
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "Restrict Anonymous Access to Named Pipes and Shares",
        "description": "Network access: Restrict anonymous access to Named Pipes and Shares. 1 = Enabled.",
        "omaUri": "./Device/Vendor/MSFT/Policy/Config/LocalPoliciesSecurityOptions/NetworkAccess_RestrictAnonymousAccessToNamedPipesAndShares",
        "value": 1
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "Disable Remote Desktop Services NTLM",
        "description": "Require NLA for Remote Desktop. 1 = Enabled.",
        "omaUri": "./Device/Vendor/MSFT/Policy/Config/RemoteDesktopServices/RequireSecureRPCCommunication",
        "value": 1
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "Prevent LLMNR",
        "description": "Turn off multicast name resolution (LLMNR). 0 = Disabled (turns off LLMNR).",
        "omaUri": "./Device/Vendor/MSFT/Policy/Config/ADMX_DnsClient/Turn_Off_Multicast",
        "value": 0
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "User Account Control - Admin Approval Mode",
        "description": "UAC: Admin Approval Mode for the Built-in Administrator account. 1 = Enabled.",
        "omaUri": "./Device/Vendor/MSFT/Policy/Config/LocalPoliciesSecurityOptions/UserAccountControl_UseAdminApprovalMode",
        "value": 1
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "UAC - Behavior of Elevation Prompt for Admins",
        "description": "UAC: Behavior of the elevation prompt for administrators. 2 = Prompt for consent on the secure desktop.",
        "omaUri": "./Device/Vendor/MSFT/Policy/Config/LocalPoliciesSecurityOptions/UserAccountControl_BehaviorOfTheElevationPromptForAdministrators",
        "value": 2
      }
    ],
    "roleScopeTagIds": [
      "0"
    ],
    "_metadata": {
      "policyId": "INT11",
      "description": "Windows security baseline aligned with CIS Level 1 benchmarks deployed via OMA-URI custom configuration. Enforces SMB signing on client and server, restricts NTLM to NTLMv2 only, disables LM hash storage, enables comprehensive audit policies for logon events, limits cached credentials to 1, locks screen after 15 minutes inactivity, restricts anonymous access, and enforces UAC admin approval mode.",
      "graphEndpoint": "POST /deviceManagement/deviceConfigurations",
      "platform": "Windows 10/11",
      "frameworks": [
        "CIS Microsoft Windows 11 Enterprise Benchmark v3.0.0 - Level 1",
        "NIST SP 800-53 Rev 5 - AC-3, AU-2, AU-3, IA-2, SC-8",
        "NIST SP 800-171 Rev 2 - 3.1.1, 3.3.1, 3.5.1",
        "ISO 27001:2022 A.8.3, A.8.15",
        "Essential Eight - Restrict Administrative Privileges",
        "MITRE ATT&CK - T1557 (Man-in-the-Middle), T1003 (OS Credential Dumping)"
      ],
      "cisChecks": [
        "CIS 2.3.8.1 - Ensure Microsoft network client: Digitally sign communications (always) is Enabled",
        "CIS 2.3.8.2 - Ensure Microsoft network server: Digitally sign communications (always) is Enabled",
        "CIS 2.3.11.7 - Ensure LAN Manager authentication level is Send NTLMv2 response only",
        "CIS 2.3.11.5 - Ensure Do not store LAN Manager hash value on next password change is Enabled",
        "CIS 9.1.8 - Ensure audit logon events is configured",
        "CIS 2.3.7.4 - Ensure number of previous logons to cache is 1",
        "CIS 2.3.7.3 - Ensure machine inactivity limit is 900 seconds"
      ],
      "version": "1.0.0",
      "lastUpdated": "2026-02-27"
    }
  },
  {
    "@odata.type": "#microsoft.graph.windows10GeneralConfiguration",
    "displayName": "INT12 - Microsoft Edge Security Baseline",
    "description": "Edge browser security settings: SmartScreen enabled, strict tracking prevention, password manager and monitor enabled, block potentially unwanted apps, block malicious downloads.",
    "version": 1,
    "edgeSearchEngine": null,
    "edgeHomepageUrls": [],
    "edgeBlockAccessToAboutFlags": true,
    "edgeBlockAddressBarDropdown": false,
    "edgeBlockAutofill": false,
    "edgeBlockCompatibilityList": false,
    "edgeBlockDeveloperTools": false,
    "edgeBlockExtensions": false,
    "edgeBlockInPrivateBrowsing": false,
    "edgeBlockJavaScript": false,
    "edgeBlockLiveTileDataCollection": true,
    "edgeBlockPasswordManager": false,
    "edgeBlockPopups": true,
    "edgeBlockSearchSuggestions": false,
    "edgeBlockSendingDoNotTrackHeader": false,
    "edgeBlockSendingIntranetTrafficToInternetExplorer": true,
    "edgeClearBrowsingDataOnExit": false,
    "edgeCookiePolicy": "blockThirdParty",
    "edgeDisableFirstRunPage": true,
    "edgeFavoritesBarVisibility": "notConfigured",
    "edgeOpensWith": "startPage",
    "edgePreventCertificateErrorOverride": true,
    "edgeRequireSmartScreen": true,
    "edgeSendIntranetTrafficToInternetExplorer": false,
    "edgeSyncFavoritesWithInternetExplorer": false,
    "edgeTelemetryForMicrosoft365Analytics": "notConfigured",
    "smartScreenBlockPromptOverride": true,
    "smartScreenBlockPromptOverrideForFiles": true,
    "smartScreenEnableAppInstallControl": true,
    "webRtcBlockLocalhostIpAddress": true,
    "defenderSmartScreenPromptOverrideEnabled": false,
    "defenderSmartScreenBlockDownloadOverride": true,
    "roleScopeTagIds": [
      "0"
    ],
    "_edgeOmaSettings": {
      "description": "Additional Edge policies via OMA-URI for settings not available in the windows10GeneralConfiguration type.",
      "settings": [
        {
          "@odata.type": "#microsoft.graph.omaSettingInteger",
          "displayName": "Edge - Tracking Prevention Level",
          "description": "TrackingPrevention: 3 = Strict tracking prevention.",
          "omaUri": "./Device/Vendor/MSFT/Policy/Config/Edge~Policy~microsoft_edge/TrackingPrevention",
          "value": 3
        },
        {
          "@odata.type": "#microsoft.graph.omaSettingInteger",
          "displayName": "Edge - SmartScreen Enabled",
          "description": "SmartScreenEnabled: 1 = Enabled.",
          "omaUri": "./Device/Vendor/MSFT/Policy/Config/Edge~Policy~microsoft_edge/SmartScreenEnabled",
          "value": 1
        },
        {
          "@odata.type": "#microsoft.graph.omaSettingInteger",
          "displayName": "Edge - SmartScreen for PUA",
          "description": "SmartScreenPuaEnabled: 1 = Enabled - block potentially unwanted apps.",
          "omaUri": "./Device/Vendor/MSFT/Policy/Config/Edge~Policy~microsoft_edge/SmartScreenPuaEnabled",
          "value": 1
        },
        {
          "@odata.type": "#microsoft.graph.omaSettingInteger",
          "displayName": "Edge - Password Manager Enabled",
          "description": "PasswordManagerEnabled: 1 = Enabled.",
          "omaUri": "./Device/Vendor/MSFT/Policy/Config/Edge~Policy~microsoft_edge/PasswordManagerEnabled",
          "value": 1
        },
        {
          "@odata.type": "#microsoft.graph.omaSettingInteger",
          "displayName": "Edge - Password Monitor Enabled",
          "description": "PasswordMonitorAllowed: 1 = Enabled - alerts users if passwords are found in data breach.",
          "omaUri": "./Device/Vendor/MSFT/Policy/Config/Edge~Policy~microsoft_edge/PasswordMonitorAllowed",
          "value": 1
        },
        {
          "@odata.type": "#microsoft.graph.omaSettingInteger",
          "displayName": "Edge - Block Dangerous Downloads",
          "description": "PreventSmartScreenPromptOverrideForFiles: 1 = Enabled.",
          "omaUri": "./Device/Vendor/MSFT/Policy/Config/Edge~Policy~microsoft_edge/PreventSmartScreenPromptOverrideForFiles",
          "value": 1
        },
        {
          "@odata.type": "#microsoft.graph.omaSettingInteger",
          "displayName": "Edge - Enhanced Security Mode",
          "description": "EnhanceSecurityMode: 2 = Strict mode.",
          "omaUri": "./Device/Vendor/MSFT/Policy/Config/Edge~Policy~microsoft_edge/EnhanceSecurityMode",
          "value": 2
        },
        {
          "@odata.type": "#microsoft.graph.omaSettingInteger",
          "displayName": "Edge - Typosquatting Checker",
          "description": "TyposquattingCheckerEnabled: 1 = Enabled.",
          "omaUri": "./Device/Vendor/MSFT/Policy/Config/Edge~Policy~microsoft_edge/TyposquattingCheckerEnabled",
          "value": 1
        }
      ]
    },
    "_metadata": {
      "policyId": "INT12",
      "description": "Microsoft Edge security baseline enforcing SmartScreen protection, strict tracking prevention, password manager and breach monitor, PUA blocking, blocking malicious downloads, preventing certificate error overrides, third-party cookie blocking, and enhanced security mode. The _edgeOmaSettings section contains supplementary OMA-URI policies for a custom configuration profile.",
      "graphEndpoint": "POST /deviceManagement/deviceConfigurations",
      "platform": "Windows 10/11",
      "frameworks": [
        "CIS Microsoft Edge Benchmark v2.0",
        "NIST SP 800-53 Rev 5 - SC-18, SI-3, SI-8",
        "ISO 27001:2022 A.8.23",
        "Essential Eight - Application Control",
        "Microsoft Cloud Security Benchmark - NS-8"
      ],
      "cisChecks": [
        "CIS 1.1 - Ensure SmartScreen is enabled for Microsoft Edge",
        "CIS 1.2 - Ensure SmartScreen prompt override is blocked",
        "CIS 1.3 - Ensure tracking prevention is set to Strict",
        "CIS 1.4 - Ensure potentially unwanted app blocking is enabled",
        "CIS 1.5 - Ensure password manager is enabled",
        "CIS 1.6 - Ensure password monitor is enabled"
      ],
      "version": "1.0.0",
      "lastUpdated": "2026-02-27"
    }
  },
  {
    "@odata.type": "#microsoft.graph.windowsIdentityProtectionConfiguration",
    "displayName": "INT13 - Windows Hello for Business Configuration",
    "description": "Enables Windows Hello for Business for all users: PIN required (min 6, max 127 digits), biometric allowed, TPM required, PIN recovery enabled. Phishing-resistant passwordless authentication.",
    "version": 1,
    "useSecurityKeyForSignin": true,
    "enhancedAntiSpoofingForFacialFeaturesEnabled": true,
    "pinMinimumLength": 6,
    "pinMaximumLength": 127,
    "pinUppercaseCharactersUsage": "allowed",
    "pinLowercaseCharactersUsage": "allowed",
    "pinSpecialCharactersUsage": "allowed",
    "pinExpirationInDays": 0,
    "pinPreviousBlockCount": 0,
    "pinRecoveryEnabled": true,
    "securityDeviceRequired": true,
    "unlockWithBiometricsEnabled": true,
    "useCertificatesForOnPremisesAuthEnabled": false,
    "windowsHelloForBusinessBlocked": false,
    "roleScopeTagIds": [
      "0"
    ],
    "_metadata": {
      "policyId": "INT13",
      "description": "Windows Hello for Business configuration enabling phishing-resistant passwordless authentication. Requires TPM-backed PIN (minimum 6 digits, maximum 127), allows biometric unlock with enhanced anti-spoofing, enables PIN recovery, and supports FIDO2 security key sign-in. Deploys to all Windows 10/11 devices.",
      "graphEndpoint": "POST /deviceManagement/deviceConfigurations",
      "platform": "Windows 10/11",
      "frameworks": [
        "CIS Microsoft Intune for Windows 11 Benchmark v3.0.1",
        "NIST SP 800-53 Rev 5 - IA-2, IA-5, IA-12",
        "NIST SP 800-63B - AAL2",
        "NIST SP 800-171 Rev 2 - 3.5.3",
        "ISO 27001:2022 A.8.5",
        "Essential Eight - Multi-Factor Authentication",
        "MITRE ATT&CK - T1110 (Brute Force), T1078 (Valid Accounts)"
      ],
      "cisChecks": [
        "CIS 5.2.2.2 - Ensure Windows Hello for Business is enabled",
        "CIS 5.3.1 - Ensure PIN minimum length is 6 or greater",
        "CIS 5.3.2 - Ensure biometric authentication is allowed",
        "CIS 5.3.3 - Ensure TPM is required for Windows Hello"
      ],
      "version": "1.0.0",
      "lastUpdated": "2026-02-27"
    }
  },
  {
    "@odata.type": "#microsoft.graph.windows10EndpointProtectionConfiguration",
    "displayName": "INT14 - Windows Firewall Policy (All Profiles)",
    "description": "Enforces Windows Firewall on all profiles (Domain, Private, Public): block inbound on public, allow outbound, enable logging of dropped packets.",
    "version": 1,
    "firewallProfileDomain": {
      "firewallEnabled": "allowed",
      "stealthModeRequired": false,
      "stealthModeBlocked": false,
      "incomingTrafficRequired": false,
      "incomingTrafficBlocked": false,
      "unicastResponsesToMulticastBroadcastsRequired": false,
      "unicastResponsesToMulticastBroadcastsBlocked": false,
      "inboundNotificationsRequired": false,
      "inboundNotificationsBlocked": false,
      "authorizedApplicationRulesFromGroupPolicyMerged": true,
      "authorizedApplicationRulesFromGroupPolicyNotMerged": false,
      "globalPortRulesFromGroupPolicyMerged": true,
      "globalPortRulesFromGroupPolicyNotMerged": false,
      "connectionSecurityRulesFromGroupPolicyMerged": true,
      "connectionSecurityRulesFromGroupPolicyNotMerged": false,
      "outboundConnectionsRequired": false,
      "outboundConnectionsBlocked": false,
      "inboundConnectionsRequired": false,
      "inboundConnectionsBlocked": false,
      "securedPacketExemptionAllowed": false,
      "securedPacketExemptionBlocked": false,
      "policyRulesFromGroupPolicyMerged": true,
      "policyRulesFromGroupPolicyNotMerged": false
    },
    "firewallProfilePrivate": {
      "firewallEnabled": "allowed",
      "stealthModeRequired": false,
      "stealthModeBlocked": false,
      "incomingTrafficRequired": false,
      "incomingTrafficBlocked": false,
      "unicastResponsesToMulticastBroadcastsRequired": false,
      "unicastResponsesToMulticastBroadcastsBlocked": false,
      "inboundNotificationsRequired": false,
      "inboundNotificationsBlocked": false,
      "authorizedApplicationRulesFromGroupPolicyMerged": true,
      "authorizedApplicationRulesFromGroupPolicyNotMerged": false,
      "globalPortRulesFromGroupPolicyMerged": true,
      "globalPortRulesFromGroupPolicyNotMerged": false,
      "connectionSecurityRulesFromGroupPolicyMerged": true,
      "connectionSecurityRulesFromGroupPolicyNotMerged": false,
      "outboundConnectionsRequired": false,
      "outboundConnectionsBlocked": false,
      "inboundConnectionsRequired": false,
      "inboundConnectionsBlocked": false,
      "securedPacketExemptionAllowed": false,
      "securedPacketExemptionBlocked": false,
      "policyRulesFromGroupPolicyMerged": true,
      "policyRulesFromGroupPolicyNotMerged": false
    },
    "firewallProfilePublic": {
      "firewallEnabled": "allowed",
      "stealthModeRequired": true,
      "stealthModeBlocked": false,
      "incomingTrafficRequired": false,
      "incomingTrafficBlocked": true,
      "unicastResponsesToMulticastBroadcastsRequired": false,
      "unicastResponsesToMulticastBroadcastsBlocked": true,
      "inboundNotificationsRequired": false,
      "inboundNotificationsBlocked": true,
      "authorizedApplicationRulesFromGroupPolicyMerged": false,
      "authorizedApplicationRulesFromGroupPolicyNotMerged": true,
      "globalPortRulesFromGroupPolicyMerged": false,
      "globalPortRulesFromGroupPolicyNotMerged": true,
      "connectionSecurityRulesFromGroupPolicyMerged": false,
      "connectionSecurityRulesFromGroupPolicyNotMerged": true,
      "outboundConnectionsRequired": false,
      "outboundConnectionsBlocked": false,
      "inboundConnectionsRequired": false,
      "inboundConnectionsBlocked": true,
      "securedPacketExemptionAllowed": false,
      "securedPacketExemptionBlocked": true,
      "policyRulesFromGroupPolicyMerged": false,
      "policyRulesFromGroupPolicyNotMerged": true
    },
    "firewallBlockAllIncoming": false,
    "firewallIPSecExemptionsNone": false,
    "firewallIPSecExemptionsAllowNeighborDiscovery": true,
    "firewallIPSecExemptionsAllowICMP": false,
    "firewallIPSecExemptionsAllowRouterDiscovery": true,
    "firewallIPSecExemptionsAllowDHCP": true,
    "firewallMergeKeyingModuleSettings": false,
    "firewallPacketQueueingMethod": "deviceDefault",
    "firewallPreSharedKeyEncodingMethod": "deviceDefault",
    "firewallCertificateRevocationListCheckMethod": "deviceDefault",
    "_firewallLogging": {
      "description": "Firewall logging settings to be deployed via OMA-URI custom configuration profile for dropped packet logging.",
      "omaSettings": [
        {
          "@odata.type": "#microsoft.graph.omaSettingString",
          "displayName": "Domain Profile - Log Dropped Packets",
          "omaUri": "./Vendor/MSFT/Firewall/MdmStore/DomainProfile/EnableLogDroppedPackets",
          "value": "true"
        },
        {
          "@odata.type": "#microsoft.graph.omaSettingInteger",
          "displayName": "Domain Profile - Log File Size",
          "omaUri": "./Vendor/MSFT/Firewall/MdmStore/DomainProfile/LogMaxFileSize",
          "value": 16384
        },
        {
          "@odata.type": "#microsoft.graph.omaSettingString",
          "displayName": "Private Profile - Log Dropped Packets",
          "omaUri": "./Vendor/MSFT/Firewall/MdmStore/PrivateProfile/EnableLogDroppedPackets",
          "value": "true"
        },
        {
          "@odata.type": "#microsoft.graph.omaSettingInteger",
          "displayName": "Private Profile - Log File Size",
          "omaUri": "./Vendor/MSFT/Firewall/MdmStore/PrivateProfile/LogMaxFileSize",
          "value": 16384
        },
        {
          "@odata.type": "#microsoft.graph.omaSettingString",
          "displayName": "Public Profile - Log Dropped Packets",
          "omaUri": "./Vendor/MSFT/Firewall/MdmStore/PublicProfile/EnableLogDroppedPackets",
          "value": "true"
        },
        {
          "@odata.type": "#microsoft.graph.omaSettingInteger",
          "displayName": "Public Profile - Log File Size",
          "omaUri": "./Vendor/MSFT/Firewall/MdmStore/PublicProfile/LogMaxFileSize",
          "value": 16384
        }
      ]
    },
    "roleScopeTagIds": [
      "0"
    ],
    "_metadata": {
      "policyId": "INT14",
      "description": "Windows Firewall policy enabling all three profiles (Domain, Private, Public). Public profile blocks all inbound connections and enables stealth mode. All profiles allow outbound. Dropped packet logging enabled at 16 MB per profile via supplementary OMA-URI settings in _firewallLogging.",
      "graphEndpoint": "POST /deviceManagement/deviceConfigurations",
      "platform": "Windows 10/11",
      "frameworks": [
        "CIS Microsoft Windows 11 Enterprise Benchmark v3.0.0",
        "NIST SP 800-53 Rev 5 - SC-7, AU-3",
        "NIST SP 800-171 Rev 2 - 3.13.1, 3.13.6",
        "ISO 27001:2022 A.8.20, A.8.21",
        "Essential Eight - Patch Operating Systems",
        "Microsoft Cloud Security Benchmark - NS-1, NS-4"
      ],
      "cisChecks": [
        "CIS 9.1.1 - Ensure Windows Firewall: Domain: Firewall state is On",
        "CIS 9.2.1 - Ensure Windows Firewall: Private: Firewall state is On",
        "CIS 9.3.1 - Ensure Windows Firewall: Public: Firewall state is On",
        "CIS 9.3.2 - Ensure Windows Firewall: Public: Inbound connections is Block",
        "CIS 9.1.5 - Ensure Windows Firewall: Domain: Logging: Log dropped packets is enabled",
        "CIS 9.2.5 - Ensure Windows Firewall: Private: Logging: Log dropped packets is enabled",
        "CIS 9.3.5 - Ensure Windows Firewall: Public: Logging: Log dropped packets is enabled"
      ],
      "version": "1.0.0",
      "lastUpdated": "2026-02-27"
    }
  },
  {
    "@odata.type": "#microsoft.graph.windows10CustomConfiguration",
    "displayName": "INT15 - Attack Surface Reduction Rules (All 16 in Block Mode)",
    "description": "Deploys all 16 ASR rules in Block mode via OMA-URI. Blocks Office macro abuse, credential theft from LSASS, untrusted USB processes, executable email content, obfuscated scripts, and more.",
    "version": 1,
    "omaSettings": [
      {
        "@odata.type": "#microsoft.graph.omaSettingString",
        "displayName": "ASR - Block Office apps from creating child processes",
        "description": "GUID: D4F940AB-401B-4EFC-AADC-AD5F3C50688A. Value: 1 = Block.",
        "omaUri": "./Vendor/MSFT/Policy/Config/Defender/AttackSurfaceReductionRules",
        "value": "D4F940AB-401B-4EFC-AADC-AD5F3C50688A=1|3B576869-A4EC-4529-8536-B80A7769E899=1|75668C1F-73B5-4CF0-BB93-3ECF5CB7CC84=1|5BEB7EFE-FD9A-4556-801D-275E5FFC04CC=1|D3E037E1-3EB8-44C8-A917-57927947596D=1|BE9BA2D9-53EA-4CDC-84E5-9B1EEEE46550=1|92E97FA1-2EDF-4476-BDD6-9DD0B4DDDC7B=1|01443614-CD74-433A-B99E-2ECDC07BFC25=1|26190899-1602-49E8-8B27-EB1D0A1CE869=1|9E6C4E1F-7D60-472F-BA1A-A39EF669E4B2=1|B2B3F03D-6A65-4F7B-A9C7-1C7EF74A9BA4=1|7674BA52-37EB-4A4F-A9A1-F0F9A1619A2C=1|E6DB77E5-3DF2-4CF1-B95A-636979351E5B=1|D1E49AAC-8F56-4280-B9BA-993A6D77406C=1|33DDEDF1-C6E0-47CB-833E-DE6133960387=1|C1DB55AB-C21A-4637-BB3F-A12568109D35=1"
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingString",
        "displayName": "ASR - Actions for all rules",
        "description": "Sets all ASR rule actions to Block (1).",
        "omaUri": "./Vendor/MSFT/Policy/Config/Defender/AttackSurfaceReductionOnlyExclusions",
        "value": ""
      }
    ],
    "_asrRuleReference": {
      "description": "Complete mapping of all 16 ASR rule GUIDs to descriptions. All set to Block (1). Other valid values: 0=Off, 2=Audit, 6=Warn.",
      "rules": [
        {
          "guid": "D4F940AB-401B-4EFC-AADC-AD5F3C50688A",
          "name": "Block Office applications from creating child processes",
          "action": 1
        },
        {
          "guid": "3B576869-A4EC-4529-8536-B80A7769E899",
          "name": "Block Office applications from creating executable content",
          "action": 1
        },
        {
          "guid": "75668C1F-73B5-4CF0-BB93-3ECF5CB7CC84",
          "name": "Block Office applications from injecting code into other processes",
          "action": 1
        },
        {
          "guid": "5BEB7EFE-FD9A-4556-801D-275E5FFC04CC",
          "name": "Block execution of potentially obfuscated scripts",
          "action": 1
        },
        {
          "guid": "D3E037E1-3EB8-44C8-A917-57927947596D",
          "name": "Block JavaScript or VBScript from launching downloaded executable content",
          "action": 1
        },
        {
          "guid": "BE9BA2D9-53EA-4CDC-84E5-9B1EEEE46550",
          "name": "Block executable content from email client and webmail",
          "action": 1
        },
        {
          "guid": "92E97FA1-2EDF-4476-BDD6-9DD0B4DDDC7B",
          "name": "Block Win32 API calls from Office macros",
          "action": 1
        },
        {
          "guid": "01443614-CD74-433A-B99E-2ECDC07BFC25",
          "name": "Block executable files from running unless they meet a prevalence, age, or trusted list criterion",
          "action": 1
        },
        {
          "guid": "26190899-1602-49E8-8B27-EB1D0A1CE869",
          "name": "Block Office communication application from creating child processes",
          "action": 1
        },
        {
          "guid": "9E6C4E1F-7D60-472F-BA1A-A39EF669E4B2",
          "name": "Block credential stealing from the Windows local security authority subsystem (lsass.exe)",
          "action": 1
        },
        {
          "guid": "B2B3F03D-6A65-4F7B-A9C7-1C7EF74A9BA4",
          "name": "Block untrusted and unsigned processes that run from USB",
          "action": 1
        },
        {
          "guid": "7674BA52-37EB-4A4F-A9A1-F0F9A1619A2C",
          "name": "Block Adobe Reader from creating child processes",
          "action": 1
        },
        {
          "guid": "E6DB77E5-3DF2-4CF1-B95A-636979351E5B",
          "name": "Block persistence through WMI event subscription",
          "action": 1
        },
        {
          "guid": "D1E49AAC-8F56-4280-B9BA-993A6D77406C",
          "name": "Block process creations originating from PSExec and WMI commands",
          "action": 1
        },
        {
          "guid": "33DDEDF1-C6E0-47CB-833E-DE6133960387",
          "name": "Block rebooting machine in Safe Mode",
          "action": 1
        },
        {
          "guid": "C1DB55AB-C21A-4637-BB3F-A12568109D35",
          "name": "Use advanced protection against ransomware",
          "action": 1
        }
      ]
    },
    "roleScopeTagIds": [
      "0"
    ],
    "_metadata": {
      "policyId": "INT15",
      "description": "Deploys all 16 Attack Surface Reduction (ASR) rules in Block mode via OMA-URI custom configuration. Rules prevent Office macro child process creation, executable content creation, code injection, obfuscated script execution, credential theft from LSASS, untrusted USB processes, email executable content, WMI persistence, PSExec/WMI process creation, and advanced ransomware protection. IMPORTANT: Deploy in Audit mode (value=2) for 2-4 weeks before switching to Block mode (value=1) in production.",
      "graphEndpoint": "POST /deviceManagement/deviceConfigurations",
      "platform": "Windows 10/11",
      "prerequisite": "Microsoft Defender for Endpoint Plan 1 or above. Test in Audit mode for 2-4 weeks before enabling Block mode.",
      "frameworks": [
        "CIS Microsoft Intune for Windows 11 Benchmark v3.0.1",
        "NIST SP 800-53 Rev 5 - SI-3, SI-4, SI-7",
        "NIST SP 800-171 Rev 2 - 3.14.2, 3.14.6",
        "ISO 27001:2022 A.8.7, A.8.8",
        "Essential Eight - Application Control (Maturity Level 2)",
        "Essential Eight - Configure Microsoft Office Macro Settings (Maturity Level 2)",
        "MITRE ATT&CK - T1059 (Command and Scripting Interpreter), T1566 (Phishing), T1003 (OS Credential Dumping), T1091 (Replication Through Removable Media)"
      ],
      "cisChecks": [
        "CIS 18.9.47.5.1.1 - Ensure ASR rules are configured",
        "CIS 18.9.47.5.1.2 - Ensure ASR rule: Block Office applications from creating child processes is Enabled",
        "CIS 18.9.47.5.1.3 - Ensure ASR rule: Block credential stealing from LSASS is Enabled"
      ],
      "version": "1.0.0",
      "lastUpdated": "2026-02-27"
    }
  },
  {
    "@odata.type": "#microsoft.graph.windows10EndpointProtectionConfiguration",
    "displayName": "INT16 - Windows Credential Guard and Device Guard",
    "description": "Enables Credential Guard with UEFI lock to protect domain credentials via virtualisation-based security (VBS). Enables Device Guard for code integrity. Mitigates pass-the-hash and pass-the-ticket attacks.",
    "version": 1,
    "deviceGuardLocalSystemAuthorityCredentialGuardSettings": "enableWithUEFILock",
    "deviceGuardEnableVirtualizationBasedSecurity": true,
    "deviceGuardEnableSecureBootWithDMA": true,
    "deviceGuardSecureBootWithDMA": "withoutDMA",
    "deviceGuardLaunchSystemGuard": "enabled",
    "dmaGuardDeviceEnumerationPolicy": "blockAll",
    "xboxServicesEnableXboxGameSaveTask": false,
    "xboxServicesAccessoryManagementServiceStartupMode": "disabled",
    "xboxServicesLiveAuthManagerServiceStartupMode": "disabled",
    "xboxServicesLiveGameSaveServiceStartupMode": "disabled",
    "xboxServicesLiveNetworkingServiceStartupMode": "disabled",
    "roleScopeTagIds": [
      "0"
    ],
    "_supplementaryOmaUri": {
      "description": "Additional Credential Guard and VBS settings via OMA-URI for comprehensive deployment.",
      "settings": [
        {
          "@odata.type": "#microsoft.graph.omaSettingInteger",
          "displayName": "Enable Virtualization Based Security",
          "description": "RequirePlatformSecurityFeatures: 3 = Secure Boot and DMA Protection.",
          "omaUri": "./Device/Vendor/MSFT/Policy/Config/DeviceGuard/RequirePlatformSecurityFeatures",
          "value": 3
        },
        {
          "@odata.type": "#microsoft.graph.omaSettingInteger",
          "displayName": "Credential Guard Configuration",
          "description": "LsaCfgFlags: 1 = Enabled with UEFI lock.",
          "omaUri": "./Device/Vendor/MSFT/Policy/Config/DeviceGuard/LsaCfgFlags",
          "value": 1
        },
        {
          "@odata.type": "#microsoft.graph.omaSettingInteger",
          "displayName": "Enable Virtualization Based Security",
          "description": "EnableVirtualizationBasedSecurity: 1 = Enabled.",
          "omaUri": "./Device/Vendor/MSFT/Policy/Config/DeviceGuard/EnableVirtualizationBasedSecurity",
          "value": 1
        },
        {
          "@odata.type": "#microsoft.graph.omaSettingInteger",
          "displayName": "Hypervisor Enforced Code Integrity",
          "description": "HypervisorEnforcedCodeIntegrity: 1 = Enabled with UEFI lock.",
          "omaUri": "./Device/Vendor/MSFT/Policy/Config/DeviceGuard/HypervisorEnforcedCodeIntegrity",
          "value": 1
        }
      ]
    },
    "_metadata": {
      "policyId": "INT16",
      "description": "Enables Windows Credential Guard with UEFI lock to isolate domain credentials (NTLM hashes, Kerberos TGTs) in a virtualization-based security (VBS) container. Enables Device Guard with Hypervisor-enforced Code Integrity (HVCI). Blocks DMA attacks via DMA Guard. Requires hardware supporting UEFI Secure Boot and VBS. WARNING: UEFI lock means Credential Guard cannot be disabled remotely - only via physical UEFI/BIOS access.",
      "graphEndpoint": "POST /deviceManagement/deviceConfigurations",
      "platform": "Windows 10/11 Enterprise/Education",
      "prerequisite": "Requires UEFI Secure Boot, VBS-capable hardware, TPM 2.0. Windows Enterprise or Education edition. Test on pilot devices first. UEFI lock is persistent.",
      "frameworks": [
        "CIS Microsoft Windows 11 Enterprise Benchmark v3.0.0",
        "NIST SP 800-53 Rev 5 - AC-25, SC-39",
        "NIST SP 800-171 Rev 2 - 3.13.4",
        "ISO 27001:2022 A.8.6",
        "Essential Eight - Restrict Administrative Privileges",
        "MITRE ATT&CK - T1003.001 (LSASS Memory), T1550 (Use Alternate Authentication Material)"
      ],
      "cisChecks": [
        "CIS 18.8.5.1 - Ensure Turn On Virtualization Based Security is Enabled",
        "CIS 18.8.5.2 - Ensure Turn On Virtualization Based Security: Credential Guard Configuration is Enabled with UEFI lock",
        "CIS 18.8.5.3 - Ensure Turn On Virtualization Based Security: Require Platform Security Features is Secure Boot and DMA Protection"
      ],
      "version": "1.0.0",
      "lastUpdated": "2026-02-27"
    }
  },
  {
    "@odata.type": "#microsoft.graph.windows10CustomConfiguration",
    "displayName": "INT17 - Removable Storage Device Control Policy",
    "description": "Blocks USB removable storage read and write access. Allows specific approved USB vendor IDs via exception list. Prevents data exfiltration via removable media.",
    "version": 1,
    "omaSettings": [
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "Removable Disk - Deny Read Access",
        "description": "RemovableDiskDenyReadAccess: 1 = Block read access to removable storage.",
        "omaUri": "./Device/Vendor/MSFT/Policy/Config/Storage/RemovableDiskDenyReadAccess",
        "value": 1
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "Removable Disk - Deny Write Access",
        "description": "RemovableDiskDenyWriteAccess: 1 = Block write access to removable storage.",
        "omaUri": "./Device/Vendor/MSFT/Policy/Config/Storage/RemovableDiskDenyWriteAccess",
        "value": 1
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "WPD Devices - Deny Read Access",
        "description": "Blocks read access to Windows Portable Devices (MTP/PTP). 1 = Block.",
        "omaUri": "./Device/Vendor/MSFT/Policy/Config/Storage/WPDDevicesDenyReadAccessPerDevice",
        "value": 1
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "WPD Devices - Deny Write Access",
        "description": "Blocks write access to Windows Portable Devices (MTP/PTP). 1 = Block.",
        "omaUri": "./Device/Vendor/MSFT/Policy/Config/Storage/WPDDevicesDenyWriteAccessPerDevice",
        "value": 1
      },
      {
        "@odata.type": "#microsoft.graph.omaSettingInteger",
        "displayName": "All Removable Storage - Deny All Access",
        "description": "AllRemovableStorageClasses_DenyAll_Access: 1 = Block all removable storage classes.",
        "omaUri": "./Device/Vendor/MSFT/Policy/Config/Storage/AllRemovableStorageClasses_DenyAll_Access",
        "value": 1
      }
    ],
    "_approvedDeviceExceptions": {
      "description": "To allow specific approved USB devices, create a Defender for Endpoint Device Control policy with approved vendor/product IDs. Replace placeholder VIDs/PIDs below with your organisation's approved device identifiers.",
      "approvedDevices": [
        {
          "vendorId": "0781",
          "productId": "",
          "friendlyName": "PLACEHOLDER - SanDisk (replace with your approved VID)",
          "serialNumber": ""
        },
        {
          "vendorId": "0951",
          "productId": "",
          "friendlyName": "PLACEHOLDER - Kingston Technology (replace with your approved VID)",
          "serialNumber": ""
        }
      ],
      "defenderDeviceControlPolicy": {
        "description": "Use Microsoft Defender for Endpoint Device Control for granular allow/deny rules by VID/PID.",
        "endpoint": "POST /deviceManagement/intents with templateId for Device Control"
      }
    },
    "roleScopeTagIds": [
      "0"
    ],
    "_metadata": {
      "policyId": "INT17",
      "description": "Blocks all USB removable storage read/write access and Windows Portable Device (MTP/PTP) access via OMA-URI storage policies. Prevents data exfiltration through USB drives, external hard disks, and portable media devices. The _approvedDeviceExceptions section provides placeholder vendor IDs for organisations that need to allow specific approved USB devices via Defender for Endpoint Device Control.",
      "graphEndpoint": "POST /deviceManagement/deviceConfigurations",
      "platform": "Windows 10/11",
      "frameworks": [
        "CIS Microsoft Windows 11 Enterprise Benchmark v3.0.0",
        "NIST SP 800-53 Rev 5 - MP-7, SC-41",
        "NIST SP 800-171 Rev 2 - 3.8.7",
        "ISO 27001:2022 A.7.10, A.8.12",
        "Essential Eight - Restrict Administrative Privileges",
        "PCI DSS v4.0 - Req 12.3.10",
        "MITRE ATT&CK - T1052 (Exfiltration Over Physical Medium), T1091 (Replication Through Removable Media)"
      ],
      "cisChecks": [
        "CIS 18.8.37.1 - Ensure removable storage access is restricted",
        "CIS 18.8.37.2 - Ensure WPD device access is restricted"
      ],
      "version": "1.0.0",
      "lastUpdated": "2026-02-27"
    }
  },
  {
    "@odata.type": "#microsoft.graph.windows10GeneralConfiguration",
    "displayName": "INT18 - Windows Diagnostic Data - Required/Security Level",
    "description": "Restricts Windows diagnostic data collection to the Required (Security) level. Disables optional telemetry. Supports GDPR and data minimisation compliance.",
    "version": 1,
    "diagnosticsDataSubmissionMode": "basic",
    "edgeTelemetryForMicrosoft365Analytics": "notConfigured",
    "inkWorkspaceAccess": "disabled",
    "inkWorkspaceAccessState": "blocked",
    "inkWorkspaceBlockSuggestedApps": true,
    "searchBlockDiacritics": false,
    "searchDisableAutoLanguageDetection": false,
    "searchDisableIndexerBackoff": false,
    "searchDisableIndexingEncryptedItems": false,
    "searchDisableIndexingRemovableDriveItems": true,
    "searchEnableRemoteQueries": false,
    "experienceBlockDeviceDiscovery": false,
    "experienceBlockErrorDialogWhenNoSIM": false,
    "experienceBlockTaskSwitcher": false,
    "experienceDoNotSyncBrowserSettings": "blocked",
    "privacyBlockActivityFeed": true,
    "privacyBlockPublishUserActivities": true,
    "privacyBlockInputPersonalization": true,
    "startBlockUnpinningAppsFromTaskbar": false,
    "settingsBlockSettingsApp": false,
    "settingsBlockSystemPage": false,
    "settingsBlockPrivacyPage": false,
    "roleScopeTagIds": [
      "0"
    ],
    "_supplementaryOmaUri": {
      "description": "Additional diagnostic data restrictions via OMA-URI for comprehensive telemetry control.",
      "settings": [
        {
          "@odata.type": "#microsoft.graph.omaSettingInteger",
          "displayName": "Allow Telemetry - Required Only",
          "description": "AllowTelemetry: 1 = Required/Basic diagnostic data only. For Enterprise, use 0 for Security level.",
          "omaUri": "./Device/Vendor/MSFT/Policy/Config/System/AllowTelemetry",
          "value": 1
        },
        {
          "@odata.type": "#microsoft.graph.omaSettingInteger",
          "displayName": "Limit Enhanced Diagnostic Data",
          "description": "LimitEnhancedDiagnosticDataWindowsAnalytics: 1 = Limit to minimum required.",
          "omaUri": "./Device/Vendor/MSFT/Policy/Config/System/LimitEnhancedDiagnosticDataWindowsAnalytics",
          "value": 1
        },
        {
          "@odata.type": "#microsoft.graph.omaSettingInteger",
          "displayName": "Disable Diagnostic Data Opt-In Settings UI",
          "description": "ConfigureTelemetryOptInSettingsUx: 1 = Disable the Settings UI for telemetry opt-in.",
          "omaUri": "./Device/Vendor/MSFT/Policy/Config/System/ConfigureTelemetryOptInSettingsUx",
          "value": 1
        },
        {
          "@odata.type": "#microsoft.graph.omaSettingInteger",
          "displayName": "Disable Diagnostic Data Viewer",
          "description": "DisableDiagnosticDataViewer: 1 = Disable.",
          "omaUri": "./Device/Vendor/MSFT/Policy/Config/System/DisableDiagnosticDataViewer",
          "value": 1
        },
        {
          "@odata.type": "#microsoft.graph.omaSettingInteger",
          "displayName": "Disable One Settings Downloads",
          "description": "DisableOneSettingsDownloads: 1 = Prevents dynamic configuration data downloads.",
          "omaUri": "./Device/Vendor/MSFT/Policy/Config/System/DisableOneSettingsDownloads",
          "value": 1
        },
        {
          "@odata.type": "#microsoft.graph.omaSettingInteger",
          "displayName": "Allow Commercial Data Pipeline",
          "description": "AllowCommercialDataPipeline: 1 = Enable Windows diagnostic data processor configuration for EU compliance.",
          "omaUri": "./Device/Vendor/MSFT/Policy/Config/System/AllowCommercialDataPipeline",
          "value": 1
        }
      ]
    },
    "_metadata": {
      "policyId": "INT18",
      "description": "Restricts Windows diagnostic data to the Required/Basic level (Security level for Enterprise SKUs). Disables optional telemetry, activity feed publishing, input personalisation, and browser settings sync. Supplementary OMA-URI settings limit enhanced diagnostics, disable telemetry opt-in UI, and enable the EU data boundary commercial data pipeline for GDPR compliance.",
      "graphEndpoint": "POST /deviceManagement/deviceConfigurations",
      "platform": "Windows 10/11",
      "frameworks": [
        "GDPR (EU) 2016/679 - Article 5(1)(c) Data Minimisation",
        "NIST SP 800-53 Rev 5 - SI-12",
        "ISO 27001:2022 A.5.33, A.8.11",
        "ISO 27701:2019 - 7.4.1",
        "CIS Microsoft Windows 11 Enterprise Benchmark v3.0.0",
        "BSI IT-Grundschutz - APP.1.1.A18"
      ],
      "cisChecks": [
        "CIS 18.9.17.1 - Ensure Allow Telemetry is set to Required or Security",
        "CIS 18.9.17.2 - Ensure diagnostic data is not sent beyond required level",
        "CIS 18.9.17.3 - Ensure telemetry opt-in UI is disabled"
      ],
      "version": "1.0.0",
      "lastUpdated": "2026-02-27"
    }
  },
  {
    "@odata.type": "#microsoft.graph.windows10EndpointProtectionConfiguration",
    "displayName": "INT19 - Windows Exploit Protection (System-Wide Mitigations)",
    "description": "Enables system-wide exploit mitigations: DEP always on, SEHOP enabled, mandatory ASLR, Control Flow Guard (CFG) enabled. Hardens all processes against memory exploitation techniques.",
    "version": 1,
    "defenderExploitProtectionXml": null,
    "defenderExploitProtectionXmlFileName": null,
    "roleScopeTagIds": [
      "0"
    ],
    "_exploitProtectionXml": {
      "description": "The exploit protection XML below should be Base64-encoded and set as defenderExploitProtectionXml value, or deployed via the Exploit Protection settings in Endpoint Security. The XML configures system-wide mitigations for all processes.",
      "xmlContent": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<MitigationPolicy>\n  <SystemConfig>\n    <DEP Enable=\"true\" EmulateAtlThunks=\"false\" />\n    <ASLR ForceRelocateImages=\"true\" RequireInfo=\"false\" BottomUp=\"true\" HighEntropy=\"true\" />\n    <SEHOP Enable=\"true\" TelemetryOnly=\"false\" />\n    <ControlFlowGuard Enable=\"true\" SuppressExports=\"false\" />\n    <Heap TerminateOnError=\"true\" />\n    <ImageLoad BlockRemoteImageLoads=\"false\" BlockLowLabelImageLoads=\"false\" />\n  </SystemConfig>\n  <AppConfig Executable=\"iexplore.exe\">\n    <DEP Enable=\"true\" EmulateAtlThunks=\"false\" />\n    <ASLR ForceRelocateImages=\"true\" RequireInfo=\"false\" BottomUp=\"true\" HighEntropy=\"true\" />\n    <SEHOP Enable=\"true\" TelemetryOnly=\"false\" />\n    <ExtensionPoints DisableExtensionPoints=\"true\" />\n  </AppConfig>\n  <AppConfig Executable=\"OUTLOOK.EXE\">\n    <DEP Enable=\"true\" EmulateAtlThunks=\"false\" />\n    <ASLR ForceRelocateImages=\"true\" RequireInfo=\"false\" BottomUp=\"true\" HighEntropy=\"true\" />\n    <SEHOP Enable=\"true\" TelemetryOnly=\"false\" />\n    <ExtensionPoints DisableExtensionPoints=\"true\" />\n  </AppConfig>\n  <AppConfig Executable=\"WINWORD.EXE\">\n    <DEP Enable=\"true\" EmulateAtlThunks=\"false\" />\n    <ASLR ForceRelocateImages=\"true\" RequireInfo=\"false\" BottomUp=\"true\" HighEntropy=\"true\" />\n    <SEHOP Enable=\"true\" TelemetryOnly=\"false\" />\n    <ExtensionPoints DisableExtensionPoints=\"true\" />\n  </AppConfig>\n  <AppConfig Executable=\"EXCEL.EXE\">\n    <DEP Enable=\"true\" EmulateAtlThunks=\"false\" />\n    <ASLR ForceRelocateImages=\"true\" RequireInfo=\"false\" BottomUp=\"true\" HighEntropy=\"true\" />\n    <SEHOP Enable=\"true\" TelemetryOnly=\"false\" />\n    <ExtensionPoints DisableExtensionPoints=\"true\" />\n  </AppConfig>\n  <AppConfig Executable=\"POWERPNT.EXE\">\n    <DEP Enable=\"true\" EmulateAtlThunks=\"false\" />\n    <ASLR ForceRelocateImages=\"true\" RequireInfo=\"false\" BottomUp=\"true\" HighEntropy=\"true\" />\n    <SEHOP Enable=\"true\" TelemetryOnly=\"false\" />\n    <ExtensionPoints DisableExtensionPoints=\"true\" />\n  </AppConfig>\n  <AppConfig Executable=\"msedge.exe\">\n    <DEP Enable=\"true\" EmulateAtlThunks=\"false\" />\n    <ASLR ForceRelocateImages=\"true\" RequireInfo=\"false\" BottomUp=\"true\" HighEntropy=\"true\" />\n    <SEHOP Enable=\"true\" TelemetryOnly=\"false\" />\n  </AppConfig>\n</MitigationPolicy>"
    },
    "_omaUriSettings": {
      "description": "OMA-URI settings for deploying exploit protection XML and system-level mitigations.",
      "settings": [
        {
          "@odata.type": "#microsoft.graph.omaSettingString",
          "displayName": "Exploit Protection XML",
          "description": "Deploy exploit protection XML configuration. The value should be the Base64-encoded XML from _exploitProtectionXml.",
          "omaUri": "./Device/Vendor/MSFT/Policy/Config/ExploitGuard/ExploitProtectionSettings",
          "value": "BASE64_ENCODED_XML_HERE"
        }
      ]
    },
    "_metadata": {
      "policyId": "INT19",
      "description": "Windows Exploit Protection policy enabling system-wide memory mitigations: Data Execution Prevention (DEP) always on, Structured Exception Handler Overwrite Protection (SEHOP), mandatory Address Space Layout Randomization (ASLR) with high entropy, Control Flow Guard (CFG), and heap termination on corruption. Includes per-application hardening for Office apps (Outlook, Word, Excel, PowerPoint), Internet Explorer, and Edge. Deploy the XML via defenderExploitProtectionXml (Base64-encoded) or via OMA-URI.",
      "graphEndpoint": "POST /deviceManagement/deviceConfigurations",
      "platform": "Windows 10/11",
      "frameworks": [
        "CIS Microsoft Windows 11 Enterprise Benchmark v3.0.0",
        "NIST SP 800-53 Rev 5 - SI-16, SC-39",
        "NIST SP 800-171 Rev 2 - 3.14.2",
        "ISO 27001:2022 A.8.6",
        "Essential Eight - Application Control",
        "MITRE ATT&CK - T1203 (Exploitation for Client Execution), T1068 (Exploitation for Privilege Escalation)"
      ],
      "cisChecks": [
        "CIS 18.9.47.1 - Ensure DEP is enabled for all processes",
        "CIS 18.9.47.2 - Ensure SEHOP is enabled",
        "CIS 18.9.47.3 - Ensure mandatory ASLR is enabled",
        "CIS 18.9.47.4 - Ensure Control Flow Guard is enabled"
      ],
      "version": "1.0.0",
      "lastUpdated": "2026-02-27"
    }
  },
  {
    "@odata.type": "#microsoft.graph.windows10EndpointProtectionConfiguration",
    "displayName": "INT20 - Controlled Folder Access (Ransomware Protection)",
    "description": "Enables Controlled Folder Access in Block mode to protect Documents, Desktop, Pictures, and Videos folders from unauthorised modifications. Provides ransomware protection by blocking untrusted app access to protected folders.",
    "version": 1,
    "defenderGuardMyFoldersType": "enable",
    "defenderGuardedFoldersAllowedAppPaths": [],
    "defenderAdditionalGuardedFolders": [
      "C:\\Users\\*\\Documents",
      "C:\\Users\\*\\Desktop",
      "C:\\Users\\*\\Pictures",
      "C:\\Users\\*\\Videos",
      "C:\\Users\\*\\Music",
      "C:\\Users\\*\\Favorites"
    ],
    "defenderNetworkProtectionType": "enable",
    "defenderAdvancedRansomewareProtectionType": "enable",
    "defenderPotentiallyUnwantedAppAction": "block",
    "defenderRealTimeMonitorAllowed": true,
    "roleScopeTagIds": [
      "0"
    ],
    "_omaUriSettings": {
      "description": "OMA-URI settings for granular Controlled Folder Access configuration.",
      "settings": [
        {
          "@odata.type": "#microsoft.graph.omaSettingInteger",
          "displayName": "Enable Controlled Folder Access",
          "description": "EnableControlledFolderAccess: 1 = Enabled (Block mode). Use 2 for Audit mode.",
          "omaUri": "./Vendor/MSFT/Policy/Config/Defender/EnableControlledFolderAccess",
          "value": 1
        },
        {
          "@odata.type": "#microsoft.graph.omaSettingString",
          "displayName": "Controlled Folder Access Protected Folders",
          "description": "Additional folders to protect beyond the default system folders.",
          "omaUri": "./Vendor/MSFT/Policy/Config/Defender/ControlledFolderAccessProtectedFolders",
          "value": "C:\\Users\\Public\\Documents|C:\\Shares"
        },
        {
          "@odata.type": "#microsoft.graph.omaSettingString",
          "displayName": "Controlled Folder Access Allowed Applications",
          "description": "Applications allowed to access protected folders. Add trusted LOB applications here.",
          "omaUri": "./Vendor/MSFT/Policy/Config/Defender/ControlledFolderAccessAllowedApplications",
          "value": ""
        }
      ]
    },
    "_metadata": {
      "policyId": "INT20",
      "description": "Controlled Folder Access policy in Block mode providing ransomware protection for user profile folders (Documents, Desktop, Pictures, Videos, Music, Favorites) and optional additional paths. Only trusted applications (automatically determined by Microsoft Defender) can modify files in protected folders. Untrusted applications are blocked from writing to protected locations. IMPORTANT: Deploy in Audit mode (defenderGuardMyFoldersType=auditMode, OMA-URI value=2) for at least 2 weeks before enabling Block mode to identify legitimate applications that need allow-listing.",
      "graphEndpoint": "POST /deviceManagement/deviceConfigurations",
      "platform": "Windows 10/11",
      "prerequisite": "Microsoft Defender for Endpoint Plan 1 or above. Cloud-delivered protection must be enabled. Test in Audit mode for 2 weeks before Block mode.",
      "frameworks": [
        "CIS Microsoft Windows 11 Enterprise Benchmark v3.0.0",
        "NIST SP 800-53 Rev 5 - SI-3, SI-4, SC-7",
        "NIST SP 800-171 Rev 2 - 3.14.2",
        "ISO 27001:2022 A.8.7",
        "Essential Eight - Application Control",
        "MITRE ATT&CK - T1486 (Data Encrypted for Impact), T1490 (Inhibit System Recovery)"
      ],
      "cisChecks": [
        "CIS 18.9.47.5.3.1 - Ensure Controlled Folder Access is enabled",
        "CIS 18.9.47.5.3.2 - Ensure protected folders are configured",
        "CIS 18.9.47.5.3.3 - Ensure allowed applications list is reviewed"
      ],
      "version": "1.0.0",
      "lastUpdated": "2026-02-27"
    }
  },
  {
    "_metadata": {
      "id": "MDE01",
      "title": "Onboard Windows Devices to Defender for Endpoint",
      "description": "Intune EDR onboarding configuration that enables automatic onboarding of Windows devices to Microsoft Defender for Endpoint via the Intune connector. Configures sample sharing and telemetry reporting frequency.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "NIST SP 800-53 Rev.5",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "GDPR (EU) 2016/679",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "BSI IT-Grundschutz",
        "ASD Essential Eight",
        "NZ ISM v3.8",
        "MITRE ATT&CK",
        "PCI DSS v4.0",
        "CMMC v2.0",
        "CJIS v6",
        "Microsoft Cloud Security Benchmark",
        "NIST CSF 2.0"
      ],
      "cisChecks": [
        "5.1.4.1",
        "5.1.4.2"
      ],
      "mitreMappings": [
        "T1059",
        "T1204",
        "T1547",
        "T1053"
      ],
      "requiredLicences": [
        "Microsoft Defender for Endpoint P1 or P2",
        "Microsoft 365 E5 or Microsoft 365 E5 Security"
      ],
      "requiredRoles": [
        "Intune Administrator",
        "Security Administrator"
      ],
      "deploymentOrder": 1,
      "importMethod": "powershell-graph",
      "importScript": "scripts/Import-DefenderEndpointPolicies.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Microsoft Defender for Endpoint service must be provisioned at security.microsoft.com",
        "Intune connector to MDE must be established via MEM admin center > Endpoint Security > Microsoft Defender for Endpoint",
        "Windows devices must be enrolled in Intune MDM",
        "Minimum OS: Windows 10 version 1709 or later, or Windows 11",
        "Network connectivity to *.securitycenter.windows.com and *.blob.core.windows.net"
      ],
      "deploymentSteps": [
        "1. Enable the MDE connector in Intune admin center under Endpoint Security",
        "2. Deploy this configuration profile to the target device group",
        "3. Allow up to 24 hours for onboarding to propagate to all targeted devices",
        "4. Verify onboarding status in security.microsoft.com > Assets > Devices"
      ],
      "rollbackProcedure": "Remove the configuration profile assignment from the device group. Devices will offboard after 7 days. For immediate offboarding, use the offboarding script from the MDE portal."
    },
    "intuneProfile": {
      "@odata.type": "#microsoft.graph.windowsDefenderAdvancedThreatProtectionConfiguration",
      "displayName": "MDE01 - Onboard Windows Devices to Defender for Endpoint",
      "description": "Enables automatic onboarding of Windows devices to Microsoft Defender for Endpoint via the Intune EDR connector.",
      "roleScopeTagIds": [
        "0"
      ],
      "advancedThreatProtectionAutoPopulateOnboardingBlob": true,
      "advancedThreatProtectionOnboardingBlob": null,
      "advancedThreatProtectionOnboardingFilename": null,
      "allowSampleSharing": true,
      "enableExpeditedTelemetryReporting": false
    },
    "endpointSecurityPolicy": {
      "@odata.type": "#microsoft.graph.deviceManagementConfigurationPolicy",
      "name": "MDE01 - EDR Onboarding - Windows",
      "description": "Endpoint Detection and Response onboarding configuration for Windows 10/11 devices",
      "platforms": "windows10",
      "technologies": "mdm,microsoftSense",
      "templateReference": {
        "templateId": "0385b795-0f2f-44ac-8602-9f65bf6adede_1",
        "templateFamily": "endpointSecurityEndpointDetectionAndResponse",
        "templateDisplayName": "Endpoint detection and response",
        "templateDisplayVersion": "Version 2"
      },
      "settings": [
        {
          "settingInstance": {
            "@odata.type": "#microsoft.graph.deviceManagementConfigurationChoiceSettingInstance",
            "settingDefinitionId": "device_vendor_msft_windowsadvancedthreatprotection_configurationtype",
            "choiceSettingValue": {
              "value": "device_vendor_msft_windowsadvancedthreatprotection_configurationtype_autofromconnector",
              "children": []
            }
          }
        },
        {
          "settingInstance": {
            "@odata.type": "#microsoft.graph.deviceManagementConfigurationChoiceSettingInstance",
            "settingDefinitionId": "device_vendor_msft_windowsadvancedthreatprotection_configuration_samplesharing",
            "choiceSettingValue": {
              "value": "device_vendor_msft_windowsadvancedthreatprotection_configuration_samplesharing_all",
              "children": []
            }
          }
        },
        {
          "settingInstance": {
            "@odata.type": "#microsoft.graph.deviceManagementConfigurationChoiceSettingInstance",
            "settingDefinitionId": "device_vendor_msft_windowsadvancedthreatprotection_configuration_telemetryreportingfrequency",
            "choiceSettingValue": {
              "value": "device_vendor_msft_windowsadvancedthreatprotection_configuration_telemetryreportingfrequency_normal",
              "children": []
            }
          }
        }
      ]
    },
    "connectorSettings": {
      "graphApiEndpoint": "https://graph.microsoft.com/beta/deviceManagement/advancedThreatProtection",
      "microsoftDefenderForEndpointConnector": {
        "autoOnboardConnectorEnabled": true,
        "allowSampleSharing": true,
        "sampleSharingScope": "all",
        "telemetryReportingFrequency": "normal",
        "blockUnsupportedOSVersions": true
      },
      "complianceIntegration": {
        "androidEnabled": false,
        "iosEnabled": false,
        "windowsEnabled": true,
        "macEnabled": false
      }
    },
    "assignments": {
      "include": [
        {
          "@odata.type": "#microsoft.graph.groupAssignmentTarget",
          "groupId": "",
          "groupDisplayName": "All Managed Windows Devices"
        }
      ],
      "exclude": [
        {
          "@odata.type": "#microsoft.graph.exclusionGroupAssignmentTarget",
          "groupId": "",
          "groupDisplayName": "MDE Onboarding Exclusions"
        }
      ]
    }
  },
  {
    "_metadata": {
      "id": "MDE02",
      "title": "Onboard macOS Devices to Defender for Endpoint",
      "description": "Intune configuration profile for deploying Microsoft Defender for Endpoint on macOS. Enables real-time protection, cloud-delivered protection, automatic sample submission, and ensures active (non-passive) mode.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "ISO 27001:2022",
        "NIST SP 800-53 Rev.5",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "GDPR (EU) 2016/679",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "BSI IT-Grundschutz",
        "ASD Essential Eight",
        "NZ ISM v3.8",
        "MITRE ATT&CK",
        "Microsoft Cloud Security Benchmark",
        "DORA",
        "CMMC v2.0",
        "PCI DSS v4.0",
        "HIPAA",
        "CJIS v6"
      ],
      "cisChecks": [
        "5.1.4.1",
        "5.1.4.2"
      ],
      "mitreMappings": [
        "T1059.004",
        "T1204",
        "T1547.011",
        "T1564.001"
      ],
      "requiredLicences": [
        "Microsoft Defender for Endpoint P1 or P2",
        "Microsoft 365 E5 or Microsoft 365 E5 Security"
      ],
      "requiredRoles": [
        "Intune Administrator",
        "Security Administrator"
      ],
      "deploymentOrder": 2,
      "importMethod": "powershell-graph",
      "importScript": "scripts/Import-DefenderEndpointPolicies.ps1"
    },
    "_notes": {
      "prerequisites": [
        "macOS devices must be enrolled in Intune via Apple MDM push certificate",
        "System Extensions profile must be deployed BEFORE MDE to approve com.microsoft.wdav.epsext and com.microsoft.wdav.netext",
        "Full Disk Access (TCC/Privacy Preferences) profile must grant access to com.microsoft.wdav",
        "Network Content Filter profile required for Network Protection",
        "Minimum OS: macOS 11 (Big Sur) or later",
        "Microsoft Defender app must be deployed via Intune (LOB or VPP)"
      ],
      "deploymentSteps": [
        "1. Deploy the System Extensions approval profile",
        "2. Deploy the Full Disk Access / TCC profile",
        "3. Deploy the Network Content Filter profile",
        "4. Deploy this MDE configuration profile",
        "5. Deploy the Microsoft Defender app package",
        "6. Verify onboarding in security.microsoft.com > Assets > Devices"
      ],
      "rollbackProcedure": "Unassign the configuration profile and uninstall Microsoft Defender via Intune app uninstall. Remove the system extension and TCC profiles."
    },
    "intuneCustomConfigurationProfile": {
      "@odata.type": "#microsoft.graph.macOSCustomConfiguration",
      "displayName": "MDE02 - Defender for Endpoint macOS Configuration",
      "description": "Microsoft Defender for Endpoint settings for macOS devices deployed via Intune managed preferences (plist).",
      "deploymentChannel": "deviceChannel",
      "payloadName": "com.microsoft.wdav.mobileconfig",
      "payloadFileName": "com.microsoft.wdav.mobileconfig"
    },
    "mdeConfigurationPlist": {
      "PayloadType": "Configuration",
      "PayloadDisplayName": "MDE02 - Defender for Endpoint macOS",
      "PayloadIdentifier": "com.microsoft.wdav.managed",
      "PayloadUUID": "",
      "PayloadVersion": 1,
      "PayloadContent": [
        {
          "PayloadType": "com.microsoft.wdav",
          "PayloadDisplayName": "Microsoft Defender for Endpoint",
          "PayloadIdentifier": "com.microsoft.wdav.config",
          "PayloadUUID": "",
          "PayloadVersion": 1,
          "antivirusEngine": {
            "enforcementLevel": "real_time",
            "enableRealTimeProtection": true,
            "passiveMode": false,
            "scanAfterDefinitionUpdate": true,
            "scanArchives": true,
            "maximumOnDemandScanThreads": 2,
            "exclusionsMergePolicy": "admin_only",
            "threatTypeSettings": [
              {
                "key": "potentially_unwanted_application",
                "value": "block"
              },
              {
                "key": "archive_bomb",
                "value": "block"
              }
            ],
            "exclusions": []
          },
          "cloudService": {
            "enabled": true,
            "diagnosticLevel": "optional",
            "automaticSampleSubmission": true,
            "automaticSampleSubmissionConsent": "safe",
            "cloudBlockLevel": "normal"
          },
          "networkProtection": {
            "enforcementLevel": "block"
          },
          "tamperProtection": {
            "enforcementLevel": "block"
          },
          "features": {
            "dataLossPrevention": "enabled",
            "deviceControl": "enabled"
          },
          "edr": {
            "tags": [
              {
                "key": "GROUP",
                "value": ""
              }
            ]
          },
          "userInterface": {
            "hideStatusMenuIcon": false,
            "userInitiatedFeedback": "enabled"
          }
        }
      ]
    },
    "systemExtensionsProfile": {
      "PayloadType": "com.apple.system-extension-policy",
      "PayloadDisplayName": "MDE System Extensions",
      "AllowedSystemExtensions": {
        "UBF8T346G9": [
          "com.microsoft.wdav.epsext",
          "com.microsoft.wdav.netext"
        ]
      },
      "AllowedSystemExtensionTypes": {
        "UBF8T346G9": [
          "EndpointSecurityExtension",
          "NetworkExtension"
        ]
      }
    },
    "fullDiskAccessProfile": {
      "PayloadType": "com.apple.TCC.configuration-profile-policy",
      "PayloadDisplayName": "MDE Full Disk Access",
      "Services": {
        "SystemPolicyAllFiles": [
          {
            "Identifier": "com.microsoft.wdav",
            "IdentifierType": "bundleID",
            "CodeRequirement": "identifier \"com.microsoft.wdav\" and anchor apple generic",
            "Allowed": true
          },
          {
            "Identifier": "com.microsoft.wdav.epsext",
            "IdentifierType": "bundleID",
            "CodeRequirement": "identifier \"com.microsoft.wdav.epsext\" and anchor apple generic",
            "Allowed": true
          }
        ]
      }
    },
    "assignments": {
      "include": [
        {
          "@odata.type": "#microsoft.graph.groupAssignmentTarget",
          "groupId": "",
          "groupDisplayName": "All Managed macOS Devices"
        }
      ],
      "exclude": []
    }
  },
  {
    "_metadata": {
      "id": "MDE03",
      "title": "Onboard iOS and Android Devices to Defender for Endpoint",
      "description": "Intune App Configuration policy for Microsoft Defender for Endpoint on iOS and Android. Enables web protection, VPN-based network protection, anti-phishing, and jailbreak/root detection for mobile devices.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "ISO 27001:2022",
        "NIST SP 800-53 Rev.5",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "GDPR (EU) 2016/679",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "BSI IT-Grundschutz",
        "ASD Essential Eight",
        "NZ ISM v3.8",
        "MITRE ATT&CK",
        "Microsoft Cloud Security Benchmark",
        "DORA",
        "CMMC v2.0",
        "PCI DSS v4.0",
        "HIPAA",
        "CJIS v6"
      ],
      "cisChecks": [
        "5.1.4.1",
        "5.1.4.2",
        "5.1.4.3"
      ],
      "mitreMappings": [
        "T1660",
        "T1437",
        "T1461",
        "T1417"
      ],
      "requiredLicences": [
        "Microsoft Defender for Endpoint P1 or P2",
        "Microsoft 365 E5 or Microsoft 365 E5 Security",
        "Microsoft Intune Plan 1"
      ],
      "requiredRoles": [
        "Intune Administrator",
        "Security Administrator"
      ],
      "deploymentOrder": 3,
      "importMethod": "powershell-graph",
      "importScript": "scripts/Import-DefenderEndpointPolicies.ps1"
    },
    "_notes": {
      "prerequisites": [
        "iOS devices must be enrolled in Intune (supervised or unsupervised)",
        "Android devices must be enrolled in Intune (device admin, work profile, or fully managed)",
        "Microsoft Defender app must be deployed as a required app via Intune",
        "For iOS: Minimum iOS 15.0; VPN profile auto-created by MDE",
        "For Android: Minimum Android 8.0; Google Play Services required",
        "MDE connector must be enabled in Intune for iOS and Android compliance"
      ],
      "deploymentSteps": [
        "1. Enable the iOS and Android toggles in Intune > Endpoint Security > Microsoft Defender for Endpoint connector",
        "2. Deploy the Microsoft Defender app as a required app to mobile device groups",
        "3. Deploy this App Configuration policy to the same groups",
        "4. For iOS supervised devices, deploy the VPN profile for web protection",
        "5. Configure compliance policies to require MDE threat level assessment"
      ],
      "rollbackProcedure": "Remove the App Configuration policy assignment and uninstall the Defender app. Disable the MDE connector toggles for mobile platforms."
    },
    "androidAppConfigPolicy": {
      "@odata.type": "#microsoft.graph.androidManagedAppProtection",
      "displayName": "MDE03 - Defender for Endpoint - Android Configuration",
      "description": "App Configuration policy for Microsoft Defender for Endpoint on Android devices",
      "targetedManagedAppGroupType": "allAndroidManagedApps",
      "packageId": "com.microsoft.scmx",
      "appConfigurationSettings": [
        {
          "key": "vpn",
          "valueType": "integer",
          "value": "1",
          "_description": "Enable VPN-based network protection (1=enabled, 0=disabled)"
        },
        {
          "key": "antiphishing",
          "valueType": "integer",
          "value": "1",
          "_description": "Enable anti-phishing protection (1=enabled, 0=disabled)"
        },
        {
          "key": "web_protection",
          "valueType": "integer",
          "value": "1",
          "_description": "Enable web protection (1=enabled, 0=disabled)"
        },
        {
          "key": "DefenderNetworkProtectionEnable",
          "valueType": "integer",
          "value": "1",
          "_description": "Enable network protection (1=block, 2=audit, 0=disabled)"
        },
        {
          "key": "DefenderOpenNetworkDetection",
          "valueType": "integer",
          "value": "1",
          "_description": "Detect open/unsecured Wi-Fi networks"
        },
        {
          "key": "DefenderEndUserTrustFlowEnable",
          "valueType": "integer",
          "value": "0",
          "_description": "Disable end-user trust flow for certificate warnings"
        },
        {
          "key": "DefenderMalwareScanEnabled",
          "valueType": "integer",
          "value": "1",
          "_description": "Enable malware scanning on Android"
        },
        {
          "key": "DefenderDeviceTag",
          "valueType": "string",
          "value": "",
          "_description": "MDE device tag for grouping"
        }
      ]
    },
    "iosAppConfigPolicy": {
      "@odata.type": "#microsoft.graph.iosManagedAppProtection",
      "displayName": "MDE03 - Defender for Endpoint - iOS Configuration",
      "description": "App Configuration policy for Microsoft Defender for Endpoint on iOS devices",
      "targetedManagedAppGroupType": "allIOSManagedApps",
      "bundleId": "com.microsoft.scmx",
      "appConfigurationSettings": [
        {
          "key": "WebProtection",
          "valueType": "string",
          "value": "true",
          "_description": "Enable web protection via local VPN"
        },
        {
          "key": "VPNEnabled",
          "valueType": "string",
          "value": "true",
          "_description": "Enable VPN tunnel for web filtering"
        },
        {
          "key": "AntiPhishing",
          "valueType": "string",
          "value": "true",
          "_description": "Enable anti-phishing URL detection"
        },
        {
          "key": "NetworkProtection",
          "valueType": "string",
          "value": "true",
          "_description": "Enable network protection"
        },
        {
          "key": "DefenderOpenNetworkDetection",
          "valueType": "string",
          "value": "1",
          "_description": "Detect unsecured Wi-Fi connections"
        },
        {
          "key": "JailbreakDetection",
          "valueType": "string",
          "value": "true",
          "_description": "Detect jailbroken iOS devices"
        },
        {
          "key": "DeviceTag",
          "valueType": "string",
          "value": "",
          "_description": "MDE device tag for grouping"
        }
      ]
    },
    "iosSupervisedVpnProfile": {
      "@odata.type": "#microsoft.graph.iosVpnConfiguration",
      "displayName": "MDE03 - Defender Web Protection VPN - iOS Supervised",
      "description": "Per-app VPN profile for MDE web protection on supervised iOS devices",
      "connectionType": "customVpn",
      "connectionName": "Microsoft Defender",
      "server": {
        "address": "127.0.0.1",
        "description": "MDE Local Tunnel"
      },
      "customData": [
        {
          "key": "tunnelType",
          "value": "splitTunnel"
        }
      ],
      "identifier": "com.microsoft.scmx",
      "enablePerApp": true,
      "safariDomains": [],
      "onDemandRules": [
        {
          "action": "connect",
          "domainAction": "neverConnect",
          "domains": []
        }
      ]
    },
    "compliancePolicyIntegration": {
      "androidComplianceRule": {
        "deviceThreatProtectionEnabled": true,
        "deviceThreatProtectionRequiredSecurityLevel": "secured",
        "advancedThreatProtectionRequiredSecurityLevel": "clear"
      },
      "iosComplianceRule": {
        "deviceThreatProtectionEnabled": true,
        "deviceThreatProtectionRequiredSecurityLevel": "secured",
        "advancedThreatProtectionRequiredSecurityLevel": "clear"
      }
    },
    "assignments": {
      "include": [
        {
          "@odata.type": "#microsoft.graph.groupAssignmentTarget",
          "groupId": "",
          "groupDisplayName": "All Managed Mobile Devices (iOS and Android)"
        }
      ],
      "exclude": [
        {
          "@odata.type": "#microsoft.graph.exclusionGroupAssignmentTarget",
          "groupId": "",
          "groupDisplayName": "Shared/Kiosk Mobile Devices"
        }
      ]
    }
  },
  {
    "_metadata": {
      "id": "MDE04",
      "title": "Enable EDR in Block Mode",
      "description": "Enables EDR in Block Mode so that Microsoft Defender for Endpoint can block malicious artefacts even when a third-party antivirus is the primary protection engine. This provides a post-breach behavioural blocking layer on top of the existing AV.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "NIST SP 800-53 Rev.5",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "BSI IT-Grundschutz",
        "ASD Essential Eight",
        "MITRE ATT&CK",
        "Microsoft Cloud Security Benchmark",
        "NIST CSF 2.0",
        "CMMC v2.0",
        "PCI DSS v4.0",
        "HIPAA"
      ],
      "cisChecks": [
        "5.1.4.1",
        "5.1.4.2"
      ],
      "mitreMappings": [
        "T1059",
        "T1055",
        "T1053",
        "T1547",
        "T1574"
      ],
      "requiredLicences": [
        "Microsoft Defender for Endpoint P2",
        "Microsoft 365 E5 or Microsoft 365 E5 Security"
      ],
      "requiredRoles": [
        "Security Administrator",
        "Intune Administrator"
      ],
      "deploymentOrder": 4,
      "importMethod": "powershell-graph",
      "importScript": "scripts/Import-DefenderEndpointPolicies.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Devices must be onboarded to Microsoft Defender for Endpoint (MDE01 must be deployed first)",
        "MDE P2 licence is required for EDR in Block Mode",
        "Cloud-delivered protection must be enabled for EDR Block Mode to function",
        "Works alongside third-party AV products; does NOT require Microsoft Defender Antivirus as primary AV",
        "When Defender AV is primary, this setting is not needed as Defender already blocks in real-time"
      ],
      "deploymentSteps": [
        "1. Verify devices are onboarded to MDE via MDE01",
        "2. Deploy this Intune endpoint security profile to enable EDR Block Mode",
        "3. Alternatively, use the PowerShell command via a remediation script",
        "4. Monitor for false positives in security.microsoft.com > Incidents for 2 weeks",
        "5. Review blocked items under security.microsoft.com > Action center"
      ],
      "rollbackProcedure": "Set EnableEDRBlockMode to Disabled via PowerShell or remove the Intune profile assignment."
    },
    "intuneEndpointSecurityPolicy": {
      "@odata.type": "#microsoft.graph.deviceManagementConfigurationPolicy",
      "name": "MDE04 - EDR in Block Mode",
      "description": "Enable EDR in Block Mode for post-breach behavioural blocking even with third-party AV installed",
      "platforms": "windows10",
      "technologies": "mdm,microsoftSense",
      "templateReference": {
        "templateId": "0385b795-0f2f-44ac-8602-9f65bf6adede_1",
        "templateFamily": "endpointSecurityEndpointDetectionAndResponse",
        "templateDisplayName": "Endpoint detection and response",
        "templateDisplayVersion": "Version 2"
      },
      "settings": [
        {
          "settingInstance": {
            "@odata.type": "#microsoft.graph.deviceManagementConfigurationChoiceSettingInstance",
            "settingDefinitionId": "device_vendor_msft_windowsadvancedthreatprotection_configuration_edrinblockmode",
            "choiceSettingValue": {
              "value": "device_vendor_msft_windowsadvancedthreatprotection_configuration_edrinblockmode_enabled",
              "children": []
            }
          }
        }
      ]
    },
    "powershellDeployment": {
      "description": "Alternative deployment via PowerShell remediation script or GPO",
      "command": "Set-MpPreference -EnableEDRBlockMode Enabled",
      "verificationCommand": "Get-MpPreference | Select-Object -Property EnableEDRBlockMode",
      "expectedResult": "EnableEDRBlockMode: Enabled",
      "remediationScript": {
        "displayName": "MDE04 - Enable EDR Block Mode Remediation",
        "description": "Proactive remediation to ensure EDR Block Mode is enabled",
        "detectionScript": "$edrMode = (Get-MpPreference).EnableEDRBlockMode; if ($edrMode -eq 'Enabled' -or $edrMode -eq $true) { Write-Output 'Compliant'; exit 0 } else { Write-Output 'Non-compliant'; exit 1 }",
        "remediationScript": "Set-MpPreference -EnableEDRBlockMode Enabled; Write-Output 'EDR Block Mode enabled'; exit 0",
        "runAs": "system",
        "runAs32Bit": false,
        "scheduleFrequency": "daily"
      }
    },
    "omaUriAlternative": {
      "_description": "OMA-URI deployment via Intune custom configuration profile",
      "omaUri": "./Vendor/MSFT/Defender/Configuration/PassiveRemediation",
      "dataType": "Integer",
      "value": 1,
      "_valueDescription": "1 = Enable EDR in Block Mode, 0 = Disable"
    },
    "assignments": {
      "include": [
        {
          "@odata.type": "#microsoft.graph.groupAssignmentTarget",
          "groupId": "",
          "groupDisplayName": "All Managed Windows Devices"
        }
      ],
      "exclude": [
        {
          "@odata.type": "#microsoft.graph.exclusionGroupAssignmentTarget",
          "groupId": "",
          "groupDisplayName": "Sensitive Servers - Manual Remediation Only"
        }
      ]
    }
  },
  {
    "_metadata": {
      "id": "MDE05",
      "title": "Automated Investigation and Remediation (AIR)",
      "description": "Configures Automated Investigation and Remediation to Full Automation level. MDE will automatically investigate alerts and remediate confirmed threats without requiring analyst approval, reducing mean-time-to-respond (MTTR).",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "ISO 22301:2019",
        "NIST SP 800-53 Rev.5",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "BSI IT-Grundschutz",
        "ASD Essential Eight",
        "MITRE ATT&CK",
        "Microsoft Cloud Security Benchmark",
        "NIST CSF 2.0",
        "CMMC v2.0",
        "NERC-CIP",
        "PCI DSS v4.0",
        "HIPAA",
        "CJIS v6",
        "TSA Security Directive"
      ],
      "cisChecks": [
        "5.1.4.1",
        "5.1.4.2"
      ],
      "mitreMappings": [
        "T1059",
        "T1547",
        "T1053",
        "T1036",
        "T1055"
      ],
      "requiredLicences": [
        "Microsoft Defender for Endpoint P2",
        "Microsoft 365 E5 or Microsoft 365 E5 Security"
      ],
      "requiredRoles": [
        "Security Administrator",
        "Security Operator"
      ],
      "deploymentOrder": 5,
      "importMethod": "powershell-graph",
      "importScript": "scripts/Import-DefenderEndpointPolicies.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Devices must be onboarded to Microsoft Defender for Endpoint (MDE01-MDE03)",
        "MDE P2 licence is required for Automated Investigation and Remediation",
        "Cloud-delivered protection must be enabled",
        "Review and understand the automation levels before deploying Full Automation",
        "Consider starting with Semi - require approval for core folders before moving to Full"
      ],
      "automationLevels": {
        "fullAutomation": "All remediation actions run automatically without analyst approval (recommended for mature SOCs)",
        "semiRequireApprovalForCoreFolders": "Auto-remediate except for files in core OS/user folders which require approval",
        "semiRequireApprovalForNonTempFolders": "Auto-remediate temp folder items; all others require approval",
        "semiRequireApprovalForAllFolders": "All remediation actions require analyst approval",
        "noAutomatedResponse": "Investigation runs but no automated remediation (not recommended)"
      },
      "deploymentSteps": [
        "1. Navigate to security.microsoft.com > Settings > Endpoints > Advanced features",
        "2. Ensure Automated Investigation is toggled ON",
        "3. Navigate to Settings > Endpoints > Device groups",
        "4. Set the automation level per device group using the API or portal",
        "5. Monitor the Action Center for automated remediations"
      ],
      "rollbackProcedure": "Change the automation level to 'Semi - require approval for all folders' via the portal or API."
    },
    "deviceGroupAutomationSettings": {
      "graphApiEndpoint": "https://api.securitycenter.microsoft.com/api/machinegroups",
      "method": "PATCH",
      "deviceGroups": [
        {
          "name": "Standard Workstations",
          "description": "All standard Windows workstations - full automation",
          "automationLevel": "fullAutomation",
          "matchRules": [
            {
              "type": "tag",
              "operator": "contains",
              "value": "Workstation"
            }
          ]
        },
        {
          "name": "Servers - Production",
          "description": "Production servers - semi automation requiring approval for core folders",
          "automationLevel": "semiRequireApprovalForCoreFolders",
          "matchRules": [
            {
              "type": "tag",
              "operator": "contains",
              "value": "Server-Prod"
            }
          ]
        },
        {
          "name": "High-Value Assets",
          "description": "Domain controllers, CA servers, financial systems - manual approval required",
          "automationLevel": "semiRequireApprovalForAllFolders",
          "matchRules": [
            {
              "type": "tag",
              "operator": "contains",
              "value": "HVA"
            }
          ]
        }
      ]
    },
    "advancedFeatures": {
      "graphApiEndpoint": "https://api.securitycenter.microsoft.com/api/preferences",
      "settings": {
        "automatedInvestigation": true,
        "autoResolveRemediatedAlerts": true,
        "allowOrBlockFile": true,
        "liveResponse": true,
        "liveResponseForServers": true,
        "liveResponseUnsignedScriptExecution": false
      }
    },
    "intuneIntegration": {
      "graphApiEndpoint": "https://graph.microsoft.com/beta/deviceManagement/advancedThreatProtection",
      "advancedThreatProtectionSettings": {
        "automatedInvestigation": {
          "enabled": true,
          "automationLevel": "fullAutomation"
        },
        "autoResolveRemediatedAlerts": true
      }
    },
    "monitoringConfig": {
      "actionCenterReview": {
        "frequency": "daily",
        "reviewUrl": "https://security.microsoft.com/action-center",
        "alertOnPendingActions": true,
        "pendingActionThresholdHours": 4
      }
    }
  },
  {
    "_metadata": {
      "id": "MDE06",
      "title": "Enable Defender Vulnerability Management",
      "description": "Enables Microsoft Defender Vulnerability Management (TVM) for continuous vulnerability assessment, software inventory, security recommendations, and risk-based prioritisation across all onboarded endpoints.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "NIST SP 800-53 Rev.5",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "BSI IT-Grundschutz",
        "ASD Essential Eight",
        "NZ ISM v3.8",
        "MITRE ATT&CK",
        "Microsoft Cloud Security Benchmark",
        "NIST CSF 2.0",
        "CMMC v2.0",
        "NERC-CIP",
        "CJIS v6"
      ],
      "cisChecks": [
        "5.1.4.1",
        "5.1.4.2"
      ],
      "mitreMappings": [
        "T1190",
        "T1210",
        "T1068",
        "T1203"
      ],
      "requiredLicences": [
        "Microsoft Defender for Endpoint P2",
        "Microsoft Defender Vulnerability Management add-on (for premium capabilities)",
        "Microsoft 365 E5 or Microsoft 365 E5 Security"
      ],
      "requiredRoles": [
        "Security Administrator",
        "Security Reader"
      ],
      "deploymentOrder": 6,
      "importMethod": "powershell-graph",
      "importScript": "scripts/Import-DefenderEndpointPolicies.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Devices must be onboarded to Microsoft Defender for Endpoint (MDE01-MDE03)",
        "MDE P2 licence provides core TVM features; premium add-on provides additional capabilities",
        "For authenticated scans, a scan service account is required",
        "Network device scanning requires SNMP configuration"
      ],
      "capabilities": {
        "coreTvm": [
          "Software inventory and vulnerability discovery",
          "Security recommendations with risk-based prioritisation",
          "Exposure score and device secure score",
          "Remediation tracking and exception management",
          "Browser extension inventory"
        ],
        "premiumAddOn": [
          "Certificate inventory assessment",
          "Network share analysis",
          "Firmware vulnerability assessment",
          "Authenticated scan for Windows",
          "CIS benchmark assessment",
          "Block vulnerable applications"
        ]
      },
      "deploymentSteps": [
        "1. Verify device onboarding is complete (MDE01-MDE03)",
        "2. Navigate to security.microsoft.com > Vulnerability management",
        "3. Review the Dashboard for initial vulnerability discovery results",
        "4. Configure authenticated scans for deeper vulnerability assessment",
        "5. Set up remediation request workflows to ServiceNow or Intune",
        "6. Configure baseline assessment profiles"
      ],
      "rollbackProcedure": "TVM is a built-in capability of MDE P2 and cannot be individually disabled. Removing device onboarding removes TVM coverage."
    },
    "vulnerabilityManagementSettings": {
      "portalUrl": "https://security.microsoft.com/tvm",
      "features": {
        "softwareInventory": {
          "enabled": true,
          "includeOpenSource": true,
          "includeBrowserExtensions": true,
          "includeNetworkDevices": true
        },
        "vulnerabilityAssessment": {
          "enabled": true,
          "continuousAssessment": true,
          "scanFrequency": "continuous",
          "includeOsVulnerabilities": true,
          "includeSoftwareVulnerabilities": true,
          "includeFirmwareVulnerabilities": true
        },
        "securityRecommendations": {
          "enabled": true,
          "riskBasedPrioritisation": true,
          "exposedDeviceThreshold": 10
        },
        "remediationTracking": {
          "enabled": true,
          "integrateWithIntune": true,
          "createSecurityTasks": true
        }
      }
    },
    "authenticatedScanConfig": {
      "graphApiEndpoint": "https://api.securitycenter.microsoft.com/api/DeviceAuthenticatedScanDefinitions",
      "method": "POST",
      "scanDefinition": {
        "scanName": "MDE06 - Authenticated Vulnerability Scan - Windows",
        "scanType": "Windows",
        "isActive": true,
        "target": {
          "deviceGroupIds": []
        },
        "scanAuthenticationParams": {
          "@odata.type": "#microsoft.windowsDefenderSecurity.api.WindowsAuthParams",
          "type": "kerberos",
          "keyVaultUrl": "",
          "keyVaultSecretName": ""
        },
        "scannerAgent": {
          "machineId": "",
          "machineName": ""
        }
      }
    },
    "baselineAssessmentProfiles": [
      {
        "profileName": "CIS Windows 11 Enterprise L1",
        "benchmark": "CIS",
        "benchmarkVersion": "3.0",
        "operatingSystem": "Windows11Enterprise",
        "complianceLevel": "Level1",
        "enabled": true,
        "targetDeviceGroups": []
      },
      {
        "profileName": "CIS Windows Server 2022 L1",
        "benchmark": "CIS",
        "benchmarkVersion": "2.0",
        "operatingSystem": "WindowsServer2022",
        "complianceLevel": "Level1",
        "enabled": true,
        "targetDeviceGroups": []
      }
    ],
    "blockVulnerableApplications": {
      "_description": "Premium feature: Block execution of known vulnerable application versions",
      "enabled": true,
      "action": "warn",
      "minimumSeverity": "critical",
      "applicationsToBlock": [],
      "_note": "Specific applications are configured via the TVM portal based on vulnerability severity"
    }
  },
  {
    "_metadata": {
      "id": "MDE07",
      "title": "Network Protection in Block Mode",
      "description": "Enables Network Protection in Block mode to prevent outbound connections to known malicious or dangerous domains and IP addresses. Uses SmartScreen intelligence at the network stack level, applying to all processes, not just browsers.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "NIST SP 800-53 Rev.5",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "GDPR (EU) 2016/679",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "BSI IT-Grundschutz",
        "ASD Essential Eight",
        "NZ ISM v3.8",
        "MITRE ATT&CK",
        "Microsoft Cloud Security Benchmark",
        "NIST CSF 2.0",
        "CMMC v2.0",
        "NERC-CIP",
        "PCI DSS v4.0",
        "HIPAA",
        "CJIS v6"
      ],
      "cisChecks": [
        "5.1.4.1",
        "5.1.4.2"
      ],
      "mitreMappings": [
        "T1071",
        "T1566",
        "T1189",
        "T1204.001",
        "T1568"
      ],
      "requiredLicences": [
        "Microsoft Defender for Endpoint P1 or P2",
        "Microsoft 365 E5 or Microsoft 365 E3 + E5 Security add-on"
      ],
      "requiredRoles": [
        "Intune Administrator",
        "Security Administrator"
      ],
      "deploymentOrder": 7,
      "importMethod": "powershell-graph",
      "importScript": "scripts/Import-DefenderEndpointPolicies.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Devices must be onboarded to MDE (MDE01 deployed)",
        "Microsoft Defender Antivirus must be the active AV or running in passive mode",
        "Cloud-delivered protection must be enabled for real-time URL/IP reputation checks",
        "Recommended: Deploy in Audit mode (value 2) for 2 weeks before switching to Block (value 1)",
        "Network Protection works on Windows 10 v1709+, Windows 11, macOS, and Linux"
      ],
      "deploymentSteps": [
        "1. Deploy in Audit mode first: Set EnableNetworkProtection = 2",
        "2. Monitor audit events in security.microsoft.com > Advanced Hunting for 2 weeks",
        "3. Review blocked URLs/IPs and create any necessary allow-list custom indicators",
        "4. Switch to Block mode: Set EnableNetworkProtection = 1",
        "5. Monitor the Network Protection report in the MDE portal"
      ],
      "rollbackProcedure": "Set EnableNetworkProtection to 0 (Disabled) via Intune OMA-URI, PowerShell, or GPO. Takes effect immediately."
    },
    "intuneOmaUriPolicy": {
      "@odata.type": "#microsoft.graph.windows10CustomConfiguration",
      "displayName": "MDE07 - Network Protection Block Mode",
      "description": "Enables Network Protection in Block mode via Intune OMA-URI custom policy",
      "omaSettings": [
        {
          "@odata.type": "#microsoft.graph.omaSettingInteger",
          "displayName": "Enable Network Protection",
          "description": "0=Disabled, 1=Enabled (Block), 2=Audit mode",
          "omaUri": "./Vendor/MSFT/Policy/Config/Defender/EnableNetworkProtection",
          "value": 1
        }
      ]
    },
    "intuneEndpointSecurityPolicy": {
      "@odata.type": "#microsoft.graph.deviceManagementConfigurationPolicy",
      "name": "MDE07 - Network Protection - Block Mode",
      "description": "Enable Network Protection in Block mode to prevent connections to malicious destinations",
      "platforms": "windows10",
      "technologies": "mdm,microsoftSense",
      "templateReference": {
        "templateId": "46ddfc50-d10f-4a96-9c12-b210e585b44f_1",
        "templateFamily": "endpointSecurityAttackSurfaceReduction",
        "templateDisplayName": "Attack surface reduction rules"
      },
      "settings": [
        {
          "settingInstance": {
            "@odata.type": "#microsoft.graph.deviceManagementConfigurationChoiceSettingInstance",
            "settingDefinitionId": "device_vendor_msft_policy_config_defender_enablenetworkprotection",
            "choiceSettingValue": {
              "value": "device_vendor_msft_policy_config_defender_enablenetworkprotection_1",
              "children": [],
              "_valueDescription": "1 = Block mode"
            }
          }
        }
      ]
    },
    "powershellDeployment": {
      "enableBlockMode": {
        "command": "Set-MpPreference -EnableNetworkProtection Enabled",
        "description": "Enable Network Protection in Block mode via PowerShell"
      },
      "enableAuditMode": {
        "command": "Set-MpPreference -EnableNetworkProtection AuditMode",
        "description": "Enable Network Protection in Audit mode for initial testing"
      },
      "disable": {
        "command": "Set-MpPreference -EnableNetworkProtection Disabled",
        "description": "Disable Network Protection (rollback)"
      },
      "verify": {
        "command": "Get-MpPreference | Select-Object -Property EnableNetworkProtection",
        "expectedResult": "EnableNetworkProtection: 1"
      },
      "remediationScript": {
        "displayName": "MDE07 - Network Protection Compliance Check",
        "detectionScript": "$np = (Get-MpPreference).EnableNetworkProtection; if ($np -eq 1) { Write-Output 'Compliant'; exit 0 } else { Write-Output \"Non-compliant: value=$np\"; exit 1 }",
        "remediationScript": "Set-MpPreference -EnableNetworkProtection Enabled; Write-Output 'Network Protection set to Block mode'; exit 0",
        "runAs": "system",
        "scheduleFrequency": "daily"
      }
    },
    "groupPolicyAlternative": {
      "path": "Computer Configuration > Administrative Templates > Windows Components > Microsoft Defender Antivirus > Microsoft Defender Exploit Guard > Network Protection",
      "setting": "Prevent users and apps from accessing dangerous websites",
      "value": "Enabled (Block)"
    },
    "advancedHuntingQuery": {
      "_description": "KQL query to monitor Network Protection audit and block events",
      "query": "DeviceEvents | where ActionType in ('ExploitGuardNetworkProtectionAudited', 'ExploitGuardNetworkProtectionBlocked') | summarize count() by ActionType, RemoteUrl, DeviceName | sort by count_ desc | take 100"
    },
    "assignments": {
      "include": [
        {
          "@odata.type": "#microsoft.graph.groupAssignmentTarget",
          "groupId": "",
          "groupDisplayName": "All Managed Windows Devices"
        }
      ],
      "exclude": [
        {
          "@odata.type": "#microsoft.graph.exclusionGroupAssignmentTarget",
          "groupId": "",
          "groupDisplayName": "Network Testing Lab Devices"
        }
      ]
    }
  },
  {
    "_metadata": {
      "id": "MDE08",
      "title": "Web Content Filtering",
      "description": "Configures MDE Web Content Filtering to block access to web categories including Adult content, Gambling, Hacking tools, Malware hosting, Phishing, and Violence. Uses SmartScreen at the OS level so no proxy or agent is required.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "NIST SP 800-53 Rev.5",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "GDPR (EU) 2016/679",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "BSI IT-Grundschutz",
        "ASD Essential Eight",
        "NZ ISM v3.8",
        "MITRE ATT&CK",
        "Microsoft Cloud Security Benchmark",
        "CMMC v2.0",
        "PCI DSS v4.0",
        "HIPAA",
        "CJIS v6"
      ],
      "cisChecks": [
        "5.1.4.1",
        "5.1.4.2"
      ],
      "mitreMappings": [
        "T1189",
        "T1566.002",
        "T1204.001",
        "T1071.001"
      ],
      "requiredLicences": [
        "Microsoft Defender for Endpoint P1 or P2",
        "Microsoft 365 E5 or Microsoft 365 E5 Security"
      ],
      "requiredRoles": [
        "Security Administrator"
      ],
      "deploymentOrder": 8,
      "importMethod": "powershell-graph",
      "importScript": "scripts/Import-DefenderEndpointPolicies.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Devices must be onboarded to MDE (MDE01 deployed)",
        "Network Protection must be enabled in Block or Audit mode (MDE07)",
        "SmartScreen must be enabled for web content filtering to work",
        "Web Content Filtering works with Microsoft Edge, Chrome (via Network Protection), and other browsers",
        "Requires Windows 10 v1709+, Windows 11, macOS 11+, or Linux"
      ],
      "deploymentSteps": [
        "1. Ensure Network Protection (MDE07) is deployed and active",
        "2. Deploy this web content filtering policy via the MDE portal API",
        "3. Assign the policy to the target device groups",
        "4. Monitor blocked categories in security.microsoft.com > Reports > Web protection",
        "5. Review and refine blocked categories based on business need"
      ],
      "rollbackProcedure": "Delete the web content filtering policy via the MDE portal or API. Alternatively, change blocked categories to audit-only."
    },
    "webContentFilteringPolicy": {
      "apiEndpoint": "https://api.securitycenter.microsoft.com/api/webContentFilteringPolicies",
      "method": "POST",
      "policy": {
        "policyName": "MDE08 - Corporate Web Content Filtering",
        "description": "Block high-risk and inappropriate web content categories across all managed endpoints",
        "isEnabled": true,
        "mode": "block",
        "blockedCategories": [
          {
            "categoryGroup": "Adult content",
            "categories": [
              {
                "id": "adultContent",
                "name": "Adult Content",
                "action": "block"
              },
              {
                "id": "cults",
                "name": "Cults",
                "action": "block"
              },
              {
                "id": "nudity",
                "name": "Nudity",
                "action": "block"
              },
              {
                "id": "pornographySexuallyExplicit",
                "name": "Pornography / Sexually Explicit",
                "action": "block"
              },
              {
                "id": "sexEducation",
                "name": "Sex Education",
                "action": "audit"
              }
            ]
          },
          {
            "categoryGroup": "High bandwidth",
            "categories": [
              {
                "id": "peerToPeer",
                "name": "Peer-to-Peer",
                "action": "block"
              },
              {
                "id": "streamingMediaEntertainment",
                "name": "Streaming Media & Entertainment",
                "action": "audit"
              }
            ]
          },
          {
            "categoryGroup": "Legal liability",
            "categories": [
              {
                "id": "childAbuseImages",
                "name": "Child Abuse Images",
                "action": "block"
              },
              {
                "id": "gambling",
                "name": "Gambling",
                "action": "block"
              },
              {
                "id": "hateAndIntolerance",
                "name": "Hate & Intolerance",
                "action": "block"
              },
              {
                "id": "illegalDrug",
                "name": "Illegal Drug",
                "action": "block"
              },
              {
                "id": "illegalSoftware",
                "name": "Illegal Software",
                "action": "block"
              },
              {
                "id": "violence",
                "name": "Violence",
                "action": "block"
              },
              {
                "id": "weapons",
                "name": "Weapons",
                "action": "block"
              }
            ]
          },
          {
            "categoryGroup": "Security",
            "categories": [
              {
                "id": "hacking",
                "name": "Hacking",
                "action": "block"
              },
              {
                "id": "malware",
                "name": "Malware",
                "action": "block"
              },
              {
                "id": "phishing",
                "name": "Phishing",
                "action": "block"
              },
              {
                "id": "spamUrls",
                "name": "Spam URLs",
                "action": "block"
              },
              {
                "id": "commandAndControl",
                "name": "Command and Control",
                "action": "block"
              },
              {
                "id": "compromised",
                "name": "Compromised",
                "action": "block"
              }
            ]
          }
        ],
        "auditCategories": [
          {
            "categoryGroup": "Productivity loss",
            "categories": [
              {
                "id": "chat",
                "name": "Chat",
                "action": "audit"
              },
              {
                "id": "gaming",
                "name": "Gaming",
                "action": "audit"
              },
              {
                "id": "socialNetworking",
                "name": "Social Networking",
                "action": "audit"
              },
              {
                "id": "webBasedEmail",
                "name": "Web-based Email (personal)",
                "action": "audit"
              }
            ]
          }
        ]
      }
    },
    "scopeAndAssignment": {
      "assignedDeviceGroups": [
        {
          "groupName": "All Managed Windows Devices",
          "groupId": ""
        },
        {
          "groupName": "All Managed macOS Devices",
          "groupId": ""
        }
      ],
      "excludedDeviceGroups": [
        {
          "groupName": "Security Research Team",
          "groupId": "",
          "_reason": "Security researchers require access to hacking/malware categories for threat analysis"
        }
      ]
    },
    "customIndicatorExceptions": {
      "_description": "URLs that should be allowed despite being in a blocked category",
      "allowedUrls": [
        {
          "url": "",
          "title": "Business Exception",
          "description": "Approved exception for business use",
          "action": "allowed",
          "severity": "informational"
        }
      ]
    },
    "advancedHuntingQuery": {
      "_description": "KQL query to monitor web content filtering blocks and audits",
      "query": "DeviceEvents | where ActionType in ('SmartScreenUrlWarning', 'ExploitGuardNetworkProtectionBlocked') | extend ParsedFields = parse_json(AdditionalFields) | project Timestamp, DeviceName, RemoteUrl, ActionType, ParsedFields.ResponseCategory | summarize BlockCount=count() by tostring(ParsedFields_ResponseCategory), bin(Timestamp, 1d) | sort by BlockCount desc"
    }
  },
  {
    "_metadata": {
      "id": "MDE09",
      "title": "Enable Tamper Protection",
      "description": "Enables Tamper Protection to prevent users, local admins, and malware from disabling Microsoft Defender Antivirus, real-time protection, cloud-delivered protection, and other security settings. Managed centrally via Intune and cannot be overridden locally.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "NIST SP 800-53 Rev.5",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "GDPR (EU) 2016/679",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "BSI IT-Grundschutz",
        "ASD Essential Eight",
        "NZ ISM v3.8",
        "MITRE ATT&CK",
        "Microsoft Cloud Security Benchmark",
        "NIST CSF 2.0",
        "CMMC v2.0",
        "PCI DSS v4.0",
        "HIPAA",
        "CJIS v6"
      ],
      "cisChecks": [
        "5.1.4.1",
        "5.1.4.2"
      ],
      "mitreMappings": [
        "T1562.001",
        "T1562.004",
        "T1112",
        "T1543"
      ],
      "requiredLicences": [
        "Microsoft Defender for Endpoint P1 or P2",
        "Microsoft 365 E5 or Microsoft 365 E3 + E5 Security add-on"
      ],
      "requiredRoles": [
        "Security Administrator",
        "Intune Administrator"
      ],
      "deploymentOrder": 9,
      "importMethod": "powershell-graph",
      "importScript": "scripts/Import-DefenderEndpointPolicies.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Devices must be onboarded to MDE (MDE01 deployed)",
        "Microsoft Defender Antivirus must be the active AV or in passive mode",
        "Devices must be Intune-enrolled for cloud-managed Tamper Protection",
        "Windows 10 version 1903+ or Windows 11 required",
        "Windows Server 2019+ required for server Tamper Protection"
      ],
      "protectedSettings": [
        "Real-time protection cannot be disabled",
        "Cloud-delivered protection cannot be disabled",
        "IOAV (IOfficeAntiVirus) scanning stays enabled",
        "Behaviour monitoring cannot be turned off",
        "Security intelligence updates cannot be removed",
        "Defender service cannot be stopped or disabled",
        "Defender exclusions cannot be modified locally"
      ],
      "deploymentSteps": [
        "1. Deploy the Intune endpoint security Antivirus profile with Tamper Protection enabled",
        "2. For tenant-wide enablement, use the MDE portal advanced settings",
        "3. Verify status via PowerShell: Get-MpComputerStatus | Select IsTamperProtected",
        "4. Monitor tamper attempts in security.microsoft.com > Advanced Hunting"
      ],
      "rollbackProcedure": "Set Tamper Protection to 'Not configured' in Intune to allow local control, or disable tenant-wide in MDE portal > Settings > Endpoints > Advanced features. Note: Disabling Tamper Protection is not recommended."
    },
    "intuneEndpointSecurityPolicy": {
      "@odata.type": "#microsoft.graph.deviceManagementConfigurationPolicy",
      "name": "MDE09 - Tamper Protection - Enable",
      "description": "Enable Tamper Protection to prevent modification or disabling of Microsoft Defender security settings",
      "platforms": "windows10",
      "technologies": "mdm,microsoftSense",
      "templateReference": {
        "templateId": "d02f2162-fcac-48db-9b7b-b0a3f160d100_1",
        "templateFamily": "endpointSecurityAntivirus",
        "templateDisplayName": "Windows Security experience",
        "templateDisplayVersion": "Version 1"
      },
      "settings": [
        {
          "settingInstance": {
            "@odata.type": "#microsoft.graph.deviceManagementConfigurationChoiceSettingInstance",
            "settingDefinitionId": "device_vendor_msft_policy_config_defender_tamperprotection",
            "choiceSettingValue": {
              "value": "device_vendor_msft_policy_config_defender_tamperprotection_enable",
              "children": [],
              "_valueDescription": "Enable Tamper Protection - prevents local modification of Defender settings"
            }
          }
        },
        {
          "settingInstance": {
            "@odata.type": "#microsoft.graph.deviceManagementConfigurationChoiceSettingInstance",
            "settingDefinitionId": "device_vendor_msft_policy_config_windowsdefendersecuritycenter_disabletamperprotection",
            "choiceSettingValue": {
              "value": "device_vendor_msft_policy_config_windowsdefendersecuritycenter_disabletamperprotection_0",
              "children": [],
              "_valueDescription": "0 = Do not allow users to toggle Tamper Protection in the Security Center UI"
            }
          }
        }
      ]
    },
    "intuneAntivirusProfile": {
      "@odata.type": "#microsoft.graph.deviceManagementConfigurationPolicy",
      "name": "MDE09 - Antivirus with Tamper Protection",
      "description": "Microsoft Defender Antivirus policy with Tamper Protection enforced",
      "platforms": "windows10",
      "technologies": "mdm,microsoftSense",
      "templateReference": {
        "templateId": "804339ad-1553-4478-a742-138fb5807418_1",
        "templateFamily": "endpointSecurityAntivirus",
        "templateDisplayName": "Microsoft Defender Antivirus"
      },
      "settings": [
        {
          "settingDefinitionId": "device_vendor_msft_policy_config_defender_tamperprotection",
          "value": "enable"
        },
        {
          "settingDefinitionId": "device_vendor_msft_policy_config_defender_allowrealtimemonitoring",
          "value": "allowed"
        },
        {
          "settingDefinitionId": "device_vendor_msft_policy_config_defender_allowcloudprotection",
          "value": "allowed"
        },
        {
          "settingDefinitionId": "device_vendor_msft_policy_config_defender_allowbehaviormonitoring",
          "value": "allowed"
        }
      ]
    },
    "tenantWideSettings": {
      "portalPath": "security.microsoft.com > Settings > Endpoints > Advanced features",
      "setting": "Tamper Protection",
      "value": "On",
      "_note": "Tenant-wide setting applies to all onboarded devices. Intune policy provides per-group granularity."
    },
    "verificationCommands": {
      "powershell": {
        "checkStatus": "Get-MpComputerStatus | Select-Object -Property IsTamperProtected, RealTimeProtectionEnabled, AntivirusEnabled",
        "expectedResult": {
          "IsTamperProtected": true,
          "RealTimeProtectionEnabled": true,
          "AntivirusEnabled": true
        }
      },
      "advancedHuntingQuery": "DeviceEvents | where ActionType == 'TamperingAttempt' | project Timestamp, DeviceName, InitiatingProcessFileName, InitiatingProcessCommandLine, ActionType | sort by Timestamp desc | take 50"
    },
    "assignments": {
      "include": [
        {
          "@odata.type": "#microsoft.graph.allDevicesAssignmentTarget",
          "groupDisplayName": "All Devices (tenant-wide)"
        }
      ],
      "exclude": []
    }
  },
  {
    "_metadata": {
      "id": "MDE10",
      "title": "MDE Alert Notification Rules",
      "description": "Configures email alert notification rules to ensure the security operations team is notified immediately when High and Medium severity alerts are generated in Microsoft Defender for Endpoint.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "ISO 22301:2019",
        "NIST SP 800-53 Rev.5",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "GDPR (EU) 2016/679",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "BSI IT-Grundschutz",
        "MITRE ATT&CK",
        "Microsoft Cloud Security Benchmark",
        "NIST CSF 2.0",
        "CMMC v2.0",
        "NERC-CIP",
        "CJIS v6",
        "TSA Security Directive",
        "CIRCIA (US)",
        "SEC Cyber Rule"
      ],
      "cisChecks": [
        "5.1.4.1",
        "5.1.4.2"
      ],
      "mitreMappings": [],
      "requiredLicences": [
        "Microsoft Defender for Endpoint P1 or P2",
        "Microsoft 365 E5 or Microsoft 365 E5 Security"
      ],
      "requiredRoles": [
        "Security Administrator"
      ],
      "deploymentOrder": 10,
      "importMethod": "powershell-graph",
      "importScript": "scripts/Import-DefenderEndpointPolicies.ps1"
    },
    "_notes": {
      "prerequisites": [
        "MDE must be provisioned and devices onboarded",
        "Replace  with your SOC/security team distribution list",
        "Replace  with your security manager email",
        "Ensure email addresses are valid Exchange Online or external SMTP addresses",
        "Consider creating a dedicated distribution group for MDE notifications"
      ],
      "deploymentSteps": [
        "1. Replace all placeholder email addresses in the notification rules",
        "2. Create the notification rules via the MDE portal or API",
        "3. Send a test notification to verify delivery",
        "4. Ensure email delivery is not blocked by spam filters or transport rules",
        "5. Integrate with SIEM/SOAR via the MDE Streaming API for production alerting"
      ],
      "rollbackProcedure": "Delete or disable the notification rules via the MDE portal or API."
    },
    "notificationRules": {
      "apiEndpoint": "https://api.securitycenter.microsoft.com/api/alertNotificationRules",
      "rules": [
        {
          "ruleName": "MDE10 - Critical and High Severity Alert Notifications",
          "description": "Notify the security team immediately for all Critical and High severity MDE alerts",
          "isEnabled": true,
          "severity": [
            "critical",
            "high"
          ],
          "alertTypes": [
            "newAlert"
          ],
          "notificationTargets": [
            {
              "type": "email",
              "emailAddress": "",
              "description": "Security Operations Team distribution list"
            },
            {
              "type": "email",
              "emailAddress": "",
              "description": "Security Manager / CISO"
            }
          ],
          "includeOrganizationName": true,
          "includeDeviceInfo": true,
          "includeAlertDetails": true,
          "deviceGroupIds": [],
          "_deviceGroupNote": "Empty array = all device groups. Specify group IDs to scope to specific groups."
        },
        {
          "ruleName": "MDE10 - Medium Severity Alert Notifications",
          "description": "Notify the security team for Medium severity alerts during business hours review",
          "isEnabled": true,
          "severity": [
            "medium"
          ],
          "alertTypes": [
            "newAlert"
          ],
          "notificationTargets": [
            {
              "type": "email",
              "emailAddress": "",
              "description": "Security Operations Team distribution list"
            }
          ],
          "includeOrganizationName": true,
          "includeDeviceInfo": true,
          "includeAlertDetails": true,
          "deviceGroupIds": []
        },
        {
          "ruleName": "MDE10 - Alert Resolution Notifications",
          "description": "Notify when alerts are resolved for tracking and compliance",
          "isEnabled": true,
          "severity": [
            "critical",
            "high",
            "medium"
          ],
          "alertTypes": [
            "alertResolved"
          ],
          "notificationTargets": [
            {
              "type": "email",
              "emailAddress": "",
              "description": "Security Operations Team distribution list"
            }
          ],
          "includeOrganizationName": true,
          "includeDeviceInfo": true,
          "includeAlertDetails": true,
          "deviceGroupIds": []
        }
      ]
    },
    "emailNotificationSettings": {
      "portalPath": "security.microsoft.com > Settings > Endpoints > Email notifications > Alerts",
      "generalSettings": {
        "includeOrganizationName": true,
        "includeTenantId": false,
        "includeDeviceName": true,
        "includeDeviceGroup": true,
        "includeAlertSeverity": true,
        "includeAlertCategory": true,
        "includeAlertDescription": true,
        "includeInvestigationStatus": true
      }
    },
    "vulnerabilityNotificationSettings": {
      "_description": "Separate notification channel for Vulnerability Management events",
      "portalPath": "security.microsoft.com > Settings > Endpoints > Email notifications > Vulnerabilities",
      "rules": [
        {
          "ruleName": "MDE10 - New Critical Vulnerability Notifications",
          "isEnabled": true,
          "notificationEvents": [
            "newExploit",
            "newVulnerability"
          ],
          "minimumSeverity": "critical",
          "notificationTargets": [
            {
              "type": "email",
              "emailAddress": ""
            },
            {
              "type": "email",
              "emailAddress": ""
            }
          ]
        }
      ]
    },
    "siemIntegration": {
      "_description": "For production environments, also configure streaming API to SIEM",
      "streamingApiEndpoint": "https://api.securitycenter.microsoft.com/api/streamingconnection",
      "supportedTargets": [
        {
          "type": "azureEventHubs",
          "eventHubNamespace": "",
          "eventHubName": "",
          "eventTypes": [
            "AlertCreated",
            "AlertUpdated",
            "AlertResolved"
          ]
        },
        {
          "type": "azureStorage",
          "storageAccountName": "",
          "containerName": "mde-alerts"
        }
      ]
    }
  },
  {
    "_metadata": {
      "id": "MDE11",
      "title": "Enable MDE Deception Technology",
      "description": "Enables Microsoft Defender for Endpoint deception capabilities including honeytoken accounts, decoy files, and lure components. Detects adversary lateral movement and credential theft with high-fidelity alerts.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "NIST SP 800-53 Rev.5",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "MITRE ATT&CK",
        "Microsoft Cloud Security Benchmark",
        "NIST CSF 2.0",
        "CMMC v2.0",
        "NERC-CIP",
        "CJIS v6",
        "TSA Security Directive",
        "CIRCIA (US)",
        "SEC Cyber Rule"
      ],
      "cisChecks": [
        "5.1.4.1",
        "5.1.4.2"
      ],
      "mitreMappings": [
        "T1078",
        "T1003",
        "T1021",
        "T1552",
        "T1550",
        "T1558"
      ],
      "requiredLicences": [
        "Microsoft Defender for Endpoint P2",
        "Microsoft 365 E5 or Microsoft 365 E5 Security"
      ],
      "requiredRoles": [
        "Security Administrator"
      ],
      "deploymentOrder": 11,
      "importMethod": "powershell-graph",
      "importScript": "scripts/Import-DefenderEndpointPolicies.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Devices must be onboarded to MDE (MDE01 deployed)",
        "MDE P2 licence required for deception capabilities",
        "Active Directory must be connected for honeytoken account deception",
        "Requires domain-joined devices for full deception lure deployment",
        "At least one device per network segment for effective coverage"
      ],
      "deceptionTypes": {
        "honeytokenAccounts": "Fake user accounts planted in Active Directory that generate high-fidelity alerts when authentication is attempted",
        "decoyFiles": "Fake documents and files placed on endpoints that generate alerts when accessed",
        "lureComponents": "Fake cached credentials, browser history entries, and RDP connections that attract lateral movement"
      },
      "deploymentSteps": [
        "1. Navigate to security.microsoft.com > Settings > Endpoints > Advanced features",
        "2. Enable the Deception capability toggle",
        "3. Configure deception rules in Settings > Endpoints > Deception",
        "4. Create honeytoken accounts in Active Directory or via the deception settings",
        "5. Configure lure types and deployment scope",
        "6. Deploy lures to target device groups",
        "7. Monitor deception alerts in the Incidents queue"
      ],
      "rollbackProcedure": "Disable the Deception toggle in MDE advanced features. Remove honeytoken accounts from AD. Lures will be automatically cleaned up from endpoints."
    },
    "deceptionSettings": {
      "portalUrl": "https://security.microsoft.com/deception",
      "featureToggle": {
        "path": "Settings > Endpoints > Advanced features > Deception",
        "enabled": true
      }
    },
    "deceptionRules": [
      {
        "ruleName": "MDE11 - Honeytoken Account Deception",
        "description": "Deploy honeytoken accounts that generate alerts on any authentication attempt",
        "ruleType": "honeytokenAccount",
        "isEnabled": true,
        "honeytokenAccounts": [
          {
            "displayName": "Service Account - Legacy Backup",
            "samAccountName": "svc-backup-legacy",
            "description": "Backup service account (decommissioned)",
            "_note": "Create this account in AD with a strong random password. Account should be disabled but appear legitimate."
          },
          {
            "displayName": "Admin - IT Support",
            "samAccountName": "adm-itsupport",
            "description": "IT admin account",
            "_note": "Honeytoken admin account. Any authentication attempt triggers a high-severity alert."
          }
        ],
        "alertSeverity": "high",
        "alertTitle": "Honeytoken account authentication attempt detected"
      },
      {
        "ruleName": "MDE11 - Decoy File Deception",
        "description": "Deploy decoy documents that generate alerts when opened or accessed",
        "ruleType": "decoyFile",
        "isEnabled": true,
        "decoyFiles": [
          {
            "fileName": "Passwords-Master-List.xlsx",
            "fileType": "xlsx",
            "placementPath": "C:\\Users\\Public\\Documents",
            "description": "Decoy password file that attracts credential seekers"
          },
          {
            "fileName": "VPN-Config-Backup.docx",
            "fileType": "docx",
            "placementPath": "C:\\Users\\Public\\Documents",
            "description": "Decoy VPN configuration file"
          },
          {
            "fileName": "AWS-Keys-Production.txt",
            "fileType": "txt",
            "placementPath": "C:\\Users\\Public\\Documents",
            "description": "Decoy cloud credential file"
          }
        ],
        "targetDeviceGroups": [],
        "alertSeverity": "high"
      },
      {
        "ruleName": "MDE11 - Lure Components",
        "description": "Deploy lure components (cached credentials, browser history, RDP shortcuts) to attract lateral movement",
        "ruleType": "lureComponent",
        "isEnabled": true,
        "lureTypes": [
          {
            "type": "cachedCredentials",
            "enabled": true,
            "description": "Plant fake cached domain credentials on endpoints"
          },
          {
            "type": "browserHistory",
            "enabled": true,
            "description": "Plant fake browser history entries pointing to honeytoken resources"
          },
          {
            "type": "rdpConnections",
            "enabled": true,
            "description": "Plant fake RDP connection history entries"
          },
          {
            "type": "networkShares",
            "enabled": true,
            "description": "Plant fake mapped network drive entries"
          }
        ],
        "targetDeviceGroups": [],
        "deploymentScope": "allOnboardedDevices",
        "alertSeverity": "high"
      }
    ],
    "monitoringConfig": {
      "advancedHuntingQuery": "AlertInfo | where Title has 'deception' or Title has 'honeytoken' or Title has 'lure' | join kind=inner AlertEvidence on AlertId | project Timestamp, AlertId, Title, Severity, DeviceName, AccountName, RemoteIP | sort by Timestamp desc",
      "incidentCorrelation": true,
      "_note": "Deception alerts are high-fidelity and should always be investigated as priority incidents"
    }
  },
  {
    "_metadata": {
      "id": "MDE12",
      "title": "Threat Intelligence Integration - Custom Indicators",
      "description": "Configures custom Indicators of Compromise (IoCs) in Microsoft Defender for Endpoint to block, alert, or allow specific file hashes, IP addresses, URLs, and certificates. Provides a template for custom threat intelligence integration via the MDE tiIndicators API.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "NIST SP 800-53 Rev.5",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "MITRE ATT&CK",
        "Microsoft Cloud Security Benchmark",
        "NIST CSF 2.0",
        "CMMC v2.0",
        "NERC-CIP",
        "CJIS v6",
        "TSA Security Directive",
        "CIRCIA (US)",
        "SEC Cyber Rule"
      ],
      "cisChecks": [
        "5.1.4.1",
        "5.1.4.2"
      ],
      "mitreMappings": [
        "T1071",
        "T1204",
        "T1566",
        "T1189",
        "T1568",
        "T1105"
      ],
      "requiredLicences": [
        "Microsoft Defender for Endpoint P2",
        "Microsoft 365 E5 or Microsoft 365 E5 Security",
        "Microsoft Defender Threat Intelligence (optional, for premium TI feeds)"
      ],
      "requiredRoles": [
        "Security Administrator",
        "TI Analyst"
      ],
      "deploymentOrder": 12,
      "importMethod": "powershell-graph",
      "importScript": "scripts/Import-DefenderEndpointPolicies.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Devices must be onboarded to MDE (MDE01 deployed)",
        "MDE P2 licence required for custom indicators",
        "Custom indicators for URLs/domains require Network Protection enabled (MDE07)",
        "Microsoft Graph API permissions required: ThreatIndicators.ReadWrite.OwnedBy",
        "For TAXII feeds, Microsoft Sentinel integration is recommended"
      ],
      "indicatorLimits": {
        "fileHashIndicators": 15000,
        "ipIndicators": 15000,
        "urlDomainIndicators": 15000,
        "certificateIndicators": 500
      },
      "deploymentSteps": [
        "1. Register an Azure AD app with ThreatIndicators.ReadWrite.OwnedBy permission",
        "2. Use the tiIndicators API to submit custom indicators",
        "3. For manual indicators, use the MDE portal > Settings > Endpoints > Indicators",
        "4. For automated feeds, integrate via Microsoft Graph Security API or Sentinel TAXII connector",
        "5. Monitor indicator matches in Advanced Hunting"
      ],
      "rollbackProcedure": "Delete individual indicators via the API or portal. Use the bulk delete API endpoint for mass removal."
    },
    "customIndicatorTemplates": {
      "apiEndpoint": "https://api.securitycenter.microsoft.com/api/indicators",
      "graphApiEndpoint": "https://graph.microsoft.com/beta/security/tiIndicators",
      "fileHashIndicator": {
        "@odata.type": "#microsoft.graph.tiIndicator",
        "action": "block",
        "description": "Blocked file hash - known malware sample",
        "expirationDateTime": "2027-02-27T00:00:00Z",
        "indicatorProvider": "Custom Threat Intelligence",
        "fileHashType": "sha256",
        "fileHashValue": "",
        "severity": "high",
        "generateAlert": true,
        "recommendedActions": "Quarantine the file. Investigate the device for additional compromise indicators. Run full AV scan.",
        "title": "Custom IoC - Malicious File Hash",
        "tags": [
          "custom-ioc",
          "malware"
        ],
        "rbacGroupNames": [],
        "_note": "Leave rbacGroupNames empty to apply to all device groups"
      },
      "ipAddressIndicator": {
        "@odata.type": "#microsoft.graph.tiIndicator",
        "action": "block",
        "description": "Blocked IP address - known C2 infrastructure",
        "expirationDateTime": "2027-02-27T00:00:00Z",
        "indicatorProvider": "Custom Threat Intelligence",
        "networkDestinationIPv4": "",
        "severity": "high",
        "generateAlert": true,
        "recommendedActions": "Investigate the device for C2 communication. Check for data exfiltration. Isolate if confirmed compromised.",
        "title": "Custom IoC - C2 IP Address",
        "tags": [
          "custom-ioc",
          "c2-infrastructure"
        ],
        "rbacGroupNames": []
      },
      "urlIndicator": {
        "@odata.type": "#microsoft.graph.tiIndicator",
        "action": "block",
        "description": "Blocked URL - known phishing or malware delivery URL",
        "expirationDateTime": "2027-02-27T00:00:00Z",
        "indicatorProvider": "Custom Threat Intelligence",
        "url": "",
        "severity": "high",
        "generateAlert": true,
        "recommendedActions": "Check browser history for URL access. Scan device for downloaded payloads. Reset user credentials if phishing confirmed.",
        "title": "Custom IoC - Malicious URL",
        "tags": [
          "custom-ioc",
          "phishing"
        ],
        "rbacGroupNames": [],
        "_prerequisite": "Network Protection (MDE07) must be enabled for URL indicators to work"
      },
      "domainIndicator": {
        "@odata.type": "#microsoft.graph.tiIndicator",
        "action": "alert",
        "description": "Alert-only domain indicator - suspicious domain for monitoring",
        "expirationDateTime": "2027-02-27T00:00:00Z",
        "indicatorProvider": "Custom Threat Intelligence",
        "domainName": "",
        "severity": "medium",
        "generateAlert": true,
        "recommendedActions": "Review the connection context. Determine if the domain access is business-justified.",
        "title": "Custom IoC - Suspicious Domain",
        "tags": [
          "custom-ioc",
          "monitoring"
        ],
        "rbacGroupNames": []
      },
      "certificateIndicator": {
        "@odata.type": "#microsoft.graph.tiIndicator",
        "action": "blockAndRemediate",
        "description": "Block files signed with known malicious certificate",
        "expirationDateTime": "2027-02-27T00:00:00Z",
        "indicatorProvider": "Custom Threat Intelligence",
        "certificateThumbprint": "",
        "certificateIssuerName": "",
        "certificateSubjectName": "",
        "severity": "high",
        "generateAlert": true,
        "recommendedActions": "Block all files signed with this certificate. Investigate for supply chain compromise.",
        "title": "Custom IoC - Malicious Code Signing Certificate",
        "tags": [
          "custom-ioc",
          "supply-chain"
        ],
        "rbacGroupNames": []
      },
      "allowListIndicator": {
        "@odata.type": "#microsoft.graph.tiIndicator",
        "action": "allowed",
        "description": "Allow-listed file hash - false positive exclusion for known safe file",
        "expirationDateTime": "2027-02-27T00:00:00Z",
        "indicatorProvider": "Internal Security Team",
        "fileHashType": "sha256",
        "fileHashValue": "",
        "severity": "informational",
        "generateAlert": false,
        "title": "Allow List - Known Safe Application",
        "tags": [
          "allow-list",
          "false-positive-exclusion"
        ],
        "rbacGroupNames": []
      }
    },
    "bulkImportTemplate": {
      "_description": "CSV format for bulk indicator import via the MDE portal",
      "csvHeaders": "IndicatorType,IndicatorValue,ExpirationTime,Action,Severity,Title,Description,RecommendedActions,RbacGroups,Category,MitreTechniques,GenerateAlert",
      "exampleRows": [
        "FileSha256,,2027-02-27T00:00:00Z,Block,High,Malware Sample,Known malicious file,Quarantine and investigate,,Malware,T1204,TRUE",
        "IpAddress,,2027-02-27T00:00:00Z,Block,High,C2 Infrastructure,Known command-and-control IP,Isolate device,,CommandAndControl,T1071,TRUE",
        "Url,,2027-02-27T00:00:00Z,Block,High,Phishing URL,Known phishing page,Reset credentials,,Phishing,T1566.002,TRUE",
        "DomainName,,2027-02-27T00:00:00Z,Alert,Medium,Suspicious Domain,Monitoring suspicious domain,Review connections,,SuspiciousActivity,,TRUE"
      ]
    },
    "automatedFeedIntegration": {
      "microsoftSentinelTaxii": {
        "_description": "Integrate TAXII/STIX threat intelligence feeds via Microsoft Sentinel for automatic indicator submission to MDE",
        "connectorType": "ThreatIntelligenceTaxii",
        "configuration": {
          "taxiiServer": "",
          "collectionId": "",
          "username": "",
          "password": "",
          "pollingFrequency": "hourly",
          "lookbackPeriod": "24h"
        }
      },
      "graphSecurityApi": {
        "_description": "Submit indicators programmatically via Microsoft Graph Security API",
        "endpoint": "https://graph.microsoft.com/beta/security/tiIndicators",
        "requiredPermissions": [
          "ThreatIndicators.ReadWrite.OwnedBy"
        ],
        "authentication": {
          "type": "clientCredentials",
          "tenantId": "",
          "clientId": "",
          "clientSecret": ""
        }
      }
    },
    "advancedHuntingQueries": {
      "indicatorMatches": "DeviceEvents | where ActionType == 'IndicatorFileBlocked' or ActionType == 'IndicatorIpBlocked' or ActionType == 'IndicatorUrlBlocked' | project Timestamp, DeviceName, ActionType, FileName, RemoteUrl, RemoteIP, SHA256 | sort by Timestamp desc | take 100",
      "indicatorStats": "DeviceEvents | where ActionType startswith 'Indicator' | summarize MatchCount=count() by ActionType, bin(Timestamp, 1d) | sort by Timestamp desc"
    }
  },
  {
    "_metadata": {
      "id": "PV01",
      "title": "DLP - Block Credit Card Numbers Shared Externally",
      "description": "Data Loss Prevention policy that detects and blocks credit card numbers (Visa, Mastercard, Amex, Discover, and other major card types) from being shared with external recipients across Exchange, SharePoint, OneDrive, and Teams.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "ISO 27001:2022",
        "ISO 27701:2019",
        "NIST SP 800-53 Rev.5",
        "SOC 2",
        "GDPR (EU) 2016/679",
        "PCI DSS v4.0",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "BSI IT-Grundschutz",
        "DORA",
        "HIPAA",
        "CMMC v2.0",
        "NYDFS 23 NYCRR 500",
        "Microsoft Cloud Security Benchmark",
        "MITRE ATT&CK"
      ],
      "cisChecks": [
        "9.1.1",
        "9.1.2",
        "9.1.3",
        "9.1.5"
      ],
      "mitreMappings": [
        "T1048",
        "T1567",
        "T1041"
      ],
      "requiredLicences": [
        "Microsoft 365 E3 (basic DLP)",
        "Microsoft 365 E5 or Microsoft 365 E5 Compliance (advanced DLP)",
        "Microsoft Purview Data Loss Prevention add-on"
      ],
      "requiredRoles": [
        "Compliance Administrator",
        "Security Administrator"
      ],
      "deploymentOrder": 1,
      "importMethod": "powershell-security-compliance",
      "importScript": "scripts/Import-PurviewPolicies.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Connect to Security & Compliance PowerShell: Connect-IPPSSession",
        "DLP licensing must be assigned to all users in scope",
        "Deploy in TestWithNotifications mode first, then switch to Enable after validation",
        "Ensure Exchange Online, SharePoint Online, and Teams services are active"
      ],
      "deploymentSteps": [
        "1. Connect to Security & Compliance PowerShell",
        "2. Run the New-DlpCompliancePolicy cmdlet to create the policy",
        "3. Run the New-DlpComplianceRule cmdlet to create the detection rule",
        "4. Set Mode to TestWithNotifications for initial 2-week pilot",
        "5. Review DLP reports in compliance.microsoft.com > Reports > DLP",
        "6. After validation, change Mode to Enable for enforcement"
      ],
      "rollbackProcedure": "Set-DlpCompliancePolicy -Identity 'PV01-DLP-Block-CreditCard-External' -Mode Disable"
    },
    "powershellCommands": {
      "createPolicy": {
        "cmdlet": "New-DlpCompliancePolicy",
        "parameters": {
          "Name": "PV01-DLP-Block-CreditCard-External",
          "Comment": "Blocks credit card numbers from being shared externally across Exchange, SharePoint, OneDrive, and Teams. PCI DSS compliance.",
          "ExchangeLocation": [
            "All"
          ],
          "SharePointLocation": [
            "All"
          ],
          "OneDriveLocation": [
            "All"
          ],
          "TeamsLocation": [
            "All"
          ],
          "Mode": "TestWithNotifications",
          "Priority": 0
        }
      },
      "createRule": {
        "cmdlet": "New-DlpComplianceRule",
        "parameters": {
          "Name": "PV01-Rule-Block-CreditCard-External",
          "Policy": "PV01-DLP-Block-CreditCard-External",
          "ContentContainsSensitiveInformation": [
            {
              "name": "Credit Card Number",
              "id": "50842eb7-edc8-4019-85dd-5a5c1f2bb085",
              "minCount": 1,
              "maxCount": -1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "Visa Card Number",
              "id": "82b5f0f4-e55f-4fbb-b tried",
              "minCount": 1,
              "minConfidence": 75
            },
            {
              "name": "Mastercard Card Number",
              "id": "fca93088-e9af-4c6b-abf7-f0402d40a704",
              "minCount": 1,
              "minConfidence": 75
            },
            {
              "name": "American Express Card Number",
              "id": "9b21b198-3d5b-4296-bd0d-db8caf813310",
              "minCount": 1,
              "minConfidence": 75
            },
            {
              "name": "Discover Card Number",
              "id": "b1b1b1b1-0000-4c6b-abf7-discover00001",
              "minCount": 1,
              "minConfidence": 75
            }
          ],
          "AccessScope": "NotInOrganization",
          "BlockAccess": true,
          "BlockAccessScope": "ExternalUsers",
          "NotifyUser": [
            "SiteAdmin",
            "LastModifier"
          ],
          "NotifyUserType": "NotifyAll",
          "NotifyPolicyTipCustomText": "This content contains credit card information and cannot be shared externally. Please remove the sensitive data or contact your compliance team for assistance.",
          "GenerateAlert": "SiteAdmin",
          "AlertProperties": {
            "AggregationType": "SimpleAggregation",
            "Threshold": 1,
            "TimeWindow": 60
          },
          "GenerateIncidentReport": [],
          "IncidentReportContent": [
            "Title",
            "DocumentAuthor",
            "DocumentLastModifier",
            "Service",
            "MatchedItem",
            "RulesMatched",
            "Severity"
          ],
          "ReportSeverityLevel": "High"
        }
      }
    },
    "sensitiveInformationTypes": [
      {
        "name": "Credit Card Number",
        "id": "50842eb7-edc8-4019-85dd-5a5c1f2bb085",
        "description": "Detects all major credit card formats: Visa (4xxx), MC (5xxx/2xxx), Amex (3xxx), Discover (6xxx), JCB, Diners Club",
        "publisher": "Microsoft",
        "rulePackId": "00000000-0000-0000-0000-000000000000"
      }
    ],
    "policySettings": {
      "mode": "TestWithNotifications",
      "_modeOptions": [
        "Enable",
        "TestWithNotifications",
        "TestWithoutNotifications",
        "Disable"
      ],
      "priority": 0,
      "workloads": {
        "exchangeOnline": true,
        "sharePointOnline": true,
        "oneDriveForBusiness": true,
        "microsoftTeams": true,
        "endpointDevices": false,
        "onPremisesRepositories": false,
        "powerBI": false,
        "thirdPartyApps": false
      }
    },
    "overrideSettings": {
      "allowOverride": false,
      "requireBusinessJustification": false,
      "_note": "Credit card data should never be shared externally. No override permitted for PCI DSS compliance."
    }
  },
  {
    "_metadata": {
      "id": "PV02",
      "title": "DLP - Block UK/EU PII Shared Externally",
      "description": "Data Loss Prevention policy that detects and blocks UK and EU personally identifiable information from being shared with external recipients. Covers UK NI Number, NHS Number, UK Passport, UK Driving Licence, EU National ID, EU Passport, EU SSN, and EU Tax ID.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "ISO 27001:2022",
        "ISO 27701:2019",
        "NIST SP 800-53 Rev.5",
        "SOC 2",
        "GDPR (EU) 2016/679",
        "UK NCSC CAF v3.2",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "BSI IT-Grundschutz",
        "ENS (Spain) RD311/22",
        "DORA",
        "HIPAA",
        "EU Cyber Resilience Act",
        "CMMC v2.0",
        "Microsoft Cloud Security Benchmark",
        "NYDFS 23 NYCRR 500"
      ],
      "cisChecks": [
        "9.1.1",
        "9.1.2",
        "9.1.3",
        "9.1.5"
      ],
      "mitreMappings": [
        "T1048",
        "T1567",
        "T1041"
      ],
      "requiredLicences": [
        "Microsoft 365 E3 (basic DLP)",
        "Microsoft 365 E5 or E5 Compliance (advanced DLP)",
        "Microsoft Purview Data Loss Prevention add-on"
      ],
      "requiredRoles": [
        "Compliance Administrator",
        "Security Administrator"
      ],
      "deploymentOrder": 2,
      "importMethod": "powershell-security-compliance",
      "importScript": "scripts/Import-PurviewPolicies.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Connect to Security & Compliance PowerShell: Connect-IPPSSession",
        "DLP licensing must be assigned to all in-scope users",
        "Deploy in TestWithNotifications mode for initial validation",
        "Review GDPR requirements for your specific EU member state obligations"
      ],
      "deploymentSteps": [
        "1. Connect to Security & Compliance PowerShell",
        "2. Create the DLP policy with New-DlpCompliancePolicy",
        "3. Create the UK PII rule with New-DlpComplianceRule",
        "4. Create the EU PII rule with New-DlpComplianceRule",
        "5. Test in simulation mode for 2 weeks",
        "6. Review matches and false positives",
        "7. Switch to enforcement mode"
      ],
      "rollbackProcedure": "Set-DlpCompliancePolicy -Identity 'PV02-DLP-Block-PII-UKEU-External' -Mode Disable"
    },
    "powershellCommands": {
      "createPolicy": {
        "cmdlet": "New-DlpCompliancePolicy",
        "parameters": {
          "Name": "PV02-DLP-Block-PII-UKEU-External",
          "Comment": "Blocks UK and EU PII from being shared externally. GDPR compliance policy covering personal data identifiers across Exchange, SharePoint, OneDrive, and Teams.",
          "ExchangeLocation": [
            "All"
          ],
          "SharePointLocation": [
            "All"
          ],
          "OneDriveLocation": [
            "All"
          ],
          "TeamsLocation": [
            "All"
          ],
          "Mode": "TestWithNotifications",
          "Priority": 1
        }
      },
      "createRuleUkPii": {
        "cmdlet": "New-DlpComplianceRule",
        "parameters": {
          "Name": "PV02-Rule-Block-UK-PII-External",
          "Policy": "PV02-DLP-Block-PII-UKEU-External",
          "ContentContainsSensitiveInformation": [
            {
              "name": "U.K. National Insurance Number (NINO)",
              "id": "16c07343-c26f-49d2-a987-3daf717e94cc",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "U.K. National Health Service Number",
              "id": "eb44f8b2-4d1b-42b5-9b63-3b5be9fcab01",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "U.K. Passport Number",
              "id": "d09e2058-be5e-4fca-8e84-5a2f19d7d70a",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "U.K. Driver's License Number",
              "id": "f93de4be-d94c-40df-a8be-461738047551",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "U.K. Electoral Roll Number",
              "id": "a]275dc8-3a3f-4e10-9b63-6a3c3e5fb8c8",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            }
          ],
          "AccessScope": "NotInOrganization",
          "BlockAccess": true,
          "BlockAccessScope": "ExternalUsers",
          "NotifyUser": [
            "SiteAdmin",
            "LastModifier"
          ],
          "GenerateIncidentReport": [],
          "IncidentReportContent": [
            "Title",
            "DocumentAuthor",
            "DocumentLastModifier",
            "Service",
            "MatchedItem",
            "RulesMatched",
            "Severity"
          ],
          "ReportSeverityLevel": "High",
          "NotifyPolicyTipCustomText": "This content contains UK personal data that is protected under the UK Data Protection Act 2018 and UK GDPR. External sharing is blocked. Contact your Data Protection Officer for guidance."
        }
      },
      "createRuleEuPii": {
        "cmdlet": "New-DlpComplianceRule",
        "parameters": {
          "Name": "PV02-Rule-Block-EU-PII-External",
          "Policy": "PV02-DLP-Block-PII-UKEU-External",
          "ContentContainsSensitiveInformation": [
            {
              "name": "EU National Identification Number",
              "id": "eec48844-2ecd-4f40-be8e-8e5e7bd64a1a",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "EU Passport Number",
              "id": "2c8a1953-6bf7-4f1e-8a8f-39b6919e4ec0",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "EU Social Security Number or Equivalent Identification",
              "id": "d3c4b82e-d4f2-489e-8d35-8d0e6f52395e",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "EU Tax Identification Number",
              "id": "f2d8e840-6c64-4e85-9d3b-93e8c91f0d57",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "EU Debit Card Number",
              "id": "0e9b3178-9678-47dd-a509-37222ca96b42",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            }
          ],
          "AccessScope": "NotInOrganization",
          "BlockAccess": true,
          "BlockAccessScope": "ExternalUsers",
          "NotifyUser": [
            "SiteAdmin",
            "LastModifier"
          ],
          "GenerateIncidentReport": [],
          "IncidentReportContent": [
            "Title",
            "DocumentAuthor",
            "DocumentLastModifier",
            "Service",
            "MatchedItem",
            "RulesMatched",
            "Severity"
          ],
          "ReportSeverityLevel": "High",
          "NotifyPolicyTipCustomText": "This content contains EU personal data protected under the General Data Protection Regulation (GDPR). External sharing is blocked. Contact your Data Protection Officer for guidance."
        }
      }
    },
    "policySettings": {
      "mode": "TestWithNotifications",
      "priority": 1,
      "workloads": {
        "exchangeOnline": true,
        "sharePointOnline": true,
        "oneDriveForBusiness": true,
        "microsoftTeams": true
      }
    },
    "overrideSettings": {
      "allowOverride": false,
      "requireBusinessJustification": false,
      "_note": "No override for PII external sharing under GDPR. Internal DPO must approve any exceptions via separate process."
    }
  },
  {
    "_metadata": {
      "id": "PV03",
      "title": "DLP - Block Protected Health Information (HIPAA)",
      "description": "Data Loss Prevention policy based on the HIPAA U.S. template that detects and blocks Protected Health Information (PHI) including SSNs, DEA numbers, ICD-9/10 codes, health insurance information, and Medicare beneficiary identifiers from external sharing. Includes a business justification override for low-volume matches.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "HIPAA",
        "HITRUST CSF v11",
        "NIST SP 800-53 Rev.5",
        "ISO 27001:2022",
        "SOC 2",
        "FedRAMP Moderate",
        "NYDFS 23 NYCRR 500",
        "CRI Profile v2.0",
        "HPH CPGs",
        "CJIS v6",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "9.1.1",
        "9.1.2",
        "9.1.3"
      ],
      "mitreMappings": [
        "T1048",
        "T1567",
        "T1041"
      ],
      "requiredLicences": [
        "Microsoft 365 E5 or E5 Compliance",
        "Microsoft Purview Data Loss Prevention add-on"
      ],
      "requiredRoles": [
        "Compliance Administrator",
        "Security Administrator"
      ],
      "deploymentOrder": 3,
      "importMethod": "powershell-security-compliance",
      "importScript": "scripts/Import-PurviewPolicies.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Connect to Security & Compliance PowerShell: Connect-IPPSSession",
        "HIPAA Business Associate Agreement (BAA) must be signed with Microsoft",
        "Organisation must have HIPAA compliance obligations",
        "Deploy in TestWithNotifications mode initially"
      ],
      "deploymentSteps": [
        "1. Connect to Security & Compliance PowerShell",
        "2. Create the DLP policy scoped to all workloads",
        "3. Create high-volume PHI rule (10+ instances) with strict block",
        "4. Create low-volume PHI rule (1-9 instances) with override option",
        "5. Validate in simulation mode for 2 weeks",
        "6. Switch to enforcement mode"
      ],
      "rollbackProcedure": "Set-DlpCompliancePolicy -Identity 'PV03-DLP-Block-PHI-HIPAA' -Mode Disable"
    },
    "powershellCommands": {
      "createPolicy": {
        "cmdlet": "New-DlpCompliancePolicy",
        "parameters": {
          "Name": "PV03-DLP-Block-PHI-HIPAA",
          "Comment": "HIPAA compliance DLP policy. Blocks PHI from external sharing across all M365 workloads. Based on U.S. HIPAA template.",
          "ExchangeLocation": [
            "All"
          ],
          "SharePointLocation": [
            "All"
          ],
          "OneDriveLocation": [
            "All"
          ],
          "TeamsLocation": [
            "All"
          ],
          "Mode": "TestWithNotifications",
          "Priority": 2
        }
      },
      "createRuleHighVolume": {
        "cmdlet": "New-DlpComplianceRule",
        "parameters": {
          "Name": "PV03-Rule-HighVolume-PHI-Block",
          "Policy": "PV03-DLP-Block-PHI-HIPAA",
          "Comment": "High volume PHI detection (10+ instances) - strict block, no override",
          "ContentContainsSensitiveInformation": [
            {
              "name": "U.S. Social Security Number (SSN)",
              "id": "a44669fe-0d48-453d-a9b1-2cc83f2cba77",
              "minCount": 10,
              "minConfidence": 85,
              "maxConfidence": 100
            },
            {
              "name": "Drug Enforcement Agency (DEA) Number",
              "id": "d5b30b42-ecba-40c1-af3a-d6b9e5b79c97",
              "minCount": 10,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "International Classification of Diseases (ICD-9-CM)",
              "id": "fa0f9141-0d09-4c29-bca5-0037e6f5fc4b",
              "minCount": 10,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "International Classification of Diseases (ICD-10-CM)",
              "id": "3356946c-6bb7-449b-b253-6ffa419c0ce7",
              "minCount": 10,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "U.S. Medicare Beneficiary Identifier (MBI)",
              "id": "1d607691-c165-4f41-8c5c-7f3d4a28c897",
              "minCount": 10,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "U.S. Health Insurance Claim Number (HICN)",
              "id": "f6dba3ed-dc3c-4c3e-8bd5-0db5e1f0e8db",
              "minCount": 10,
              "minConfidence": 75,
              "maxConfidence": 100
            }
          ],
          "AccessScope": "NotInOrganization",
          "BlockAccess": true,
          "BlockAccessScope": "All",
          "NotifyUser": [
            "SiteAdmin",
            "LastModifier"
          ],
          "NotifyPolicyTipCustomText": "This content contains a large volume of Protected Health Information (PHI) subject to HIPAA. External sharing is strictly prohibited.",
          "GenerateIncidentReport": [],
          "IncidentReportContent": [
            "Title",
            "DocumentAuthor",
            "DocumentLastModifier",
            "Service",
            "MatchedItem",
            "RulesMatched",
            "Severity"
          ],
          "ReportSeverityLevel": "High"
        }
      },
      "createRuleLowVolume": {
        "cmdlet": "New-DlpComplianceRule",
        "parameters": {
          "Name": "PV03-Rule-LowVolume-PHI-BlockWithOverride",
          "Policy": "PV03-DLP-Block-PHI-HIPAA",
          "Comment": "Low volume PHI detection (1-9 instances) - block with business justification override",
          "ContentContainsSensitiveInformation": [
            {
              "name": "U.S. Social Security Number (SSN)",
              "id": "a44669fe-0d48-453d-a9b1-2cc83f2cba77",
              "minCount": 1,
              "maxCount": 9,
              "minConfidence": 85,
              "maxConfidence": 100
            },
            {
              "name": "Drug Enforcement Agency (DEA) Number",
              "id": "d5b30b42-ecba-40c1-af3a-d6b9e5b79c97",
              "minCount": 1,
              "maxCount": 9,
              "minConfidence": 75
            },
            {
              "name": "International Classification of Diseases (ICD-10-CM)",
              "id": "3356946c-6bb7-449b-b253-6ffa419c0ce7",
              "minCount": 1,
              "maxCount": 9,
              "minConfidence": 75
            },
            {
              "name": "U.S. Medicare Beneficiary Identifier (MBI)",
              "id": "1d607691-c165-4f41-8c5c-7f3d4a28c897",
              "minCount": 1,
              "maxCount": 9,
              "minConfidence": 75
            },
            {
              "name": "U.S. Health Insurance Claim Number (HICN)",
              "id": "f6dba3ed-dc3c-4c3e-8bd5-0db5e1f0e8db",
              "minCount": 1,
              "maxCount": 9,
              "minConfidence": 75
            }
          ],
          "AccessScope": "NotInOrganization",
          "BlockAccess": true,
          "BlockAccessScope": "ExternalUsers",
          "NotifyUser": [
            "SiteAdmin",
            "LastModifier"
          ],
          "NotifyPolicyTipCustomText": "This content contains Protected Health Information (PHI) subject to HIPAA. You may override with a business justification if sharing is required for treatment, payment, or healthcare operations.",
          "NotifyOverride": "WithJustification",
          "GenerateIncidentReport": [],
          "IncidentReportContent": [
            "Title",
            "DocumentAuthor",
            "DocumentLastModifier",
            "Service",
            "MatchedItem",
            "RulesMatched",
            "Severity"
          ],
          "ReportSeverityLevel": "Medium"
        }
      }
    },
    "policySettings": {
      "mode": "TestWithNotifications",
      "priority": 2,
      "policyTemplate": "U.S. Health Insurance Act (HIPAA)",
      "workloads": {
        "exchangeOnline": true,
        "sharePointOnline": true,
        "oneDriveForBusiness": true,
        "microsoftTeams": true
      }
    },
    "overrideSettings": {
      "highVolumeRule": {
        "allowOverride": false,
        "_note": "No override for bulk PHI exposure (10+ matches)"
      },
      "lowVolumeRule": {
        "allowOverride": true,
        "requireBusinessJustification": true,
        "_note": "Override with mandatory business justification for 1-9 PHI matches"
      }
    }
  },
  {
    "_metadata": {
      "id": "PV04",
      "title": "DLP - Block Financial Data (PCI DSS)",
      "description": "Data Loss Prevention policy that detects and blocks financial account data including credit card numbers, bank account numbers (US, UK, EU), IBAN, SWIFT/BIC codes, and routing numbers from being shared externally. Satisfies PCI DSS Requirement 3 and 4.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "PCI DSS v4.0",
        "NIS2",
        "ISO 27001:2022",
        "NIST SP 800-53 Rev.5",
        "SOC 2",
        "GDPR (EU) 2016/679",
        "DORA",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "BSI IT-Grundschutz",
        "NYDFS 23 NYCRR 500",
        "FFIEC-CAT",
        "NERC-CIP",
        "Microsoft Cloud Security Benchmark",
        "MITRE ATT&CK"
      ],
      "cisChecks": [
        "9.1.2",
        "9.1.3"
      ],
      "mitreMappings": [
        "T1048",
        "T1567",
        "T1041"
      ],
      "requiredLicences": [
        "Microsoft 365 E3 (basic DLP)",
        "Microsoft 365 E5 or E5 Compliance (advanced DLP)"
      ],
      "requiredRoles": [
        "Compliance Administrator",
        "Security Administrator"
      ],
      "deploymentOrder": 4,
      "importMethod": "powershell-security-compliance",
      "importScript": "scripts/Import-PurviewPolicies.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Connect to Security & Compliance PowerShell: Connect-IPPSSession",
        "PCI DSS scope assessment must be completed to identify cardholder data flows",
        "Deploy in TestWithNotifications mode initially"
      ],
      "deploymentSteps": [
        "1. Connect to Security & Compliance PowerShell",
        "2. Create the DLP policy",
        "3. Create the financial data detection rule",
        "4. Test in simulation mode for 2 weeks",
        "5. Review and approve false positive exceptions",
        "6. Switch to enforcement mode"
      ],
      "rollbackProcedure": "Set-DlpCompliancePolicy -Identity 'PV04-DLP-Block-FinancialData-PCI' -Mode Disable"
    },
    "powershellCommands": {
      "createPolicy": {
        "cmdlet": "New-DlpCompliancePolicy",
        "parameters": {
          "Name": "PV04-DLP-Block-FinancialData-PCI",
          "Comment": "PCI DSS compliance DLP policy. Blocks financial account data and cardholder data from external sharing across all M365 workloads.",
          "ExchangeLocation": [
            "All"
          ],
          "SharePointLocation": [
            "All"
          ],
          "OneDriveLocation": [
            "All"
          ],
          "TeamsLocation": [
            "All"
          ],
          "Mode": "TestWithNotifications",
          "Priority": 3
        }
      },
      "createRule": {
        "cmdlet": "New-DlpComplianceRule",
        "parameters": {
          "Name": "PV04-Rule-Block-FinancialData-External",
          "Policy": "PV04-DLP-Block-FinancialData-PCI",
          "ContentContainsSensitiveInformation": [
            {
              "name": "Credit Card Number",
              "id": "50842eb7-edc8-4019-85dd-5a5c1f2bb085",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "U.S. Bank Account Number",
              "id": "a2ce32a8-f935-4bb6-8e96-2a5c55672ed2",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "U.K. Bank Account Number",
              "id": "0959a6d0-eb1b-45b3-925e-aae46be37e5b",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "EU Debit Card Number",
              "id": "0e9b3178-9678-47dd-a509-37222ca96b42",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "International Banking Account Number (IBAN)",
              "id": "2c7f5672-8e8d-4f5e-8d14-b5dc5b426e1d",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "SWIFT Code",
              "id": "9d828d89-5f09-4e3e-9f2a-a7b72c0f8e5f",
              "minCount": 1,
              "minConfidence": 85,
              "maxConfidence": 100
            },
            {
              "name": "ABA Routing Number",
              "id": "cb353f78-2b72-4c3c-8827-92bbe4f69fdf",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "U.K. SWIFT Code",
              "id": "1d7b61fc-fc61-4aa4-b4c6-c8a93ad9e9cf",
              "minCount": 1,
              "minConfidence": 85,
              "maxConfidence": 100
            }
          ],
          "AccessScope": "NotInOrganization",
          "BlockAccess": true,
          "BlockAccessScope": "ExternalUsers",
          "NotifyUser": [
            "SiteAdmin",
            "LastModifier"
          ],
          "NotifyPolicyTipCustomText": "This content contains financial account data protected under PCI DSS. External sharing is blocked. Contact the finance or compliance team for approved data transfer methods.",
          "GenerateIncidentReport": [],
          "IncidentReportContent": [
            "Title",
            "DocumentAuthor",
            "DocumentLastModifier",
            "Service",
            "MatchedItem",
            "RulesMatched",
            "Severity"
          ],
          "ReportSeverityLevel": "High"
        }
      }
    },
    "policySettings": {
      "mode": "TestWithNotifications",
      "priority": 3,
      "policyTemplate": "PCI Data Security Standard (PCI DSS)",
      "workloads": {
        "exchangeOnline": true,
        "sharePointOnline": true,
        "oneDriveForBusiness": true,
        "microsoftTeams": true
      }
    },
    "overrideSettings": {
      "allowOverride": false,
      "requireBusinessJustification": false,
      "_note": "No override for financial data external sharing under PCI DSS. Approved data transfer must use encrypted channels with explicit authorization."
    }
  },
  {
    "_metadata": {
      "id": "PV05",
      "title": "DLP - Insider Risk Bulk Download Detection",
      "description": "DLP policy that detects unusual bulk file download and access activity exceeding 50 files, indicative of insider data theft or exfiltration. Integrates with Purview Insider Risk Management for correlated risk scoring.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "ISO 27001:2022",
        "NIST SP 800-53 Rev.5",
        "SOC 2",
        "GDPR (EU) 2016/679",
        "DORA",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "PCI DSS v4.0",
        "NYDFS 23 NYCRR 500",
        "CMMC v2.0",
        "MITRE ATT&CK",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "9.1.4"
      ],
      "mitreMappings": [
        "T1119",
        "T1530",
        "T1039",
        "T1048",
        "T1567"
      ],
      "requiredLicences": [
        "Microsoft 365 E5 or E5 Compliance",
        "Microsoft Purview Insider Risk Management add-on"
      ],
      "requiredRoles": [
        "Compliance Administrator",
        "Insider Risk Management Admin"
      ],
      "deploymentOrder": 5,
      "importMethod": "powershell-security-compliance",
      "importScript": "scripts/Import-PurviewPolicies.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Connect to Security & Compliance PowerShell: Connect-IPPSSession",
        "Microsoft 365 E5 or Insider Risk Management add-on required",
        "Audit logging must be enabled (PV11)",
        "Insider Risk Management must be configured for full integration",
        "HR connector recommended for departing employee correlation"
      ],
      "deploymentSteps": [
        "1. Ensure audit logging is enabled and retained for 12 months (PV11)",
        "2. Create the DLP policy scoped to SharePoint and OneDrive",
        "3. Create detection rules for bulk download thresholds",
        "4. Configure alert notifications for security team",
        "5. Integrate with Insider Risk Management policy (PV12)"
      ],
      "rollbackProcedure": "Set-DlpCompliancePolicy -Identity 'PV05-DLP-InsiderRisk-BulkDownload' -Mode Disable"
    },
    "powershellCommands": {
      "createPolicy": {
        "cmdlet": "New-DlpCompliancePolicy",
        "parameters": {
          "Name": "PV05-DLP-InsiderRisk-BulkDownload",
          "Comment": "Detects unusual bulk file download and access patterns indicative of insider data theft. Scoped to SharePoint and OneDrive.",
          "SharePointLocation": [
            "All"
          ],
          "OneDriveLocation": [
            "All"
          ],
          "Mode": "Enable",
          "Priority": 4
        }
      },
      "createRuleBulkDownload": {
        "cmdlet": "New-DlpComplianceRule",
        "parameters": {
          "Name": "PV05-Rule-BulkDownload-Alert",
          "Policy": "PV05-DLP-InsiderRisk-BulkDownload",
          "Comment": "Alert on bulk file downloads exceeding 50 files in a single session",
          "ContentContainsSensitiveInformation": [
            {
              "name": "All Full Names",
              "id": "50842eb7-edc8-4019-85dd-5a5c1f2bb085",
              "minCount": 50,
              "minConfidence": 65,
              "maxConfidence": 100,
              "_note": "High-count threshold to detect bulk data patterns"
            }
          ],
          "AccessScope": "InOrganization",
          "BlockAccess": false,
          "GenerateAlert": "SiteAdmin",
          "AlertProperties": {
            "AggregationType": "AggregateByActivity",
            "Threshold": 50,
            "TimeWindow": 1440
          },
          "NotifyUser": [
            "SiteAdmin"
          ],
          "GenerateIncidentReport": [],
          "IncidentReportContent": [
            "Title",
            "DocumentAuthor",
            "DocumentLastModifier",
            "Service",
            "MatchedItem",
            "RulesMatched",
            "Severity"
          ],
          "ReportSeverityLevel": "High"
        }
      },
      "createRuleUnusualVolume": {
        "cmdlet": "New-DlpComplianceRule",
        "parameters": {
          "Name": "PV05-Rule-UnusualVolume-External-Block",
          "Policy": "PV05-DLP-InsiderRisk-BulkDownload",
          "Comment": "Block external sharing when bulk file access is detected alongside external sharing attempts",
          "AccessScope": "NotInOrganization",
          "BlockAccess": true,
          "BlockAccessScope": "ExternalUsers",
          "ContentContainsSensitiveInformation": [
            {
              "name": "Credit Card Number",
              "id": "50842eb7-edc8-4019-85dd-5a5c1f2bb085",
              "minCount": 5,
              "minConfidence": 75
            },
            {
              "name": "U.S. Social Security Number (SSN)",
              "id": "a44669fe-0d48-453d-a9b1-2cc83f2cba77",
              "minCount": 5,
              "minConfidence": 85
            }
          ],
          "NotifyUser": [
            "SiteAdmin",
            "LastModifier"
          ],
          "NotifyPolicyTipCustomText": "Unusual bulk file activity detected. External sharing has been blocked pending security review. Contact the security team if this is a legitimate business need.",
          "GenerateIncidentReport": [],
          "IncidentReportContent": [
            "Title",
            "DocumentAuthor",
            "DocumentLastModifier",
            "Service",
            "MatchedItem",
            "RulesMatched",
            "Severity"
          ],
          "ReportSeverityLevel": "High"
        }
      }
    },
    "activityAlertConfig": {
      "_description": "Complementary activity alert for bulk download detection via the Security & Compliance activity alerts",
      "cmdlet": "New-ActivityAlert",
      "parameters": {
        "Name": "PV05-ActivityAlert-BulkDownload",
        "Description": "Alert on user downloading more than 50 files from SharePoint/OneDrive within 60 minutes",
        "Operation": [
          "FileDownloaded",
          "FileSyncDownloadedFull"
        ],
        "Condition": {
          "aggregationType": "ByUser",
          "threshold": 50,
          "timeWindow": 60
        },
        "NotifyUser": [],
        "Severity": "High",
        "Type": "Custom",
        "Enabled": true
      }
    },
    "policySettings": {
      "mode": "Enable",
      "priority": 4,
      "workloads": {
        "sharePointOnline": true,
        "oneDriveForBusiness": true,
        "exchangeOnline": false,
        "microsoftTeams": false
      }
    },
    "insiderRiskIntegration": {
      "_description": "This DLP policy feeds into Insider Risk Management as a triggering event and risk indicator",
      "triggerType": "DlpPolicyMatch",
      "riskScoreContribution": "high",
      "correlatedPolicies": [
        "PV12-Insider-Risk-Management-Policy"
      ]
    }
  },
  {
    "_metadata": {
      "id": "PV06",
      "title": "DLP - Block Source Code and Credentials External Sharing",
      "description": "Data Loss Prevention policy that detects and blocks source code credentials, API keys, cloud storage keys, GitHub tokens, private keys, and connection strings from being shared externally. Uses built-in SITs and custom regex patterns.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "ISO 27001:2022",
        "NIST SP 800-53 Rev.5",
        "SOC 2",
        "GDPR (EU) 2016/679",
        "DORA",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "CMMC v2.0",
        "NERC-CIP",
        "NYDFS 23 NYCRR 500",
        "MITRE ATT&CK",
        "Microsoft Cloud Security Benchmark",
        "SEC Cyber Rule",
        "EU Cyber Resilience Act"
      ],
      "cisChecks": [
        "9.1.2",
        "9.1.3"
      ],
      "mitreMappings": [
        "T1552.001",
        "T1552.004",
        "T1048",
        "T1567"
      ],
      "requiredLicences": [
        "Microsoft 365 E5 or E5 Compliance",
        "Microsoft Purview Data Loss Prevention add-on"
      ],
      "requiredRoles": [
        "Compliance Administrator",
        "Security Administrator"
      ],
      "deploymentOrder": 6,
      "importMethod": "powershell-security-compliance",
      "importScript": "scripts/Import-PurviewPolicies.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Connect to Security & Compliance PowerShell: Connect-IPPSSession",
        "E5 Compliance or Purview DLP add-on required for custom SITs",
        "Custom SITs must be created before the DLP rule references them",
        "Deploy in TestWithNotifications mode initially"
      ],
      "deploymentSteps": [
        "1. Create custom Sensitive Information Types for credential patterns",
        "2. Create the DLP policy",
        "3. Create the credential detection rules",
        "4. Test in simulation mode for 2 weeks",
        "5. Review and tune false positives (especially for base64 patterns)",
        "6. Switch to enforcement mode"
      ],
      "rollbackProcedure": "Set-DlpCompliancePolicy -Identity 'PV06-DLP-Block-SourceCode-Credentials' -Mode Disable"
    },
    "powershellCommands": {
      "createCustomSensitiveInformationTypes": [
        {
          "cmdlet": "New-DlpSensitiveInformationType",
          "parameters": {
            "Name": "PV06-Custom-ConnectionString-Pattern",
            "Description": "Detects database and service connection strings containing credentials",
            "SensitiveInformationTypeRulePackage": {
              "rules": [
                {
                  "pattern": "(Server|Data Source|Host)\\s*=\\s*[^;]+;\\s*(User Id|uid|Username)\\s*=\\s*[^;]+;\\s*(Password|pwd)\\s*=\\s*[^;\"']+",
                  "confidence": 85,
                  "proximity": 300
                },
                {
                  "pattern": "mongodb(\\+srv)?://[^:]+:[^@]+@[^/]+",
                  "confidence": 90,
                  "proximity": 300
                }
              ]
            }
          }
        },
        {
          "cmdlet": "New-DlpSensitiveInformationType",
          "parameters": {
            "Name": "PV06-Custom-PrivateKey-Pattern",
            "Description": "Detects RSA/EC private keys and PEM-encoded certificates",
            "SensitiveInformationTypeRulePackage": {
              "rules": [
                {
                  "pattern": "-----BEGIN (RSA |EC |DSA |OPENSSH )?PRIVATE KEY-----",
                  "confidence": 95,
                  "proximity": 300
                },
                {
                  "pattern": "-----BEGIN CERTIFICATE-----",
                  "confidence": 75,
                  "proximity": 300
                }
              ]
            }
          }
        }
      ],
      "createPolicy": {
        "cmdlet": "New-DlpCompliancePolicy",
        "parameters": {
          "Name": "PV06-DLP-Block-SourceCode-Credentials",
          "Comment": "Blocks source code credentials, API keys, cloud storage keys, and private keys from external sharing. Protects against credential exfiltration.",
          "ExchangeLocation": [
            "All"
          ],
          "SharePointLocation": [
            "All"
          ],
          "OneDriveLocation": [
            "All"
          ],
          "TeamsLocation": [
            "All"
          ],
          "Mode": "TestWithNotifications",
          "Priority": 5
        }
      },
      "createRule": {
        "cmdlet": "New-DlpComplianceRule",
        "parameters": {
          "Name": "PV06-Rule-Block-Credentials-External",
          "Policy": "PV06-DLP-Block-SourceCode-Credentials",
          "ContentContainsSensitiveInformation": [
            {
              "name": "Azure Storage Account Key",
              "id": "c7bc98f8-d33a-4e36-93b9-cb10fe5a6f88",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "Azure Storage Account Shared Access Signature",
              "id": "66fa3f8a-db74-4c47-9a5c-8a0c0c6e2b5d",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "Amazon Web Services Access Key",
              "id": "be34c6f0-6e4b-48c4-b6c8-9c64246b4e6a",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "Amazon Web Services Secret Access Key",
              "id": "d2b5e4c8-7f3a-4e9d-b1c2-8a9f0e3d5c7b",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "GitHub Personal Access Token",
              "id": "6b2c8f4a-1d5e-4b7a-9c3f-2e8d0a6b4c1f",
              "minCount": 1,
              "minConfidence": 85,
              "maxConfidence": 100
            },
            {
              "name": "Azure AD Client Secret",
              "id": "3e8f2a1d-5b7c-4d9e-a6f0-1c4b8e2d7a3f",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "General Password",
              "id": "3a3c9f3e-5d7b-4c1a-8e2f-6b9d0a4c8e1f",
              "minCount": 1,
              "minConfidence": 65,
              "maxConfidence": 100
            },
            {
              "name": "PV06-Custom-ConnectionString-Pattern",
              "minCount": 1,
              "minConfidence": 85
            },
            {
              "name": "PV06-Custom-PrivateKey-Pattern",
              "minCount": 1,
              "minConfidence": 95
            }
          ],
          "AccessScope": "NotInOrganization",
          "BlockAccess": true,
          "BlockAccessScope": "ExternalUsers",
          "NotifyUser": [
            "SiteAdmin",
            "LastModifier"
          ],
          "NotifyPolicyTipCustomText": "This content appears to contain credentials, API keys, or private keys. External sharing is blocked to prevent credential exposure. Use Azure Key Vault or a secrets manager instead.",
          "GenerateIncidentReport": [],
          "IncidentReportContent": [
            "Title",
            "DocumentAuthor",
            "DocumentLastModifier",
            "Service",
            "MatchedItem",
            "RulesMatched",
            "Severity"
          ],
          "ReportSeverityLevel": "High"
        }
      }
    },
    "policySettings": {
      "mode": "TestWithNotifications",
      "priority": 5,
      "workloads": {
        "exchangeOnline": true,
        "sharePointOnline": true,
        "oneDriveForBusiness": true,
        "microsoftTeams": true
      }
    },
    "overrideSettings": {
      "allowOverride": false,
      "_note": "Credentials must never be shared externally. No override permitted."
    }
  },
  {
    "_metadata": {
      "id": "PV07",
      "title": "DLP - Block Password and Credential Sharing",
      "description": "Data Loss Prevention policy using custom Sensitive Information Types and keyword lists to detect and block the sharing of passwords, API keys, bearer tokens, and secret keys in emails, documents, and chat messages across all M365 workloads.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "ISO 27001:2022",
        "NIST SP 800-53 Rev.5",
        "SOC 2",
        "DORA",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "CMMC v2.0",
        "PCI DSS v4.0",
        "NYDFS 23 NYCRR 500",
        "MITRE ATT&CK",
        "Microsoft Cloud Security Benchmark",
        "ASD Essential Eight",
        "CJIS v6"
      ],
      "cisChecks": [
        "9.1.2",
        "9.1.3"
      ],
      "mitreMappings": [
        "T1552.001",
        "T1552.004",
        "T1078",
        "T1048"
      ],
      "requiredLicences": [
        "Microsoft 365 E5 or E5 Compliance (for custom SITs)",
        "Microsoft Purview Data Loss Prevention add-on"
      ],
      "requiredRoles": [
        "Compliance Administrator",
        "Security Administrator"
      ],
      "deploymentOrder": 7,
      "importMethod": "powershell-security-compliance",
      "importScript": "scripts/Import-PurviewPolicies.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Connect to Security & Compliance PowerShell: Connect-IPPSSession",
        "Custom SITs must be created before the DLP rule references them",
        "Keyword lists may generate false positives in IT documentation - tune as needed",
        "Deploy in TestWithNotifications mode initially"
      ],
      "deploymentSteps": [
        "1. Create the custom keyword dictionary SIT for credential patterns",
        "2. Create the custom regex SIT for structured credential patterns",
        "3. Create the DLP policy",
        "4. Create the detection rule referencing both built-in and custom SITs",
        "5. Test in simulation mode for 2 weeks",
        "6. Review false positives, especially from IT documentation",
        "7. Add exclusions for known safe sites (e.g., IT wiki, developer documentation)",
        "8. Switch to enforcement mode"
      ],
      "rollbackProcedure": "Set-DlpCompliancePolicy -Identity 'PV07-DLP-Block-Password-Sharing' -Mode Disable"
    },
    "powershellCommands": {
      "createCustomKeywordDictionary": {
        "cmdlet": "New-DlpKeywordDictionary",
        "parameters": {
          "Name": "PV07-CredentialKeywords",
          "Description": "Keyword dictionary for detecting credential sharing patterns",
          "FileData": null,
          "_keywords": [
            "password:",
            "password =",
            "password=",
            "passwd:",
            "passwd=",
            "api_key=",
            "api_key:",
            "apikey=",
            "apikey:",
            "api-key=",
            "api-key:",
            "secret_key=",
            "secret_key:",
            "secretkey=",
            "access_key=",
            "access_key:",
            "accesskey=",
            "bearer ",
            "Bearer ",
            "token:",
            "token=",
            "auth_token=",
            "client_secret=",
            "client_secret:",
            "private_key=",
            "encryption_key=",
            "database_password=",
            "db_password=",
            "smtp_password=",
            "ftp_password=",
            "-----BEGIN RSA PRIVATE KEY-----",
            "-----BEGIN PRIVATE KEY-----",
            "-----BEGIN EC PRIVATE KEY-----"
          ]
        }
      },
      "createCustomSensitiveInformationType": {
        "cmdlet": "New-DlpSensitiveInformationType",
        "parameters": {
          "Name": "PV07-Custom-CredentialPattern",
          "Description": "Detects structured credential patterns including API keys, tokens, and passwords in various formats",
          "SensitiveInformationTypeRulePackage": {
            "rules": [
              {
                "name": "API Key Pattern",
                "pattern": "(api[_-]?key|apikey|api[_-]?secret)\\s*[=:]\\s*['\"]?[A-Za-z0-9+/=_\\-]{20,}['\"]?",
                "confidence": 85,
                "proximity": 300
              },
              {
                "name": "Bearer Token Pattern",
                "pattern": "(Bearer|bearer)\\s+[A-Za-z0-9\\-._~+/]+=*",
                "confidence": 80,
                "proximity": 300
              },
              {
                "name": "Password Assignment Pattern",
                "pattern": "(password|passwd|pwd)\\s*[=:]\\s*['\"]?[^\\s'\"]{8,}['\"]?",
                "confidence": 75,
                "proximity": 300
              },
              {
                "name": "Connection String Password",
                "pattern": "(Password|pwd)\\s*=\\s*[^;\\s]{8,}",
                "confidence": 85,
                "proximity": 300
              },
              {
                "name": "AWS Access Key Pattern",
                "pattern": "AKIA[0-9A-Z]{16}",
                "confidence": 95,
                "proximity": 300
              },
              {
                "name": "Azure SAS Token Pattern",
                "pattern": "sig=[A-Za-z0-9%+/=]{40,}",
                "confidence": 80,
                "proximity": 300
              }
            ]
          }
        }
      },
      "createPolicy": {
        "cmdlet": "New-DlpCompliancePolicy",
        "parameters": {
          "Name": "PV07-DLP-Block-Password-Sharing",
          "Comment": "Blocks password and credential sharing in emails, documents, and chat messages. Prevents accidental credential exposure, a leading cause of cloud security incidents.",
          "ExchangeLocation": [
            "All"
          ],
          "SharePointLocation": [
            "All"
          ],
          "OneDriveLocation": [
            "All"
          ],
          "TeamsLocation": [
            "All"
          ],
          "Mode": "TestWithNotifications",
          "Priority": 6
        }
      },
      "createRule": {
        "cmdlet": "New-DlpComplianceRule",
        "parameters": {
          "Name": "PV07-Rule-Block-Credentials",
          "Policy": "PV07-DLP-Block-Password-Sharing",
          "ContentContainsSensitiveInformation": [
            {
              "name": "PV07-Custom-CredentialPattern",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            }
          ],
          "ContentContainsKeywordDictionary": {
            "Name": "PV07-CredentialKeywords",
            "minCount": 2,
            "_note": "Require at least 2 keyword matches to reduce false positives"
          },
          "BlockAccess": true,
          "BlockAccessScope": "All",
          "NotifyUser": [
            "SiteAdmin",
            "LastModifier"
          ],
          "NotifyPolicyTipCustomText": "This content appears to contain passwords, API keys, or authentication tokens. Sharing credentials in email, documents, or chat is a security violation. Use Azure Key Vault or your organisation's approved secrets management solution.",
          "GenerateIncidentReport": [],
          "IncidentReportContent": [
            "Title",
            "DocumentAuthor",
            "DocumentLastModifier",
            "Service",
            "MatchedItem",
            "RulesMatched",
            "Severity"
          ],
          "ReportSeverityLevel": "High"
        }
      }
    },
    "policySettings": {
      "mode": "TestWithNotifications",
      "priority": 6,
      "workloads": {
        "exchangeOnline": true,
        "sharePointOnline": true,
        "oneDriveForBusiness": true,
        "microsoftTeams": true
      }
    },
    "exclusions": {
      "_description": "Sites or groups to exclude from credential pattern detection to reduce false positives",
      "excludedSharePointSites": [],
      "_note": "Exclude IT documentation sites where credential patterns appear in instructional content. Review exclusions quarterly."
    }
  },
  {
    "_metadata": {
      "id": "PV08",
      "title": "DLP - GDPR Article 9 Special Category Data",
      "description": "Data Loss Prevention policy for GDPR Article 9 special category data including health data, racial/ethnic origin, political opinions, religious beliefs, trade union membership, biometric data, and genetic data. Blocks external sharing and requires business justification for internal sharing overrides.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "GDPR (EU) 2016/679",
        "NIS2",
        "ISO 27001:2022",
        "ISO 27701:2019",
        "NIST SP 800-53 Rev.5",
        "SOC 2",
        "DORA",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "BSI IT-Grundschutz",
        "ENS (Spain) RD311/22",
        "HIPAA",
        "EU Cyber Resilience Act",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "9.1.2",
        "9.1.3"
      ],
      "mitreMappings": [
        "T1048",
        "T1567",
        "T1041"
      ],
      "requiredLicences": [
        "Microsoft 365 E5 or E5 Compliance",
        "Microsoft Purview Data Loss Prevention add-on"
      ],
      "requiredRoles": [
        "Compliance Administrator",
        "Security Administrator",
        "Data Protection Officer"
      ],
      "deploymentOrder": 8,
      "importMethod": "powershell-security-compliance",
      "importScript": "scripts/Import-PurviewPolicies.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Connect to Security & Compliance PowerShell: Connect-IPPSSession",
        "GDPR Data Protection Impact Assessment (DPIA) should be completed",
        "Data Protection Officer must approve special category data handling rules",
        "Custom SITs for non-standard special categories may need to be created"
      ],
      "gdprArticle9Categories": [
        "Racial or ethnic origin",
        "Political opinions",
        "Religious or philosophical beliefs",
        "Trade union membership",
        "Genetic data",
        "Biometric data (for identification purposes)",
        "Health data",
        "Sex life or sexual orientation"
      ],
      "deploymentSteps": [
        "1. Create custom keyword dictionaries for special categories not covered by built-in SITs",
        "2. Create the DLP policy with EU GDPR template",
        "3. Create detection rules for each special category",
        "4. Test in simulation mode for 4 weeks (longer period due to sensitivity)",
        "5. Review with DPO and legal team",
        "6. Switch to enforcement mode"
      ],
      "rollbackProcedure": "Set-DlpCompliancePolicy -Identity 'PV08-DLP-GDPR-SpecialCategory' -Mode Disable"
    },
    "powershellCommands": {
      "createCustomKeywordDictionaries": [
        {
          "cmdlet": "New-DlpKeywordDictionary",
          "parameters": {
            "Name": "PV08-HealthDataKeywords",
            "Description": "Keywords indicating health/medical data for GDPR Article 9",
            "_keywords": [
              "diagnosis",
              "treatment plan",
              "medical record",
              "patient",
              "prescription",
              "blood type",
              "allergy",
              "medication",
              "surgery",
              "hospital admission",
              "clinical",
              "pathology",
              "radiology",
              "mental health",
              "disability",
              "chronic condition"
            ]
          }
        },
        {
          "cmdlet": "New-DlpKeywordDictionary",
          "parameters": {
            "Name": "PV08-SpecialCategoryKeywords",
            "Description": "Keywords indicating GDPR Article 9 special category data",
            "_keywords": [
              "ethnic origin",
              "ethnicity",
              "racial origin",
              "race",
              "political party",
              "political opinion",
              "political affiliation",
              "religious belief",
              "religion",
              "philosophical belief",
              "trade union",
              "union membership",
              "biometric",
              "fingerprint",
              "facial recognition",
              "retina scan",
              "genetic data",
              "DNA",
              "genome",
              "genetic test",
              "sexual orientation",
              "gender identity"
            ]
          }
        }
      ],
      "createPolicy": {
        "cmdlet": "New-DlpCompliancePolicy",
        "parameters": {
          "Name": "PV08-DLP-GDPR-SpecialCategory",
          "Comment": "GDPR Article 9 special category data protection. Blocks external sharing of health data, racial/ethnic origin, political opinions, religious beliefs, biometric data, and genetic data.",
          "ExchangeLocation": [
            "All"
          ],
          "SharePointLocation": [
            "All"
          ],
          "OneDriveLocation": [
            "All"
          ],
          "TeamsLocation": [
            "All"
          ],
          "Mode": "TestWithNotifications",
          "Priority": 7
        }
      },
      "createRuleHealthData": {
        "cmdlet": "New-DlpComplianceRule",
        "parameters": {
          "Name": "PV08-Rule-Block-HealthData-External",
          "Policy": "PV08-DLP-GDPR-SpecialCategory",
          "Comment": "Detect and block health data shared externally",
          "ContentContainsSensitiveInformation": [
            {
              "name": "International Classification of Diseases (ICD-10-CM)",
              "id": "3356946c-6bb7-449b-b253-6ffa419c0ce7",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "International Classification of Diseases (ICD-9-CM)",
              "id": "fa0f9141-0d09-4c29-bca5-0037e6f5fc4b",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "Drug Enforcement Agency (DEA) Number",
              "id": "d5b30b42-ecba-40c1-af3a-d6b9e5b79c97",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            }
          ],
          "AccessScope": "NotInOrganization",
          "BlockAccess": true,
          "BlockAccessScope": "ExternalUsers",
          "NotifyUser": [
            "SiteAdmin",
            "LastModifier"
          ],
          "NotifyPolicyTipCustomText": "This content contains health data classified as GDPR Article 9 special category data. External sharing is prohibited without explicit consent and DPO approval.",
          "NotifyOverride": "WithJustification",
          "GenerateIncidentReport": [],
          "IncidentReportContent": [
            "Title",
            "DocumentAuthor",
            "DocumentLastModifier",
            "Service",
            "MatchedItem",
            "RulesMatched",
            "Severity"
          ],
          "ReportSeverityLevel": "High"
        }
      },
      "createRuleSpecialCategories": {
        "cmdlet": "New-DlpComplianceRule",
        "parameters": {
          "Name": "PV08-Rule-Block-SpecialCategory-External",
          "Policy": "PV08-DLP-GDPR-SpecialCategory",
          "Comment": "Detect and block GDPR Article 9 special category personal data shared externally",
          "ContentContainsSensitiveInformation": [
            {
              "name": "EU National Identification Number",
              "id": "eec48844-2ecd-4f40-be8e-8e5e7bd64a1a",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "EU Social Security Number or Equivalent Identification",
              "id": "d3c4b82e-d4f2-489e-8d35-8d0e6f52395e",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            }
          ],
          "ContentContainsKeywordDictionary": {
            "Name": "PV08-SpecialCategoryKeywords",
            "minCount": 1
          },
          "AccessScope": "NotInOrganization",
          "BlockAccess": true,
          "BlockAccessScope": "ExternalUsers",
          "NotifyUser": [
            "SiteAdmin",
            "LastModifier"
          ],
          "NotifyPolicyTipCustomText": "This content contains GDPR Article 9 special category personal data (e.g., racial/ethnic origin, political opinions, religious beliefs, biometric or genetic data). External sharing requires explicit consent and DPO approval.",
          "NotifyOverride": "WithJustification",
          "GenerateIncidentReport": [],
          "IncidentReportContent": [
            "Title",
            "DocumentAuthor",
            "DocumentLastModifier",
            "Service",
            "MatchedItem",
            "RulesMatched",
            "Severity"
          ],
          "ReportSeverityLevel": "High"
        }
      }
    },
    "policySettings": {
      "mode": "TestWithNotifications",
      "priority": 7,
      "policyTemplate": "EU General Data Protection Regulation (GDPR)",
      "workloads": {
        "exchangeOnline": true,
        "sharePointOnline": true,
        "oneDriveForBusiness": true,
        "microsoftTeams": true
      }
    },
    "overrideSettings": {
      "allowOverride": true,
      "requireBusinessJustification": true,
      "_note": "Override with mandatory GDPR-compliant justification. All overrides are logged and reported to the DPO."
    }
  },
  {
    "_metadata": {
      "id": "PV09",
      "title": "DLP - Teams Block Sensitive Data to External Participants",
      "description": "DLP policy scoped exclusively to Microsoft Teams that detects and blocks credit card numbers, Social Security numbers, UK National Insurance numbers, and passport numbers from being shared in Teams chat and channel messages with external participants.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "ISO 27001:2022",
        "NIST SP 800-53 Rev.5",
        "SOC 2",
        "GDPR (EU) 2016/679",
        "DORA",
        "PCI DSS v4.0",
        "HIPAA",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "CMMC v2.0",
        "MITRE ATT&CK",
        "Microsoft Cloud Security Benchmark",
        "CJIS v6"
      ],
      "cisChecks": [
        "4.2",
        "9.1.5"
      ],
      "mitreMappings": [
        "T1048",
        "T1567.002",
        "T1530"
      ],
      "requiredLicences": [
        "Microsoft 365 E3 (basic DLP for Teams)",
        "Microsoft 365 E5 or E5 Compliance (advanced DLP features)"
      ],
      "requiredRoles": [
        "Compliance Administrator",
        "Teams Administrator"
      ],
      "deploymentOrder": 9,
      "importMethod": "powershell-security-compliance",
      "importScript": "scripts/Import-PurviewPolicies.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Connect to Security & Compliance PowerShell: Connect-IPPSSession",
        "Teams DLP requires at minimum M365 E3 licensing",
        "External access and guest access must be configured in Teams admin center",
        "Deploy in TestWithNotifications mode initially"
      ],
      "teamsSpecificBehaviour": [
        "DLP in Teams blocks the message from being delivered to external participants",
        "The sender receives a policy tip explaining why the message was blocked",
        "Internal recipients in the same conversation can still see the message",
        "Applies to 1:1 chats, group chats, and channel messages",
        "File attachments shared in Teams are covered by SharePoint/OneDrive DLP policies"
      ],
      "deploymentSteps": [
        "1. Create the DLP policy scoped to Teams only",
        "2. Create the detection rule for sensitive data types",
        "3. Test in simulation mode for 1 week",
        "4. Verify policy tips appear correctly in Teams client",
        "5. Switch to enforcement mode"
      ],
      "rollbackProcedure": "Set-DlpCompliancePolicy -Identity 'PV09-DLP-Teams-BlockSensitive-External' -Mode Disable"
    },
    "powershellCommands": {
      "createPolicy": {
        "cmdlet": "New-DlpCompliancePolicy",
        "parameters": {
          "Name": "PV09-DLP-Teams-BlockSensitive-External",
          "Comment": "Blocks sensitive data (credit cards, SSNs, NI numbers, passport numbers) in Teams chat and channel messages to external participants.",
          "TeamsLocation": [
            "All"
          ],
          "ExchangeLocation": [],
          "SharePointLocation": [],
          "OneDriveLocation": [],
          "Mode": "TestWithNotifications",
          "Priority": 8
        }
      },
      "createRule": {
        "cmdlet": "New-DlpComplianceRule",
        "parameters": {
          "Name": "PV09-Rule-Teams-BlockSensitive-External",
          "Policy": "PV09-DLP-Teams-BlockSensitive-External",
          "ContentContainsSensitiveInformation": [
            {
              "name": "Credit Card Number",
              "id": "50842eb7-edc8-4019-85dd-5a5c1f2bb085",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "U.S. Social Security Number (SSN)",
              "id": "a44669fe-0d48-453d-a9b1-2cc83f2cba77",
              "minCount": 1,
              "minConfidence": 85,
              "maxConfidence": 100
            },
            {
              "name": "U.K. National Insurance Number (NINO)",
              "id": "16c07343-c26f-49d2-a987-3daf717e94cc",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "U.S. / U.K. Passport Number",
              "id": "178ec42a-18b4-47cc-85c7-d62c92fd67f8",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "EU Passport Number",
              "id": "2c8a1953-6bf7-4f1e-8a8f-39b6919e4ec0",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            },
            {
              "name": "U.K. National Health Service Number",
              "id": "eb44f8b2-4d1b-42b5-9b63-3b5be9fcab01",
              "minCount": 1,
              "minConfidence": 75,
              "maxConfidence": 100
            }
          ],
          "AccessScope": "NotInOrganization",
          "BlockAccess": true,
          "BlockAccessScope": "ExternalUsers",
          "NotifyUser": [
            "LastModifier"
          ],
          "NotifyUserType": "NotifyAll",
          "NotifyPolicyTipCustomText": "Your Teams message contains sensitive information (credit card, national ID, or passport numbers) that cannot be shared with external participants. Please remove the sensitive data and try again.",
          "GenerateAlert": "SiteAdmin",
          "GenerateIncidentReport": [],
          "IncidentReportContent": [
            "Title",
            "DocumentAuthor",
            "DocumentLastModifier",
            "Service",
            "MatchedItem",
            "RulesMatched",
            "Severity"
          ],
          "ReportSeverityLevel": "Medium"
        }
      }
    },
    "policySettings": {
      "mode": "TestWithNotifications",
      "priority": 8,
      "workloads": {
        "exchangeOnline": false,
        "sharePointOnline": false,
        "oneDriveForBusiness": false,
        "microsoftTeams": true
      },
      "_note": "This policy is intentionally scoped to Teams only. Other workloads are covered by PV01-PV08."
    },
    "overrideSettings": {
      "allowOverride": false,
      "requireBusinessJustification": false,
      "_note": "No override for sensitive data in Teams messages to external users."
    }
  },
  {
    "_metadata": {
      "id": "PV10",
      "title": "Sensitivity Labels - Deploy Across All Workloads",
      "description": "Deploys a four-tier sensitivity label taxonomy (Public, Internal, Confidential, Highly Confidential) with encryption for Confidential and above, watermarking for Highly Confidential, and auto-labelling rules for known sensitive content patterns.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "ISO 27001:2022",
        "ISO 27701:2019",
        "NIST SP 800-53 Rev.5",
        "SOC 2",
        "GDPR (EU) 2016/679",
        "DORA",
        "PCI DSS v4.0",
        "HIPAA",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "CMMC v2.0",
        "ASD Essential Eight",
        "MITRE ATT&CK",
        "Microsoft Cloud Security Benchmark",
        "CJIS v6"
      ],
      "cisChecks": [
        "9.1.7",
        "9.1.10",
        "9.1.11"
      ],
      "mitreMappings": [
        "T1048",
        "T1567",
        "T1041",
        "T1530"
      ],
      "requiredLicences": [
        "Microsoft 365 E5 or E5 Compliance",
        "Microsoft Purview Information Protection",
        "Azure Information Protection P2 (for auto-labelling)"
      ],
      "requiredRoles": [
        "Compliance Administrator",
        "Security Administrator"
      ],
      "deploymentOrder": 10,
      "importMethod": "powershell-security-compliance",
      "importScript": "scripts/Import-PurviewPolicies.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Connect to Security & Compliance PowerShell: Connect-IPPSSession",
        "Azure Information Protection unified labelling must be activated",
        "Microsoft 365 Apps must support sensitivity labels (Microsoft 365 Apps for Enterprise)",
        "For container labels (Teams/Groups/Sites), enable the Azure AD settings",
        "Plan label taxonomy with stakeholders before deployment"
      ],
      "deploymentSteps": [
        "1. Create labels in order (parent labels first, then sub-labels)",
        "2. Create the label policy and publish to all users",
        "3. Configure auto-labelling policies for service-side labelling",
        "4. Enable mandatory labelling after a 4-week adoption period",
        "5. Configure default label for new documents",
        "6. Deploy to containers (Teams, Groups, SharePoint sites)"
      ],
      "rollbackProcedure": "Set label policy to draft or remove label assignments. Note: removing encryption from already-encrypted files requires Rights Management super user permissions."
    },
    "powershellCommands": {
      "createLabels": [
        {
          "cmdlet": "New-Label",
          "parameters": {
            "Name": "Public",
            "DisplayName": "Public",
            "Comment": "Information approved for unrestricted distribution. No confidentiality requirements.",
            "Tooltip": "Use for information that can be freely shared with anyone, including external parties and the general public.",
            "Priority": 0,
            "Settings": {
              "color": "#00AA00"
            },
            "LabelActions": {
              "headerEnabled": true,
              "headerText": "Classification: PUBLIC",
              "headerFontSize": 8,
              "headerColor": "#00AA00",
              "headerAlignment": "Right",
              "footerEnabled": true,
              "footerText": " - Public",
              "footerFontSize": 8,
              "footerColor": "#00AA00",
              "footerAlignment": "Center"
            }
          }
        },
        {
          "cmdlet": "New-Label",
          "parameters": {
            "Name": "Internal",
            "DisplayName": "Internal",
            "Comment": "Information intended only for internal use within the organisation. Not for external distribution without approval.",
            "Tooltip": "Use for internal business information that should not be shared outside the organisation without prior approval.",
            "Priority": 1,
            "Settings": {
              "color": "#0078D4"
            },
            "LabelActions": {
              "headerEnabled": true,
              "headerText": "Classification: INTERNAL",
              "headerFontSize": 8,
              "headerColor": "#0078D4",
              "headerAlignment": "Right",
              "footerEnabled": true,
              "footerText": " - Internal Use Only",
              "footerFontSize": 8,
              "footerColor": "#0078D4",
              "footerAlignment": "Center"
            }
          }
        },
        {
          "cmdlet": "New-Label",
          "parameters": {
            "Name": "Confidential",
            "DisplayName": "Confidential",
            "Comment": "Sensitive business information requiring protection. Encrypted at rest and in transit. Access restricted to authorised internal users.",
            "Tooltip": "Use for sensitive information such as financial reports, HR data, customer PII, or business strategies. Content will be encrypted.",
            "Priority": 2,
            "Settings": {
              "color": "#FF8C00"
            },
            "EncryptionEnabled": true,
            "EncryptionProtectionType": "Template",
            "EncryptionRightsDefinitions": [
              {
                "identity": "",
                "rights": [
                  "VIEW",
                  "EDIT",
                  "PRINT",
                  "COPY",
                  "EXPORT",
                  "FORWARD",
                  "REPLY",
                  "REPLYALL",
                  "EXTRACT"
                ]
              }
            ],
            "EncryptionDoNotForward": false,
            "EncryptionOfflineAccessDays": 30,
            "EncryptionContentExpiredOnDateInDaysOrNever": "Never",
            "LabelActions": {
              "headerEnabled": true,
              "headerText": "Classification: CONFIDENTIAL",
              "headerFontSize": 8,
              "headerColor": "#FF8C00",
              "headerAlignment": "Right",
              "footerEnabled": true,
              "footerText": " - Confidential - Do Not Distribute Externally",
              "footerFontSize": 8,
              "footerColor": "#FF8C00",
              "footerAlignment": "Center"
            }
          }
        },
        {
          "cmdlet": "New-Label",
          "parameters": {
            "Name": "HighlyConfidential",
            "DisplayName": "Highly Confidential",
            "Comment": "Extremely sensitive information with the highest protection. Encrypted with restricted access. Watermarked. Requires explicit authorisation for any sharing.",
            "Tooltip": "Use for the most sensitive information: board papers, M&A documents, security credentials, legal privilege, or regulated data (HIPAA/PCI). Content will be encrypted and watermarked.",
            "Priority": 3,
            "Settings": {
              "color": "#CC0000"
            },
            "EncryptionEnabled": true,
            "EncryptionProtectionType": "Template",
            "EncryptionRightsDefinitions": [
              {
                "identity": "@",
                "rights": [
                  "VIEW",
                  "EDIT"
                ]
              },
              {
                "identity": "@",
                "rights": [
                  "VIEW",
                  "EDIT",
                  "PRINT",
                  "EXPORT"
                ]
              }
            ],
            "EncryptionDoNotForward": true,
            "EncryptionOfflineAccessDays": 7,
            "EncryptionContentExpiredOnDateInDaysOrNever": "Never",
            "LabelActions": {
              "headerEnabled": true,
              "headerText": "Classification: HIGHLY CONFIDENTIAL",
              "headerFontSize": 10,
              "headerColor": "#CC0000",
              "headerAlignment": "Right",
              "footerEnabled": true,
              "footerText": " - HIGHLY CONFIDENTIAL - Authorised Recipients Only",
              "footerFontSize": 10,
              "footerColor": "#CC0000",
              "footerAlignment": "Center",
              "watermarkEnabled": true,
              "watermarkText": "HIGHLY CONFIDENTIAL - ",
              "watermarkFontSize": 48,
              "watermarkColor": "#CC0000",
              "watermarkLayout": "Diagonal"
            }
          }
        }
      ],
      "createLabelPolicy": {
        "cmdlet": "New-LabelPolicy",
        "parameters": {
          "Name": "PV10-SensitivityLabelPolicy-AllUsers",
          "Comment": "Publishes sensitivity labels to all users across all M365 workloads. Default label set to Internal. Mandatory labelling enabled.",
          "Labels": [
            "Public",
            "Internal",
            "Confidential",
            "HighlyConfidential"
          ],
          "ExchangeLocation": [
            "All"
          ],
          "ModernGroupLocation": [
            "All"
          ],
          "Settings": {
            "requireDowngradeJustification": true,
            "mandatoryLabelEnabled": true,
            "defaultLabelId": "",
            "_defaultLabelNote": "Default label for new documents is Internal. Users must explicitly select a different label.",
            "outlookDefaultLabel": "",
            "powerbilabelenabled": true,
            "teamworkLabelEnabled": true,
            "sitesAndGroupsLabelEnabled": true
          }
        }
      },
      "createAutoLabellingPolicies": [
        {
          "cmdlet": "New-AutoSensitivityLabelPolicy",
          "parameters": {
            "Name": "PV10-AutoLabel-CreditCard-Confidential",
            "Comment": "Auto-apply Confidential label to documents containing credit card numbers",
            "ApplySensitivityLabel": "Confidential",
            "ExchangeLocation": [
              "All"
            ],
            "SharePointLocation": [
              "All"
            ],
            "OneDriveLocation": [
              "All"
            ],
            "Mode": "TestWithNotifications"
          }
        },
        {
          "cmdlet": "New-AutoSensitivityLabelRule",
          "parameters": {
            "Name": "PV10-AutoLabel-CreditCard-Rule",
            "Policy": "PV10-AutoLabel-CreditCard-Confidential",
            "ContentContainsSensitiveInformation": [
              {
                "name": "Credit Card Number",
                "id": "50842eb7-edc8-4019-85dd-5a5c1f2bb085",
                "minCount": 1,
                "minConfidence": 85
              }
            ]
          }
        },
        {
          "cmdlet": "New-AutoSensitivityLabelPolicy",
          "parameters": {
            "Name": "PV10-AutoLabel-HealthData-HighlyConfidential",
            "Comment": "Auto-apply Highly Confidential label to documents containing PHI/health data",
            "ApplySensitivityLabel": "HighlyConfidential",
            "ExchangeLocation": [
              "All"
            ],
            "SharePointLocation": [
              "All"
            ],
            "OneDriveLocation": [
              "All"
            ],
            "Mode": "TestWithNotifications"
          }
        }
      ]
    },
    "policySettings": {
      "mandatoryLabelling": true,
      "defaultLabel": "Internal",
      "requireJustificationOnDowngrade": true,
      "workloads": {
        "officeApps": true,
        "exchangeOnline": true,
        "sharePointOnline": true,
        "oneDriveForBusiness": true,
        "microsoftTeams": true,
        "powerBI": true,
        "microsoftFabric": true
      }
    }
  },
  {
    "_metadata": {
      "id": "PV11",
      "title": "Unified Audit Log Retention - 1 Year",
      "description": "Configures Microsoft Purview unified audit log retention to 12 months (TwelveMonths) for all record types and all users, extending beyond the default 180-day retention. Required for regulatory compliance and incident investigation timelines.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "ISO 27001:2022",
        "NIST SP 800-53 Rev.5",
        "SOC 2",
        "GDPR (EU) 2016/679",
        "DORA",
        "PCI DSS v4.0",
        "HIPAA",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "CMMC v2.0",
        "NERC-CIP",
        "ASD Essential Eight",
        "NZ ISM v3.8",
        "MITRE ATT&CK",
        "Microsoft Cloud Security Benchmark",
        "CJIS v6",
        "TSA Security Directive",
        "CIRCIA (US)",
        "SEC Cyber Rule"
      ],
      "cisChecks": [
        "9.1.1",
        "9.1.9"
      ],
      "mitreMappings": [],
      "requiredLicences": [
        "Microsoft 365 E5 or E5 Compliance (for 1-year retention)",
        "Microsoft Purview Audit (Premium) add-on",
        "Office 365 E5 (alternative)"
      ],
      "requiredRoles": [
        "Compliance Administrator",
        "Organization Management"
      ],
      "deploymentOrder": 11,
      "importMethod": "powershell-security-compliance",
      "importScript": "scripts/Import-PurviewPolicies.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Connect to Security & Compliance PowerShell: Connect-IPPSSession",
        "E5 Compliance or Audit Premium licence required for retention beyond 180 days",
        "Audit logging must be enabled (verify: Get-AdminAuditLogConfig | Select UnifiedAuditLogIngestionEnabled)",
        "With E5, retention up to 10 years is available for specific record types"
      ],
      "retentionLimits": {
        "e3Default": "180 days (Standard Audit)",
        "e5OneYear": "365 days (Audit Premium - 1 year)",
        "e5TenYears": "3650 days (Audit Premium - 10 year retention add-on)"
      },
      "deploymentSteps": [
        "1. Connect to Security & Compliance PowerShell",
        "2. Verify audit logging is enabled",
        "3. Create the 1-year retention policy for all record types",
        "4. Create additional high-priority retention policies for security-critical events",
        "5. Verify policy creation and confirm retention period"
      ],
      "rollbackProcedure": "Remove-UnifiedAuditLogRetentionPolicy -Identity 'PV11-AuditRetention-1Year-AllRecords'. Note: audit records already stored will be retained until their original expiry."
    },
    "powershellCommands": {
      "verifyAuditEnabled": {
        "cmdlet": "Get-AdminAuditLogConfig",
        "parameters": {},
        "expectedResult": "UnifiedAuditLogIngestionEnabled: True",
        "enableIfDisabled": {
          "cmdlet": "Set-AdminAuditLogConfig",
          "parameters": {
            "UnifiedAuditLogIngestionEnabled": true
          }
        }
      },
      "createRetentionPolicyAllRecords": {
        "cmdlet": "New-UnifiedAuditLogRetentionPolicy",
        "parameters": {
          "Name": "PV11-AuditRetention-1Year-AllRecords",
          "Description": "Retain all unified audit log records for 12 months. Applies to all users and all record types. Required for regulatory compliance (NIS2, PCI DSS, HIPAA, SOC 2).",
          "RetentionDuration": "TwelveMonths",
          "RecordTypes": [],
          "Operations": [],
          "UserIds": [],
          "Priority": 1,
          "_recordTypesNote": "Empty array = all record types. Specific record types can be targeted for longer retention."
        }
      },
      "createRetentionPolicySecurityCritical": {
        "cmdlet": "New-UnifiedAuditLogRetentionPolicy",
        "parameters": {
          "Name": "PV11-AuditRetention-1Year-SecurityCritical",
          "Description": "Extended retention for security-critical audit events including admin operations, authentication events, and data access.",
          "RetentionDuration": "TwelveMonths",
          "RecordTypes": [
            "AzureActiveDirectory",
            "AzureActiveDirectoryAccountLogon",
            "AzureActiveDirectoryStsLogon",
            "ExchangeAdmin",
            "SharePointSharingOperation",
            "DLP",
            "SecurityComplianceAlerts",
            "ThreatIntelligence",
            "SecurityComplianceInsights",
            "MipAutoLabelSharePointItem",
            "MipAutoLabelExchangeItem"
          ],
          "Operations": [],
          "UserIds": [],
          "Priority": 2
        }
      },
      "createRetentionPolicyPrivilegedAccounts": {
        "cmdlet": "New-UnifiedAuditLogRetentionPolicy",
        "parameters": {
          "Name": "PV11-AuditRetention-1Year-PrivilegedAccounts",
          "Description": "Extended retention for all audit events from privileged admin accounts.",
          "RetentionDuration": "TwelveMonths",
          "RecordTypes": [],
          "Operations": [],
          "UserIds": [],
          "Priority": 3
        }
      },
      "verifyPolicies": {
        "cmdlet": "Get-UnifiedAuditLogRetentionPolicy",
        "parameters": {},
        "expectedOutput": "Lists all created retention policies with their retention durations and priorities"
      }
    },
    "policySettings": {
      "retentionDuration": "TwelveMonths",
      "scope": "allRecordTypes",
      "allUsers": true,
      "priority": 1
    },
    "complianceMappings": {
      "pciDss": "PCI DSS v4.0 Req 10.7: Retain audit logs for at least 12 months",
      "hipaa": "HIPAA 164.312(b): Audit controls with sufficient retention for investigations",
      "soc2": "SOC 2 CC7.2: Monitoring and detection of anomalies with adequate log retention",
      "nis2": "NIS2 Article 21: Incident handling and reporting with evidence preservation",
      "gdpr": "GDPR Article 5(2): Accountability principle - demonstrate compliance",
      "nist": "NIST SP 800-53 AU-11: Audit Record Retention"
    }
  },
  {
    "_metadata": {
      "id": "PV12",
      "title": "Insider Risk Management Policy",
      "description": "Configures Microsoft Purview Insider Risk Management policies for detecting departing employee data theft, general data leaks, and security policy violations. Uses HR connector signals, DLP policy matches, and behavioural indicators to identify insider threats.",
      "version": "1.0",
      "lastUpdated": "2026-02-27",
      "frameworks": [
        "NIS2",
        "ISO 27001:2022",
        "NIST SP 800-53 Rev.5",
        "SOC 2",
        "GDPR (EU) 2016/679",
        "DORA",
        "PCI DSS v4.0",
        "HIPAA",
        "FedRAMP Moderate",
        "HITRUST CSF v11",
        "CMMC v2.0",
        "NERC-CIP",
        "NYDFS 23 NYCRR 500",
        "ASD Essential Eight",
        "MITRE ATT&CK",
        "Microsoft Cloud Security Benchmark",
        "CJIS v6",
        "SEC Cyber Rule"
      ],
      "cisChecks": [
        "9.1.4"
      ],
      "mitreMappings": [
        "T1048",
        "T1567",
        "T1530",
        "T1119",
        "T1039",
        "T1052",
        "T1041"
      ],
      "requiredLicences": [
        "Microsoft 365 E5 or E5 Compliance",
        "Microsoft Purview Insider Risk Management add-on",
        "Microsoft 365 E5 Insider Risk Management"
      ],
      "requiredRoles": [
        "Insider Risk Management Admin",
        "Compliance Administrator"
      ],
      "deploymentOrder": 12,
      "importMethod": "powershell-security-compliance",
      "importScript": "scripts/Import-PurviewPolicies.ps1"
    },
    "_notes": {
      "prerequisites": [
        "Microsoft 365 E5 or Insider Risk Management add-on licence required",
        "Audit logging must be enabled and retained (PV11)",
        "HR connector configured for departing employee signals (recommended)",
        "Microsoft Defender for Endpoint integration enabled for device indicators",
        "DLP policies deployed (PV01-PV09) for DLP match triggering events",
        "Privacy settings configured to anonymise user names during investigation"
      ],
      "privacyConsiderations": [
        "Enable pseudonymised (anonymised) usernames in Insider Risk settings",
        "Configure role-based access for investigators",
        "Ensure legal/HR review of monitoring scope before deployment",
        "Document lawful basis for monitoring under GDPR Article 6",
        "Conduct Data Protection Impact Assessment (DPIA) if required"
      ],
      "deploymentSteps": [
        "1. Configure Insider Risk Management settings (privacy, indicators, detection thresholds)",
        "2. Set up HR connector for resignation/termination signals",
        "3. Enable Defender for Endpoint integration for device-level indicators",
        "4. Create the Departing Employee Data Theft policy",
        "5. Create the General Data Leaks policy",
        "6. Create the Security Policy Violations policy",
        "7. Assign investigator roles to the Insider Risk team",
        "8. Monitor alerts and triage cases"
      ],
      "rollbackProcedure": "Disable individual policies via the Insider Risk Management portal. Policies can be paused without deletion."
    },
    "insiderRiskSettings": {
      "portalUrl": "https://compliance.microsoft.com/insiderriskmanagement",
      "globalSettings": {
        "privacySettings": {
          "showAnonymizedVersionsOfUsernames": true,
          "_note": "Anonymise user identities until an investigation is formally opened"
        },
        "policyIndicators": {
          "officeIndicators": {
            "fileDownloadFromSharePoint": true,
            "fileDownloadFromOneDrive": true,
            "fileUploadToPersonalCloud": true,
            "emailSentExternalRecipients": true,
            "emailWithAttachmentsToExternalDomains": true,
            "sharingLinkCreated": true,
            "fileCopiedToRemovableMedia": true,
            "filePrintActivity": true,
            "fileCopiedToClipboard": true,
            "fileCopiedToNetworkShare": true
          },
          "deviceIndicators": {
            "_note": "Requires MDE integration (MDE01-MDE03)",
            "fileMovedToUSBDrive": true,
            "fileCopiedToUSBDrive": true,
            "filePrintedOnNetworkPrinter": true,
            "fileCopiedToCloudSyncFolder": true,
            "browsingToExfiltrationSite": true,
            "usbDeviceConnected": true
          },
          "securityPolicyViolationIndicators": {
            "malwareThreatDetection": true,
            "dlpPolicyMatch": true,
            "disabledSecurityControls": true,
            "bypassedSecurityControls": true
          }
        },
        "detectionThresholds": {
          "useDefaultThresholds": false,
          "customThresholds": {
            "fileDownloadThreshold": {
              "dailyLimit": 50,
              "description": "Alert when user downloads more than 50 files in a day"
            },
            "emailVolumeThreshold": {
              "dailyExternalEmails": 25,
              "description": "Alert when user sends more than 25 emails to external recipients in a day"
            },
            "sharingThreshold": {
              "dailySharingLinks": 20,
              "description": "Alert when user creates more than 20 sharing links in a day"
            }
          }
        },
        "intelligentDetections": {
          "excludedDomains": [
            ".com",
            ".com"
          ],
          "excludedFileTypes": [
            ".log",
            ".tmp"
          ],
          "unusualActivityDetection": true,
          "cumulativeExfiltrationDetection": true
        }
      }
    },
    "policies": [
      {
        "policyName": "PV12-DepartingEmployee-DataTheft",
        "displayName": "PV12 - Departing Employee Data Theft Detection",
        "template": "DepartingEmployeeDataTheft",
        "description": "Detects potential data theft by employees who have submitted resignation or are scheduled for termination. Triggered by HR connector resignation signal.",
        "isEnabled": true,
        "triggeringEvents": [
          {
            "type": "hrConnector",
            "event": "resignation",
            "description": "HR connector signals resignation or termination date"
          },
          {
            "type": "hrConnector",
            "event": "lastDayOfWork",
            "description": "HR connector signals last working day"
          }
        ],
        "activationWindow": {
          "daysBeforeTrigger": 90,
          "daysAfterTrigger": 30,
          "_description": "Monitor activity 90 days before resignation date and 30 days after departure"
        },
        "indicators": [
          "fileDownloadFromSharePoint",
          "fileDownloadFromOneDrive",
          "emailSentExternalRecipients",
          "emailWithAttachmentsToExternalDomains",
          "fileCopiedToRemovableMedia",
          "fileCopiedToCloudSyncFolder",
          "sharingLinkCreated",
          "filePrintActivity"
        ],
        "userScope": {
          "type": "allUsers",
          "_note": "Triggered only when HR connector provides resignation signal"
        },
        "alertSeverity": {
          "low": "1-3 risk indicators",
          "medium": "4-6 risk indicators",
          "high": "7+ risk indicators or cumulative exfiltration detected"
        }
      },
      {
        "policyName": "PV12-GeneralDataLeaks",
        "displayName": "PV12 - General Data Leaks Detection",
        "template": "DataLeaks",
        "description": "Detects potential data leaks through unusual sharing, downloading, or exfiltration patterns. Triggered by DLP policy matches.",
        "isEnabled": true,
        "triggeringEvents": [
          {
            "type": "dlpPolicyMatch",
            "policies": [
              "PV01-DLP-Block-CreditCard-External",
              "PV02-DLP-Block-PII-UKEU-External",
              "PV03-DLP-Block-PHI-HIPAA",
              "PV04-DLP-Block-FinancialData-PCI",
              "PV06-DLP-Block-SourceCode-Credentials",
              "PV07-DLP-Block-Password-Sharing"
            ],
            "severity": [
              "High",
              "Medium"
            ]
          }
        ],
        "indicators": [
          "fileDownloadFromSharePoint",
          "fileDownloadFromOneDrive",
          "emailSentExternalRecipients",
          "fileCopiedToRemovableMedia",
          "fileUploadToPersonalCloud",
          "sharingLinkCreated",
          "fileCopiedToNetworkShare",
          "browsingToExfiltrationSite"
        ],
        "userScope": {
          "type": "allUsers"
        }
      },
      {
        "policyName": "PV12-SecurityPolicyViolations",
        "displayName": "PV12 - Security Policy Violations",
        "template": "SecurityPolicyViolations",
        "description": "Detects users who violate security policies including disabling security controls, browsing blocked sites, or triggering malware detections.",
        "isEnabled": true,
        "triggeringEvents": [
          {
            "type": "securityViolation",
            "events": [
              "dlpPolicyMatch",
              "malwareDetection",
              "securityControlDisabled"
            ]
          }
        ],
        "indicators": [
          "malwareThreatDetection",
          "disabledSecurityControls",
          "bypassedSecurityControls",
          "dlpPolicyMatch",
          "browsingToExfiltrationSite"
        ],
        "userScope": {
          "type": "allUsers"
        }
      }
    ],
    "hrConnectorConfig": {
      "_description": "HR connector configuration for employee lifecycle event signals",
      "connectorType": "HRConnector",
      "dataSource": {
        "type": "csvUpload",
        "fields": [
          "EmailAddress",
          "ResignationDate",
          "LastWorkingDay",
          "PerformanceImprovementPlanStartDate",
          "PerformanceImprovementPlanEndDate",
          "TerminationDate"
        ],
        "uploadFrequency": "daily",
        "_note": "CSV file must be uploaded daily via the HR connector in the Compliance portal or via API"
      }
    }
  },
  {
    "_metadata": {
      "id": "SPO01",
      "title": "Restrict External Sharing - Existing Guests Only",
      "description": "Restricts SharePoint Online and OneDrive for Business external sharing to existing authenticated guest users only. No anonymous links permitted, no new external invitations. Only users already in the directory as guest accounts can access shared content.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "CMMC v2.0",
        "HITRUST CSF v11",
        "ASD Essential Eight",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "7.2.3",
        "7.2.5",
        "7.2.7",
        "7.3.2"
      ],
      "severity": "High",
      "category": "SharePoint Online",
      "deploymentOrder": 1,
      "requiredLicence": "SharePoint Online (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "ExistingExternalUserSharingOnly means only guests already present in your Entra ID directory can access shared content. New external users must be invited through Entra ID B2B first. This is more restrictive than ExternalUserSharingOnly (which allows new invitations) but less restrictive than Disabled (no external sharing). OneDrive sharing level cannot be more permissive than the tenant-level SharePoint setting."
    },
    "steps": [
      {
        "cmdlet": "Set-SPOTenant",
        "parameters": {
          "SharingCapability": "ExistingExternalUserSharingOnly"
        },
        "_notes": "Sets the tenant-wide SharePoint sharing level. Options: Disabled, ExistingExternalUserSharingOnly, ExternalUserSharingOnly, ExternalUserAndGuestSharing. This sets ExistingExternalUserSharingOnly which only permits sharing with guests already in your directory."
      },
      {
        "cmdlet": "Set-SPOSite",
        "parameters": {
          "Identity": "https://-my.sharepoint.com",
          "SharingCapability": "ExistingExternalUserSharingOnly"
        },
        "_notes": "Sets the OneDrive for Business site collection to the same restriction. The OneDrive sharing level cannot exceed the tenant-level setting."
      }
    ],
    "postDeployment": [
      "Get-SPOTenant | Select-Object SharingCapability",
      "Get-SPOSite -Identity 'https://-my.sharepoint.com' | Select-Object SharingCapability",
      "Audit existing external sharing: Get-SPOSite -IncludePersonalSite $true -Limit All | Where-Object {$_.SharingCapability -ne 'Disabled'} | Select-Object Url, SharingCapability",
      "Communicate to users that new external sharing invitations are no longer possible without first adding the guest via Entra ID",
      "Review existing guest accounts: Get-AzureADUser -Filter \"userType eq 'Guest'\" | Select-Object DisplayName, Mail, CreatedDateTime"
    ]
  },
  {
    "_metadata": {
      "id": "SPO02",
      "title": "Set Default Sharing Link - Internal Only",
      "description": "Changes the default sharing link type from 'Anyone with the link' to 'People in your organization'. Sets the default permission to View-only. Users can still choose other link types, but the default prevents accidental oversharing.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "CMMC v2.0",
        "HITRUST CSF v11",
        "ASD Essential Eight",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "7.2.4"
      ],
      "severity": "Medium",
      "category": "SharePoint Online",
      "deploymentOrder": 2,
      "requiredLicence": "SharePoint Online (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "This changes the DEFAULT link type only. Users can still manually select other link types (specific people, anyone, etc.) when sharing. DefaultSharingLinkType: Internal means 'People in your organization' is pre-selected. DefaultLinkPermission: View means view-only is the default permission (users must explicitly choose Edit). This reduces accidental oversharing without blocking legitimate use cases."
    },
    "cmdlet": "Set-SPOTenant",
    "parameters": {
      "DefaultSharingLinkType": "Internal",
      "DefaultLinkPermission": "View"
    },
    "postDeployment": [
      "Get-SPOTenant | Select-Object DefaultSharingLinkType, DefaultLinkPermission",
      "Verify in the SharePoint UI that the default sharing dialog shows 'People in <org>' and 'Can view' as defaults",
      "Communicate to users that the default sharing behavior has changed; they can still select other link types as needed",
      "Consider also setting per-site defaults for sensitive site collections: Set-SPOSite -Identity <url> -DefaultSharingLinkType Internal -DefaultLinkPermission View"
    ]
  },
  {
    "_metadata": {
      "id": "SPO03",
      "title": "Enable Anonymous Link Expiry - 30 Days",
      "description": "Sets anonymous (Anyone) sharing links to automatically expire after 30 days. Prevents indefinite anonymous access to shared files and folders. If anonymous sharing is permitted, this ensures temporary shares do not persist forever.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "CMMC v2.0",
        "HITRUST CSF v11",
        "ASD Essential Eight",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "7.2.6"
      ],
      "severity": "Medium",
      "category": "SharePoint Online",
      "deploymentOrder": 3,
      "requiredLicence": "SharePoint Online (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "This setting only applies if anonymous (Anyone) sharing links are permitted by the tenant SharingCapability setting. If SharingCapability is set to ExistingExternalUserSharingOnly or Disabled, anonymous links are already blocked and this setting has no effect. The 30-day expiry is a balance between usability and security. CIS recommends setting an expiration. After expiry, the link becomes invalid and the recipient must request a new share."
    },
    "cmdlet": "Set-SPOTenant",
    "parameters": {
      "RequireAnonymousLinksExpireInDays": 30
    },
    "postDeployment": [
      "Get-SPOTenant | Select-Object RequireAnonymousLinksExpireInDays",
      "Verify the setting applies to new anonymous links created after deployment",
      "Note: This does NOT retroactively expire existing anonymous links; only new links created after this setting is applied",
      "If stricter control is needed, reduce to 14 or 7 days, or disable anonymous sharing entirely via SPO01"
    ]
  },
  {
    "_metadata": {
      "id": "SPO04",
      "title": "Block Download on Unmanaged Devices",
      "description": "Configures SharePoint Online to allow limited (browser-only, view-only) access from unmanaged devices while blocking downloads, print, and sync. Prevents corporate data from being saved to personal or unmanaged devices. Full enforcement requires a complementary Conditional Access policy.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "CMMC v2.0",
        "HITRUST CSF v11",
        "ASD Essential Eight",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "7.2.2",
        "7.2.10"
      ],
      "severity": "High",
      "category": "SharePoint Online",
      "deploymentOrder": 4,
      "requiredLicence": "Microsoft Entra ID P1 (for Conditional Access) + SharePoint Online",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "IMPORTANT: Set-SPOTenant -ConditionalAccessPolicy AllowLimitedAccess enables the SharePoint-side enforcement, but full protection requires an Entra ID Conditional Access policy targeting SharePoint Online and OneDrive with a 'Use app enforced restrictions' session control. Without the CA policy, the SPO setting alone may not fully enforce device-based restrictions. Managed devices are those that are Entra ID joined, hybrid joined, or Intune compliant."
    },
    "cmdlet": "Set-SPOTenant",
    "parameters": {
      "ConditionalAccessPolicy": "AllowLimitedAccess",
      "AllowDownloadingNonWebViewableFiles": false
    },
    "conditionalAccessRequirement": {
      "_notes": "A Conditional Access policy must also be created in Entra ID to fully enforce this control",
      "targetApps": [
        "Office 365 SharePoint Online"
      ],
      "sessionControl": "Use app enforced restrictions",
      "conditions": {
        "deviceState": "All devices except compliant and hybrid Azure AD joined"
      },
      "grantControls": "Block or require compliant device"
    },
    "postDeployment": [
      "Get-SPOTenant | Select-Object ConditionalAccessPolicy, AllowDownloadingNonWebViewableFiles",
      "Create a Conditional Access policy in Entra ID: Target SharePoint Online > Session > Use app enforced restrictions",
      "Test from an unmanaged device: user should be able to view files in browser but not download, print, or sync",
      "Test from a managed device: full access should be available",
      "Note: Some file types (e.g., .pdf) may still be viewable in browser even with download blocked"
    ]
  },
  {
    "_metadata": {
      "id": "SPO05",
      "title": "Disable Infected File Download",
      "description": "Prevents users from downloading files that have been flagged as infected by Microsoft Defender for Office 365 in SharePoint Online and OneDrive for Business. Users will see a warning that the file is infected and cannot download it.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "CMMC v2.0",
        "HITRUST CSF v11",
        "ASD Essential Eight",
        "Microsoft Cloud Security Benchmark",
        "MITRE ATT&CK T1080"
      ],
      "cisChecks": [
        "7.2.8"
      ],
      "severity": "High",
      "category": "SharePoint Online",
      "deploymentOrder": 5,
      "requiredLicence": "SharePoint Online (included with Microsoft 365). Defender for Office 365 enhances scanning.",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "By default, SharePoint Online allows users to download files flagged as infected (with a warning). This setting blocks the download entirely. Files are scanned asynchronously after upload; there may be a brief window before scanning completes. This works with both EOP (basic) and Defender for Office 365 (advanced) scanning. DEF07 (EnableATPForSPOTeamsODB) should be enabled for enhanced scanning capabilities."
    },
    "cmdlet": "Set-SPOTenant",
    "parameters": {
      "DisallowInfectedFileDownload": true
    },
    "postDeployment": [
      "Get-SPOTenant | Select-Object DisallowInfectedFileDownload",
      "Verify DEF07 (Defender for SharePoint, OneDrive, Teams) is also enabled for enhanced malware scanning",
      "Test by uploading an EICAR test file to a SharePoint document library and attempting to download it after scanning completes",
      "Note: Scanning is asynchronous; newly uploaded files may be downloadable for a brief period before scanning completes",
      "Admins can still access infected files via SharePoint admin tools if needed for investigation"
    ]
  },
  {
    "_metadata": {
      "id": "SPO06",
      "title": "Enable Entra ID B2B Integration",
      "description": "Enables SharePoint and OneDrive integration with Entra ID (Azure AD) B2B. When enabled, all external sharing creates Entra ID guest accounts, making external users subject to Conditional Access policies, access reviews, and centralized identity governance.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "CMMC v2.0",
        "HITRUST CSF v11",
        "ASD Essential Eight",
        "NYDFS 23 NYCRR 500",
        "FFIEC-CAT",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "7.2.1"
      ],
      "severity": "High",
      "category": "SharePoint Online",
      "deploymentOrder": 6,
      "requiredLicence": "SharePoint Online (included with Microsoft 365) + Entra ID P1 for Conditional Access enforcement",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "Without B2B integration, SharePoint uses its own ad-hoc sharing mechanism which does not create Entra ID guest accounts. This means external users bypass Conditional Access policies, MFA requirements, and access reviews. Enabling B2B integration ensures all external access is governed by your Entra ID security policies. IMPORTANT: This is a one-way setting. Once enabled, it cannot be disabled via PowerShell; you must contact Microsoft Support to revert. Existing ad-hoc external users will be migrated to Entra ID B2B guest accounts."
    },
    "cmdlet": "Set-SPOTenant",
    "parameters": {
      "EnableAzureADB2BIntegration": true
    },
    "postDeployment": [
      "Get-SPOTenant | Select-Object EnableAzureADB2BIntegration",
      "IMPORTANT: This setting is ONE-WAY. Once enabled, it cannot be disabled without contacting Microsoft Support.",
      "Verify external users now appear as Guest accounts in Entra ID: Get-AzureADUser -Filter \"userType eq 'Guest'\"",
      "Configure Conditional Access policies to apply to guest users (e.g., require MFA for guests)",
      "Set up Entra ID Access Reviews for guest accounts to ensure regular review of external access",
      "Existing ad-hoc external users will be converted to B2B guest accounts automatically"
    ]
  },
  {
    "_metadata": {
      "id": "SPO07",
      "title": "Restrict External Sharing - Organization Accounts Only",
      "description": "Restricts SharePoint Online external sharing to authenticated external users with organizational accounts only (no anonymous links, no personal Microsoft accounts). Requires the invited email address to match the accepting account, preventing invitation forwarding.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "HITRUST CSF v11",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "7.2.9"
      ],
      "severity": "Medium",
      "category": "SharePoint Online",
      "deploymentOrder": 7,
      "requiredLicence": "SharePoint Online (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "ExternalUserSharingOnly allows new external invitations but blocks anonymous (Anyone) links. RequireAcceptingAccountMatchInvitedAccount ensures the person accepting the invitation is the same person who was invited (prevents forwarded invitations from being accepted by unintended recipients). This is an alternative to SPO01 when the business needs to invite new external users but wants to prevent anonymous access and invitation forwarding."
    },
    "steps": [
      {
        "cmdlet": "Set-SPOTenant",
        "parameters": {
          "SharingCapability": "ExternalUserSharingOnly",
          "RequireAcceptingAccountMatchInvitedAccount": true
        },
        "_notes": "ExternalUserSharingOnly allows new and existing external users but blocks anonymous links. RequireAcceptingAccountMatchInvitedAccount prevents invitation forwarding."
      }
    ],
    "postDeployment": [
      "Get-SPOTenant | Select-Object SharingCapability, RequireAcceptingAccountMatchInvitedAccount",
      "Verify users can share with external organizational accounts but cannot create anonymous links",
      "Test invitation forwarding prevention: share a file with user A, forward the invitation to user B, confirm B cannot accept it",
      "Note: This is LESS restrictive than SPO01 (ExistingExternalUserSharingOnly) as it allows new invitations",
      "Consider combining with SPO06 (Entra ID B2B) to ensure all external users are governed by Conditional Access"
    ]
  },
  {
    "_metadata": {
      "id": "SPO08",
      "title": "Require Managed Device for OneDrive Sync",
      "description": "Restricts OneDrive and SharePoint file sync to devices that are domain-joined to specific Active Directory domains or Intune-compliant. Prevents the OneDrive sync client from syncing corporate data to unmanaged personal devices.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "CMMC v2.0",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "HITRUST CSF v11",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "7.2.10"
      ],
      "severity": "High",
      "category": "SharePoint Online",
      "deploymentOrder": 8,
      "requiredLicence": "SharePoint Online + Entra ID P1 (for device management)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "AllowedDomainListForSyncClient restricts which AD domain GUIDs can sync. The GUID is your Active Directory domain GUID (not the Entra ID tenant ID). Retrieve it with: (Get-ADDomain).ObjectGUID. For Intune-only environments, use TenantRestrictionEnabled and IsUnmanagedSyncClientRestricted instead. SyncClientRestrictionType: DomainRestriction enforces the domain GUID list. Users on non-domain-joined devices will see the sync button but syncing will fail with an error."
    },
    "cmdlet": "Set-SPOTenant",
    "parameters": {
      "OneDriveStorageQuota": 1048576,
      "AllowedDomainListForSyncClient": [],
      "BlockMacSync": false,
      "IsUnmanagedSyncClientForTenantRestricted": true
    },
    "postDeployment": [
      "Get-SPOTenant | Select-Object AllowedDomainListForSyncClient, IsUnmanagedSyncClientForTenantRestricted",
      "Retrieve your AD domain GUID: PowerShell (on-premises AD): (Get-ADDomain).ObjectGUID",
      "Replace  with the actual Active Directory domain GUID",
      "Test from an unmanaged device: the OneDrive sync client should fail to sync with an error message",
      "Test from a managed (domain-joined) device: syncing should work normally",
      "If using multiple AD domains or forests, add all domain GUIDs to the AllowedDomainListForSyncClient array",
      "For Mac devices, set BlockMacSync to true if Macs are not managed in your environment"
    ]
  },
  {
    "_metadata": {
      "id": "SPO09",
      "title": "Enable Modern Authentication for SharePoint Online",
      "description": "Disables legacy authentication protocols for SharePoint Online by setting LegacyAuthProtocolsEnabled to false. This forces all SharePoint Online connections to use Modern Authentication (OAuth 2.0), which supports MFA, Conditional Access, and token-based authentication.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "CMMC v2.0",
        "HITRUST CSF v11",
        "NYDFS 23 NYCRR 500",
        "FFIEC-CAT",
        "ASD Essential Eight",
        "Microsoft Cloud Security Benchmark",
        "MITRE ATT&CK T1078"
      ],
      "cisChecks": [
        "7.3.1"
      ],
      "severity": "Critical",
      "category": "SharePoint Online",
      "deploymentOrder": 9,
      "requiredLicence": "SharePoint Online (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "Legacy authentication protocols transmit credentials without MFA support and bypass Conditional Access policies. Setting LegacyAuthProtocolsEnabled to false blocks legacy auth for SharePoint Online. IMPORTANT: Ensure all clients (Office desktop, mobile apps, third-party apps) support modern auth before disabling legacy auth. Office 2013 requires a registry key to enable modern auth. Office 2016+ supports modern auth natively. Some automated scripts using SharePoint CSOM may need to be updated to use modern auth patterns."
    },
    "cmdlet": "Set-SPOTenant",
    "parameters": {
      "LegacyAuthProtocolsEnabled": false
    },
    "postDeployment": [
      "Get-SPOTenant | Select-Object LegacyAuthProtocolsEnabled",
      "Audit legacy auth usage before deployment: Review Entra ID sign-in logs filtered by clientApp != 'Browser' and clientApp != 'Mobile Apps and Desktop clients'",
      "Ensure Office 2016 or later is deployed to all workstations",
      "For Office 2013: Enable modern auth via registry key HKCU\\Software\\Microsoft\\Office\\15.0\\Common\\Identity\\EnableADAL = 1",
      "Update any automated scripts or third-party apps that use SharePoint CSOM to use modern auth (MSAL library)",
      "Monitor Entra ID sign-in logs for legacy auth failures after deployment"
    ]
  },
  {
    "_metadata": {
      "id": "SPO10",
      "title": "Restrict SharePoint Online Access by IP Range",
      "description": "Configures IP-based access restrictions for SharePoint Online. Only allows access from specified corporate IP ranges (e.g., office egress IPs, VPN endpoints). All access from non-listed IP addresses is blocked.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "CMMC v2.0",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "HITRUST CSF v11",
        "NYDFS 23 NYCRR 500",
        "NERC-CIP",
        "TSA Security Directive",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "7.2.11"
      ],
      "severity": "High",
      "category": "SharePoint Online",
      "deploymentOrder": 10,
      "requiredLicence": "SharePoint Online (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "CAUTION: IP-based restrictions can lock out users working remotely unless VPN egress IPs are included. Before enabling IPAddressEnforcement, ensure ALL corporate egress IP addresses, VPN endpoints, and any required third-party service IPs are listed in IPAddressAllowList. Consider using Entra ID Conditional Access with Named Locations as a more flexible alternative. IPAddressAllowList supports IPv4 CIDR notation (e.g., 203.0.113.0/24). Test thoroughly with IPAddressEnforcement: false first (logging only) before setting to true."
    },
    "cmdlet": "Set-SPOTenant",
    "parameters": {
      "IPAddressAllowList": "",
      "IPAddressEnforcement": true,
      "IPAddressWACTokenLifetime": 15
    },
    "postDeployment": [
      "Get-SPOTenant | Select-Object IPAddressAllowList, IPAddressEnforcement, IPAddressWACTokenLifetime",
      "Replace  with actual CIDR ranges, e.g., '203.0.113.0/24,198.51.100.0/24'",
      "IMPORTANT: Test with IPAddressEnforcement: $false first to verify your IP list is complete",
      "Include all: office egress IPs, VPN concentrator public IPs, remote office IPs, any third-party service IPs that need SPO access",
      "IPAddressWACTokenLifetime: 15 means Office Online sessions expire after 15 minutes when accessed from allowed IPs",
      "If remote workers without VPN need access, consider Entra ID Conditional Access with Named Locations instead of SPO IP restrictions",
      "Monitor access failures after enabling enforcement to identify missing IP ranges"
    ]
  },
  {
    "_metadata": {
      "id": "TEA01",
      "title": "Disable Anonymous Meeting Join",
      "description": "Prevents anonymous (unauthenticated) users from joining Microsoft Teams meetings. All meeting participants must authenticate with a valid identity. This prevents unauthorized access to meetings containing sensitive discussions.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "CMMC v2.0",
        "HITRUST CSF v11",
        "ASD Essential Eight",
        "NYDFS 23 NYCRR 500",
        "FFIEC-CAT",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "8.1.1",
        "8.5.1",
        "8.5.9"
      ],
      "severity": "High",
      "category": "Microsoft Teams",
      "deploymentOrder": 1,
      "requiredLicence": "Microsoft Teams (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "AllowAnonymousUsersToJoinMeeting: false prevents any unauthenticated user from joining meetings. This applies to the Global (Org-wide default) policy. External authenticated users (federated users, guests) can still join if permitted by other policies. IMPACT: External participants who do not have a Microsoft account or guest account will be unable to join meetings. If your organization regularly meets with external parties who lack Microsoft accounts, consider using TEA02/TEA03 (lobby controls) instead of fully blocking anonymous join."
    },
    "cmdlet": "Set-CsTeamsMeetingPolicy",
    "parameters": {
      "Identity": "Global",
      "AllowAnonymousUsersToJoinMeeting": false,
      "AllowAnonymousUsersToStartMeeting": false
    },
    "postDeployment": [
      "Get-CsTeamsMeetingPolicy -Identity Global | Select-Object AllowAnonymousUsersToJoinMeeting, AllowAnonymousUsersToStartMeeting",
      "Communicate to users: external participants without Microsoft accounts will need to be invited as guests or use federated access",
      "If specific departments need to allow anonymous join (e.g., webinars, public events), create a separate meeting policy with anonymous join enabled and assign it to those users",
      "Test by sharing a meeting link with an unauthenticated user and verify they cannot join"
    ]
  },
  {
    "_metadata": {
      "id": "TEA02",
      "title": "Enable Meeting Lobby for All External Users",
      "description": "Configures Teams meetings so that only internal users (same organization, excluding guests) can bypass the lobby. All external participants including guests, federated users, and PSTN dial-in callers must wait in the lobby until admitted by the meeting organizer.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "CMMC v2.0",
        "HITRUST CSF v11",
        "ASD Essential Eight",
        "NYDFS 23 NYCRR 500",
        "FFIEC-CAT",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "8.1.2",
        "8.5.3",
        "8.5.9"
      ],
      "severity": "High",
      "category": "Microsoft Teams",
      "deploymentOrder": 2,
      "requiredLicence": "Microsoft Teams (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "AutoAdmittedUsers: EveryoneInCompanyExcludingGuests means only users in your organization (not guests) bypass the lobby. AllowPSTNUsersToBypassLobby: false ensures dial-in callers also wait in the lobby. This is important because PSTN callers cannot be visually identified. Meeting organizers will need to manually admit external participants from the lobby."
    },
    "cmdlet": "Set-CsTeamsMeetingPolicy",
    "parameters": {
      "Identity": "Global",
      "AutoAdmittedUsers": "EveryoneInCompanyExcludingGuests",
      "AllowPSTNUsersToBypassLobby": false
    },
    "postDeployment": [
      "Get-CsTeamsMeetingPolicy -Identity Global | Select-Object AutoAdmittedUsers, AllowPSTNUsersToBypassLobby",
      "Test by joining a meeting as an external user and verify you are held in the lobby",
      "Test PSTN dial-in: call into a meeting and verify the caller is held in the lobby",
      "Communicate to meeting organizers: they must admit external participants from the lobby",
      "If specific users need different lobby behavior, create a custom meeting policy and assign it to those users"
    ]
  },
  {
    "_metadata": {
      "id": "TEA03",
      "title": "Restrict Lobby Bypass to Internal Users Only",
      "description": "Configures the Global Teams meeting policy so only users within the same organization (excluding guests) can bypass the meeting lobby. All external users, guest accounts, and federated users must wait in the lobby. This is the most restrictive lobby setting that still allows internal users to join seamlessly.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "CMMC v2.0",
        "HITRUST CSF v11",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "8.1.2",
        "8.5.3"
      ],
      "severity": "High",
      "category": "Microsoft Teams",
      "deploymentOrder": 3,
      "requiredLicence": "Microsoft Teams (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "This policy complements TEA02 by reinforcing the same setting. EveryoneInCompanyExcludingGuests is the recommended CIS value. Other options: EveryoneInCompany (includes guests), EveryoneInSameAndFederatedCompany (includes federated), Everyone (no lobby), OrganizerOnly (most restrictive - only organizer bypasses). For maximum security, use OrganizerOnly, but this impacts internal user experience."
    },
    "cmdlet": "Set-CsTeamsMeetingPolicy",
    "parameters": {
      "Identity": "Global",
      "AutoAdmittedUsers": "EveryoneInCompanyExcludingGuests"
    },
    "postDeployment": [
      "Get-CsTeamsMeetingPolicy -Identity Global | Select-Object AutoAdmittedUsers",
      "Verify internal users can join meetings directly without waiting in the lobby",
      "Verify guest users are held in the lobby until admitted",
      "Verify federated users (from other M365 tenants) are held in the lobby",
      "For even stricter control, consider OrganizerOnly which requires the organizer to admit all participants"
    ]
  },
  {
    "_metadata": {
      "id": "TEA04",
      "title": "Disable External File Sharing via Unapproved Cloud Storage",
      "description": "Disables all third-party cloud storage provider integrations in Microsoft Teams. Blocks Dropbox, Box, Google Drive, ShareFile, and Egnyte. File sharing in Teams is restricted to SharePoint Online and OneDrive for Business only, ensuring all files remain within managed Microsoft 365 storage.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "HITRUST CSF v11",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "8.2.3"
      ],
      "severity": "Medium",
      "category": "Microsoft Teams",
      "deploymentOrder": 4,
      "requiredLicence": "Microsoft Teams (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "Third-party cloud storage integrations allow users to share files from external providers within Teams. This bypasses DLP policies, retention policies, and audit logging that apply to SharePoint/OneDrive. Disabling these providers ensures all files shared in Teams are stored in managed Microsoft 365 storage where governance controls apply. This does not prevent users from sharing links to external cloud storage via chat messages."
    },
    "cmdlet": "Set-CsTeamsClientConfiguration",
    "parameters": {
      "Identity": "Global",
      "AllowDropBox": false,
      "AllowBox": false,
      "AllowGoogleDrive": false,
      "AllowShareFile": false,
      "AllowEgnyte": false
    },
    "postDeployment": [
      "Get-CsTeamsClientConfiguration | Select-Object AllowDropBox, AllowBox, AllowGoogleDrive, AllowShareFile, AllowEgnyte",
      "Verify that third-party storage options no longer appear in the Teams file picker",
      "Communicate to users that file sharing in Teams is now restricted to SharePoint/OneDrive",
      "If specific teams need third-party storage (e.g., partnerships), note that this is a tenant-wide setting and cannot be scoped to specific users",
      "Users can still paste links to external storage in chat; consider DLP policies to detect and block external storage URLs if needed"
    ]
  },
  {
    "_metadata": {
      "id": "TEA05",
      "title": "Disable Unmanaged (Personal) Teams Communication",
      "description": "Blocks communication with external users on unmanaged (personal/free) Teams accounts. Prevents both outbound and inbound communication with Teams consumer accounts. Only managed organizational Teams accounts can communicate with your users.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "HITRUST CSF v11",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "8.2.4"
      ],
      "severity": "Medium",
      "category": "Microsoft Teams",
      "deploymentOrder": 5,
      "requiredLicence": "Microsoft Teams (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "Teams consumer accounts (personal/free Teams) are not managed by any organization and have no IT governance. Allowing communication with these accounts creates a phishing and social engineering risk as the identity cannot be verified. AllowTeamsConsumer: false blocks outbound communication to personal Teams accounts. AllowTeamsConsumerInbound: false blocks inbound messages from personal Teams accounts. This does NOT affect communication with other Microsoft 365 tenants (that is controlled by federation settings in TEA06)."
    },
    "cmdlet": "Set-CsTeamsClientConfiguration",
    "parameters": {
      "Identity": "Global",
      "AllowTeamsConsumer": false,
      "AllowTeamsConsumerInbound": false
    },
    "postDeployment": [
      "Get-CsTeamsClientConfiguration | Select-Object AllowTeamsConsumer, AllowTeamsConsumerInbound",
      "Verify users cannot search for or communicate with personal Teams accounts",
      "Verify inbound messages from personal Teams accounts are blocked",
      "This setting is separate from federation (TEA06) which controls communication with other M365 tenants",
      "If specific users need to communicate with personal Teams accounts, this setting is tenant-wide and cannot be scoped per-user"
    ]
  },
  {
    "_metadata": {
      "id": "TEA06",
      "title": "Restrict External Access / Federation",
      "description": "Restricts or disables Teams federation (external access) to prevent communication with users in other Microsoft 365 tenants. Provides two options: fully disable federation, or use an allow-list to permit only specific approved partner domains.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "CMMC v2.0",
        "HITRUST CSF v11",
        "ASD Essential Eight",
        "Microsoft Cloud Security Benchmark",
        "MITRE ATT&CK T1199"
      ],
      "cisChecks": [
        "8.4.1"
      ],
      "severity": "High",
      "category": "Microsoft Teams",
      "deploymentOrder": 6,
      "requiredLicence": "Microsoft Teams (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "Federation (external access) allows users to chat and call users in other M365 tenants. With open federation (default), ANY external M365 tenant can communicate with your users. This creates a significant phishing/social engineering attack surface. Option A disables all federation. Option B uses AllowedDomains to permit only specific trusted partner domains. Choose based on business requirements. AllowTeamsConsumer is also set to false to block personal Teams accounts (complements TEA05)."
    },
    "options": {
      "optionA_DisableAllFederation": {
        "_notes": "Use this option for maximum security. Blocks all external Teams communication.",
        "cmdlet": "Set-CsTenantFederationConfiguration",
        "parameters": {
          "AllowFederatedUsers": false,
          "AllowTeamsConsumer": false,
          "AllowTeamsConsumerInbound": false,
          "AllowPublicUsers": false
        }
      },
      "optionB_AllowListOnly": {
        "_notes": "Use this option if the business needs to communicate with specific partner organizations. Only domains in AllowedDomains can federate.",
        "cmdlet": "Set-CsTenantFederationConfiguration",
        "parameters": {
          "AllowFederatedUsers": true,
          "AllowedDomainsAsAList": [
            {
              "Domain": ""
            },
            {
              "Domain": ""
            }
          ],
          "AllowTeamsConsumer": false,
          "AllowTeamsConsumerInbound": false,
          "AllowPublicUsers": false
        }
      }
    },
    "postDeployment": [
      "Get-CsTenantFederationConfiguration | Format-List",
      "If using Option B, verify allowed domains: (Get-CsTenantFederationConfiguration).AllowedDomains",
      "Test by attempting to chat with a user in a non-allowed external tenant and verify the message is blocked",
      "Test by attempting to chat with a user in an allowed domain (Option B) and verify it succeeds",
      "Review and update the allowed domains list quarterly as business partnerships change"
    ]
  },
  {
    "_metadata": {
      "id": "TEA07",
      "title": "Disable Automatic Guest Access in Teams",
      "description": "Restricts guest access in Microsoft Teams to prevent automatic guest user creation. When disabled, external users cannot be directly added as guests to Teams. Guest access must be explicitly managed through Entra ID B2B invitation workflows with appropriate approval processes.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "HITRUST CSF v11",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "8.5.2"
      ],
      "severity": "Medium",
      "category": "Microsoft Teams",
      "deploymentOrder": 7,
      "requiredLicence": "Microsoft Teams (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "When AllowGuestUser is true (default), team owners can invite external users as guests, which creates Entra ID guest accounts automatically. Setting this to false prevents team owners from adding guests directly. For organizations that need controlled guest access, consider using Entra ID entitlement management with access packages and approval workflows instead of fully disabling guest access. This is a tenant-wide Teams client configuration setting."
    },
    "cmdlet": "Set-CsTeamsClientConfiguration",
    "parameters": {
      "Identity": "Global",
      "AllowGuestUser": false
    },
    "postDeployment": [
      "Get-CsTeamsClientConfiguration | Select-Object AllowGuestUser",
      "Verify team owners can no longer add external users as guests directly in Teams",
      "If controlled guest access is needed, configure Entra ID entitlement management with access packages and approval workflows",
      "Review existing guest users: Get-AzureADUser -Filter \"userType eq 'Guest'\" | Select-Object DisplayName, Mail",
      "Existing guests already in teams will retain access; this only prevents NEW guest additions via Teams",
      "Consider also reviewing: Set-MicrosoftTeamsGuestCallingConfiguration and Set-CsTeamsGuestMeetingConfiguration for granular guest controls"
    ]
  },
  {
    "_metadata": {
      "id": "TEA08",
      "title": "Restrict Meeting Presenters - Organizer Only (User Override)",
      "description": "Sets the default presenter role in Teams meetings to 'Organizer Only' with user override permitted. Only the meeting organizer and co-organizers can present (share screen, control slides) by default. Other participants must be promoted to presenter by the organizer. Meeting organizers can change this setting per-meeting if needed.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "PCI DSS v4.0",
        "HIPAA",
        "NYDFS 23 NYCRR 500",
        "FFIEC-CAT",
        "CMMC v2.0",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "HITRUST CSF v11",
        "ASD Essential Eight",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "8.5.4",
        "8.5.8"
      ],
      "severity": "Medium",
      "category": "Microsoft Teams",
      "deploymentOrder": 8,
      "requiredLicence": "Microsoft Teams (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "DesignatedPresenterRoleMode: OrganizerOnlyUserOverride sets the default to organizer-only but allows the meeting organizer to change presenter permissions per-meeting via meeting options. This balances security (prevents unauthorized screen sharing) with flexibility. Other options: EveryoneUserOverride (default, least secure), EveryoneInCompanyUserOverride, OrganizerOnlyUserOverride (recommended). For maximum enforcement without user override, consider using meeting templates with locked settings."
    },
    "cmdlet": "Set-CsTeamsMeetingPolicy",
    "parameters": {
      "Identity": "Global",
      "DesignatedPresenterRoleMode": "OrganizerOnlyUserOverride"
    },
    "postDeployment": [
      "Get-CsTeamsMeetingPolicy -Identity Global | Select-Object DesignatedPresenterRoleMode",
      "Verify new meetings default to 'Only me' (organizer) as presenter in meeting options",
      "Verify meeting organizers can still change the presenter setting per-meeting via meeting options",
      "Communicate to users: attendees must be promoted to presenter by the organizer to share screen",
      "Test: join a meeting as an attendee and verify the 'Share' button is not available until promoted to presenter"
    ]
  },
  {
    "_metadata": {
      "id": "TEA09",
      "title": "Restrict Meeting Recording - Internal Organizers Only",
      "description": "Configures Teams meeting recording so that only internal meeting organizers and co-organizers can initiate recordings. Cloud recording is enabled for internal use but restricted to prevent external participants from recording meetings. Recording storage remains within the organization's OneDrive/SharePoint.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "HITRUST CSF v11",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "8.5.5"
      ],
      "severity": "Medium",
      "category": "Microsoft Teams",
      "deploymentOrder": 9,
      "requiredLicence": "Microsoft Teams (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "AllowCloudRecording: true enables recording for internal organizers. AllowRecordingStorageOutsideRegion: false ensures recordings are stored within the organization's data residency region. RecordingStorageMode: OneDriveForBusiness stores recordings in the organizer's OneDrive. External participants (guests, federated users) do not have recording permissions when these settings are applied. The recording button is only available to the meeting organizer and co-organizers."
    },
    "cmdlet": "Set-CsTeamsMeetingPolicy",
    "parameters": {
      "Identity": "Global",
      "AllowCloudRecording": true,
      "AllowRecordingStorageOutsideRegion": false,
      "RecordingStorageMode": "OneDriveForBusiness",
      "AllowMeetingRegistration": true,
      "AllowCartCaptionsAndTranscriptions": true,
      "AllowTranscription": true
    },
    "postDeployment": [
      "Get-CsTeamsMeetingPolicy -Identity Global | Select-Object AllowCloudRecording, AllowRecordingStorageOutsideRegion, RecordingStorageMode",
      "Verify internal organizers can start recordings in meetings",
      "Verify external/guest participants do not see the recording button",
      "Recordings are stored in the organizer's OneDrive > Recordings folder",
      "Review data residency requirements: AllowRecordingStorageOutsideRegion: false ensures recordings stay in-region",
      "If recording must be fully disabled for all users, set AllowCloudRecording: false"
    ]
  },
  {
    "_metadata": {
      "id": "TEA10",
      "title": "Disable Teams Channel Email Addresses",
      "description": "Disables the ability to send email to Teams channel email addresses. Channel email bypasses Exchange Online Protection (anti-spam, anti-malware, Safe Attachments, Safe Links, transport rules, DLP) because messages are delivered directly to the Teams channel without passing through the email security stack.",
      "frameworks": [
        "CIS Microsoft 365 v3.1.0",
        "NIST SP 800-53 Rev 5",
        "NIS2",
        "DORA",
        "ISO 27001:2022",
        "UK NCSC CAF v3.2",
        "SOC 2",
        "FedRAMP Moderate",
        "GDPR (EU) 2016/679",
        "HITRUST CSF v11",
        "Microsoft Cloud Security Benchmark"
      ],
      "cisChecks": [
        "8.5.6"
      ],
      "severity": "Medium",
      "category": "Microsoft Teams",
      "deploymentOrder": 10,
      "requiredLicence": "Microsoft Teams (included with Microsoft 365)",
      "version": "2.0",
      "lastUpdated": "2026-02-27",
      "_notes": "Teams channels can have email addresses (e.g., channelname.<guid>@<tenant>.onmicrosoft.com) that allow anyone to send email content to a channel. This email BYPASSES all Exchange Online Protection scanning including anti-spam, anti-malware, Safe Attachments, Safe Links, and DLP policies. This creates a significant security gap where malicious content can reach users without any inspection. Setting AllowEmailIntoChannel to false removes this capability."
    },
    "cmdlet": "Set-CsTeamsClientConfiguration",
    "parameters": {
      "Identity": "Global",
      "AllowEmailIntoChannel": false
    },
    "postDeployment": [
      "Get-CsTeamsClientConfiguration | Select-Object AllowEmailIntoChannel",
      "Verify the 'Get email address' option no longer appears in Teams channel settings",
      "Existing channel email addresses will stop receiving email after this setting is applied",
      "If specific channels need email ingestion (e.g., support ticket channels), consider alternatives such as Power Automate flows that process email through Exchange Online first",
      "Communicate to users that email-to-channel functionality is being disabled for security reasons"
    ]
  }
]