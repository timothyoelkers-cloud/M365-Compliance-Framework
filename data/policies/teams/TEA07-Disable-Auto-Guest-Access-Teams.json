{
  "_metadata": {
    "id": "TEA07",
    "title": "Disable Automatic Guest Access in Teams",
    "description": "Restricts guest access in Microsoft Teams to prevent automatic guest user creation. When disabled, external users cannot be directly added as guests to Teams. Guest access must be explicitly managed through Entra ID B2B invitation workflows with appropriate approval processes.",
    "frameworks": [
      "CIS Microsoft 365 v3.1.0",
      "NIST SP 800-53 Rev 5",
      "NIS2",
      "DORA",
      "ISO 27001:2022",
      "UK NCSC CAF v3.2",
      "SOC 2",
      "FedRAMP Moderate",
      "GDPR (EU) 2016/679",
      "HITRUST CSF v11",
      "Microsoft Cloud Security Benchmark"
    ],
    "cisChecks": ["8.5.2"],
    "severity": "Medium",
    "category": "Microsoft Teams",
    "deploymentOrder": 7,
    "requiredLicence": "Microsoft Teams (included with Microsoft 365)",
    "version": "2.0",
    "lastUpdated": "2026-02-27",
    "_notes": "When AllowGuestUser is true (default), team owners can invite external users as guests, which creates Entra ID guest accounts automatically. Setting this to false prevents team owners from adding guests directly. For organizations that need controlled guest access, consider using Entra ID entitlement management with access packages and approval workflows instead of fully disabling guest access. This is a tenant-wide Teams client configuration setting."
  },
  "cmdlet": "Set-CsTeamsClientConfiguration",
  "parameters": {
    "Identity": "Global",
    "AllowGuestUser": false
  },
  "postDeployment": [
    "Get-CsTeamsClientConfiguration | Select-Object AllowGuestUser",
    "Verify team owners can no longer add external users as guests directly in Teams",
    "If controlled guest access is needed, configure Entra ID entitlement management with access packages and approval workflows",
    "Review existing guest users: Get-AzureADUser -Filter \"userType eq 'Guest'\" | Select-Object DisplayName, Mail",
    "Existing guests already in teams will retain access; this only prevents NEW guest additions via Teams",
    "Consider also reviewing: Set-MicrosoftTeamsGuestCallingConfiguration and Set-CsTeamsGuestMeetingConfiguration for granular guest controls"
  ]
}
