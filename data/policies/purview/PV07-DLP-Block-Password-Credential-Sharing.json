{
  "_metadata": {
    "id": "PV07",
    "title": "DLP - Block Password and Credential Sharing",
    "description": "Data Loss Prevention policy using custom Sensitive Information Types and keyword lists to detect and block the sharing of passwords, API keys, bearer tokens, and secret keys in emails, documents, and chat messages across all M365 workloads.",
    "version": "1.0",
    "lastUpdated": "2026-02-27",
    "frameworks": [
      "NIS2",
      "ISO 27001:2022",
      "NIST SP 800-53 Rev.5",
      "SOC 2",
      "DORA",
      "FedRAMP Moderate",
      "HITRUST CSF v11",
      "CMMC v2.0",
      "PCI DSS v4.0",
      "NYDFS 23 NYCRR 500",
      "MITRE ATT&CK",
      "Microsoft Cloud Security Benchmark",
      "ASD Essential Eight",
      "CJIS v6"
    ],
    "cisChecks": [
      "9.1.2",
      "9.1.3"
    ],
    "mitreMappings": [
      "T1552.001",
      "T1552.004",
      "T1078",
      "T1048"
    ],
    "requiredLicences": [
      "Microsoft 365 E5 or E5 Compliance (for custom SITs)",
      "Microsoft Purview Data Loss Prevention add-on"
    ],
    "requiredRoles": [
      "Compliance Administrator",
      "Security Administrator"
    ],
    "deploymentOrder": 7,
    "importMethod": "powershell-security-compliance",
    "importScript": "scripts/Import-PurviewPolicies.ps1"
  },
  "_notes": {
    "prerequisites": [
      "Connect to Security & Compliance PowerShell: Connect-IPPSSession",
      "Custom SITs must be created before the DLP rule references them",
      "Keyword lists may generate false positives in IT documentation - tune as needed",
      "Deploy in TestWithNotifications mode initially"
    ],
    "deploymentSteps": [
      "1. Create the custom keyword dictionary SIT for credential patterns",
      "2. Create the custom regex SIT for structured credential patterns",
      "3. Create the DLP policy",
      "4. Create the detection rule referencing both built-in and custom SITs",
      "5. Test in simulation mode for 2 weeks",
      "6. Review false positives, especially from IT documentation",
      "7. Add exclusions for known safe sites (e.g., IT wiki, developer documentation)",
      "8. Switch to enforcement mode"
    ],
    "rollbackProcedure": "Set-DlpCompliancePolicy -Identity 'PV07-DLP-Block-Password-Sharing' -Mode Disable"
  },
  "powershellCommands": {
    "createCustomKeywordDictionary": {
      "cmdlet": "New-DlpKeywordDictionary",
      "parameters": {
        "Name": "PV07-CredentialKeywords",
        "Description": "Keyword dictionary for detecting credential sharing patterns",
        "FileData": null,
        "_keywords": [
          "password:",
          "password =",
          "password=",
          "passwd:",
          "passwd=",
          "api_key=",
          "api_key:",
          "apikey=",
          "apikey:",
          "api-key=",
          "api-key:",
          "secret_key=",
          "secret_key:",
          "secretkey=",
          "access_key=",
          "access_key:",
          "accesskey=",
          "bearer ",
          "Bearer ",
          "token:",
          "token=",
          "auth_token=",
          "client_secret=",
          "client_secret:",
          "private_key=",
          "encryption_key=",
          "database_password=",
          "db_password=",
          "smtp_password=",
          "ftp_password=",
          "-----BEGIN RSA PRIVATE KEY-----",
          "-----BEGIN PRIVATE KEY-----",
          "-----BEGIN EC PRIVATE KEY-----"
        ]
      }
    },
    "createCustomSensitiveInformationType": {
      "cmdlet": "New-DlpSensitiveInformationType",
      "parameters": {
        "Name": "PV07-Custom-CredentialPattern",
        "Description": "Detects structured credential patterns including API keys, tokens, and passwords in various formats",
        "SensitiveInformationTypeRulePackage": {
          "rules": [
            {
              "name": "API Key Pattern",
              "pattern": "(api[_-]?key|apikey|api[_-]?secret)\\s*[=:]\\s*['\"]?[A-Za-z0-9+/=_\\-]{20,}['\"]?",
              "confidence": 85,
              "proximity": 300
            },
            {
              "name": "Bearer Token Pattern",
              "pattern": "(Bearer|bearer)\\s+[A-Za-z0-9\\-._~+/]+=*",
              "confidence": 80,
              "proximity": 300
            },
            {
              "name": "Password Assignment Pattern",
              "pattern": "(password|passwd|pwd)\\s*[=:]\\s*['\"]?[^\\s'\"]{8,}['\"]?",
              "confidence": 75,
              "proximity": 300
            },
            {
              "name": "Connection String Password",
              "pattern": "(Password|pwd)\\s*=\\s*[^;\\s]{8,}",
              "confidence": 85,
              "proximity": 300
            },
            {
              "name": "AWS Access Key Pattern",
              "pattern": "AKIA[0-9A-Z]{16}",
              "confidence": 95,
              "proximity": 300
            },
            {
              "name": "Azure SAS Token Pattern",
              "pattern": "sig=[A-Za-z0-9%+/=]{40,}",
              "confidence": 80,
              "proximity": 300
            }
          ]
        }
      }
    },
    "createPolicy": {
      "cmdlet": "New-DlpCompliancePolicy",
      "parameters": {
        "Name": "PV07-DLP-Block-Password-Sharing",
        "Comment": "Blocks password and credential sharing in emails, documents, and chat messages. Prevents accidental credential exposure, a leading cause of cloud security incidents.",
        "ExchangeLocation": [
          "All"
        ],
        "SharePointLocation": [
          "All"
        ],
        "OneDriveLocation": [
          "All"
        ],
        "TeamsLocation": [
          "All"
        ],
        "Mode": "TestWithNotifications",
        "Priority": 6
      }
    },
    "createRule": {
      "cmdlet": "New-DlpComplianceRule",
      "parameters": {
        "Name": "PV07-Rule-Block-Credentials",
        "Policy": "PV07-DLP-Block-Password-Sharing",
        "ContentContainsSensitiveInformation": [
          {
            "name": "PV07-Custom-CredentialPattern",
            "minCount": 1,
            "minConfidence": 75,
            "maxConfidence": 100
          }
        ],
        "ContentContainsKeywordDictionary": {
          "Name": "PV07-CredentialKeywords",
          "minCount": 2,
          "_note": "Require at least 2 keyword matches to reduce false positives"
        },
        "BlockAccess": true,
        "BlockAccessScope": "All",
        "NotifyUser": [
          "SiteAdmin",
          "LastModifier"
        ],
        "NotifyPolicyTipCustomText": "This content appears to contain passwords, API keys, or authentication tokens. Sharing credentials in email, documents, or chat is a security violation. Use Azure Key Vault or your organisation's approved secrets management solution.",
        "GenerateIncidentReport": [],
        "IncidentReportContent": [
          "Title",
          "DocumentAuthor",
          "DocumentLastModifier",
          "Service",
          "MatchedItem",
          "RulesMatched",
          "Severity"
        ],
        "ReportSeverityLevel": "High"
      }
    }
  },
  "policySettings": {
    "mode": "TestWithNotifications",
    "priority": 6,
    "workloads": {
      "exchangeOnline": true,
      "sharePointOnline": true,
      "oneDriveForBusiness": true,
      "microsoftTeams": true
    }
  },
  "exclusions": {
    "_description": "Sites or groups to exclude from credential pattern detection to reduce false positives",
    "excludedSharePointSites": [],
    "_note": "Exclude IT documentation sites where credential patterns appear in instructional content. Review exclusions quarterly."
  }
}