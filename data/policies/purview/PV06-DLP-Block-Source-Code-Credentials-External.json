{
  "_metadata": {
    "id": "PV06",
    "title": "DLP - Block Source Code and Credentials External Sharing",
    "description": "Data Loss Prevention policy that detects and blocks source code credentials, API keys, cloud storage keys, GitHub tokens, private keys, and connection strings from being shared externally. Uses built-in SITs and custom regex patterns.",
    "version": "1.0",
    "lastUpdated": "2026-02-27",
    "frameworks": [
      "NIS2",
      "ISO 27001:2022",
      "NIST SP 800-53 Rev.5",
      "SOC 2",
      "GDPR (EU) 2016/679",
      "DORA",
      "FedRAMP Moderate",
      "HITRUST CSF v11",
      "CMMC v2.0",
      "NERC-CIP",
      "NYDFS 23 NYCRR 500",
      "MITRE ATT&CK",
      "Microsoft Cloud Security Benchmark",
      "SEC Cyber Rule",
      "EU Cyber Resilience Act"
    ],
    "cisChecks": [
      "9.1.2",
      "9.1.3"
    ],
    "mitreMappings": [
      "T1552.001",
      "T1552.004",
      "T1048",
      "T1567"
    ],
    "requiredLicences": [
      "Microsoft 365 E5 or E5 Compliance",
      "Microsoft Purview Data Loss Prevention add-on"
    ],
    "requiredRoles": [
      "Compliance Administrator",
      "Security Administrator"
    ],
    "deploymentOrder": 6,
    "importMethod": "powershell-security-compliance",
    "importScript": "scripts/Import-PurviewPolicies.ps1"
  },
  "_notes": {
    "prerequisites": [
      "Connect to Security & Compliance PowerShell: Connect-IPPSSession",
      "E5 Compliance or Purview DLP add-on required for custom SITs",
      "Custom SITs must be created before the DLP rule references them",
      "Deploy in TestWithNotifications mode initially"
    ],
    "deploymentSteps": [
      "1. Create custom Sensitive Information Types for credential patterns",
      "2. Create the DLP policy",
      "3. Create the credential detection rules",
      "4. Test in simulation mode for 2 weeks",
      "5. Review and tune false positives (especially for base64 patterns)",
      "6. Switch to enforcement mode"
    ],
    "rollbackProcedure": "Set-DlpCompliancePolicy -Identity 'PV06-DLP-Block-SourceCode-Credentials' -Mode Disable"
  },
  "powershellCommands": {
    "createCustomSensitiveInformationTypes": [
      {
        "cmdlet": "New-DlpSensitiveInformationType",
        "parameters": {
          "Name": "PV06-Custom-ConnectionString-Pattern",
          "Description": "Detects database and service connection strings containing credentials",
          "SensitiveInformationTypeRulePackage": {
            "rules": [
              {
                "pattern": "(Server|Data Source|Host)\\s*=\\s*[^;]+;\\s*(User Id|uid|Username)\\s*=\\s*[^;]+;\\s*(Password|pwd)\\s*=\\s*[^;\"']+",
                "confidence": 85,
                "proximity": 300
              },
              {
                "pattern": "mongodb(\\+srv)?://[^:]+:[^@]+@[^/]+",
                "confidence": 90,
                "proximity": 300
              }
            ]
          }
        }
      },
      {
        "cmdlet": "New-DlpSensitiveInformationType",
        "parameters": {
          "Name": "PV06-Custom-PrivateKey-Pattern",
          "Description": "Detects RSA/EC private keys and PEM-encoded certificates",
          "SensitiveInformationTypeRulePackage": {
            "rules": [
              {
                "pattern": "-----BEGIN (RSA |EC |DSA |OPENSSH )?PRIVATE KEY-----",
                "confidence": 95,
                "proximity": 300
              },
              {
                "pattern": "-----BEGIN CERTIFICATE-----",
                "confidence": 75,
                "proximity": 300
              }
            ]
          }
        }
      }
    ],
    "createPolicy": {
      "cmdlet": "New-DlpCompliancePolicy",
      "parameters": {
        "Name": "PV06-DLP-Block-SourceCode-Credentials",
        "Comment": "Blocks source code credentials, API keys, cloud storage keys, and private keys from external sharing. Protects against credential exfiltration.",
        "ExchangeLocation": [
          "All"
        ],
        "SharePointLocation": [
          "All"
        ],
        "OneDriveLocation": [
          "All"
        ],
        "TeamsLocation": [
          "All"
        ],
        "Mode": "TestWithNotifications",
        "Priority": 5
      }
    },
    "createRule": {
      "cmdlet": "New-DlpComplianceRule",
      "parameters": {
        "Name": "PV06-Rule-Block-Credentials-External",
        "Policy": "PV06-DLP-Block-SourceCode-Credentials",
        "ContentContainsSensitiveInformation": [
          {
            "name": "Azure Storage Account Key",
            "id": "c7bc98f8-d33a-4e36-93b9-cb10fe5a6f88",
            "minCount": 1,
            "minConfidence": 75,
            "maxConfidence": 100
          },
          {
            "name": "Azure Storage Account Shared Access Signature",
            "id": "66fa3f8a-db74-4c47-9a5c-8a0c0c6e2b5d",
            "minCount": 1,
            "minConfidence": 75,
            "maxConfidence": 100
          },
          {
            "name": "Amazon Web Services Access Key",
            "id": "be34c6f0-6e4b-48c4-b6c8-9c64246b4e6a",
            "minCount": 1,
            "minConfidence": 75,
            "maxConfidence": 100
          },
          {
            "name": "Amazon Web Services Secret Access Key",
            "id": "d2b5e4c8-7f3a-4e9d-b1c2-8a9f0e3d5c7b",
            "minCount": 1,
            "minConfidence": 75,
            "maxConfidence": 100
          },
          {
            "name": "GitHub Personal Access Token",
            "id": "6b2c8f4a-1d5e-4b7a-9c3f-2e8d0a6b4c1f",
            "minCount": 1,
            "minConfidence": 85,
            "maxConfidence": 100
          },
          {
            "name": "Azure AD Client Secret",
            "id": "3e8f2a1d-5b7c-4d9e-a6f0-1c4b8e2d7a3f",
            "minCount": 1,
            "minConfidence": 75,
            "maxConfidence": 100
          },
          {
            "name": "General Password",
            "id": "3a3c9f3e-5d7b-4c1a-8e2f-6b9d0a4c8e1f",
            "minCount": 1,
            "minConfidence": 65,
            "maxConfidence": 100
          },
          {
            "name": "PV06-Custom-ConnectionString-Pattern",
            "minCount": 1,
            "minConfidence": 85
          },
          {
            "name": "PV06-Custom-PrivateKey-Pattern",
            "minCount": 1,
            "minConfidence": 95
          }
        ],
        "AccessScope": "NotInOrganization",
        "BlockAccess": true,
        "BlockAccessScope": "ExternalUsers",
        "NotifyUser": [
          "SiteAdmin",
          "LastModifier"
        ],
        "NotifyPolicyTipCustomText": "This content appears to contain credentials, API keys, or private keys. External sharing is blocked to prevent credential exposure. Use Azure Key Vault or a secrets manager instead.",
        "GenerateIncidentReport": [],
        "IncidentReportContent": [
          "Title",
          "DocumentAuthor",
          "DocumentLastModifier",
          "Service",
          "MatchedItem",
          "RulesMatched",
          "Severity"
        ],
        "ReportSeverityLevel": "High"
      }
    }
  },
  "policySettings": {
    "mode": "TestWithNotifications",
    "priority": 5,
    "workloads": {
      "exchangeOnline": true,
      "sharePointOnline": true,
      "oneDriveForBusiness": true,
      "microsoftTeams": true
    }
  },
  "overrideSettings": {
    "allowOverride": false,
    "_note": "Credentials must never be shared externally. No override permitted."
  }
}