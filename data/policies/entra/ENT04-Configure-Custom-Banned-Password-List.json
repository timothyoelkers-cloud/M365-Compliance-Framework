{
  "_metadata": {
    "id": "ENT04",
    "title": "Configure Custom Banned Password List",
    "description": "Configures Entra ID Password Protection with a custom banned password list containing organisation-specific terms (company name, product names, common weak passwords). Enforces the banned list for both cloud and on-premises Active Directory password changes.",
    "version": "1.0",
    "lastUpdated": "2026-02-27",
    "frameworks": [
      "NIS2",
      "ISO 27001:2022",
      "NIST SP 800-53 Rev.5",
      "UK NCSC CAF v3.2",
      "SOC 2",
      "GDPR (EU) 2016/679",
      "FedRAMP Moderate",
      "HITRUST CSF v11",
      "BSI IT-Grundschutz",
      "DORA",
      "CMMC v2.0",
      "NERC-CIP",
      "ASD Essential Eight",
      "MITRE ATT&CK",
      "CJIS v6",
      "EU Cyber Resilience Act"
    ],
    "cisChecks": [
      "5.2.3.2",
      "5.2.3.3"
    ],
    "mitreMappings": [
      "T1110.001",
      "T1110.003",
      "T1078"
    ],
    "requiredLicences": [
      "Microsoft Entra ID P1 or P2 (for custom banned password list)",
      "Microsoft 365 E3 or E5 (includes Entra ID P1/P2)"
    ],
    "requiredRoles": [
      "Global Administrator",
      "Security Administrator"
    ],
    "deploymentOrder": 4,
    "importMethod": "powershell-graph",
    "importScript": "scripts/Import-EntraSettings.ps1"
  },
  "_notes": {
    "prerequisites": [
      "Entra ID P1 or P2 licence required for custom banned passwords",
      "Maximum 1000 entries in the custom banned password list",
      "Each entry must be between 4 and 16 characters",
      "For on-premises enforcement, Azure AD Password Protection proxy and DC agents must be installed",
      "The global banned password list is always enforced automatically (no configuration needed)"
    ],
    "deploymentSteps": [
      "1. Compile the custom banned password list (company-specific terms)",
      "2. Apply the Graph API PATCH to configure password protection settings",
      "3. Set on-premises mode to Enforce (if hybrid AD environment)",
      "4. For on-prem: Install Azure AD Password Protection proxy on a domain-joined server",
      "5. For on-prem: Install the DC agent on all domain controllers",
      "6. Verify enforcement by attempting a password change with a banned term"
    ],
    "rollbackProcedure": "PATCH the settings to set enableBannedPasswordCheck to false or switch bannedPasswordCheckOnPremisesMode to 'Audit'."
  },
  "graphApiCalls": [
    {
      "stepOrder": 1,
      "description": "Configure custom banned password list and enable enforcement",
      "method": "PATCH",
      "endpoint": "https://graph.microsoft.com/v1.0/settings/",
      "headers": {
        "Content-Type": "application/json",
        "Authorization": "Bearer "
      },
      "body": {
        "values": [
          {
            "name": "BannedPasswordCheckOnPremisesMode",
            "value": "Enforce"
          },
          {
            "name": "EnableBannedPasswordCheck",
            "value": "true"
          },
          {
            "name": "CustomBannedPasswords",
            "value": "\n\n\n\npassword\nwelcome\nqwerty\nletmein\nchangeme\nadmin123\nsummer\nwinter\nautumn\nspring\nmonday\nfootball\nbaseball"
          },
          {
            "name": "EnableBannedPasswordCheckOnPremises",
            "value": "true"
          }
        ]
      },
      "_explanation": "Enables the custom banned password list with organisation-specific terms. Passwords containing these terms (including fuzzy matching variations) will be rejected. Newline-separated values in CustomBannedPasswords."
    },
    {
      "stepOrder": 2,
      "description": "Verify password protection settings",
      "method": "GET",
      "endpoint": "https://graph.microsoft.com/v1.0/settings",
      "filter": "templateId eq '5cf42378-d67d-4f36-ba46-e8b86229381d'",
      "expectedResponse": {
        "values": {
          "EnableBannedPasswordCheck": "true",
          "BannedPasswordCheckOnPremisesMode": "Enforce"
        }
      }
    }
  ],
  "powershellAlternative": {
    "module": "Microsoft.Graph",
    "commands": [
      {
        "description": "Connect to Microsoft Graph",
        "command": "Connect-MgGraph -Scopes 'Directory.ReadWrite.All'"
      },
      {
        "description": "Get the current password protection settings ID",
        "command": "$settings = Get-MgDirectorySetting | Where-Object { $_.TemplateId -eq '5cf42378-d67d-4f36-ba46-e8b86229381d' }"
      },
      {
        "description": "Update custom banned passwords",
        "command": "Update-MgDirectorySetting -DirectorySettingId $settings.Id -Values @(@{Name='EnableBannedPasswordCheck'; Value='true'}, @{Name='BannedPasswordCheckOnPremisesMode'; Value='Enforce'}, @{Name='CustomBannedPasswords'; Value=\"`n`npassword`nwelcome`nqwerty`nletmein`nchangeme\"})"
      }
    ]
  },
  "entraPortalPath": {
    "navigation": "Entra admin center > Protection > Authentication methods > Password protection",
    "settings": {
      "customBannedPasswords": "Enabled",
      "customList": [
        "password",
        "welcome",
        "qwerty",
        "letmein",
        "changeme"
      ],
      "enablePasswordProtectionOnWindoesServerActiveDirectory": true,
      "mode": "Enforced"
    }
  },
  "customBannedPasswordList": {
    "_description": "Replace placeholders with actual organisation-specific terms. Maximum 1000 entries, 4-16 characters each.",
    "organisationSpecific": [],
    "commonWeakPasswords": [
      "password",
      "welcome",
      "qwerty",
      "letmein",
      "changeme",
      "admin123",
      "temp1234",
      "summer",
      "winter",
      "autumn",
      "spring",
      "monday",
      "football",
      "baseball",
      "shadow",
      "master"
    ],
    "_note": "Entra ID applies fuzzy matching: 'company' also blocks 'c0mp@ny', 'COMPANY', 'Company123', etc."
  }
}