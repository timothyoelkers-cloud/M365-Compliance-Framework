{
  "_metadata": {
    "id": "DEF07",
    "title": "Defender for SharePoint, OneDrive, and Teams",
    "description": "Enables Microsoft Defender for Office 365 file scanning for SharePoint Online, OneDrive for Business, and Microsoft Teams. Enables Safe Documents for Office clients. Prevents users from opening files flagged as malicious in Safe Documents.",
    "frameworks": [
      "CIS Microsoft 365 v3.1.0",
      "NIST SP 800-53 Rev 5",
      "MITRE ATT&CK T1080",
      "NIS2",
      "DORA",
      "ISO 27001:2022",
      "UK NCSC CAF v3.2",
      "SOC 2",
      "PCI DSS v4.0",
      "HIPAA",
      "HITRUST CSF v11",
      "CMMC v2.0",
      "FedRAMP Moderate",
      "GDPR (EU) 2016/679",
      "ASD Essential Eight",
      "Microsoft Cloud Security Benchmark"
    ],
    "cisChecks": ["2.1.12", "2.1.13"],
    "severity": "High",
    "category": "Defender for Office 365",
    "deploymentOrder": 7,
    "requiredLicence": "Microsoft Defender for Office 365 Plan 1 or Plan 2 (Safe Documents requires E5 or Defender P2)",
    "version": "2.0",
    "lastUpdated": "2026-02-27",
    "_notes": "This is a tenant-wide setting using Set-AtpPolicyForO365 (not a policy/rule pair). EnableATPForSPOTeamsODB scans files uploaded to SharePoint/OneDrive/Teams for malware. EnableSafeDocs sends Protected View documents to the cloud for sandbox analysis. AllowSafeDocsOpen: false prevents users from bypassing Safe Documents warnings. Safe Documents requires Microsoft 365 E5 or Defender for Office 365 Plan 2."
  },
  "cmdlet": "Set-AtpPolicyForO365",
  "parameters": {
    "EnableATPForSPOTeamsODB": true,
    "EnableSafeDocs": true,
    "AllowSafeDocsOpen": false
  },
  "postDeployment": [
    "Get-AtpPolicyForO365 | Format-List",
    "Verify licensing: Safe Documents requires Microsoft 365 E5 or Defender for Office 365 Plan 2",
    "Test by uploading an EICAR test file to a SharePoint document library and verifying it is blocked",
    "Note: There may be a delay of up to 30 minutes before scanning becomes active after enabling"
  ]
}
