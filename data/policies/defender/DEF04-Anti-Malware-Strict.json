{
  "_metadata": {
    "id": "DEF04",
    "title": "Anti-Malware Policy - Strict",
    "description": "Strict anti-malware policy for Exchange Online. Enables the common attachment types filter to block 70+ dangerous file extensions. Enables ZAP for retroactive malware removal. Sends internal admin notifications for malware detections.",
    "frameworks": [
      "CIS Microsoft 365 v3.1.0",
      "NIST SP 800-53 Rev 5",
      "MITRE ATT&CK T1204",
      "NIS2",
      "DORA",
      "ISO 27001:2022",
      "UK NCSC CAF v3.2",
      "SOC 2",
      "PCI DSS v4.0",
      "HIPAA",
      "HITRUST CSF v11",
      "CMMC v2.0",
      "FedRAMP Moderate",
      "GDPR (EU) 2016/679",
      "ASD Essential Eight",
      "Microsoft Cloud Security Benchmark"
    ],
    "cisChecks": [
      "2.1.1",
      "2.1.3"
    ],
    "severity": "High",
    "category": "Defender for Office 365",
    "deploymentOrder": 4,
    "requiredLicence": "Exchange Online Protection (included with Microsoft 365)",
    "version": "2.0",
    "lastUpdated": "2026-02-27",
    "_notes": "EOP is included with all Microsoft 365 plans. This policy creates a new malware filter policy and rule. The file type filter blocks common malicious extensions at the transport layer before they reach the user mailbox. ZAP retroactively removes malware discovered after delivery. InternalSenderAdminNotifications alert the security team when internal users send malware (possible compromise indicator)."
  },
  "steps": [
    {
      "cmdlet": "New-MalwareFilterPolicy",
      "parameters": {
        "Name": "Strict Anti-Malware Policy",
        "EnableFileFilter": true,
        "FileTypeAction": "Reject",
        "FileTypes": [
          "ace",
          "apk",
          "app",
          "appx",
          "ani",
          "arj",
          "bat",
          "cab",
          "cmd",
          "com",
          "deb",
          "dex",
          "dll",
          "docm",
          "elf",
          "exe",
          "hta",
          "img",
          "iso",
          "jar",
          "jnlp",
          "kext",
          "lha",
          "lib",
          "library",
          "lnk",
          "lzh",
          "macho",
          "msc",
          "msi",
          "msix",
          "msp",
          "mst",
          "pif",
          "ppa",
          "ppam",
          "reg",
          "rev",
          "scf",
          "scr",
          "sh",
          "sys",
          "vb",
          "vbe",
          "vbs",
          "vxd",
          "wsc",
          "wsf",
          "wsh",
          "xll",
          "xz",
          "ps1",
          "ps2",
          "js",
          "jse",
          "wsh",
          "xlam",
          "xla",
          "dotm",
          "sldm",
          "potm",
          "ppsm",
          "xlsm"
        ],
        "ZapEnabled": true,
        "EnableInternalSenderAdminNotifications": true,
        "InternalSenderAdminAddress": "",
        "EnableExternalSenderAdminNotifications": false,
        "QuarantineTag": "AdminOnlyAccessPolicy",
        "EnableInternalSenderNotifications": false,
        "EnableExternalSenderNotifications": false,
        "CustomNotifications": false
      }
    },
    {
      "cmdlet": "New-MalwareFilterRule",
      "parameters": {
        "Name": "Strict Anti-Malware Rule - All Recipients",
        "MalwareFilterPolicy": "Strict Anti-Malware Policy",
        "RecipientDomainIs": [],
        "Enabled": true,
        "Priority": 0
      }
    }
  ],
  "postDeployment": [
    "Get-MalwareFilterPolicy -Identity 'Strict Anti-Malware Policy' | Format-List",
    "Get-MalwareFilterRule -Identity 'Strict Anti-Malware Rule - All Recipients' | Format-List",
    "Replace  with the actual security operations mailbox",
    "Test by sending an EICAR test file to verify detection and quarantine behavior",
    "Review FileTypes list and add any organization-specific extensions that should be blocked"
  ]
}