{
  "_metadata": {
    "id": "DEF03",
    "title": "Safe Attachments - Strict (Dynamic Delivery)",
    "description": "Enables Safe Attachments with Dynamic Delivery mode. Email bodies are delivered immediately while attachments are sandboxed and scanned. Malicious attachments are blocked after detonation. ActionOnError ensures messages are not delivered if scanning fails.",
    "frameworks": [
      "CIS Microsoft 365 v3.1.0",
      "NIST SP 800-53 Rev 5",
      "MITRE ATT&CK T1566.001",
      "NIS2",
      "DORA",
      "ISO 27001:2022",
      "UK NCSC CAF v3.2",
      "SOC 2",
      "PCI DSS v4.0",
      "HIPAA",
      "HITRUST CSF v11",
      "CMMC v2.0",
      "FedRAMP Moderate",
      "GDPR (EU) 2016/679",
      "ASD Essential Eight",
      "Microsoft Cloud Security Benchmark"
    ],
    "cisChecks": [
      "2.1.4",
      "2.1.12",
      "2.1.13"
    ],
    "severity": "High",
    "category": "Defender for Office 365",
    "deploymentOrder": 3,
    "requiredLicence": "Microsoft Defender for Office 365 Plan 1 or Plan 2",
    "version": "2.0",
    "lastUpdated": "2026-02-27",
    "_notes": "Requires Defender for Office 365 P1/P2. Dynamic Delivery sends the message body immediately and replaces attachments with a placeholder until scanning completes. This minimizes user disruption while still providing sandbox detonation. ActionOnError: true blocks delivery if the scanning service is unavailable."
  },
  "steps": [
    {
      "cmdlet": "New-SafeAttachmentPolicy",
      "parameters": {
        "Name": "Safe Attachments - Dynamic Delivery",
        "Action": "DynamicDelivery",
        "Enable": true,
        "ActionOnError": true,
        "Redirect": false,
        "RedirectAddress": "",
        "QuarantineTag": "AdminOnlyAccessPolicy"
      }
    },
    {
      "cmdlet": "New-SafeAttachmentRule",
      "parameters": {
        "Name": "Safe Attachments Rule - All Recipients",
        "SafeAttachmentPolicy": "Safe Attachments - Dynamic Delivery",
        "RecipientDomainIs": [],
        "Enabled": true,
        "Priority": 0
      }
    }
  ],
  "postDeployment": [
    "Get-SafeAttachmentPolicy -Identity 'Safe Attachments - Dynamic Delivery' | Format-List",
    "Get-SafeAttachmentRule -Identity 'Safe Attachments Rule - All Recipients' | Format-List",
    "Send a test email with a benign attachment to verify Dynamic Delivery behavior (placeholder shown, then replaced with scanned attachment)",
    "If redirect to a security mailbox is desired, set Redirect: true and populate RedirectAddress"
  ]
}